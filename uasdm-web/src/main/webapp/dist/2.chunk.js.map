{"version":3,"sources":["webpack:///./src/app/site/service/map.service.ts","webpack:///./src/app/site/component/map-attribute/map-attribute.component.html","webpack:///./src/app/site/component/map-attribute/map-attribute.component.ts","webpack:///./src/app/site/service/management.service.ts","webpack:///./src/app/site/component/modal/image-preview-modal.component.html","webpack:///./src/app/site/component/modal/image-preview-modal.component.ts","webpack:///./src/app/site/model/management.ts","webpack:///./src/app/site/model/sensor.ts","webpack:///./src/app/site/directive/number-only.directive.ts","webpack:///./src/app/site/component/modal/metadata-modal.component.html","webpack:///./src/app/site/component/modal/metadata-modal.component.ts","webpack:///./src/app/site/model/metadata.ts","webpack:///./src/app/site/service/metadata.service.ts","webpack:///./src/app/site/component/modal/leaf-modal.component.html","webpack:///./src/app/site/component/modal/leaf-modal.component.ts","webpack:///./src/app/site/service/product.service.ts","webpack:///./src/app/site/component/modal/product-modal.component.html","webpack:///./src/app/site/component/modal/product-modal.component.ts","webpack:///./src/app/site/component/product-panel/product-panel.component.html","webpack:///./src/app/site/component/product-panel/product-panel.component.ts","webpack:///./src/app/site/component/modal/entity-modal.component.html","webpack:///./src/app/site/component/modal/entity-modal.component.ts","webpack:///./src/app/site/component/modal/upload-modal.component.html","webpack:///./src/app/site/component/modal/upload-modal.component.ts","webpack:///./src/app/site/component/modal/accessible-support-modal.component.html","webpack:///./src/app/site/component/modal/accessible-support-modal.component.ts","webpack:///./src/app/site/component/projects.component.html","webpack:///./src/app/site/component/projects.component.ts","webpack:///./src/app/site/component/upload.component.html","webpack:///./src/app/site/component/upload.component.ts","webpack:///./src/app/site/component/tasks/tasks-panel.component.html","webpack:///./src/app/site/component/tasks/tasks-panel.component.ts","webpack:///./src/app/site/component/tasks.component.html","webpack:///./src/app/site/component/tasks.component.ts","webpack:///./src/app/site/service/sensor.service.ts","webpack:///./src/app/site/component/sensor/sensor.component.html","webpack:///./src/app/site/component/sensor/sensor.component.ts","webpack:///./src/app/site/component/sensor/sensors.component.html","webpack:///./src/app/site/component/sensor/sensors.component.ts","webpack:///./src/app/site/service/platform.service.ts","webpack:///./src/app/site/component/platform/platform.component.html","webpack:///./src/app/site/component/platform/platform.component.ts","webpack:///./src/app/site/component/platform/platforms.component.html","webpack:///./src/app/site/component/platform/platforms.component.ts","webpack:///./src/app/site/directive/forbidden-name.directive.ts","webpack:///./src/app/site/service/can.deactivate.guard.service.ts","webpack:///./src/app/site/site-routing.module.ts","webpack:///./src/app/site/site.module.ts"],"names":["mapboxKey","http","params","this","get","acp","toPromise","searchText","url","mapService","baseLayers","label","id","selected","center","zoom","coordinate","longitude","latitude","search","dataSource","Observable","create","observer","mbForwardGeocode","then","response","match","features","results","forEach","obj","newObj","hierarchy","place_name","source","push","next","refreshCoordinateFromMap","config","container","style","site","geometry","coordinates","map","on","initMap","remove","modes","static","draw","displayControlsDefault","controls","addControl","$event","onDrawUpdate","onDrawCreate","addLayers","feature","type","properties","oid","name","add","changeMode","featureIds","addSource","data","event","action","length","updateGeometry","console","log","ids","set","layer","baseLayer","setStyle","result","item","flyTo","handleClick","preventDefault","refreshCoordinateFromInput","noErrorHttpClient","eventService","authService","key","pageNumber","pageSize","toString","bounds","JSON","stringify","headers","start","post","pipe","finalize","complete","excludes","entity","parentId","getUserName","componentId","uploadId","folder","file","formData","FormData","append","statuses","token","useSpinner","responseType","terms","debounceTime","distinctUntilChanged","switchMap","term","searchEntries","metaObj","json","condition","value","isAdmin","ImagePreviewModalComponent","service","bsModalRef","message","open","loading","component","getImage","image","reader","FileReader","addEventListener","imageToShow","readAsDataURL","download","subscribe","blob","createImageFromBlob","error","err","localizedMessage","SiteObjectsResultSet","WAVELENGTHS","OnlyNumber","el","e","indexOf","keyCode","ctrlKey","shiftKey","disabled","metaObject","collectionId","pointOfContact","email","platform","otherName","class","serialNumber","faaIdNumber","sensor","model","wavelength","sensorWidth","sensorHeight","pixelSizeWidth","pixelSizeHeight","upload","dataType","sensors","platforms","wavelengths","otherSensorId","otherPlatformId","onMetadataChange","Subject","getMetadataOptions","options","handleSensorSelect","handlePlatformSelect","catch","getSelectedSensor","sensorType","waveLength","getSelectedPlatform","platformType","findIndex","i","checked","splice","submitCollectionMetadata","hide","handleSubmit","Metadata","root","leaf","drillable","expandable","uploadable","processable","childLabel","cache","fieldName","metadataService","modalService","previous","folders","thumbnails","processRunning","enableSelectableImages","showOrthoRerunMessage","constPageSize","page","video","src","context","ins","init","onNodeChange","count","onSelect","isProcessable","imageData","rootPath","substr","lastIndexOf","fileName","exec","lastPeriod","thumbKey","getData","pn","ps","getObjects","resultSet","isImage","getThumbnail","excludeFromProcess","toLowerCase","position","stopPropagation","confirmModalRef","show","animated","backdrop","ignoreBackdropClick","content","submitText","onConfirm","runOrtho","setTimeout","statusMessage","window","location","href","modalRef","metadataUploaded","pService","items","showSite","product","imageKey","pDocument","entities","getDetail","detail","target","breadcrumbs","getItems","nodes","initData","rawImagePreviewModal","mService","toggleMapImage","products","changes","refreshProducts","currentValue","getProducts","emit","filter","n","togglePublish","p","mapIt","orthoMapped","workspace","mapKey","published","userName","admin","newInstance","attributes","applyWithParent","update","node","attribute","readonly","evaluate","differs","objectKeys","Object","keys","importedValues","values","uploader","taskStatusMessages","currentTask","finishedTask","existingTask","pollingIsSet","uploadVisible","selectedContinue","uploadCounter","showFileSelectPanel","taskFinishedNotifications","selections","labels","pages","index","selection","hierarchyChange","modalStepConfig","differ","find","elem","that","uiOptions","debug","autoUpload","multiple","element","nativeElement","template","request","endpoint","forceMultipart","resume","enabled","recordsExpireIn","chunking","retry","enableAuto","text","defaultResponseError","failedUploadTextDisplay","mode","validation","allowedExtensions","showMessage","callbacks","onUpload","countUpload","onProgress","uploadedBytes","totalBytes","onUploadChunk","chunkData","onUploadChunkSuccess","responseJSON","xhr","taskPolling","interval","task","onComplete","xhrOrXdr","isNew","unsubscribe","clearStoredFiles","clearInterval","uplodeCounterInterfal","success","onUploadComplete","onCancel","removeTask","onError","errorReason","diff","setExistingTask","onHierarchyChange","getHierarchy","getChildren","children","child","getResumableFilesData","hasField","uploads","getUploads","collection","nextPage","updateCurrentPageLabel","prevPage","steps","step","uploadStoredFiles","uploadTarget","getUploadTarget","setParams","hasExtraField","uuid","localStorage","clear","thisRef","ct","setInterval","hours","Math","floor","minutes","seconds","hoursStr","minutesStr","secondsStr","returnValue","close","files","droppedFile","fileEntry","isFile","refresh","relativePath","removeObject","supportingData","worker","active","layers","baselayerIconHover","tasks","subject","handleExtentChange","searchEntites","isWorker","getCurrentUser","baseUrl","hostname","port","notifier","webSocket","attributionControl","compact","coord","lngLat","wrap","lat","lng","document","getElementById","textContent","queryRenderedFeatures","point","current","focusFeatureId","setFilter","highlightListItem","clearHighlightListItem","addLayer","addImageLayer","getBounds","isValidBounds","roots","ne","getNorthEast","sw","getSouthWest","abs","getSource","setData","bbox","fitBounds","padding","idx","setNodes","parent","newChild","getCenter","getZoom","edit","refreshEntity","getMetadata","sText","subText","numberOfChildren","highlightMapFeature","clearHighlightMapFeature","hoverFeatureId","handleViewSite","view","select","getLayer","removeLayer","removeSource","boundingBox","wkspace","encodeURI","layerName","getTypeContainsFolders","showLeafModal","addBreadcrumb","expand","staticTabs","tabs","sites","projects","missions","collections","hideUploadPanel","siteId","project","mission","projectId","missionId","uasComponentOid","trim","showUploadPanel","managementService","showUploads","showProcess","showStore","showODMOutput","showError","taskGroups","taskGroupType","actions","deleteTask","pos","totalTaskCount","activeTab","taskPage","errorStatuses","completeStatuses","messages","collectionGroups","from","updateTaskData","setTaskData","getMissingMetadata","updatePage","tab","parentNode","classList","contains","lis","getElementsByTagName","li","cls","addOnly","collectPosition","group","collectionLabel","groups","status","lastUpdatedDate","ancestors","taskGroupTypeIndex","setTaskGroupStatuses","collectionGroup","isError","isWorking","isWarning","sortedTasks","sort","a","b","Date","getTime","noMatch","newTask","matchFound","existingTaskGrp","existingGroup","lastUpdateDate","odmOutput","onMessagePageChange","onTabClick","waveLengths","onSensorChange","apply","unlock","router","localizeService","res","h","showModal","onPageChange","onPlatformChange","ForbiddenNameDirective","control","nameRe","RegExp","test","provide","useExisting","multi","CanDeactivateGuardService","canDeactivate","confirm","routes","path","canActivate","SiteRoutingModule","useClass","forChild","SiteModule","forRoot"],"mappings":"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","file":"2.chunk.js","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\n\r\nimport { map } from 'rxjs/operators';\r\n// import 'rxjs/add/operator/toPromise';\r\nimport { finalize } from 'rxjs/operators';\r\n\r\nimport { GeoJSONSource } from 'mapbox-gl';\r\n\r\nimport * as mapboxgl from 'mapbox-gl';\r\n\r\n\r\nconst mapboxKey = 'pk.eyJ1IjoidGVycmFmcmFtZSIsImEiOiJjanZxNTFnaTYyZ2RuNDlxcmNnejNtNjN6In0.-kmlS8Tgb2fNc1NPb5rJEQ';\r\n\r\n\r\ndeclare var acp: any;\r\n\r\n@Injectable()\r\nexport class MapService {\r\n\r\n    constructor( private http: HttpClient ) {\r\n        ( mapboxgl as any ).accessToken = mapboxKey;\r\n    }\r\n\r\n    features(): Promise<{ features: GeoJSONSource, bbox: number[] }> {\r\n        let params: HttpParams = new HttpParams();\r\n\r\n        return this.http\r\n            .get<{ features: GeoJSONSource, bbox: number[] }>( acp + '/project/features', { params: params } )\r\n            .toPromise()\r\n    }\r\n\r\n    mbForwardGeocode(searchText: string): Promise<any> {\r\n        let params: HttpParams = new HttpParams();\r\n\r\n        let url = \"https://api.mapbox.com/geocoding/v5/mapbox.places/\"+ searchText +\".json?proximity=-74.70850,40.78375&access_token=\"+ mapboxKey;\r\n\r\n        return this.http\r\n            .get( url, { params: params } )\r\n            .toPromise()\r\n    }\r\n\r\n}","<div class=\"row-holder\">\n    <div class=\"label-holder\"></div>\n    <div class=\"holder\">\n    <div class=\"modal-body\">\n      <div id=\"search-container\" style=\"position: absolute;z-index: 999;padding: 15px;width: 35%;\">\n        <input class=\"form-control search-input\" type=\"text\" placeholder=\"Search...\" [(ngModel)]=\"search\"\n                          [typeaheadAsync]=\"true\" [typeahead]=\"dataSource\" (typeaheadOnSelect)=\"handleClick($event)\"\n                          [typeaheadOptionsLimit]=\"10\" [typeaheadItemTemplate]=\"bsItemTemplate\" typeaheadOptionField=\"label\"\n                          [ngModelOptions]=\"{standalone: true}\" (keydown.enter)=\"$event.preventDefault()\" />\n      </div>\n\t\t  <div id=\"map-attribute-div\" class=\"map-view-port\" style=\"height:300px;\"></div>\n    </div>\n  </div>\n</div>\n<div class=\"row-holder\">\n    <div class=\"label-holder\"><label>Longitude</label></div>\n    <div class=\"holder\">\n    <div class=\"modal-body text-left\">\n      <input name=\"longitude\" type=\"number\" class=\"form-control\" [(ngModel)]=\"coordinate.longitude\" (change)=\"refreshCoordinateFromInput()\" required />\n    </div>\n  </div>\n</div>\n<div class=\"row-holder\">\n    <div class=\"label-holder\"><label>Latitude</label></div>\n    <div class=\"holder\">\n    <div class=\"modal-body text-left\">\n      <input name=\"latitude\" type=\"number\" class=\"form-control\" [(ngModel)]=\"coordinate.latitude\" (change)=\"refreshCoordinateFromInput()\" required />\n    </div>\n  </div>\n</div>\n\n<ng-template #bsItemTemplate let-match=\"match\" let-query=\"query\">\n  <span *ngIf=\"match.item.filename == null\">\n    <i class=\"fa fa-folder-open\"></i>\n  </span>\n  <span *ngIf=\"match.item.filename != null\">\n    <i class=\"fa fa-file\"></i>\n  </span>\n  <span>\n    <span *ngFor=\"let site of match.item.hierarchy; index as i\">\n        {{site.label}} /\n        <!-- <span *ngIf=\"i < (match.item.hierarchy.length -1)\">/</span> -->\n    </span>\n  </span>\n  <b>{{ match.item.label}}</b>\n</ng-template>","import { Component, OnInit, OnDestroy, AfterViewInit, Input } from '@angular/core';\nimport { Map, LngLat, NavigationControl, ImageSource, MapboxOptions } from 'mapbox-gl';\nimport * as MapboxDraw from '@mapbox/mapbox-gl-draw';\nimport * as StaticMode from '@mapbox/mapbox-gl-draw-static-mode';\nimport { Observable } from 'rxjs';\n\n\nimport { SiteEntity } from '../../model/management';\nimport { MapService } from '../../service/map.service';\n\n\n@Component( {\n    selector: 'map-attribute',\n    templateUrl: './map-attribute.component.html',\n    styles: [],\n} )\nexport class MapAttributeComponent implements OnInit, AfterViewInit, OnDestroy {\n\n    /* \n     * mapbox-gl map\n     */\n    map: Map;\n\n    /* \n     * Draw control\n     */\n    draw: MapboxDraw;\n\n    /* \n     * List of base layers\n     */\n    baseLayers: any[] = [{\n        label: 'Outdoors',\n        id: 'outdoors-v11',\n        selected: true\n    }, {\n        label: 'Satellite',\n        id: 'satellite-v9'\n    }, {\n        label: 'Streets',\n        id: 'streets-v11'\n    }];\n\n    @Input() site: SiteEntity;\n\n    @Input() center: LngLat = new LngLat( -78.880453, 42.897852 );\n    @Input() zoom: number = 2;\n\n    coordinate: {\n        longitude: number,\n        latitude: number\n    } = { longitude: null, latitude: null };\n\n    /* \n     * Datasource to get search responses\n     */\n    dataSource: Observable<any>;\n\n    /* \n     * Model for text being searched\n     */\n    search: string = \"\";\n\n    constructor( private mapService: MapService ) { \n        this.dataSource = Observable.create(( observer: any ) => {\n\n            this.mapService.mbForwardGeocode( this.search ).then( response => {\n                const match = response.features;\n                let results = [];\n\n                // Add Mapbox results to any local results\n                match.forEach( obj => {\n                    let newObj = {\n                        id: obj.id,\n                        hierarchy: [],\n                        label: obj.place_name,\n                        center: obj.center,\n                        source: \"MAPBOX\"\n                    }\n\n                    results.push( newObj );\n                } );\n\n                observer.next( results );\n            } );\n        } );\n    }\n\n    ngOnInit(): void {\n        this.refreshCoordinateFromMap();\n    }\n\n    ngAfterViewInit() {\n\n        // setTimeout(() => {\n        //     if ( this.tree ) {\n        //         this.tree.treeModel.expandAll();\n        //     }\n        // }, 1000 );\n\n        let config: MapboxOptions = {\n            container: 'map-attribute-div',\n            style: 'mapbox://styles/mapbox/outdoors-v11',\n            zoom: this.zoom,\n            center: this.center\n        };\n\n        if ( this.site.geometry != null ) {\n            //                    config.zoom = 10;\n            config.center = this.site.geometry.coordinates;\n        }\n\n\n        this.map = new Map( config );\n\n        this.map.on( 'load', () => {\n            this.initMap();\n        } );\n    }\n\n    ngOnDestroy(): void {\n        this.map.remove();\n    }\n\n    initMap(): void {\n\n        let modes = MapboxDraw.modes;\n        modes.static = StaticMode;\n\n        this.draw = new MapboxDraw( {\n            modes: modes,\n            displayControlsDefault: false,\n            controls: {\n                static: true\n            }\n        } );\n\n        this.map.addControl( this.draw );\n\n        // Add zoom and rotation controls to the map.\n        this.map.addControl( new NavigationControl() );\n\n        this.map.on( \"draw.update\", ( $event ) => { this.onDrawUpdate( $event ) } );\n        this.map.on( \"draw.create\", ( $event ) => { this.onDrawCreate( $event ) } );\n        this.map.on( \"draw.modechange\", ( $event ) => { this.onDrawUpdate( $event ) } );\n\n        this.map.on( 'style.load', () => {\n            this.addLayers();\n            //            this.refresh( false );\n        } );\n\n        this.addLayers();\n    }\n\n\n    addLayers(): void {\n\n        if ( this.site.geometry != null ) {\n            let feature = {\n                id: this.site.id,\n                type: 'Feature',\n                properties: {\n                    oid: this.site.id,\n                    name: this.site.name\n                },\n                geometry: this.site.geometry\n            };\n\n            this.draw.add( feature );\n            this.draw.changeMode( 'simple_select', { featureIds: [feature.id] } );\n        }\n        else {\n            this.draw.changeMode( 'draw_point', {} );\n        }\n\n        this.map.addSource( 'sites', {\n            type: 'geojson',\n            data: {\n                \"type\": \"FeatureCollection\",\n                \"features\": []\n            }\n        } );\n    }\n\n    onDrawUpdate( event: any ): void {\n        if ( event.action === 'move' && event.features != null && event.features.length > 0 ) {\n            this.updateGeometry( event.features[0] )\n        }\n    }\n\n    onDrawCreate( event: any ): void {\n        if ( event.features != null && event.features.length > 0 ) {\n\n            let feature = event.features[0];\n            feature.id = this.site.id;\n\n            this.updateGeometry( feature )\n        }\n    }\n\n    updateGeometry( feature: any ): void {\n        this.site.geometry = feature.geometry;\n\n        this.refreshCoordinateFromMap();\n    }\n\n    refreshCoordinateFromMap(): void {\n        if ( this.site != null && this.site.geometry != null ) {\n            this.coordinate.longitude = this.site.geometry.coordinates[0];\n            this.coordinate.latitude = this.site.geometry.coordinates[1];\n        }\n    }\n\n    refreshCoordinateFromInput(): void {\n        if ( this.coordinate.longitude != null && this.coordinate.latitude != null ) {\n            console.log( this.site.geometry );\n\n            if ( this.site.geometry == null ) {\n                this.site.geometry = { type: 'Point' };\n            }\n\n            this.site.geometry.coordinates = [this.coordinate.longitude, this.coordinate.latitude];\n\n            var ids = this.draw.set( {\n                type: 'FeatureCollection',\n                features: [{\n                    id: this.site.id,\n                    type: 'Feature',\n                    properties: {\n                        oid: this.site.id,\n                        name: this.site.name\n                    },\n                    geometry: this.site.geometry\n                }]\n            } );\n\n            this.draw.changeMode( 'simple_select', { featureIds: ids } );\n        }\n    }\n\n    //    zoomToFeature( node: TreeNode ): void {\n    //        if ( node.data.geometry != null ) {\n    //            this.map.flyTo( {\n    //                center: node.data.geometry.coordinates\n    //            } );\n    //        }\n    //    }\n\n    handleStyle( layer: any ): void {\n\n        this.baseLayers.forEach( baseLayer => {\n            baseLayer.selected = false;\n        } );\n\n        layer.selected = true;\n\n        this.map.setStyle( 'mapbox://styles/mapbox/' + layer.id );\n    }\n\n    handleClick( $event: any ): void {\n        let result = $event.item;\n\n        if ( result.center ) {\n            this.map.flyTo( {\n                center: result.center,\n                zoom: 9\n            } )\n        }\n    }\n    \n}\n","import { Injectable } from '@angular/core';\nimport { HttpHeaders, HttpClient, HttpParams } from '@angular/common/http';\nimport { LngLatBounds } from 'mapbox-gl';\nimport { Observable } from 'rxjs';\n\n// import 'rxjs/add/operator/toPromise';\nimport { finalize, debounceTime, distinctUntilChanged, switchMap } from 'rxjs/operators';\n\nimport { AuthService } from '../../shared/service/auth.service';\nimport { EventService } from '../../shared/service/event.service';\nimport { HttpBackendClient } from '../../shared/service/http-backend-client.service';\n\nimport { SiteEntity, Message, Task, AttributeType, Condition, SiteObjectsResultSet } from '../model/management';\nimport { Sensor } from '../model/sensor';\nimport { Platform } from '../model/platform';\nimport { PageResult } from '../../shared/model/page';\n\ndeclare var acp: any;\n\n@Injectable()\nexport class ManagementService {\n\n    constructor(private http: HttpClient, private noErrorHttpClient: HttpBackendClient, private eventService: EventService, private authService: AuthService) { }\n\n    getChildren(id: string): Promise<SiteEntity[]> {\n        let params: HttpParams = new HttpParams();\n        params = params.set('id', id);\n\n\n        return this.http\n            .get<SiteEntity[]>(acp + '/project/get-children', { params: params })\n            .toPromise()\n    }\n\n    getObjects(id: string, key: string, pageNumber: number, pageSize: number): Promise<SiteObjectsResultSet> {\n        let params: HttpParams = new HttpParams();\n        params = params.set('id', id);\n\n        if (key != null) {\n            params = params.set('key', key);\n        }\n\n        if (pageNumber != null) {\n            params = params.set('pageNumber', pageNumber.toString());\n        }\n        if (pageSize != null) {\n            params = params.set('pageSize', pageSize.toString());\n        }\n\n        return this.http\n            .get<SiteObjectsResultSet>(acp + '/project/objects', { params: params })\n            .toPromise()\n    }\n\n    view(id: string): Promise<{ breadcrumbs: SiteEntity[], item: SiteEntity }> {\n        let params: HttpParams = new HttpParams();\n        params = params.set('id', id);\n\n        return this.http\n            .get<{ breadcrumbs: SiteEntity[], item: SiteEntity }>(acp + '/project/view', { params: params })\n            .toPromise()\n    }\n\n    getItems(id: string, key: string): Promise<SiteEntity[]> {\n        let params: HttpParams = new HttpParams();\n        params = params.set('id', id);\n\n        if (key != null) {\n            params = params.set('key', key);\n        }\n\n        return this.http\n            .get<SiteEntity[]>(acp + '/project/items', { params: params })\n            .toPromise()\n    }\n\n    roots(id: string, bounds: LngLatBounds): Promise<SiteEntity[]> {\n        let params: HttpParams = new HttpParams();\n\n        if (id != null) {\n            params = params.set('id', id);\n        }\n\n        if (bounds != null) {\n            params = params.set('bounds', JSON.stringify(bounds));\n        }\n\n        return this.http\n            .get<SiteEntity[]>(acp + '/project/roots', { params: params })\n            .toPromise()\n    }\n\n    edit(id: string): Promise<{ item: SiteEntity, attributes: AttributeType[] }> {\n\n        let headers = new HttpHeaders({\n            'Content-Type': 'application/json'\n        });\n\n        this.eventService.start();\n\n        return this.http\n            .post<{ item: SiteEntity, attributes: AttributeType[] }>(acp + '/project/edit', JSON.stringify({ id: id }), { headers: headers })\n            .pipe(finalize(() => {\n                this.eventService.complete();\n            }))\n            .toPromise()\n    }\n\n    runOrtho(id: string, excludes: string[]): Promise<{ item: SiteEntity, attributes: AttributeType[] }> {\n\n        let headers = new HttpHeaders({\n            'Content-Type': 'application/json'\n        });\n\n        //   this.eventService.start();\n\n        return this.http\n            .post<{ item: SiteEntity, attributes: AttributeType[] }>(acp + '/project/run-ortho', JSON.stringify({ id: id, excludes: excludes }), { headers: headers })\n            .pipe(finalize(() => {\n                //\t\t\t\tthis.eventService.complete();\n            }))\n            .toPromise()\n    }\n\n    update(entity: SiteEntity): Promise<SiteEntity> {\n\n        let headers = new HttpHeaders({\n            'Content-Type': 'application/json'\n        });\n\n        this.eventService.start();\n\n        return this.noErrorHttpClient\n            .post<SiteEntity>(acp + '/project/update', JSON.stringify({ entity: entity }), { headers: headers })\n            .pipe(finalize(() => {\n                this.eventService.complete();\n            }))\n            .toPromise()\n    }\n\n    newChild(parentId: string, type: string): Promise<{ item: SiteEntity, attributes: AttributeType[] }> {\n\n        let url = '/project/new-default-child';\n\n        let headers = new HttpHeaders({\n            'Content-Type': 'application/json'\n        });\n\n        let params = {} as any;\n\n        if (parentId != null) {\n            params.parentId = parentId;\n        }\n\n        if (type) {\n            params.type = type;\n\n            url = '/project/new-child';\n        }\n\n\n        this.eventService.start();\n\n\n        return this.http\n            .post<{ item: SiteEntity, attributes: AttributeType[] }>(acp + url, JSON.stringify(params), { headers: headers })\n            .pipe(finalize(() => {\n                this.eventService.complete();\n            }))\n            .toPromise()\n    }\n\n\n\n    applyWithParent(entity: SiteEntity, parentId: string): Promise<SiteEntity> {\n\n        let headers = new HttpHeaders({\n            'Content-Type': 'application/json'\n        });\n\n\n        let params = { entity: entity } as any;\n\n        if (parentId != null) {\n            params.parentId = parentId;\n        }\n\n\n        this.eventService.start();\n\n        return this.noErrorHttpClient\n            .post<SiteEntity>(acp + '/project/apply-with-parent', JSON.stringify(params), { headers: headers })\n            .pipe(finalize(() => {\n                this.eventService.complete();\n            }))\n            .toPromise()\n    }\n\n    getCurrentUser(): string {\n        //        let userName: string = \"admin\";\n        //\n        //        if ( this.cookieService.check( \"user\" ) ) {\n        //            let cookieData: string = this.cookieService.get( \"user\" )\n        //            let cookieDataJSON: any = JSON.parse( JSON.parse( cookieData ) );\n        //            userName = cookieDataJSON.userName;\n        //        }\n        //        else {\n        //            console.log( 'Check fails for the existence of the cookie' )\n        //\n        //            let cookieData: string = this.cookieService.get( \"user\" )\n        //\n        //            if ( cookieData != null ) {\n        //                let cookieDataJSON: any = JSON.parse( JSON.parse( cookieData ) );\n        //                userName = cookieDataJSON.userName;\n        //            }\n        //            else {\n        //                console.log( 'Unable to get cookie' );\n        //            }\n        //        }\n\n        return this.authService.getUserName();\n    }\n\n    remove(id: string): Promise<void> {\n\n        let headers = new HttpHeaders({\n            'Content-Type': 'application/json'\n        });\n\n        this.eventService.start();\n\n        return this.http\n            .post<void>(acp + '/project/remove', JSON.stringify({ id: id }), { headers: headers })\n            .pipe(finalize(() => {\n                this.eventService.complete();\n            }))\n            .toPromise()\n    }\n\n    removeObject(componentId: string, key: string): Promise<void> {\n\n        let headers = new HttpHeaders({\n            'Content-Type': 'application/json'\n        });\n\n        this.eventService.start();\n\n        return this.http\n            .post<void>(acp + '/project/removeObject', JSON.stringify({ id: componentId, key: key }), { headers: headers })\n            .pipe(finalize(() => {\n                this.eventService.complete();\n            }))\n            .toPromise()\n    }\n\n    removeTask(uploadId: string): Promise<void> {\n\n        let headers = new HttpHeaders({\n            'Content-Type': 'application/json'\n        });\n\n        this.eventService.start();\n\n        return this.http\n            .post<void>(acp + '/project/remove-task', JSON.stringify({ uploadId: uploadId }), { headers: headers })\n            .pipe(finalize(() => {\n                this.eventService.complete();\n            }))\n            .toPromise()\n    }\n\n    upload(id: string, folder: string, file: File): Promise<Document> {\n\n        this.eventService.start();\n\n        const formData = new FormData()\n        formData.append('file', file);\n        formData.append('id', id);\n        formData.append('folder', folder);\n\n        return this.http.post<Document>(acp + '/project/upload', formData)\n            .pipe(finalize(() => {\n                this.eventService.complete();\n            }))\n            .toPromise();\n    }\n\n    tasks(statuses: string[], pageSize: number, pageNumber: number, token: number): Promise<PageResult<Task>> {\n\n        // status options: PROCESSING, COMPLETE, ERROR, QUEUED\n        let params: HttpParams = new HttpParams();\n        params = params.set('statuses', JSON.stringify(statuses));\n        params = params.set('pageSize', pageSize.toString());\n        params = params.set('pageNumber', pageNumber.toString());\n        params = params.set('token', token.toString());\n\n        return this.http\n            .get<PageResult<Task>>(acp + '/project/tasks', { params: params })\n            .toPromise()\n    }\n\n    task(id: string): Promise<{ messages: Message[], task: Task }> {\n\n        let params: HttpParams = new HttpParams();\n        params = params.set('id', id);\n\n        return this.http\n            .get<{ messages: Message[], task: Task }>(acp + '/project/task', { params: params })\n            .toPromise();\n    }\n\n    getMissingMetadata(pageSize: number, pageNumber: number): Promise<PageResult<Message>> {\n\n        let params: HttpParams = new HttpParams();\n        params = params.set('pageSize', pageSize.toString());\n        params = params.set('pageNumber', pageNumber.toString());\n\n        return this.http.get<PageResult<Message>>(acp + '/project/missing-metadata', { params: params })\n            .toPromise();\n    }\n\n    download(id: string, key: string, useSpinner: boolean): Observable<Blob> {\n\n        let params: HttpParams = new HttpParams();\n        params = params.set('id', id);\n        params = params.set('key', key);\n\n        if (useSpinner) {\n            this.eventService.start();\n        }\n\n        return this.noErrorHttpClient.get<Blob>(acp + '/project/download', { params: params, responseType: 'blob' as 'json' })\n            .pipe(finalize(() => {\n                if (useSpinner) {\n                    this.eventService.complete();\n                }\n            }))\n    }\n\n    downloadAll(id: string, key: string, useSpinner: boolean): Observable<Blob> {\n\n        let params: HttpParams = new HttpParams();\n        params = params.set('id', id);\n        params = params.set('key', key);\n\n        if (useSpinner) {\n            this.eventService.start();\n        }\n\n        return this.noErrorHttpClient.get<Blob>(acp + '/project/download-all', { params: params, responseType: 'blob' as 'json' })\n            .pipe(finalize(() => {\n                if (useSpinner) {\n                    this.eventService.complete();\n                }\n            }))\n    }\n\n    search(terms: Observable<string>) {\n        return terms\n            .pipe(debounceTime(400))\n            .pipe(distinctUntilChanged())\n            .pipe(switchMap(term => this.searchEntries(term)));\n    }\n\n    searchEntries(term: string): Observable<string> {\n\n        let params: HttpParams = new HttpParams();\n        params = params.set('term', term);\n\n        return this.http\n            .get<string>(acp + '/project/search', { params: params })\n    }\n\n    searchEntites(term: string): Promise<any> {\n\n        let params: HttpParams = new HttpParams();\n        params = params.set('term', term);\n\n        return this.http\n            .get(acp + '/project/search', { params: params })\n            .toPromise()\n    }\n\n    submitCollectionMetadata(metaObj: string): Promise<void> {\n\n        let headers = new HttpHeaders({\n            'Content-Type': 'application/json'\n        });\n\n        this.eventService.start();\n\n        return this.noErrorHttpClient\n            .post<void>(acp + '/project/submit-metadata', JSON.stringify({ json: metaObj }), { headers: headers })\n            .pipe(finalize(() => {\n                this.eventService.complete();\n            }))\n            .toPromise()\n    }\n\n    getMetadataOptions(id: string): Promise<{ sensors: Sensor[], platforms: Platform[], name: string, email: string, platform: string, sensor: string }> {\n\n        let params: HttpParams = new HttpParams();\n\n        if (id != null) {\n            params = params.set('id', id);\n        }\n\n        return this.noErrorHttpClient\n            .get<{ sensors: Sensor[], platforms: Platform[], name: string, email: string, platform: string, sensor: string }>(acp + '/project/metadata-options', { params: params })\n            .toPromise()\n    }\n\n    evaluate(condition: Condition, entity: SiteEntity): boolean {\n        if (condition != null && condition.type === 'eq') {\n            return (entity[condition.name] === condition.value);\n        }\n        else if (condition != null && condition.type === 'admin') {\n            return this.authService.isAdmin();\n        }\n\n        return false;\n    }\n}\n","<div class=\"modal-body\">\n    <div *ngIf=\"message != null\" class=\"error-container\">\n        <div class=\"label-holder\">\n            <strong>Error</strong>\n        </div>\n        <div class=\"holder\">\n            <div>\n                <p class=\"error-message\">{{message}}</p>\n            </div>\n        </div>\n    </div>\n\n    <div class=\"image-preview-container\">\n        <i class=\"fa fa-times btn btn-close\" style=\"min-width:0;\" (click)=\"bsModalRef.hide()\"></i>\n        <div class=\"image-container\">\n            <p *ngIf=\"loading\" style=\"text-align: left;\">Loading image...</p>\n            <img *ngIf=\"!loading\" class=\"image-preview img-responsive center-block\" [src]=\"imageToShow | safeHtml\" alt=\"Image\">\n        </div>\n    </div>\n\n    <!-- <form #ngForm=\"ngForm\">\n    <div class=\"btn-holder\" style=\"text-align: right;\">\n      <button type=\"button\" class=\"btn btn-default\" (click)=\"bsModalRef.hide()\">Cancel</button>\n    </div>\n  </form> -->\n</div>\n","import { Component, OnInit, AfterViewInit, ViewChild, ElementRef, Input } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\n\nimport { ManagementService } from '../../service/management.service';\n\n\n@Component( {\n    selector: 'image-preview-modal',\n    templateUrl: './image-preview-modal.component.html',\n    styleUrls: []\n} )\nexport class ImagePreviewModalComponent {\n\n    message: string = null;\n    open: boolean = true;\n    loading: boolean = true;\n    imageToShow: any;\n    component: string;\n    key: string;\n\n    constructor( private service: ManagementService, public bsModalRef: BsModalRef ) { }\n\n    init( component: string, key: string ) {\n        this.component = component;\n        this.key = key;\n\n        this.getImage( this.component, this.key );\n    }\n\n    createImageFromBlob( image: Blob ) {\n        let reader = new FileReader();\n        reader.addEventListener( \"load\", () => {\n            this.imageToShow = reader.result;\n        }, false );\n\n        if ( image ) {\n            reader.readAsDataURL( image );\n        }\n    }\n\n    getImage( component: string, key: string ): void {\n\n        this.loading = true;\n\n        this.service.download( component, key, false ).subscribe( blob => {\n            this.createImageFromBlob( blob );\n            this.loading = false;\n        }, error => {\n            this.loading = false;\n\n            this.error( error );\n        } );\n    }\n\n    close(): void {\n        this.open = false;\n    }\n\n    error( err: HttpErrorResponse ): void {\n        // Handle error\n        if ( err !== null ) {\n            this.message = ( err.error.localizedMessage || err.error.message || err.message );\n\n            console.log( this.message );\n        }\n    }\n\n}\n","import { PageResult } from '../../shared/model/page';\n\nexport class Condition {\n    name: string;\n    value: string;\n    type: string;\n}\n\nexport class AttributeType {\n    name: string;\n    label: string;\n    type: string;\n    required: boolean;\n    immutable: boolean;\n    readonly: boolean;\n    condition: Condition;\n    options?: { value: string, label: string }[];\n}\n\nexport class SiteObjectsResultSet {\n    count: number;\n    pageNumber: number;\n    pageSize: number;\n    results: SiteEntity[];\n    folder: string;\n}\n\nexport class SiteEntity {\n    id: string;\n    name: string;\n    folderName: string;\n    type: string;\n    component: string;\n    key: string;\n    metadataUploaded: boolean;\n    geometry?: any;\n    numberOfChildren: number;\n    lastModified?: string;\n    ownerName?: string;\n    ownerPhone?: string;\n    ownerEmail?: string;\n    privilegeType?: string;\n    children?: SiteEntity[];\n    active?: boolean;\n    excludeFromProcess?: boolean;\n}\n\nexport class CollectionHierarchy {\n    site: string;\n    project: string;\n    mission: string;\n    collection: string;\n}\n\nexport class ImageHierarchy {\n    site: string;\n    project: string;\n    image: string;\n}\n\nexport class Selection {\n    type: string;\n    isNew: boolean;\n    value: string;\n    label: string;\n    platform?: string;\n    sensor?: string;\n};\n\n\nexport class UploadForm {\n    create: boolean;\n    name: string;\n    outFileName: string;\n    uasComponentOid: string;\n    site: string;\n    project: string;\n    mission: string;\n    collection: any;\n    imagery: any;\n    uploadTarget: string;\n    selections: string;\n}\n\nexport class Action {\n    createDate: string;\n    lastUpdatedDate: string;\n    type: string;\n    description: string;\n}\n\nexport class Task {\n    oid: string;\n    label: string;\n    createDate: string;\n    lastUpdateDate: string;\n    lastUpdatedDate: string;\n    status: string;\n    message: string;\n    actions: Action[];\n    uploadId: string;\n    odmOutput: string;\n    collection: string;\n    collectionLabel: string;\n    type: string;\n    visible?: boolean;\n    showError?: boolean;\n    ancestors?: string[];\n\n}\n\nexport class TaskGroup {\n    label: string;\n    collectionId: string;\n    visible?: boolean;\n    groups: TaskGroupType[];\n    status: string;\n    lastUpdatedDate: string;\n    ancestors?: string[];\n}\n\nexport class TaskGroupType {\n    tasks: Task[];\n    status: string;\n    type: string;\n}\n\nexport class Message {\n    collectionId: string;\n    collectionName: string;\n    ancestors: string[];\n    message: string;\n    imageWidth: string;\n    imageHeight: string;\n}\n\nexport class ProductDocument {\n    id: string;\n    name: string;\n    key: string;\n}\n\nexport class Product {\n    id: string;\n    name: string;\n    entities: SiteEntity[];\n    published: boolean;\n    imageKey?: string;\n    mapKey?: string;\n    workspace?: string;\n    boundingBox?: number[];\n    orthoMapped?: boolean;\n}\n\nexport class ProductDetail extends Product {\n    pilotName: string;\n    dateTime: string;\n    sensor: string;\n    page?: PageResult<ProductDocument>;\n}\n","export class Sensor {\n    newInstance: boolean;\n    oid: string;\n    name: string;\n    displayLabel: string;\n    sensorType: string;\n    model: string;\n    waveLength: string[];\n}\n\nexport const WAVELENGTHS: string[] = [\"Natural Color RGB\", \"Thermal\", \"Red Edge\", \"Near Infra Red\", \"LiDAR\", \"Other\"];\n","\nimport { Directive, ElementRef, HostListener, Input } from '@angular/core';\n\n@Directive({\n  selector: '[OnlyNumber]' \n})\nexport class OnlyNumber {\n\n  constructor(private el: ElementRef) { }\n\n  @Input() OnlyNumber: boolean;\n \n  @HostListener('keydown', ['$event']) onKeyDown(event:any) {\n    let e = <KeyboardEvent> event;\n    if (this.OnlyNumber) {\n      if ([46, 8, 9, 27, 13, 110, 190].indexOf(e.keyCode) !== -1 ||\n        // Allow: Ctrl+A\n        (e.keyCode == 65 && e.ctrlKey === true) ||\n        // Allow: Ctrl+C\n        (e.keyCode == 67 && e.ctrlKey === true) ||\n        // Allow: Ctrl+X\n        (e.keyCode == 88 && e.ctrlKey === true) ||\n        // Allow: home, end, left, right\n        (e.keyCode >= 35 && e.keyCode <= 39)) {\n          // let it happen, don't do anything\n          return;\n        }\n        // Ensure that it is a number and stop the keypress\n        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {\n            e.preventDefault();\n        }\n      }\n  }\n}\n\n\n","<div class=\"modal-header text-center\">\n    <h2>Collection Metadata</h2>\n</div>\n\n<div class=\"row\">\n    <div class=\"col-md-12\">\n        <form #ngForm=\"ngForm\" class=\"modal-form\">\n            <div class=\"modal-body\">\n\n                <div *ngIf=\"message != null\" class=\"error-container\">\n                    <div class=\"label-holder\">\n                        <strong>Error</strong>\n                    </div>\n                    <div class=\"holder\">\n                        <div>\n                            <p class=\"error-message\">{{message}}</p>\n                        </div>\n                    </div>\n                </div>\n\n\n                <div class=\"panel panel-default\">\n                    <div class=\"panel-heading\">Point Of Contact</div>\n                    <div class=\"panel-body\">\n                        <div class=\"form-group\">\n                            <label for=\"pointOfContact.name\">Name</label>\n                            <input type=\"text\" name=\"pointOfContact.name\" [(ngModel)]=\"metaObject.pointOfContact.name\"\n                                [maxlength]=\"100\" [required]=\"false\" [disabled]=\"false\" />\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"pointOfContact.email\">Email</label>\n                            <input type=\"text\" name=\"pointOfContact.email\" [(ngModel)]=\"metaObject.pointOfContact.email\"\n                                [maxlength]=\"255\" [required]=\"false\" [disabled]=\"false\" />\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"panel panel-default\">\n                    <div class=\"panel-heading\">Platform</div>\n                    <div class=\"panel-body\">\n                        <div class=\"form-group\">\n                            <label for=\"platform.name\">Name</label>\n                            <select [(ngModel)]=\"metaObject.platform.name\" name=\"platform.name\" type=\"input\" (change)=\"handlePlatformSelect()\" required>                               \n                                <option></option>\n                                <option *ngFor=\"let platform of platforms\" [value]=\"platform.oid\">{{platform.displayLabel}}</option>\n                            </select>\n                        </div>\n                        <div class=\"form-group\" *ngIf=\"metaObject.platform.name === otherPlatformId\">\n                            <label for=\"platform.class\">Other name</label>\n                            <input type=\"text\" name=\"platform.otherName\" [(ngModel)]=\"metaObject.platform.otherName\"\n                                maxlength=\"20\" required />\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"platform.class\">Class</label>\n                            <input type=\"text\" name=\"platform.class\" [(ngModel)]=\"metaObject.platform.class\"\n                                [maxlength]=\"20\" [disabled]=\"false\" required />\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"platform.type\">Type</label>\n                            <select [(ngModel)]=\"metaObject.platform.type\" name=\"platform.type\" type=\"input\" class=\"\"\n                                [disabled]=\"metaObject.platform.name !== otherPlatformId\" required>\n                                <option></option>\n                                <option>Fixed Wing</option>\n                                <option>Hybrid</option>\n                            </select>\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"platform.serialNumber\">Serial Number</label>\n                            <input type=\"text\" name=\"platform.serialNumber\"\n                                [(ngModel)]=\"metaObject.platform.serialNumber\" [maxlength]=\"50\"\n                                [required]=\"true\" [disabled]=\"false\" />\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"platform.faaIdNumber\">FAA Id Number</label>\n                            <input type=\"text\" name=\"platform.faaIdNumber\" [(ngModel)]=\"metaObject.platform.faaIdNumber\"\n                                [maxlength]=\"30\" [required]=\"true\" [disabled]=\"false\" />\n                        </div>\n                    </div>\n                </div>\n\n\n                <div class=\"panel panel-default\">\n                    <div class=\"panel-heading\">Sensor</div>\n                    <div class=\"panel-body\">\n                        <div class=\"form-group\">\n                            <label for=\"sensor.name\">Name</label>\n                            <select [(ngModel)]=\"metaObject.sensor.name\" name=\"sensor.name\" type=\"input\" (change)=\"handleSensorSelect()\" required>                               \n                                <option></option>\n                                <option *ngFor=\"let sensor of sensors\" [value]=\"sensor.oid\">{{sensor.displayLabel}}</option>\n                            </select>\n                        </div>                    \n                        <div class=\"form-group\" *ngIf=\"metaObject.sensor.name === otherSensorId\">\n                            <label for=\"sensor.class\">Other name</label>\n                            <input type=\"text\" name=\"sensor.otherName\" [(ngModel)]=\"metaObject.sensor.otherName\"\n                                maxlength=\"20\" required />\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"sensor.type\">Type</label>\n                            <input type=\"text\" name=\"sensor.type\" [(ngModel)]=\"metaObject.sensor.type\" [maxlength]=\"20\"\n                                [required]=\"true\" [disabled]=\"metaObject.sensor.name !== otherSensorId\" />\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"sensor.model\">Model</label>\n                            <input type=\"text\" name=\"sensor.model\" [(ngModel)]=\"metaObject.sensor.model\"\n                                [maxlength]=\"20\" [required]=\"true\" [disabled]=\"metaObject.sensor.name !== otherSensorId\" />\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"sensor.wavelength\">Wave Length</label>\n                            <div *ngFor=\"let wavelength of wavelengths\">\n                              <boolean-field [value]=\"metaObject.sensor.wavelength && (-1 !== metaObject.sensor.wavelength.indexOf(wavelength))\" [label]=\"wavelength\" (valueChange)=\"updateSelectedWaveLength(wavelength, $event)\" [disabled]=\"metaObject.sensor.name !== otherSensorId\"></boolean-field>                              \n                            </div>                                                        \n                        </div>\n                        <!-- <div class=\"form-group\">\n                            <label for=\"sensor.imageWidth\">Image Width</label>\n                            <input type=\"text\" name=\"sensor.imageWidth\" [(ngModel)]=\"imageWidth\"\n                                [required]=\"true\" [disabled]=\"true\" OnlyNumber=\"true\" />\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"sensor.imageHeight\">Image Height</label>\n                            <input type=\"text\" name=\"sensor.imageHeight\" [(ngModel)]=\"imageHeight\"\n                                [required]=\"true\" [disabled]=\"true\" OnlyNumber=\"true\" />\n                        </div> -->\n                        <div class=\"form-group\">\n                            <label for=\"sensor.sensorWidth\">Sensor Width</label>\n                            <input type=\"number\" name=\"sensor.sensorWidth\" [(ngModel)]=\"metaObject.sensor.sensorWidth\"\n                                [required]=\"true\" [disabled]=\"false\" OnlyNumber=\"true\" />\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"sensor.sensorHeight\">Sensor Height</label>\n                            <input type=\"number\" name=\"sensor.sensorHeight\" [(ngModel)]=\"metaObject.sensor.sensorHeight\"\n                                [required]=\"true\" [disabled]=\"false\" OnlyNumber=\"true\" />\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"sensor.pixelSizeWidth\">Pixel Size Width</label>\n                            <input type=\"number\" name=\"sensor.pixelSizeWidth\"\n                                [(ngModel)]=\"metaObject.sensor.pixelSizeWidth\" [required]=\"true\" [disabled]=\"false\"\n                                OnlyNumber=\"true\" />\n                        </div>\n                        <div class=\"form-group\">\n                            <label for=\"sensor.pixelSizeHeight\">Pixel Size Height</label>\n                            <input type=\"number\" name=\"sensor.pixelSizeHeight\"\n                                [(ngModel)]=\"metaObject.sensor.pixelSizeHeight\" [required]=\"true\" [disabled]=\"false\"\n                                OnlyNumber=\"true\" />\n                        </div>\n                    </div>\n                </div>\n\n                <div class=\"button-holder\">\n                    <button type=\"button\" class=\"btn btn-default\" (click)=\"bsModalRef.hide()\">Cancel</button>\n                    <button type=\"button\" [disabled]=\"!ngForm.valid\" class=\"btn btn-primary\"\n                        (click)=\"handleSubmit()\">\n                        <i class=\"icon-upload icon-white\"></i> Submit\n                    </button>\n                </div>\n            </div>\n        </form>\n    </div>\n</div>","import { Component, OnInit, AfterViewInit, ViewChild, ElementRef } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { Subject } from 'rxjs';\n\nimport { ManagementService } from '../../service/management.service';\n\nimport { Sensor, WAVELENGTHS } from '../../model/sensor';\nimport { Platform } from '../../model/platform';\n\n\ndeclare var acp: string;\n\n@Component({\n\tselector: 'metadata-modal',\n\ttemplateUrl: './metadata-modal.component.html',\n\tstyleUrls: []\n})\nexport class MetadataModalComponent {\n    /*\n     * collectionId for the metadata\n     */\n\tcollectionId: string;\n\n\tmessage: string = null;\n\n\tdisabled: boolean = false;\n\n\t// imageHeight: string;\n\n\t// imageWidth: string;\n\n\tmetaObject: any = {\n\t\tcollectionId: \"\",\n\t\t// agency:{\n\t\t//     name:\"Department of Interior\",\n\t\t//     shortName: \"\",\n\t\t//     fieldCenter: \"\"\n\t\t// },\n\t\tpointOfContact: {\n\t\t\tname: \"\",\n\t\t\temail: \"\"\n\t\t},\n\t\t// project: {\n\t\t//     name:\"\",\n\t\t//     shortName:\"\",\n\t\t//     description:\"\"\n\t\t// },\n\t\t// mission: {\n\t\t//     name:\"\",\n\t\t//     description:\"\"\n\t\t// },\n\t\t// collect: {\n\t\t//     name:\"\",\n\t\t//     description:\"\"\n\t\t// },\n\t\tplatform: {\n\t\t\tname: \"\",\n\t\t\totherName: \"\",\n\t\t\tclass: \"\",\n\t\t\ttype: \"\",\n\t\t\tserialNumber: \"\",\n\t\t\tfaaIdNumber: \"\"\n\t\t},\n\t\tsensor: {\n\t\t\tname: \"\",\n\t\t\totherName: \"\",\n\t\t\ttype: \"\",\n\t\t\tmodel: \"\",\n\t\t\twavelength: [],\n\t\t\t// imageWidth:\"\",\n\t\t\t// imageHeight:\"\",\n\t\t\tsensorWidth: \"\",\n\t\t\tsensorHeight: \"\",\n\t\t\tpixelSizeWidth: \"\",\n\t\t\tpixelSizeHeight: \"\"\n\t\t},\n\t\tupload: {\n\t\t\tdataType: \"raw\"\n\t\t}\n\t};\n\n    /*\n     * Observable subject called when metadata upload is successful\n     */\n\tpublic onMetadataChange: Subject<string>;\n\n\tsensors: Sensor[] = [];\n\tplatforms: Platform[] = [];\n\twavelengths: string[] = WAVELENGTHS;\n\n\totherSensorId: string = \"\";\n\totherPlatformId: string = \"\";\n\n\tconstructor(public bsModalRef: BsModalRef, private service: ManagementService) { }\n\n\tinit(collectionId: string): void {\n\t\tthis.collectionId = collectionId;\n\n\t\tthis.onMetadataChange = new Subject();\n\n\t\tthis.service.getMetadataOptions(this.collectionId).then((options) => {\n\t\t\tthis.sensors = options.sensors;\n\t\t\tthis.platforms = options.platforms;\n\n\t\t\tthis.metaObject.pointOfContact.name = options.name;\n\t\t\tthis.metaObject.pointOfContact.email = options.email;\n\t\t\tthis.metaObject.sensor.name = options.sensor;\n\t\t\tthis.metaObject.platform.name = options.platform;\n\n\t\t\tthis.sensors.forEach(sensor => {\n\t\t\t\tif (sensor.name === 'OTHER') {\n\t\t\t\t\tthis.otherSensorId = sensor.oid;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.platforms.forEach(platform => {\n\t\t\t\tif (platform.name === 'OTHER') {\n\t\t\t\t\tthis.otherPlatformId = platform.oid;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.handleSensorSelect();\n\t\t\tthis.handlePlatformSelect();\n\n\t\t}).catch((err: HttpErrorResponse) => {\n\t\t\tthis.error(err);\n\t\t});\n\t}\n\n\thandleSensorSelect(): void {\n\t\tif (this.metaObject.sensor.name != null && this.metaObject.sensor.name !== \"\" && this.metaObject.sensor.name !== this.otherSensorId) {\n\t\t\tconst sensor = this.getSelectedSensor();\n\n\t\t\tthis.metaObject.sensor.type = sensor.sensorType;\n\t\t\tthis.metaObject.sensor.model = sensor.model;\n\t\t\tthis.metaObject.sensor.wavelength = [...sensor.waveLength];\n\n\t\t\tconsole.log(this.metaObject.sensor);\n\t\t}\n\t}\n\n\thandlePlatformSelect(): void {\n\t\tif (this.metaObject.platform.name != null && this.metaObject.platform.name !== \"\" && this.metaObject.platform.name !== this.otherPlatformId) {\n\t\t\tconst platform = this.getSelectedPlatform();\n\n\t\t\tthis.metaObject.platform.type = platform.platformType;\n\t\t}\n\t}\n\n\tgetSelectedSensor(): Sensor {\n\t\tvar indexOf = this.sensors.findIndex(i => i.oid === this.metaObject.sensor.name);\n\n\t\treturn this.sensors[indexOf];\n\t}\n\n\tgetSelectedPlatform(): Platform {\n\t\tvar indexOf = this.platforms.findIndex(i => i.oid === this.metaObject.platform.name);\n\n\t\treturn this.platforms[indexOf];\n\t}\n\n\tupdateSelectedWaveLength(wavelength: string, checked: boolean): void {\n\n\t\tconst indexOf = this.metaObject.sensor.wavelength.indexOf(wavelength)\n\n\t\tif (checked) {\n\n\t\t\tif (indexOf < 0) {\n\t\t\t\tthis.metaObject.sensor.wavelength.push(wavelength);\n\n\t\t\t}\n\t\t} else {\n\t\t\tif (indexOf > -1) {\n\t\t\t\tthis.metaObject.sensor.wavelength.splice(indexOf, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\thandleSubmit(): void {\n\n\t\tthis.metaObject.collectionId = this.collectionId;\n\t\t// this.metaObject.imageWidth = this.imageWidth;\n\t\t// this.metaObject.imageHeight = this.imageHeight;\n\n\t\tthis.service.submitCollectionMetadata(this.metaObject).then(() => {\n\t\t\tthis.bsModalRef.hide();\n\t\t\tthis.onMetadataChange.next(this.collectionId);\n\t\t}).catch((err: HttpErrorResponse) => {\n\t\t\tthis.error(err);\n\t\t});\n\t}\n\n\terror(err: HttpErrorResponse): void {\n\t\t// Handle error\n\t\tif (err !== null) {\n\t\t\tthis.message = (err.error.localizedMessage || err.error.message || err.message);\n\t\t}\n\t}\n}\n","export class Metadata {\n    root: boolean;\n    leaf: boolean;\n    drillable: boolean;\n    expandable: boolean;\n    uploadable: boolean;\n    processable: boolean;\n    childLabel: string;\n\n    constructor( root: boolean, leaf: boolean, drillable: boolean, expandable: boolean, uploadable: boolean, processable: boolean, childLabel: string ) {\n        this.root = root;\n        this.leaf = leaf;\n        this.drillable = drillable;\n        this.expandable = expandable;\n        this.uploadable = uploadable;\n        this.processable = processable;\n        this.childLabel = childLabel;\n    }\n}","import { Injectable } from '@angular/core';\n\nimport { SiteEntity } from '../model/management';\nimport { Metadata } from '../model/metadata';\n\ndeclare var acp: any;\n\n@Injectable()\nexport class MetadataService {\n\n    private cache: any = {};\n\n    constructor() {\n        // ( root, leaf, drillable, expandable, uploadable, processable )\n        this.cache['Site'] = new Metadata( true, false, true, false, false, false, 'Projects' );\n        this.cache['Project'] = new Metadata( false, false, true, false, false, false, 'Missions' );\n        this.cache['Mission'] = new Metadata( false, false, false, true, false, false, 'Collections' );\n        this.cache['Collection'] = new Metadata( false, true, false, false, false, true, 'Images' );\n        this.cache['folder'] = new Metadata( false, true, false, false, true, false, '' );\n\n        // Metadata for specific folder types\n        this.cache['raw'] = new Metadata( false, false, false, false, true, false, '' );\n        this.cache['accessible'] = new Metadata( false, false, false, false, true, false, '' );\n    }\n\n    getMetadata( entity: SiteEntity ): Metadata {\n        return this.cache[entity.type];\n    }\n\n    getTypeContainsFolders( entity: SiteEntity ): boolean {\n        return ( entity.type === 'Collection' );\n    }\n\n    isUploadable( type: string ): boolean {\n        if ( this.cache[type] != null ) {\n            return this.cache[type].uploadable;\n        }\n\n        return false;\n    }\n\n    hasExtraField( type: string, fieldName: string ): boolean {\n        if ( type === 'Collection' ) {\n            return ( fieldName === 'platform' || fieldName === 'sensor' );\n        }\n\n        return false;\n    }\n\n    isProcessable( type: string ): boolean {\n        if ( this.cache[type] != null ) {\n            return this.cache[type].processable;\n        }\n\n        return false;\n    }\n\n    getUploadTarget( type: string ): string {\n        if ( type === 'Imagery' ) {\n            return 'imagery';\n        }\n\n        return 'raw';\n    }\n\n    getHierarchy(): string[] {\n\n        return ['Site', 'Project', 'Mission', 'Collection'];\n    }\n}","<div class=\"modal-body\" [@fadeInOnEnter]>\n  <div>\n    <div *ngIf=\"message != null\" class=\"error-container\">\n      <div class=\"label-holder\">\n        <strong>Error</strong>\n      </div>\n      <div class=\"holder\">\n        <div>\n          <p class=\"error-message\">{{message}}</p>\n        </div>\n      </div>\n    </div>\n\n    <div *ngIf=\"entity != null\">\n      <div class=\"row\">\n        <div class=\"col-md-12\">\n          <h2>{{entity.name}} <span *ngIf=\"!entity.metadataUploaded\" class=\"dot pending\" style=\"margin-left: 0;margin-bottom: 5px;\"></span></h2>\n        </div>\n      </div>\n\n      <div class=\"row\">\n        <div class=\"col-md-12\">\n          <ul class=\"breadcrumb\" style=\"margin-bottom: 10px;\">\n            <li *ngFor=\"let prev of previous\">\n              <span> {{prev.name}}</span>\n            </li>\n          </ul>\n        </div>\n      </div>\n\n      <div class=\"row\">\n        <div class=\"col-sm-12\" style=\"padding: 0;\">\n          <tabset class=\"nav-full-width\">\n            <tab *ngFor=\"let folder of folders\" [heading]=\"folder.name\" (selectTab)=\"onSelect(folder)\">\n\n              <div [ngSwitch]=\"folder.name\">\n                <div class=\"image-list-container\" *ngSwitchDefault>\n                  <ul class=\"list-group row\">\n                    <li *ngFor=\"let item of page.results\" class=\"list-group-item col-xs-3\">\n                      <a class=\"thumbnail non-clickable\">\n                        <img [src]=\"context + '/net/geoprism/images/thumbnail-default.png'\" alt=\"Image\">\n                        <div class=\"caption\">\n                          <h4 class=\"media-heading\">{{item.name}}</h4>\n                        </div>\n                      </a>\n                    </li>\n                  </ul>\n                </div>\n\n                <div class=\"image-list-container\" *ngSwitchCase=\"'raw'\">\n                  <ul class=\"list-group row\">\n                    <li\n                      *ngFor=\"let item of page.results | paginate: { itemsPerPage: page.pageSize, currentPage: page.pageNumber, totalItems: page.count }\"\n                      class=\"list-group-item col-xs-3\">\n                      <a class=\"thumbnail\"\n                        [ngClass]=\"{'card-disabled' : item.excludeFromProcess, 'non-clickable' : !enableSelectableImages}\">\n                        <input type=\"checkbox\" class=\"x-box\" *ngIf=\"enableSelectableImages\"\n                          [checked]=\"item.excludeFromProcess\" (change)=\"toggleExcludeImage($event, item)\" />\n                        <img (click)=\"enableSelectableImages ? toggleExcludeImage($event, item) : false\"\n                          [ngClass]=\"{'img-disabled' : item.excludeFromProcess}\"\n                          [src]=\"thumbnails[item.key] != null ? (thumbnails[item.key] | safeHtml) : (context + '/net/geoprism/images/thumbnail-default.png')\"\n                          alt=\"Image\">\n                        <div class=\"caption\">\n                          <h4 class=\"media-heading\">\n                            {{item.name}}\n                          </h4>\n                        </div>\n                      </a>\n                    </li>\n                  </ul>\n                </div>\n\n                <div *ngSwitchCase=\"'video'\">\n                  <div *ngIf=\"video.src !== null\">\n                    <div class=\"row\">\n                      <div class=\"col-md-1\"></div>\n                      <div class=\"col-md-10\">\n                        <h3>\n                          {{video.name}}\n                          <a (click)=\"handleDownloadVideo(video.src)\"><i class=\"fas fa-download\"></i></a>\n                          <a class=\"pull-right\" (click)=\"closeVideo()\"><i class=\"fa fa-times\"\n                              aria-hidden=\"true\"></i></a>\n                        </h3>\n                      </div>\n                      <div class=\"col-md-1\"></div>\n                    </div>\n                    <div class=\"row\">\n                      <div class=\"col-md-1\"></div>\n                      <div class=\"col-md-10\">\n                        <video style=\"width:100%\" controls>\n                          <source [src]=\"video.src\" type=\"video/mp4\" />\n                          Browser not supported\n                        </video>\n                      </div>\n                      <div class=\"col-md-1\"></div>\n                    </div>\n                  </div>\n\n                  <div class=\"image-list-container\">\n                    <ul class=\"list-group row\">\n                      <li *ngFor=\"let item of page.results\" class=\"list-group-item col-xs-3\">\n                        <a class=\"thumbnail\" (click)=\"showVideo(item)\">\n                          <img [src]=\"context + '/net/geoprism/images/thumbnail-video.png'\" alt=\"Video\">\n                          <div class=\"caption\">\n                            <h4 class=\"media-heading\">{{item.name}}</h4>\n                          </div>\n                        </a>\n                      </li>\n                    </ul>\n                  </div>\n                </div>\n\n              </div>\n            </tab>\n          </tabset>\n        </div>\n      </div>\n\n      <div class=\"row\">\n        <div class=\"col-sm-12\">\n          <pagination-controls *ngIf=\"folder.name === 'raw'\" (pageChange)=\"onPageChange($event)\"></pagination-controls>\n\n          <div *ngIf=\"showOrthoRerunMessage\" style=\"text-align:right;padding-right:20px;\">\n            <p>{{statusMessage}}</p>\n            <p>See this process on\n              <a routerlink=\"/site/tasks\" routerlinkactive=\"active\" href=\"#/site/tasks\">your tasks page</a>\n            </p>\n          </div>\n\n          <div class=\"btn-holder\" style=\"margin: 20px 20px 10px 20px;\">\n            <div class=\"row\">\n              <div class=\"col-sm-2\">\n                <button *ngIf=\"!entity.metadataUploaded\" type=\"button\" class=\"btn btn-warning\"\n                  [disabled]=\"processRunning\" (click)=\"handleSetMetadata()\">\n                  <i class=\"fa fa-plus\" style=\"color:white\"></i>\n                  Add metadata\n                </button>\n              </div>\n              <div class=\"col-md-10\" style=\"text-align: right;\">\n                <button type=\"button\" class=\"btn btn-default\" (click)=\"bsModalRef.hide()\">Close</button>\n                <button *ngIf=\"processable\" type=\"button\" class=\"btn btn-secondary\" [disabled]=\"processRunning\"\n                  (click)=\"handleDownload()\" style=\"margin-left: 5px;\">\n                  Download all\n                </button>\n                <button *ngIf=\"processable && enableSelectableImages\" [disabled]=\"processRunning\"\n                  (click)=\"handleRunOrtho()\" class=\"btn btn-primary\" style=\"margin-left: 5px;\">\n                  Reprocess imagery\n                  <i class=\"fa fa-sync-alt\" [ngClass]=\"{'fa-spin' : processRunning}\" aria-hidden=\"true\"\n                    style=\"color:white;vertical-align: middle;margin-left: 10px;\"></i>\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n","import { Component, OnInit, Input } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { Subject } from 'rxjs';\n\nimport { BasicConfirmModalComponent } from '../../../shared/component/modal/basic-confirm-modal.component';\n\nimport { SiteEntity, SiteObjectsResultSet } from '../../model/management';\nimport { ManagementService } from '../../service/management.service';\nimport { MetadataService } from '../../service/metadata.service';\nimport { MetadataModalComponent } from './metadata-modal.component';\n\nimport {\n\tfadeInOnEnterAnimation,\n\tfadeOutOnLeaveAnimation,\n\tslideInLeftOnEnterAnimation,\n\tslideInRightOnEnterAnimation,\n} from 'angular-animations';\n\ndeclare var acp: string;\n\n@Component({\n\tselector: 'leaf-modal',\n\ttemplateUrl: './leaf-modal.component.html',\n\tstyles: [],\n\tproviders: [BasicConfirmModalComponent],\n\tanimations: [\n\t\tfadeInOnEnterAnimation(),\n\t\tfadeOutOnLeaveAnimation(),\n\t\tslideInLeftOnEnterAnimation(),\n\t\tslideInRightOnEnterAnimation(),\n\t]\n})\nexport class LeafModalComponent implements OnInit {\n\tentity: SiteEntity;\n\n\t@Input()\n\tset initData(ins: any) {\n\t\tthis.init(ins.entity, ins.folders, ins.previous)\n\t}\n\n    /* \n     * Breadcrumb of previous sites clicked on\n     */\n\tprevious = [] as SiteEntity[];\n\tfolders: SiteEntity[] = [];\n\tthumbnails: any = {};\n\tprocessRunning: boolean = false;\n\tmessage: string;\n\tstatusMessage: string;\n\tprocessable: boolean = false;\n\texcludes: string[] = [];\n\tenableSelectableImages: boolean = false;\n\tfolder: SiteEntity;\n\tshowOrthoRerunMessage: boolean = false;\n\n\tconstPageSize: number = 50;\n\n\tpage: SiteObjectsResultSet = new SiteObjectsResultSet();\n\n    /*\n     * Reference to the modal current showing\n    */\n\tprivate confirmModalRef: BsModalRef;\n\n\n    /*\n     * Observable subject for TreeNode changes.  Called when create is successful \n     */\n\tpublic onNodeChange: Subject<SiteEntity>;\n\n\tvideo: { src: string, name: string } = { src: null, name: null };\n\tcontext: string;\n\n\tconstructor(private service: ManagementService, private metadataService: MetadataService, private modalService: BsModalService, public bsModalRef: BsModalRef) {\n\t\tthis.context = acp;\n\t}\n\n\tngOnInit(): void {\n\t\tthis.onNodeChange = new Subject();\n\n\t\tthis.excludes = []; // clear excludes if toggling between tabs\n\n\t\tthis.page.count = 0;\n\t\tthis.page.pageNumber = 1;\n\t\tthis.page.pageSize = this.constPageSize;\n\t\tthis.page.results = [];\n\t}\n\n\tinit(entity: SiteEntity, folders: SiteEntity[], previous: SiteEntity[]): void {\n\t\tthis.entity = entity;\n\t\tthis.folders = folders;\n\t\tthis.previous = [...previous];\n\n\t\tif (this.previous.length > 0 && this.previous[this.previous.length - 1].id !== this.entity.id) {\n\t\t\tthis.previous.push(this.entity);\n\t\t}\n\n\t\tif (this.folders.length > 0) {\n\t\t\tthis.onSelect(this.folders[0]);\n\t\t}\n\n\t\tthis.processable = this.metadataService.isProcessable(entity.type);\n\t}\n\n\tcreateImageFromBlob(image: Blob, imageData: any) {\n\t\tlet reader = new FileReader();\n\t\treader.addEventListener(\"load\", () => {\n\t\t\t// this.imageToShow = reader.result;\n\t\t\tthis.thumbnails[imageData.key] = reader.result;\n\t\t}, false);\n\n\t\tif (image) {\n\t\t\treader.readAsDataURL(image);\n\t\t}\n\t}\n\n\tgetThumbnail(image: any): void {\n\t\tif (image != null) {\n\n\t\t\tlet rootPath: string = image.key.substr(0, image.key.lastIndexOf(\"/\"));\n\t\t\tlet fileName: string = /[^/]*$/.exec(image.key)[0];\n\t\t\tconst lastPeriod: number = fileName.lastIndexOf(\".\");\n\t\t\tconst thumbKey: string = rootPath + \"/thumbnails/\" + fileName.substr(0, lastPeriod) + \".png\";\n\n\t\t\tthis.service.download(image.component, thumbKey, false).subscribe(blob => {\n\t\t\t\tthis.createImageFromBlob(blob, image);\n\t\t\t}, error => {\n\t\t\t\tconsole.log(error);\n\t\t\t});\n\t\t}\n\t}\n\n\tonPageChange(pageNumber: number): void {\n\t\tthis.getData(this.folder.component, this.folder.name, pageNumber, this.page.pageSize);\n\t}\n\n\tonSelect(folder: SiteEntity): void {\n\t\tthis.page.results = [];\n\n\t\tif (folder.name === \"raw\") {\n\t\t\tthis.enableSelectableImages = true;\n\t\t} else {\n\t\t\tthis.enableSelectableImages = false;\n\t\t}\n\n\t\tlet pn: number = null;\n\t\tlet ps: number = null;\n\n\t\tif (folder.name === \"raw\") {\n\t\t\tif (this.page.pageNumber == null) {\n\t\t\t\tpn = 1;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tpn = this.page.pageNumber;\n\t\t\t}\n\t\t\tps = this.constPageSize;\n\t\t}\n\n\t\tthis.excludes = []; // clear excludes if toggling between tabs\n\n\t\tthis.folder = folder;\n\n\t\tthis.video.src = null;\n\t\tthis.video.name = null;\n\n\t\tthis.getData(folder.component, folder.name, pn, ps);\n\t}\n\n\tgetData(component: string, folder: string, pageNumber: number, pageSize: number) {\n\t\tthis.service.getObjects(component, folder, pageNumber, pageSize).then(resultSet => {\n\t\t\tthis.page = resultSet;\n\n\t\t\tfor (let i = 0; i < this.page.results.length; ++i) {\n\t\t\t\tlet item = this.page.results[i];\n\n\t\t\t\tif (this.isImage(item)) {\n\t\t\t\t\tthis.getThumbnail(item);\n\n\t\t\t\t\tif (this.excludes.indexOf(item.name) != -1) {\n\t\t\t\t\t\titem.excludeFromProcess = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\t\t});\n\t}\n\n\tisImage(item: any): boolean {\n\t\tif (item.name.toLowerCase().indexOf(\".png\") !== -1 || item.name.toLowerCase().indexOf(\".jpg\") !== -1 ||\n\t\t\titem.name.toLowerCase().indexOf(\".jpeg\") !== -1 || item.name.toLowerCase().indexOf(\".tif\") !== -1 ||\n\t\t\titem.name.toLowerCase().indexOf(\".tiff\") !== -1) {\n\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpreviewImage(event: any, image: any): void {\n\t\t//        this.bsModalRef = this.modalService.show( ImagePreviewModalComponent, {\n\t\t//            animated: true,\n\t\t//            backdrop: true,\n\t\t//            ignoreBackdropClick: true,\n\t\t//            'class': 'image-preview-modal'\n\t\t//        } );\n\t\t//        this.bsModalRef.content.image = image;\n\t\t//        this.bsModalRef.content.src = event.target.src;\n\t}\n\n\ttoggleExcludeImage(event: any, image: any): void {\n\t\timage.excludeFromProcess = !image.excludeFromProcess;\n\n\t\tif (image.excludeFromProcess) {\n\t\t\tthis.excludes.push(image.name);\n\t\t}\n\t\telse {\n\t\t\tlet position = this.excludes.indexOf(image.name);\n\t\t\tif (position > -1) {\n\t\t\t\tthis.excludes.splice(position, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\tisProcessable(item: any): boolean {\n\t\treturn this.metadataService.isProcessable(item.type);\n\t}\n\n\thandleRunOrtho(): void {\n\n\t\t// this.notificationModalRef = this.modalService.show( NotificationModalComponent, {\n\t\t//     animated: true,\n\t\t//     backdrop: true,\n\t\t//     ignoreBackdropClick: true,\n\t\t//     class: 'modal-dialog-centered'\n\t\t// } );\n\t\t// this.notificationModalRef.content.message = \"Your ortho task is running for [\" + this.entity.name + \"]. You can view the current process and results on your tasks page.\";\n\t\t// this.notificationModalRef.content.submitText = 'OK';\n\n\n\t\tevent.stopPropagation();\n\n\t\tthis.confirmModalRef = this.modalService.show(BasicConfirmModalComponent, {\n\t\t\tanimated: true,\n\t\t\tbackdrop: true,\n\t\t\tignoreBackdropClick: true,\n\t\t\t'class': 'confirmation-modal'\n\t\t});\n\t\tthis.confirmModalRef.content.message = 'Running this process will replace all output products for this ' + this.entity.type + '. Are you sure you want to re-process this data?';\n\t\t// this.bsModalRef.content.data = node;\n\t\tthis.confirmModalRef.content.type = 'DANGER';\n\t\tthis.confirmModalRef.content.submitText = \"Run Process\";\n\n\t\t(<BasicConfirmModalComponent>this.confirmModalRef.content).onConfirm.subscribe(data => {\n\t\t\tthis.processRunning = true;\n\t\t\tthis.showOrthoRerunMessage = true;\n\n\t\t\tthis.service.runOrtho(this.entity.id, this.excludes).then(data => {\n\t\t\t    this.processRunning = false;\n\t\t\t\n\t\t\t    setTimeout( () => {\n\t\t\t      this.showOrthoRerunMessage = false;\n\t\t\t\t  this.statusMessage = \"Your process is started.\";\n\t\t\t    }, 30000 );\n\t\t\t}).catch(( err: HttpErrorResponse ) => {\n\t\t\t    this.error(err);\n\t\t\t});\n\t\t});\n\n\t}\n\n\thandleDownload(): void {\n\n\t\twindow.location.href = acp + '/project/download-all?id=' + this.folder.component + \"&key=\" + this.folder.name;\n\n\t\t//      this.service.downloadAll( data.id ).then( data => {\n\t\t//        \n\t\t//      } ).catch(( err: HttpErrorResponse ) => {\n\t\t//          this.error( err );\n\t\t//      } );\n\t}\n\n\thandleDownloadVideo(src: string): void {\n\n\t\twindow.location.href = src;\n\t}\n\n\thandleDownloadFile(item: SiteEntity): void {\n\t\twindow.location.href = acp + '/project/download?id=' + this.folder.component + \"&key=\" + item.key;\n\t}\n\n    handleSetMetadata(): void {\n        let modalRef = this.modalService.show(MetadataModalComponent, {\n            animated: true,\n            backdrop: true,\n            ignoreBackdropClick: true,\n            'class': 'upload-modal'\n        });\n        modalRef.content.init(this.entity.id);\n\n        modalRef.content.onMetadataChange.subscribe(() => {\n          this.entity.metadataUploaded = true;\n        });\n    }\n\n\n\tshowVideo(item: SiteEntity): void {\n\t\tthis.video.name = null;\n\t\tthis.video.src = null;\n\n\t\t// We have to null out the video and then set it after angular has refereshed\n\t\t// Otherwise the video tag does not register that the src has changed.\n\t\tsetTimeout(() => {\n\t\t\tthis.video.name = item.name;\n\t\t\tthis.video.src = acp + '/project/download?id=' + this.folder.component + \"&key=\" + item.key; // + \"#\" + Math.random();\n\t\t}, 200);\n\t}\n\n\tcloseVideo(): void {\n\t\tthis.video.name = null;\n\t\tthis.video.src = null;\n\t}\n\n\terror(err: HttpErrorResponse): void {\n\t\t// Handle error\n\t\tif (err !== null) {\n\t\t\tthis.message = (err.error.localizedMessage || err.error.message || err.message);\n\t\t}\n\t}\n\n}\n","import { Injectable } from '@angular/core';\nimport { HttpHeaders, HttpClient, HttpParams } from '@angular/common/http';\n\nimport { finalize } from 'rxjs/operators';\n\nimport { EventService } from '../../shared/service/event.service';\n\nimport { Product, ProductDetail } from '../model/management';\n\ndeclare var acp: any;\n\n@Injectable()\nexport class ProductService {\n\n\tconstructor(private http: HttpClient, private eventService: EventService) { }\n\n\tgetProducts(id: string): Promise<Product[]> {\n\t\tlet params: HttpParams = new HttpParams();\n\t\tparams = params.set('id', id);\n\n\t\treturn this.http.get<Product[]>(acp + '/product/get-all', { params: params }).toPromise();\n\t}\n\n\tgetDetail(id: string, pageNumber: number, pageSize: number): Promise<ProductDetail> {\n\t\tlet params: HttpParams = new HttpParams();\n\t\tparams = params.set('id', id);\n\t\tparams = params.set('pageNumber', pageNumber.toString());\n\t\tparams = params.set('pageSize', pageSize.toString());\n\n\t\tthis.eventService.start();\n\n\t\treturn this.http\n\t\t\t.get<ProductDetail>(acp + '/product/detail', { params: params })\n\t\t\t.pipe(finalize(() => {\n\t\t\t\tthis.eventService.complete();\n\t\t\t}))\n\t\t\t.toPromise();\n\t}\n\n\tremove(id: string): Promise<void> {\n\n\t\tlet headers = new HttpHeaders({\n\t\t\t'Content-Type': 'application/json'\n\t\t});\n\n\t\tthis.eventService.start();\n\n\t\treturn this.http\n\t\t\t.post<void>(acp + '/product/remove', JSON.stringify({ id: id }), { headers: headers })\n\t\t\t.pipe(finalize(() => {\n\t\t\t\tthis.eventService.complete();\n\t\t\t}))\n\t\t\t.toPromise()\n\t}\n\n\ttogglePublish(id: string): Promise<ProductDetail> {\n\n\t\tlet headers = new HttpHeaders({\n\t\t\t'Content-Type': 'application/json'\n\t\t});\n\n\t\tthis.eventService.start();\n\n\t\treturn this.http\n\t\t\t.post<ProductDetail>(acp + '/product/toggle-publish', JSON.stringify({ id: id }), { headers: headers })\n\t\t\t.pipe(finalize(() => {\n\t\t\t\tthis.eventService.complete();\n\t\t\t}))\n\t\t\t.toPromise()\n\t}\n}\n","<div *ngIf=\"!showSite\" class=\"modal-body\" style=\"padding-bottom: 0;\">\n  <div>\n    <div *ngIf=\"message != null\" class=\"error-container\">\n      <div class=\"label-holder\">\n        <strong>Error</strong>\n      </div>\n      <div class=\"holder\">\n        <div>\n          <p class=\"error-message\">{{message}}</p>\n        </div>\n      </div>\n    </div>\n\n    <div *ngIf=\"product != null\">\n      <div class=\"row\">\n        <div class=\"col-md-12\">\n          <h2>{{product.name}}</h2>\n        </div>\n      </div>\n\n      <div class=\"row\">\n        <div class=\"col-md-12\">\n          <ul class=\"breadcrumb\" style=\"margin-bottom: 10px;\">\n            <li *ngFor=\"let entity of product.entities\">\n              <span> {{entity.name}}</span>\n            </li>\n          </ul>\n        </div>\n      </div>\n\n      <div class=\"row\">\n        <div class=\"col-md-12\">\n          <div class=\"\" *ngIf=\"thumbnails[product.id] != null\">\n            <a class=\"thumbnail non-clickable\">\n              <img class=\"\" [src]=\"thumbnails[product.id] | safeHtml\" (error)=\"getDefaultImgURL($event)\" alt=\"Image\">\n            </a>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"row\">\n        <div class=\"col-md-12\">\n          <label>Pilot Name: </label> &nbsp; {{product.pilotName}}\n        </div>\n      </div>\n\n      <div class=\"row\">\n        <div class=\"col-md-12\">\n          <label>Date/Time: </label> &nbsp; {{product.dateTime}}\n        </div>\n      </div>\n\n      <div class=\"row\">\n        <div class=\"col-md-12\">\n          <label>Sensor Information:</label> &nbsp; {{product.sensor}}\n        </div>\n      </div>\n\n      <!-- <div class=\"row\">\n      <div class=\"col-md-12\">\n        <label>Raw Images</label> \n      </div>\n    </div> -->\n      <div class=\"row\" style=\"background-color: #ececec;\">\n        <div class=\"col-md-12\">\n          <div id=\"image-list-container\">\n            <h3>Raw Images</h3>\n            <ul class=\"list-group row\">\n              <li *ngFor=\"let item of product.page.resultSet | paginate: { itemsPerPage: product.page.pageSize, currentPage: product.page.pageNumber, totalItems: product.page.count }\" class=\"list-group-item col-xs-3\" style=\"background:none;\">\n                <div class=\"\" *ngIf=\"thumbnails[item.id] != null\">\n                  <a class=\"thumbnail\" (click)=\"previewImage(item)\">\n                    <img [src]=\"thumbnails[item.id] | safeHtml\" (error)=\"getDefaultImgURL($event)\" alt=\"Image\">\n                    <div class=\"caption\">\n                      <h4 class=\"media-heading\">{{item.name}}</h4>\n                    </div>\n                  </a>\n                </div>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n      <div class=\"row\">\n        <pagination-controls (pageChange)=\"onPageChange($event)\"></pagination-controls>\n      </div>\n\n\n      <div class=\"row\" style=\"background-color: #ececec;\">\n        <div class=\"btn-holder\" style=\"text-align: right;margin:20px 20px 20px 20px;\">\n          <button type=\"button\" class=\"btn btn-default\" (click)=\"bsModalRef.hide()\">Close</button>\n          <button type=\"button\" class=\"btn btn-secondary\" (click)=\"handleDownload()\">Download ODM Files</button>\n          <button (click)=\"handleGoto()\" class=\"btn btn-primary\" style=\"margin-left: 5px;\">\n            Collection Details\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n\n<leaf-modal *ngIf=\"showSite\" [initData]=\"initData\"></leaf-modal>\n","import { Component, OnInit } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\n\nimport { LeafModalComponent } from './leaf-modal.component'\nimport { BasicConfirmModalComponent } from '../../../shared/component/modal/basic-confirm-modal.component';\nimport { ImagePreviewModalComponent } from '../modal/image-preview-modal.component';\n\nimport { ProductDetail, SiteEntity } from '../../model/management';\nimport { ManagementService } from '../../service/management.service';\nimport { ProductService } from '../../service/product.service';\n\nimport {\n\tfadeInOnEnterAnimation,\n\tfadeOutOnLeaveAnimation,\n\tbounceInOnEnterAnimation,\n} from 'angular-animations';\n\ndeclare var acp: string;\n\n@Component({\n\tselector: 'product-modal',\n\ttemplateUrl: './product-modal.component.html',\n\tproviders: [LeafModalComponent, BasicConfirmModalComponent],\n\tstyleUrls: [],\n\tanimations: [\n\t\tfadeInOnEnterAnimation(),\n\t\tfadeOutOnLeaveAnimation(),\n\t\tbounceInOnEnterAnimation()\n\t]\n})\nexport class ProductModalComponent implements OnInit {\n\tproduct: ProductDetail;\n\n\tthumbnails: any = {};\n\titems: any[] = [];\n\tshowSite: boolean = false;\n\tmessage: string;\n\tinitData: any;\n\trawImagePreviewModal: BsModalRef;\n\n\tconstructor(private pService: ProductService, private service: ManagementService, public bsModalRef: BsModalRef, private modalService: BsModalService) { }\n\n\tngOnInit(): void {\n\t}\n\n\tinit(product: ProductDetail): void {\n\t\tthis.product = product;\n\n\t\tif (this.product.imageKey) {\n\t\t\tthis.getThumbnail(this.product.id, this.product.imageKey);\n\t\t}\n\n\t\tthis.product.page.resultSet.forEach(pDocument => {\n\t\t\tthis.getThumbnail(pDocument.id, pDocument.key);\n\t\t});\n\t}\n\n\tcreateImageFromBlob(image: Blob, id: string) {\n\t\tlet reader = new FileReader();\n\t\treader.addEventListener(\"load\", () => {\n\t\t\t// this.imageToShow = reader.result;\n\t\t\tthis.thumbnails[id] = reader.result;\n\t\t}, false);\n\n\t\tif (image) {\n\t\t\treader.readAsDataURL(image);\n\t\t}\n\t}\n\n\tgetThumbnail(id: string, key: string): void {\n\n\t\tconst component: string = this.product.entities[this.product.entities.length - 1].id;\n\t\tconst rootPath: string = key.substr(0, key.lastIndexOf(\"/\"));\n\t\tconst fileName: string = /[^/]*$/.exec(key)[0];\n\t\tconst lastPeriod: number = fileName.lastIndexOf(\".\");\n\t\tconst thumbKey: string = rootPath + \"/thumbnails/\" + fileName.substr(0, lastPeriod) + \".png\";\n\n\t\tthis.service.download(component, thumbKey, false).subscribe(blob => {\n\t\t\tthis.createImageFromBlob(blob, id);\n\t\t}, error => {\n\t\t\tconsole.log(error);\n\t\t});\n\t}\n\n\tonPageChange(pageNumber: number): void {\n\t\tthis.pService.getDetail(this.product.id, pageNumber, 20).then(detail => {\n\t\t\tthis.init(detail);\n\t\t});\n\t}\n\n\tgetDefaultImgURL(event: any): void {\n\t\tevent.target.src = acp + \"/net/geoprism/images/thumbnail-default.png\";\n\t}\n\n\thandleGoto(): void {\n\t\tconst entity = this.product.entities[this.product.entities.length - 1];\n\t\tconst breadcrumbs = this.product.entities;\n\n\n\t\tthis.service.getItems(entity.id, null).then(nodes => {\n\t\t\tthis.initData = { \"entity\": entity, \"folders\": nodes, \"previous\": breadcrumbs }\n\n\t\t\tthis.showSite = true;\n\t\t});\n\n\t}\n\n\tpreviewImage(image: SiteEntity): void {\n\n\t\tthis.rawImagePreviewModal = this.modalService.show(ImagePreviewModalComponent, {\n\t\t\tanimated: true,\n\t\t\tbackdrop: true,\n\t\t\tignoreBackdropClick: false,\n\t\t\t'class': 'image-preview-modal'\n\t\t});\n\t\tthis.rawImagePreviewModal.content.init(image.component, image.key);\n\t}\n\n    handleDownload(): void {\n        const entity = this.product.entities[this.product.entities.length - 1];        \n\n        window.location.href = acp + '/project/download-last?id=' + entity.id + \"&key=odm_all\";\n    }\n\n\n\terror(err: HttpErrorResponse): void {\n\t\t// Handle error\n\t\tif (err !== null) {\n\t\t\tthis.message = (err.error.localizedMessage || err.error.message || err.message);\n\t\t}\n\t}\n\n}\n","<div class=\"list-group\">\n\n    <div *ngIf=\"products.length < 1\" [@fadeInOnEnter] style=\"padding: 10px;text-align: center;color: grey;\">\n        <h4>No data found</h4>\n    </div>\n\n    <div *ngFor=\"let product of products\" class=\"list-group-item\">\n        <div class=\"card card-default\" [@fadeInOnEnter] [@fadeOutOnLeave]>\n            <div class=\"card-body card-8-4\">\n                <h5 class=\"card-title\" style=\"color:#a0a0a0\">\n                    {{product.name}}\n                </h5>\n\n                <ul class=\"breadcrumb\" style=\"margin: 5px 0 5px 0;\">\n                    <li *ngFor=\"let entity of product.entities\">\n                        <span> {{entity.name}} </span>\n                    </li>\n                </ul>\n\n                <div class=\"card-left\">\n                    \n                    <!-- <img src=\"https://via.placeholder.com/150x75\" class=\"img-responsive\"> -->\n\n                    <div *ngIf=\"thumbnails[product.id] != null\">\n                        <a class=\"thumbnail\" (click)=\"previewImage(product)\">\n                            <img class=\"\" [src]=\"thumbnails[product.id] | safeHtml\" (error)=\"getDefaultImgURL($event)\" alt=\"Image\">\n                        </a>\n                    </div>\n                </div>\n                <div class=\"card-right\">   \n                    <ul style=\"list-style: none;padding: 0;\">\n                        <li style=\"padding: 3px 0 3px 0;\">\n                            <a class=\"fa fa-globe\" [ngClass]=\"{'active': product.orthoMapped}\" (click)=\"handleMapIt(product)\" title=\"Show on map\">Map It</a>\n                            <i *ngIf=\"product.orthoMapped\" [@bounceInOnEnter] [@bounceOutOnLeave] class=\"fas fa-check\" style=\"color: #007276;float: right;vertical-align: middle;line-height: 20px;\"></i>\n                        </li>\n                        <li style=\"padding: 3px 0 3px 0;\">\n                            <a class=\"fa fa-info-circle\" (click)=\"handleGetInfo(product)\" title=\"See details\">Get Info</a>\n                        </li>\n                        <li style=\"padding: 3px 0 3px 0;\">\n                            <a class=\"fa fa-trash-alt\" (click)=\"handleDelete(product, $event)\" title=\"Delete\">Delete</a>\n                        </li>\n                        <li *ngIf=\"product.published\" style=\"padding: 3px 0 3px 0;\">\n                            <a class=\"fa fa-arrow-alt-circle-down\" (click)=\"handleTogglePublish(product)\" title=\"Unpublish\">Unpublish</a>\n                        </li>\n                        <li *ngIf=\"!product.published\" style=\"padding: 3px 0 3px 0;\">\n                            <a class=\"fa fa-arrow-alt-circle-up\" (click)=\"handleTogglePublish(product)\" title=\"Publish\">Publish</a>\n                        </li>\n                    </ul>             \n                </div>\n            </div>\n        </div>\n    </div>\n</div>","import { Component, Input, Output, EventEmitter, SimpleChanges } from '@angular/core';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\n\nimport { BasicConfirmModalComponent } from '../../../shared/component/modal/basic-confirm-modal.component';\nimport { ImagePreviewModalComponent } from '../modal/image-preview-modal.component';\nimport { ProductModalComponent } from '../modal/product-modal.component';\n\nimport { Product } from '../../model/management';\nimport { ProductService } from '../../service/product.service';\nimport { ManagementService } from '../../service/management.service';\n\nimport {\n    fadeInOnEnterAnimation,\n    fadeOutOnLeaveAnimation,\n    bounceInOnEnterAnimation,\n    bounceOutOnLeaveAnimation\n} from 'angular-animations';\n\ndeclare var acp: string;\n\n@Component({\n    selector: 'product-panel',\n    templateUrl: './product-panel.component.html',\n    styles: [],\n    animations: [\n        fadeInOnEnterAnimation(),\n        fadeOutOnLeaveAnimation(),\n        bounceInOnEnterAnimation(),\n        bounceOutOnLeaveAnimation()\n    ]\n})\nexport class ProductPanelComponent {\n\n    @Input() id: string;\n\n    @Output() public toggleMapImage = new EventEmitter<Product>();\n\n    /* \n     * List of products for the current node\n     */\n    products: Product[] = [];\n\n    thumbnails: any = {};\n\n    /*\n     * Reference to the modal current showing\n    */\n    private bsModalRef: BsModalRef;\n\n\n    constructor(private pService: ProductService, private mService: ManagementService, private modalService: BsModalService) { }\n\n    ngOnChanges(changes: SimpleChanges) {\n\n        this.refreshProducts(changes['id'].currentValue);\n    }\n\n    refreshProducts(id: string): void {\n        this.products = [];\n        this.thumbnails = {};\n\n        this.pService.getProducts(id).then(products => {\n            this.products = products;\n\n            this.products.forEach(product => {\n                this.getThumbnail(product);\n            });\n        });\n    }\n\n    createImageFromBlob(image: Blob, product: Product) {\n        let reader = new FileReader();\n        reader.addEventListener(\"load\", () => {\n            // this.imageToShow = reader.result;\n            this.thumbnails[product.id] = reader.result;\n        }, false);\n\n        if (image) {\n            reader.readAsDataURL(image);\n        }\n    }\n\n    getThumbnail(product: Product): void {\n\n        // imageKey only exists if an image actually exists on s3\n        if (product.imageKey) {\n            const component: string = product.entities[product.entities.length - 1].id;\n            const rootPath: string = product.imageKey.substr(0, product.imageKey.lastIndexOf(\"/\"));\n            const fileName: string = /[^/]*$/.exec(product.imageKey)[0];\n            const lastPeriod: number = fileName.lastIndexOf(\".\");\n            const thumbKey: string = rootPath + \"/thumbnails/\" + fileName.substr(0, lastPeriod) + \".png\";\n\n            this.mService.download(component, thumbKey, false).subscribe(blob => {\n                this.createImageFromBlob(blob, product);\n            }, error => {\n                console.log(error);\n\n                this.thumbnails[product.id] = acp + \"/net/geoprism/images/thumbnail-default.png\";\n\n            });\n        }\n        else {\n            this.thumbnails[product.id] = acp + \"/net/geoprism/images/thumbnail-default.png\";\n        }\n    }\n\n    getDefaultImgURL(event: any): void {\n        event.target.src = acp + \"/net/geoprism/images/thumbnail-default.png\";\n    }\n\n    handleMapIt(product: Product): void {\n        this.toggleMapImage.emit(product);\n    }\n\n    handleDelete(product: Product, event: any): void {\n\n        event.stopPropagation();\n\n        this.bsModalRef = this.modalService.show(BasicConfirmModalComponent, {\n            animated: true,\n            backdrop: true,\n            ignoreBackdropClick: true,\n        });\n        this.bsModalRef.content.message = 'Are you sure you want to delete [' + product.name + ']?';\n        this.bsModalRef.content.data = product;\n        this.bsModalRef.content.type = 'DANGER';\n        this.bsModalRef.content.submitText = 'Delete';\n\n        (<BasicConfirmModalComponent>this.bsModalRef.content).onConfirm.subscribe(data => {\n            this.remove(data);\n        });\n    }\n\n    remove(product: Product): void {\n        this.pService.remove(product.id).then(response => {\n            this.products = this.products.filter((n: any) => n.id !== product.id);\n        });\n    }\n\n    previewImage(product: Product): void {\n        const component: string = product.entities[product.entities.length - 1].id;\n\n        this.bsModalRef = this.modalService.show(ImagePreviewModalComponent, {\n            animated: true,\n            backdrop: true,\n            ignoreBackdropClick: false,\n            'class': 'image-preview-modal'\n        });\n        this.bsModalRef.content.init(component, product.imageKey);\n    }\n\n    handleGetInfo(product: Product): void {\n        this.pService.getDetail(product.id, 1, 20).then(detail => {\n            this.bsModalRef = this.modalService.show(ProductModalComponent, {\n                animated: true,\n                backdrop: true,\n                ignoreBackdropClick: true,\n                'class': 'product-info-modal'\n            });\n            this.bsModalRef.content.init(detail);\n        });\n    }\n\n    handleTogglePublish(product: Product): void {\n        this.pService.togglePublish(product.id).then(p => {\n            const mapIt:boolean = product.orthoMapped;\n            \n            if (mapIt) {\n                this.toggleMapImage.emit(product);\n            }\n\n            product.workspace = p.workspace;\n            product.mapKey = p.mapKey;\n            product.published = p.published;\n\n            if (mapIt) {\n                this.toggleMapImage.emit(product);\n            }\n        });\n    }\n}\n","<div *ngIf=\"entity != null\" class=\"modal-body\">\n  <div *ngIf=\"message != null\" class=\"error-container\">\n    <div class=\"label-holder\">\n      <strong>Error</strong>\n    </div>\n    <div class=\"holder\">\n      <div>\n        <p class=\"error-message\">{{message}}</p>\n      </div>\n    </div>\n  </div>\n\n  <div *ngIf=\"newInstance\" class=\"modal-title-container\">\n      <h3 >Add new {{entity.type}}</h3>\n  </div>\n\n  <form #ngForm=\"ngForm\">\n    <div *ngFor=\"let attribute of attributes\">\n      <div *ngIf=\"evaluate(attribute)\" class=\"form-group\">\n        <div *ngIf=\"attribute.type === 'text'\">\n          <label>{{attribute.label}}</label>\n          <input [(ngModel)]=\"entity[attribute.name]\" [name]=\"attribute.name\" type=\"input\" class=\"form-control\" [disabled]=\"attribute.readonly\" [placeholder]=\"attribute.label\" [required]=\"attribute.required\" />\n        </div>\n        <div *ngIf=\"attribute.type === 'list'\">\n          <label>{{attribute.label}}</label>\n          <select [(ngModel)]=\"entity[attribute.name]\" [name]=\"attribute.name\" type=\"input\" [disabled]=\"attribute.readonly\" [required]=\"attribute.required\">\n            <option></option>\n            <option *ngFor=\"let option of attribute.options\" [value]=\"option.value\">{{option.label}}</option>\n          </select>\n        </div>\n        <div *ngIf=\"attribute.type === 'text-area'\">\n          <label>{{attribute.label}}</label>\n          <textarea [(ngModel)]=\"entity[attribute.name]\" [name]=\"attribute.name\"  [disabled]=\"attribute.readonly\" class=\"form-control\" [required]=\"attribute.required\">\n          </textarea>\n        </div>\n        <div *ngIf=\"attribute.type === 'point'\">          \n          <map-attribute [(site)]=\"entity\" [center]=\"center\" [zoom]=\"zoom\" ></map-attribute>\n        </div>\n      </div>\n    </div>\n\n    <div class=\"form-group\" *ngIf=\"entity.type === 'Collection' && !newInstance\">\n        <label>Privilege </label>\n        \n        <select style=\"padding:6px 10px;font-size:14px;\" [(ngModel)]=\"entity.privilegeType\" name=\"collection-privilege\" type=\"input\" [required]=\"true\" \n           [disabled]=\"admin === false || entity.ownerName !== userName\">\n            <option value=\"OWNER\">Owner</option>\n            <option value=\"AGENCY\">Agency</option>\n            <option value=\"PUBLIC\">Public</option>\n        </select>\n\n    </div>\n\n    <div class=\"btn-holder\" style=\"text-align: right;\">\n      <button type=\"button\" class=\"btn btn-default\" (click)=\"bsModalRef.hide()\">Cancel</button>\n      <button type=\"submit\" class=\"btn btn-primary\" (click)=\"handleOnSubmit()\" [disabled]=\"!ngForm.valid\">Apply</button>\n    </div>\n  </form>\n</div>\n","import { Component, OnInit } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { Subject } from 'rxjs';\nimport { LngLat } from 'mapbox-gl';\n\nimport { SiteEntity, AttributeType } from '../../model/management';\nimport { ManagementService } from '../../service/management.service';\n\n\n@Component({\n\tselector: 'entity-modal',\n\ttemplateUrl: './entity-modal.component.html',\n\tstyleUrls: []\n})\nexport class EntityModalComponent implements OnInit {\n    /*\n     * parent id of the node being created\n     */\n\tparentId: string;\n\tuserName: string = \"\";\n\n\tentity: SiteEntity;\n\n\tattributes: AttributeType[];\n\n\tadmin: boolean = false;\n\n\tnewInstance: boolean = false;\n\n\tmessage: string = null;\n\n\tcenter: LngLat = null;\n\tzoom: number = null;\n\n    /*\n     * Observable subject for TreeNode changes.  Called when create is successful \n     */\n\tpublic onNodeChange: Subject<SiteEntity>;\n\n\tconstructor(private service: ManagementService, public bsModalRef: BsModalRef) { }\n\n\tngOnInit(): void {\n\t\tthis.onNodeChange = new Subject();\n\t}\n\n\tinit(newInstance: boolean, userName: string, admin: boolean, entity: SiteEntity, attributes: AttributeType[], center: LngLat, zoom: number) {\n\t\tthis.newInstance = newInstance;\n\t\tthis.userName = userName;\n\t\tthis.admin = admin;\n\t\tthis.entity = entity;\n\t\tthis.attributes = attributes;\n\t\tthis.center = center;\n\t\tthis.zoom = zoom;\n\t}\n\n\thandleOnSubmit(): void {\n\t\tthis.message = null;\n\n\t\tif (this.entity.type !== 'Site' || this.entity.geometry != null) {\n\t\t\tif (this.newInstance) {\n\t\t\t\tthis.service.applyWithParent(this.entity, this.parentId).then(data => {\n\t\t\t\t\tthis.onNodeChange.next(data);\n\t\t\t\t\tthis.bsModalRef.hide();\n\t\t\t\t}).catch((err: HttpErrorResponse) => {\n\t\t\t\t\tthis.error(err);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.service.update(this.entity).then(node => {\n\t\t\t\t\tthis.onNodeChange.next(node);\n\n\t\t\t\t\tthis.bsModalRef.hide();\n\t\t\t\t}).catch((err: HttpErrorResponse) => {\n\t\t\t\t\tconsole.log(err);\n\n\t\t\t\t\tthis.error(err);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.message = \"Sites require a location\";\n\t\t}\n\t}\n\n\tevaluate(attribute: AttributeType): boolean {\n\n\t\tif (this.newInstance && attribute.readonly) {\n\t\t\treturn false;\n\t\t}\n\t\telse if (attribute.condition != null) {\n\t\t\treturn this.service.evaluate(attribute.condition, this.entity);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\terror(err: HttpErrorResponse): void {\n\t\t// Handle error\n\t\tif (err !== null) {\n\t\t\tthis.message = (err.error.localizedMessage || err.error.message || err.message);\n\t\t}\n\t}\n\n}\n","<div>\n  <div class=\"modal-body\" tabindex=\"-1\" role=\"dialog\">\n\n\n    <div *ngIf=\"message != null && message.length > 0\" class=\"row error-container\">\n      <div class=\"col-md-2\"></div>\n      <div class=\"col-md-8\">\n        <div class=\"label-holder\">\n          <strong style=\"color:#8c0000;\">Error</strong>\n        </div>\n        <div class=\"holder\">\n          <div>\n            <p class=\"error-message\">{{message}}</p>\n          </div>\n        </div>\n      </div>\n      <div class=\"col-md-2\"></div>\n    </div>\n\n    <div class=\"row\" *ngIf=\"!existingTask\">\n      <div class=\"col-md-2\"></div>\n      <div class=\"col-md-8\">\n        <ol class=\"list-group list-group-horizontal\">\n          <!-- \n          <li class=\"list-group-item\" [ngClass]=\"{'list-group-item-success':page.type === 'FILE'}\" >Upload</li>\n -->\n\n          <modal-step-indicator [stepConfig]=\"modalStepConfig\"></modal-step-indicator>\n\n          <!-- <li class=\"list-group-item\" [ngClass]=\"{'list-group-item-success':page.type === 'CATEGORY'}\">Categories</li> -->\n          <!-- <li class=\"list-group-item\" [ngClass]=\"{'list-group-item-success':page.type === 'SUMMARY'}\">Finalize</li> -->\n        </ol>\n      </div>\n    </div>\n\n    <div class=\"row\" *ngIf=\"!existingTask && labels.length > 0\">\n      <div class=\"col-md-2\"></div>\n      <div class=\"col-md-8\">\n        <ul class=\"breadcrumb\">\n          <li [@fadeInOnEnter] *ngFor=\"let label of labels\">\n            <span> {{label}}</span>\n          </li>\n        </ul>\n      </div>\n    </div>\n\n    <!-- Section for each page -->\n    <div class=\"row\" *ngIf=\"page.type === 'CATEGORY'\">\n      <div class=\"col-md-2\"></div>\n      <div class=\"col-md-8\">\n\n        <div class=\"form-group\">\n          <label [for]=\"page.selection.type\">{{page.selection.type}}:</label>\n\n          <div *ngIf=\"!page.selection.isNew\" class=\"row\">\n            <div class=\"col-md-8\">\n              <select [name]=\"page.selection.type\" [(ngModel)]=\"page.selection.value\" [disabled]=\"page.selection.isNew\"\n                required>\n                <option></option>\n                <option *ngFor=\"let option of page.options\" [value]=\"option.id\">{{option.name}}</option>\n              </select>\n            </div>\n            <div class=\"col-md-2\">\n              <button *ngIf=\"!page.selection.isNew\" type=\"button btn btn-primary\" class=\"btn btn-primary\"\n                (click)=\"setIsNew(true)\">\n                Add\n              </button>\n            </div>\n          </div>\n        </div>\n        <div [@fadeInOnEnter] *ngIf=\"page.selection.isNew\" class=\"form-group\">\n          <div class=\"row\">\n            <div class=\"col-md-8\">\n              <input autofocus [(ngModel)]=\"page.selection.label\" name=\"label\" type=\"input\" class=\"form-control\"\n                [placeholder]=\"page.selection.type + ' name...'\" required />\n            </div>\n            <div class=\"col-md-2\">\n              <button type=\"button btn btn-primary\" class=\"btn btn-primary\" (click)=\"setIsNew(false)\">\n                Cancel\n              </button>\n            </div>\n          </div>\n          <div [@fadeInOnEnter] class=\"row\" *ngIf=\"hasField('platform')\">\n            <div class=\"col-md-8\">\n              <label for=\"platform\" style=\"margin-top: 10px;\">Platform:</label>\n              <select [(ngModel)]=\"page.selection.platform\" name=\"platform\" type=\"input\" required>\n                <option></option>\n                <option *ngFor=\"let platform of platforms\" [value]=\"platform.oid\">{{platform.displayLabel}}</option>\n              </select>\n            </div>\n          </div>\n          <div [@fadeInOnEnter] class=\"row\" *ngIf=\"hasField('sensor')\">\n            <div class=\"col-md-8\">\n              <label for=\"sensor\" style=\"margin-top: 10px;\">Sensor:</label>\n              <select [(ngModel)]=\"page.selection.sensor\" name=\"sensor\" type=\"input\" required>\n                <option></option>\n                <option *ngFor=\"let sensor of sensors\" [value]=\"sensor.oid\">{{sensor.displayLabel}}</option>\n              </select>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- Summary page -->\n    <div [@fadeInOnEnter] class=\"row\" *ngIf=\"page.type === 'SUMMARY' && !existingTask && currentTask == null\">\n      <div class=\"col-md-2\"></div>\n      <div class=\"col-md-8\">\n\n        <div *ngFor=\"let selection of selections\" class=\"form-group\">\n          <label [for]=\"selection.type\">{{selection.type}}:</label>\n          <input [(ngModel)]=\"selection.label\" [name]=\"selection.type\" type=\"input\" class=\"form-control\" disabled\n            required />\n        </div>\n\n        <div class=\"form-group\">\n          <label for=\"outFileName\">Output Product Name Prefix</label>\n          <input [(ngModel)]=\"values.outFileName\" name=\"outFileName\" type=\"input\" class=\"form-control\"\n            placeholder=\"Output product name prefix...\" />\n        </div>\n      </div>\n    </div>\n\n    <!-- <div [@fadeInOnEnter] class=\"row\" *ngIf=\"finishedTask != null\">\n      <div class=\"col-md-2\"></div>\n      <div class=\"col-md-8\">\n        <a (click)=\"handleAddMetadata(finishedTask)\">Add Metadata</a>\n      </div>\n      <div class=\"col-md-2\"></div>\n    </div> -->\n\n\n    <div [@fadeInOnEnter] [hidden]=\"page.type !== 'FILE' && page.type !== 'SUMMARY'\" class=\"row\">\n      <div class=\"col-md-2\"></div>\n      <div class=\"col-md-8\">\n\n        <!-- Existing task panel -->\n        <div *ngIf=\"existingTask && !currentTask\">\n          <div class=\"panel panel-warning\" style=\"margin: 30px 0 30px 0;\">\n            <div class=\"panel-heading\" style=\"font-size: 20px;\">Partial Upload Detected</div>\n            <div class=\"panel-body\">\n              <h4>A partial upload was detected. You can either cancel that partial upload or attempt to\n                continue.</h4>\n              <h4>\n                <b>To continue an upload</b>\n                please re-upload your file and we will try our best to continue where you left off.\n              </h4>\n\n              <hr>\n              <button type=\"button\" class=\"btn btn-danger\" style=\"margin-top: 20px;\" (click)=\"removeUpload($event)\">\n                <i class=\"icon-upload icon-white\"></i>\n                Cancel Upload\n              </button>\n              <!-- \n                            <button type=\"button\" class=\"btn btn-primary\" style=\"margin-top: 20px;\"\n                                (click)=\"showUploadPanel()\">\n                                <i class=\"icon-upload icon-white\"></i>\n                                Continue Upload\n                            </button>\n -->\n            </div>\n          </div>\n        </div> <!-- End existing task panel -->\n\n        <!-- Task finished upload notification -->\n        <div *ngFor=\"let note of taskFinishedNotifications\" class=\"panel panel-success\" style=\"margin: 30px 0 30px 0;\">\n          <div class=\"panel-heading\" style=\"font-size: 20px;\">\n            Upload Details\n            <i class=\"fa fa-times btn btn-close pull-right\" style=\"min-width:20px;padding:0;line-height: 27px;\"\n              (click)=\"closeTaskFinishedNotification(note.id)\"></i>\n          </div>\n          <div class=\"panel-body\">\n            <h4>\n              Status:\n              <b> Upload successfully completed </b>\n            </h4>\n            <h4>\n              Message:\n              <b> {{note.message}} </b>\n              <!-- You can view your uploads on the <a href=\"management#/site/tasks\" >Workflow Task page</a>. -->\n            </h4>\n          </div>\n        </div> <!-- End task finished upload notification -->\n\n        <!-- Current upload indicator -->\n        <div class=\"\" [hidden]=\"!uploadVisible\">\n\n          <div class=\"well\">\n            <h4>All files uploaded through the upload wizard must</h4>\n            <ul>\n              <li>be compressed into a .zip format </li>\n              <li>not contain any directories within the .zip file</li>\n              <li>not contain spaces or special characters such as <, >, -, +, =, !, @, #, $, %, ^, &, *, ?,/,\\ or apostrophes in any file name</li>\n            </ul>\n\n            <h4>\n              Supported File Formats\n            </h4>\n            <table class=\"table\">\n              <thead>\n                <tr>\n                  <th>Type</th>\n                  <th>Formats</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr>\n                  <td>RGB Image Data</td>\n                  <td>jpg, jpeg, png</td>\n                </tr>\n                <tr>\n                  <td>Multispectral Image Data</td>\n                  <td>tif</td>\n                </tr>\n                <tr>\n                  <td>Video</td>\n                  <td>mp4</td>\n                </tr>\n              </tbody>\n            </table>\n\n          </div>\n\n          <div *ngIf=\"currentTask\" class=\"panel panel-warning\" style=\"margin: 30px 0 30px 0;\">\n            <div class=\"panel-heading\" style=\"font-size: 20px;\">Upload Details</div>\n            <div class=\"panel-body\">\n              <h4>\n                Status:\n                <b> {{currentTask.status}} </b>\n              </h4>\n              <h4>\n                Message:\n                <b> {{currentTask.message}} </b>\n              </h4>\n              <h4>\n                Upload Started On:\n                <b> {{currentTask.createDate}} </b>\n              </h4>\n              <h4>\n                Last Updated:\n                <b> {{currentTask.lastUpdatedDate}} </b>\n              </h4>\n              <h4>\n                Elapsed Time:\n                <b> {{uploadCounter}} </b>\n              </h4>\n            </div>\n          </div>\n\n          <div class=\"uploader-container\" style=\"margin-top: 20px;\" #uploader></div>\n        </div> <!-- End current upload indicator -->\n      </div>\n      <div class=\"col-md-2\"></div>\n    </div>\n\n    <!-- <div [@fadeInOnEnter] class=\"row\" *ngIf=\"currentTask != null\">\n      <div class=\"col-md-2\"></div>\n      <div class=\"col-md-8\">\n        <a (click)=\"handleAddMetadata(currentTask)\">Add Metadata</a>\n      </div>\n      <div class=\"col-md-2\"></div>\n    </div> -->\n\n  </div>\n  <div class=\"modal-footer\">\n\n    <div class=\"row\">\n      <div class=\"col-md-12\">\n        <div class=\"btn-holder\" style=\"text-align: right;\">\n          <button type=\"button\" [disabled]=\"disabled\" (click)=\"close()\" [disabled]=\"disabled\" class=\"btn btn-default\"\n            role=\"button\" aria-disabled=\"false\" style=\"padding: 4px 18px;\">\n            <span class=\"ui-button-text\">Close</span>\n          </button>\n\n          <button *ngIf=\"!existingTask && page.index > 0\" type=\"button btn btn-primary\" [disabled]=\"disabled\"\n            class=\"btn btn-secondary\" (click)=\"handleBackPage()\">\n            <i class=\"icon-upload icon-white\"></i>\n            Back\n          </button>\n\n          <button *ngIf=\"!existingTask && page.index < (pages.length - 1)\" type=\"button btn btn-primary\"\n            [disabled]=\"!isPageValid(page) || disabled\" class=\"btn btn-primary\" (click)=\"handleNextPage()\">\n            <i class=\"icon-upload icon-white\"></i>\n            Next\n          </button>\n\n          <button *ngIf=\"page.index === (pages.length - 1)\" type=\"button btn btn-primary\"\n            [disabled]=\"!isPageValid(page) || disabled\" class=\"btn btn-primary\" (click)=\"handleUpload()\">\n            <i class=\"icon-upload icon-white\"></i>\n            Upload\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n</div>","import { Component, OnInit, ViewChild, ElementRef, KeyValueDiffers, HostListener } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BsModalRef, BsModalService } from 'ngx-bootstrap/modal';\n\nimport { interval, Subject } from 'rxjs';\nimport { switchMap, map } from 'rxjs/operators';\n\n//use Fine Uploader UI for traditional endpoints\nimport { FineUploader, UIOptions } from 'fine-uploader';\n\nimport { BasicConfirmModalComponent } from '../../../shared/component/modal/basic-confirm-modal.component';\n\nimport { Sensor } from '../../model/sensor';\nimport { Platform } from '../../model/platform';\nimport { SiteEntity, UploadForm, Task, Selection } from '../../model/management';\nimport { ManagementService } from '../../service/management.service';\nimport { MetadataService } from '../../service/metadata.service';\nimport { MetadataModalComponent } from './metadata-modal.component';\n\nimport { StepConfig } from '../../../shared/modal/step-indicator/modal-step-indicator'\n\nimport {\n    fadeInOnEnterAnimation,\n    fadeOutOnLeaveAnimation\n} from 'angular-animations';\n\ndeclare var acp: string;\n\nclass Page {\n    index: number;\n    selection: Selection;\n    options: SiteEntity[];\n    type: string\n};\n\n@Component({\n    selector: 'upload-modal',\n    templateUrl: './upload-modal.component.html',\n    styleUrls: ['./upload-modal.component.css'],\n    animations: [\n        fadeInOnEnterAnimation(),\n        fadeOutOnLeaveAnimation()\n    ]\n})\nexport class UploadModalComponent implements OnInit {\n    objectKeys = Object.keys;\n\n    importedValues: boolean = false;\n\n    message: string = \"\";\n\n    /* \n     * Form values\n     */\n    values = { create: false } as UploadForm;\n\n    /*\n     * FineUploader for uploading large files\n     */\n    uploader = null as FineUploader;\n\n    disabled: boolean = false;\n    taskStatusMessages: string[] = [];\n    currentTask: Task = null;\n    finishedTask: Task = null;\n    existingTask: boolean = false;\n    taskPolling: any;\n    pollingIsSet: boolean = false;\n    uploadVisible: boolean = true;\n    selectedContinue: boolean = false;\n    uploadCounter: string = \"00:00:00\";\n    uplodeCounterInterfal: any;\n    differ: any;\n    showFileSelectPanel: boolean = false;\n    taskFinishedNotifications: any[] = [];\n\n    /*\n     * List of hierarchies\n     */\n    hierarchy: string[] = [];\n\n    /*\n     * List of selections: One per hierarchy type\n     */\n    selections: Selection[] = [];\n\n    /*\n     * List of previous selection labels\n     */\n    labels: string[] = [];\n\n    /*\n     * List of pages\n     */\n    pages: Page[] = [{\n        index: 0,\n        selection: null,\n        options: [],\n        type: 'FILE',\n    }];\n\n    /*\n     * Current page  \n     */\n    hierarchyChange: boolean = false;\n\n    /*\n     * Current page  \n     */\n    page: Page = this.pages[0];\n\n    sensors: Sensor[] = [];\n    platforms: Platform[] = [];\n\n    public onUploadComplete: Subject<any>;\n\n    public onHierarchyChange: Subject<boolean>;\n\n    // modalState: any = {\"state\":'category', \"attribute\":\"\", \"termOption\":\"\"}\n\n    modalStepConfig: StepConfig = {\n        \"steps\": [\n            { \"label\": \"Category\", \"active\": true, \"enabled\": true },\n            { \"label\": \"Final\", \"active\": true, \"enabled\": false }\n        ]\n    };\n\n    constructor(private service: ManagementService, private metadataService: MetadataService, private modalService: BsModalService, public bsModalRef: BsModalRef, differs: KeyValueDiffers) {\n        this.differ = differs.find([]).create();\n    }\n\n    @ViewChild('uploader') set content(elem: ElementRef) {\n\n        const that = this;\n\n        if (elem != null && this.uploader == null) {\n\n            let uiOptions: UIOptions = {\n                debug: false,\n                autoUpload: false,\n                multiple: false,\n                element: elem.nativeElement,\n                template: 'qq-template',\n                request: {\n                    endpoint: acp + \"/file/upload\",\n                    forceMultipart: true\n                },\n                resume: {\n                    enabled: true,\n                    recordsExpireIn: 1\n                },\n                chunking: {\n                    enabled: true\n                },\n                retry: {\n                    enableAuto: true\n                },\n                text: {\n                    defaultResponseError: \"Upload failed\"\n                },\n                failedUploadTextDisplay: {\n                    mode: 'none'\n                    //responseProperty: 'error'\n                },\n                validation: {\n                    allowedExtensions: ['zip', 'tar.gz']\n                },\n                showMessage: function(message: string) {\n                    // \n                },\n                callbacks: {\n                    onUpload: function(id: any, name: any): void {\n                        that.disabled = true;\n                        this.finishedTask = null;\n\n                        that.countUpload(that);\n\n                        if (that.message && that.message.length > 0) {\n                            that.message = \"\";\n                        }\n                    },\n                    onProgress: function(id: any, name: any, uploadedBytes: any, totalBytes: any): void {\n                    },\n                    onUploadChunk: function(id: any, name: any, chunkData: any): void {\n                    },\n                    onUploadChunkSuccess: function(id: any, chunkData: any, responseJSON: any, xhr: any): void {\n\n                        if (responseJSON.message && responseJSON.message.currentTask && !that.currentTask) {\n                            that.currentTask = responseJSON.message.currentTask;\n                        }\n\n                        if (that.currentTask && !that.pollingIsSet) {\n                            that.pollingIsSet = true;\n\n                            that.taskPolling = interval(2000).pipe(switchMap(() => {\n                                if (that.currentTask) {\n                                    return that.service.task(that.currentTask.oid);\n                                }\n                            }))\n                                .pipe(map((data) => data))\n                                .subscribe((data) => {\n                                    that.currentTask = data.task\n                                });\n                        }\n                    },\n                    onComplete: function(id: any, name: any, responseJSON: any, xhrOrXdr: any): void {\n                        that.disabled = false;\n                        that.finishedTask = that.currentTask;\n                        that.currentTask = null;\n                        that.existingTask = false;\n                        \n                        if (!that.hierarchyChange) {\n                            for (let i = 0; i < that.selections.length; i++) {\n                                if (that.selections[i].isNew) {\n                                    that.hierarchyChange = true;\n                                }\n                            }\n                        }\n\n                        if (that.taskPolling) {\n                            that.taskPolling.unsubscribe();\n                            that.pollingIsSet = false;\n                        }\n\n                        this.clearStoredFiles();\n\n                        clearInterval(that.uplodeCounterInterfal);\n\n                        if (responseJSON.success) {\n                            // let notificationMsg = \"\";\n                            // notificationMsg = \"Your uploaded data is being processed into final image products. You can view the progress at the Workflow Tasks page.\";\n\n                            // that.taskFinishedNotifications.push({\n                            //     'id': id,\n                            //     \"message\": notificationMsg\n                            // })\n\n                            that.bsModalRef.hide();\n                        }\n\n                        that.onUploadComplete.next();\n                    },\n                    onCancel: function(id: number, name: string) {\n                        //that.currentTask = null;\n\n                        if (that.currentTask && that.currentTask.uploadId) {\n                            that.service.removeTask(that.currentTask.uploadId)\n                                .then(() => {\n                                    this.clearStoredFiles();\n                                })\n                                .catch((err: HttpErrorResponse) => {\n                                    this.error(err);\n                                });\n                        }\n\n                        if (that.existingTask) {\n                            that.page = that.pages[0];\n                        }\n\n                        that.disabled = false;\n                        that.currentTask = null;\n                        that.existingTask = false;\n\n                        if (that.taskPolling) {\n                            that.taskPolling.unsubscribe();\n                            that.pollingIsSet = false;\n                        }\n\n                        clearInterval(that.uplodeCounterInterfal);\n                    },\n                    onError: function(id: number, errorReason: string, xhrOrXdr: string) {\n                        that.error({ error: { message: xhrOrXdr } });\n                    }\n\n                }\n            };\n\n            this.uploader = new FineUploader(uiOptions);\n\n        }\n    }\n\n    ngAfterViewInit() {\n\n    }\n\n    ngDoCheck() {\n\n        if (this.uploader) {\n            const change = this.differ.diff(this.uploader);\n            if (change) {\n                this.setExistingTask();\n            }\n        }\n    }\n\n    ngOnInit(): void {\n        this.onUploadComplete = new Subject();\n        this.onHierarchyChange = new Subject();\n\n        this.service.getMetadataOptions(null).then((options) => {\n            this.sensors = options.sensors;\n            this.platforms = options.platforms;\n        }).catch((err: HttpErrorResponse) => {\n            this.error(err);\n        });\n    }\n\n    init(entities: SiteEntity[]): void {\n        this.hierarchy = this.metadataService.getHierarchy();\n        this.selections = [];\n        this.pages = [];\n\n        for (let i = 0; i < this.hierarchy.length; i++) {\n            const type = this.hierarchy[i];\n\n            const index = entities.findIndex(entity => { return entity.type === type });\n\n            if (index !== -1) {\n                const entity = entities[index];\n\n                this.selections.push({ type: type, isNew: false, value: entity.id, label: entity.name });\n            }\n            else {\n                this.selections.push({ type: type, isNew: false, value: null, label: '' });\n            }\n\n            if (i > 0) {\n                this.pages.push({\n                    index: (this.pages.length),\n                    selection: this.selections[i],\n                    options: [],\n                    type: 'CATEGORY'\n                });\n            }\n        }\n\n        this.labels.push(this.selections[0].label);\n\n        this.pages.push({\n            index: (this.pages.length),\n            selection: null,\n            options: [],\n            type: 'SUMMARY'\n        });\n\n        this.page = this.pages[0];\n\n        this.service.getChildren(this.selections[0].value).then(children => {\n            this.pages[0].options = children.filter(child => {\n                return child.type === this.pages[0].selection.type;\n            });\n        }).catch((err: HttpErrorResponse) => {\n            this.error(err);\n        });\n\n        // Handle the case where there is an existing file upload\n        if (this.existingTask) {\n            this.page = this.pages[this.pages.length - 1];\n        }\n    }\n\n    close(): void {\n        if (this.hierarchyChange) {\n            this.onHierarchyChange.next(true);\n        }\n\n        this.bsModalRef.hide();\n    }\n\n    closeTaskFinishedNotification(id: string): void {\n        // iterate in reverse to allow splice while avoiding the reindex\n        // from affecting any of the next items in the array.\n        let i = this.taskFinishedNotifications.length;\n        while (i--) {\n            let note = this.taskFinishedNotifications[i];\n            if (id === note.id) {\n                this.taskFinishedNotifications.splice(i, 1);\n            }\n        }\n    }\n\n\n    setExistingTask(): void {\n        let resumable = this.uploader.getResumableFilesData() as any[];\n        if (resumable.length > 0) {\n            this.existingTask = true;\n            //            if ( !this.selectedContinue ) {\n            //                this.hideUploadPanel();\n            //            }\n        }\n    }\n\n    isPageValid(page: Page): boolean {\n        if (page.type === 'CATEGORY') {\n            if (page.selection != null) {\n                if (page.selection.value != null && page.selection.value.length > 0) {\n                    return true;\n                }\n                else if (page.selection.label != null && page.selection.label.length > 0) {\n                    if (this.hasField('platform') && (page.selection.platform == null || page.selection.platform.length === 0)) {\n                        return false;\n                    }\n\n                    if (this.hasField('sensor') && (page.selection.sensor == null || page.selection.sensor.length === 0)) {\n                        return false;\n                    }\n\n                    return true;\n                }\n\n                return false;\n            }\n        }\n        else if (page.type === 'FILE') {\n            if (this.uploader != null) {\n                const uploads: any = this.uploader.getUploads();\n\n                return (uploads != null && uploads.length > 0);\n            };\n        }\n        else if (page.type === 'SUMMARY') {\n            return (this.currentTask == null);\n        }\n\n        return true;\n    }\n\n    updateCurrentPageLabel(): void {\n        this.page.options.forEach(entity => {\n            if (entity.id === this.page.selection.value) {\n                this.page.selection.label = entity.name;\n            }\n        })\n    }\n\n    setIsNew(isNew: boolean): void {\n        this.page.selection.isNew = isNew;\n\n        if (isNew) {\n            this.page.selection.value = null;\n        }\n        else {\n            this.page.selection.label = null;\n        }\n    }\n\n    handleAddMetadata(task:Task): void {\n        let modalRef = this.modalService.show(MetadataModalComponent, {\n            animated: true,\n            backdrop: true,\n            ignoreBackdropClick: true,\n            'class': 'upload-modal'\n        });\n        modalRef.content.init(task.collection);\n    }\n\n    handleNextPage(): void {\n\n        if ((this.page.index + 1) < this.pages.length) {\n\n            const nextPage = this.pages[this.page.index + 1];\n\n            if (this.page.type === 'CATEGORY') {\n                this.updateCurrentPageLabel();\n                this.labels.push(this.page.selection.label);\n            }\n\n            if (nextPage.type === 'CATEGORY') {\n\n                if (this.page.type === 'FILE') {\n                    this.page = nextPage;\n                }\n                else {\n                    if (!this.page.selection.isNew && this.page.selection.value != null && this.page.selection.value.length > 0) {\n\n                        this.service.getChildren(this.page.selection.value).then(children => {\n                            nextPage.options = children.filter(child => {\n                                return child.type === nextPage.selection.type;\n                            });\n\n                            this.page = nextPage;\n                        }).catch((err: HttpErrorResponse) => {\n                            this.error(err);\n                        });\n                    }\n                    else {\n                        this.page = nextPage;\n                    }\n                }\n            }\n            else {\n                this.page = nextPage;\n\n                this.modalStepConfig = {\n                    \"steps\": [\n                        { \"label\": \"Category\", \"active\": true, \"enabled\": false },\n                        { \"label\": \"Final\", \"active\": true, \"enabled\": true }\n                    ]\n                };\n            }\n        }\n    }\n\n    handleBackPage(): void {\n\n        if (this.page.index > 0) {\n\n            const prevPage = this.pages[this.page.index - 1];\n\n            if (prevPage.type === 'CATEGORY') {\n                this.labels.splice(this.labels.length - 1, 1);\n\n                this.modalStepConfig.steps.forEach(step => {\n                    if (step.label.toLowerCase() === \"category\" && step.enabled === false) {\n                        this.modalStepConfig = {\n                            \"steps\": [\n                                { \"label\": \"Category\", \"active\": true, \"enabled\": true },\n                                { \"label\": \"Final\", \"active\": true, \"enabled\": false }\n                            ]\n                        };\n                    }\n                })\n            }\n\n            this.page = prevPage;\n        }\n    }\n\n    handleUpload(): void {\n\n\n        if (!this.existingTask) {\n            /*\n             * Validate form values before uploading\n             */\n            const selection = this.selections[this.selections.length - 1];\n\n            //            if ( selection.value == null  ) {\n            //                this.message = \"A [\" + selection.type + \"] must first be selected before the file can be uploaded\";\n            //            }\n            //            else {\n            //                this.values.uasComponentOid = selection.value;\n            this.values.selections = JSON.stringify(this.selections);\n            this.values.uploadTarget = this.metadataService.getUploadTarget(selection.type);\n\n            this.uploader.setParams(this.values);\n            this.uploader.uploadStoredFiles();\n            //            }\n        }\n        else {\n            this.uploader.uploadStoredFiles();\n        }\n    }\n\n    hasField(fieldName: string): boolean {\n        return this.metadataService.hasExtraField(this.page.selection.type, fieldName);\n    }\n\n    removeUpload(event: any): void {\n        let that = this;\n\n        this.bsModalRef = this.modalService.show(BasicConfirmModalComponent, {\n            animated: true,\n            backdrop: true,\n            ignoreBackdropClick: true,\n        });\n        this.bsModalRef.content.message = 'Are you sure you want to cancel the upload of [' + this.uploader.getResumableFilesData()[0].name + ']';\n        this.bsModalRef.content.type = 'DANGER';\n        this.bsModalRef.content.submitText = 'Cancel Upload';\n\n        this.bsModalRef.content.onConfirm.subscribe(data => {\n            this.service.removeTask(this.uploader.getResumableFilesData()[0].uuid)\n                .then(() => {\n                    //that.uploader.clearStoredFiles();\n                    //that.uploader.cancelAll()\n\n                    // The above clearStoredFiles() and cancelAll() methods don't appear to work so \n                    // we are clearing localStorage manually.\n                    localStorage.clear();\n                    that.existingTask = false;\n                    this.page = this.pages[0];\n                    //                    that.showUploadPanel();\n                }).catch((err: HttpErrorResponse) => {\n                    this.error(err);\n                });\n        });\n    }\n\n    //    hideUploadPanel(): void {\n    //        this.uploadVisible = false;\n    //    }\n    //\n    //    showUploadPanel(): void {\n    //        this.uploadVisible = true;\n    //        this.selectedContinue = true;\n    //    }\n\n    countUpload(thisRef: any): void {\n        let ct = 0;\n\n        function incrementSeconds() {\n            ct += 1;\n\n            let hours = Math.floor(ct / 3600)\n            let minutes = Math.floor((ct % 3600) / 60);\n            let seconds = Math.floor(ct % 60);\n\n            let hoursStr = minutes < 10 ? \"0\" + hours : hours;\n            let minutesStr = minutes < 10 ? \"0\" + minutes : minutes;\n            let secondsStr = seconds < 10 ? \"0\" + seconds : seconds;\n\n            thisRef.uploadCounter = hoursStr + \":\" + minutesStr + \":\" + secondsStr;\n        }\n\n        thisRef.uplodeCounterInterfal = setInterval(incrementSeconds, 1000);\n    }\n\n    error(err: any): void {\n        // Handle error\n        if (err !== null) {\n            this.message = (err.error.localizedMessage || err.error.message || err.message);\n        }\n    }\n\n    public canDeactivate(): boolean {\n        return this.disabled;\n    }\n\n    @HostListener('window:beforeunload', ['$event'])\n    unloadNotification($event: any) {\n        if (this.disabled) {\n            $event.returnValue = 'An upload is currently in progress. Are you sure you want to leave?';\n        }\n    }\n}\n","<div class=\"modal-body\">\n  <div>\n    <div *ngIf=\"message != null\" class=\"error-container\">\n      <div class=\"label-holder\">\n        <strong>Error</strong>\n      </div>\n      <div class=\"holder\">\n        <div>\n          <p class=\"error-message\">{{message}}</p>\n        </div>\n      </div>\n    </div>\n\n    <div *ngIf=\"entity != null\">\n      <div class=\"row\">\n        <div class=\"col-md-12\">\n          <h2>{{entity.name}}</h2>\n        </div>\n      </div>\n\n      <div class=\"row\">\n        <div class=\"col-md-12\">\n          <ul class=\"breadcrumb\" style=\"margin-bottom: 10px;\">\n            <li *ngFor=\"let prev of previous\">\n              <span> {{prev.name}}</span>\n            </li>\n          </ul>\n        </div>\n      </div>\n\n      <div class=\"row\">\n        <tabset class=\"nav-full-width\">\n          <tab *ngFor=\"let folder of folders\" [heading]=\"folder.name\" (selectTab)=\"onSelect(folder)\">\n            <div class=\"row image-list-container\">              \n              <div class=\"col-sm-12\">\n                <table class=\"table table-striped\">\n                  <thead>\n                    <tr>\n                      <th scope=\"col\"></th>\n                      <th scope=\"col\">Name</th>\n                      <th scope=\"col\">Date uploaded</th>\n                    </tr>\n                  </thead>\n                  <tbody class=\"upload-name-style\">\n                    <tr *ngFor=\"let item of page.results  | paginate: { itemsPerPage: page.pageSize, currentPage: page.pageNumber, totalItems: page.count }\">\n                      <td class=\"button-column\">\n                        <a class=\"fa fa-download\" (click)=\"handleDownloadFile(item)\" title=\"Download\"></a>\n                        <a style=\"margin-left: 5px;\" class=\"fa fa-trash-alt ico-remove\" (click)=\"handleDelete(item)\" title=\"Remove\"></a>\n                      </td>\n                      <td>{{ item.name }}</td>\n                      <td>{{ item.lastModified }}</td>\n                    </tr>\n                  </tbody>\n                </table>\n              </div>\n            </div>\n            <div class=\"row\">\n                   <div class=\"col-sm-12\">\n                <ngx-file-drop dropZoneLabel=\"Drop files here\" (onFileDrop)=\"dropped($event)\">\n                  <ng-template ngx-file-drop-content-tmp let-openFileSelector=\"openFileSelector\">\n                    Drag & Drop File\n                    <button type=\"button\" (click)=\"openFileSelector()\">Browse Files</button>\n                  </ng-template>\n                </ngx-file-drop>\n              </div> \n            </div>\n          </tab>\n        </tabset>\n      </div>\n      \n      <div class=\"row\">      \n        <pagination-controls (pageChange)=\"onPageChange($event)\"></pagination-controls>\n      </div>\n\n      <div class=\"row\">      \n        <div class=\"btn-holder\" style=\"text-align: right;margin: 20px 20px 10px 20px;\">\n          <button type=\"button\" class=\"btn btn-default\" (click)=\"bsModalRef.hide()\">Close</button>\n          <button type=\"button\" class=\"btn btn-secondary\" (click)=\"handleDownload()\" style=\"margin-left: 5px;\">Download all</button>\n        </div>\n      </div>\n  </div>\n</div>\n","import { Component, OnInit } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { NgxFileDropEntry, FileSystemFileEntry, FileSystemDirectoryEntry } from 'ngx-file-drop';\n\nimport { BasicConfirmModalComponent } from '../../../shared/component/modal/basic-confirm-modal.component';\nimport { SiteEntity, SiteObjectsResultSet } from '../../model/management';\nimport { ManagementService } from '../../service/management.service';\n\ndeclare var acp: string;\n\n@Component({\n    selector: 'accessible-support-modal',\n    templateUrl: './accessible-support-modal.component.html',\n    styles: [],\n})\nexport class AccessibleSupportModalComponent implements OnInit {\n\n    /* \n     * Breadcrumb of previous sites clicked on\n     */\n    previous = [] as SiteEntity[];\n    folders: SiteEntity[] = [];\n    message: string;\n\n    entity: SiteEntity;\n    folder: SiteEntity;\n\n    page: SiteObjectsResultSet = new SiteObjectsResultSet();\n\n    constructor(private service: ManagementService, private modalService: BsModalService, public bsModalRef: BsModalRef) {\n    }\n\n    ngOnInit(): void {\n        this.page.count = 0;\n        this.page.pageNumber = 1;\n        this.page.pageSize = 10;\n        this.page.results = [];\n    }\n\n    init(entity: SiteEntity, folders: SiteEntity[], previous: SiteEntity[]): void {\n\n        this.entity = entity;\n        this.folders = folders;\n        this.previous = [...previous];\n\n        if (this.previous.length > 0 && this.previous[this.previous.length - 1].id !== this.entity.id) {\n            this.previous.push(this.entity);\n        }\n\n        if (this.folders.length > 0) {\n            this.onSelect(this.folders[0]);\n        }\n    }\n\n    onPageChange(pageNumber: number): void {\n        this.getData(this.folder.component, this.folder.name, pageNumber, this.page.pageSize);\n    }\n\n    onSelect(folder: SiteEntity): void {\n\n        this.page.results = [];\n\n        this.folder = folder;\n\n        this.getData(folder.component, folder.name, 1, this.page.pageSize);\n    }\n\n    refresh(): void {\n\n        this.page.results = [];\n\n        this.getData(this.folder.component, this.folder.name, this.page.pageNumber, this.page.pageSize);\n    }\n\n    getData(component: string, folder: string, pageNumber: number, pageSize: number) {\n        this.service.getObjects(component, folder, pageNumber, pageSize).then(page => {\n            this.page = page;\n        });\n    }\n\n    handleDownload(): void {\n        window.location.href = acp + '/project/download-all?id=' + this.folder.component + \"&key=\" + this.folder.name;\n    }\n\n    handleDownloadFile(item: SiteEntity): void {\n        window.location.href = acp + '/project/download?id=' + this.folder.component + \"&key=\" + item.key;\n    }\n\n    dropped(files: NgxFileDropEntry[]): void {\n\n        for (const droppedFile of files) {\n\n            // Is it a file?\n            if (droppedFile.fileEntry.isFile) {\n                const fileEntry: FileSystemFileEntry = droppedFile.fileEntry as FileSystemFileEntry;\n\n                fileEntry.file((file: File) => {\n\n                    this.service.upload(this.folder.component, this.folder.name, file).then(() => {\n                        // Refresh the table\n                        this.refresh();\n                    });\n\n                });\n            } else {\n                // It was a directory (empty directories are added, otherwise only files)\n                const fileEntry: FileSystemDirectoryEntry = droppedFile.fileEntry as FileSystemDirectoryEntry;\n                console.log(droppedFile.relativePath, fileEntry);\n            }\n        }\n    }\n\n    handleDelete(item: SiteEntity): void {\n        let modalRef: BsModalRef = this.modalService.show(BasicConfirmModalComponent, {\n            animated: true,\n            backdrop: true,\n            ignoreBackdropClick: true,\n        });\n        modalRef.content.message = 'Are you sure you want to delete the file [' + item.name + ']?';\n        modalRef.content.type = 'DANGER';\n        modalRef.content.submitText = 'Delete';\n\n        modalRef.content.onConfirm.subscribe(() => {\n            this.remove(item);\n        });\n    }\n\n    remove(item: SiteEntity): void {\n        this.service.removeObject(item.component, item.key).then(() => {\n            // Refresh the table\n            this.refresh();\n        });\n    }\n\n    error(err: HttpErrorResponse): void {\n        // Handle error\n        if (err !== null) {\n            this.message = (err.error.localizedMessage || err.error.message || err.message);\n        }\n    }\n}\n","<div id=\"navigator-header-container\">\n    <uasdm-header [title]=\"'Site Viewer'\"></uasdm-header>\n</div>\n\n<div id=\"app-container\" class=\"container-fluid\" style=\"background: #f7f7f7;\">\n\n    <div class=\"row\">\n        <div id=\"navigator-left-sidebar\" class=\"col-md-3 lw-inner-col\">\n            <div class=\"row\">\n              <div class=\"col-md-12\">\n            \n                  <!-- IF at Site level -->\n                  <div class=\"row\" *ngIf=\"!current\">\n                    <div class=\"col-md-6\" style=\"height: 56px;\">\n                      <h3>IDM Sites</h3>\n                    </div>\n                  </div>\n            \n                  <!-- IF lower than Site -->\n                  <div class=\"row\" *ngIf=\"current\">\n                    <div class=\"col-md-12\" style=\"height: 56px; overflow: scroll;\">\n                      <ul class=\"breadcrumb\" style=\"background-color: white;\">\n                        <li>\n                          <i class=\"fa fa-angle-left breadcrumb-back-ico\" aria-hidden=\"true\"></i>\n                          <a (click)=\"back(null)\" style=\"color: #007276;\">IDM Sites</a>\n                        </li>\n                        <li *ngFor=\"let entity of breadcrumbs; last as isLast\" [ngClass]=\"{'active':isLast}\">\n                          <a *ngIf=\"!isLast\" (click)=\"back(entity)\" style=\"color: #007276;\"> {{entity.name}}</a>\n                          <span *ngIf=\"isLast\"> <b>{{entity.name}}</b> </span>\n                        </li>\n                      </ul>\n                    </div>\n                  </div>\n            \n                  <!-- Search bar -->\n                  <div class=\"row\">\n                    <div class=\"col-md-12\">\n                      <div class=\"location-management-widget-section\">\n                        <input class=\"form-control search-input\" type=\"text\" placeholder=\"Search...\" [(ngModel)]=\"search\"\n                          [typeaheadAsync]=\"true\" [typeahead]=\"dataSource\" (typeaheadOnSelect)=\"handleClick($event)\"\n                          [typeaheadOptionsLimit]=\"10\" [typeaheadItemTemplate]=\"bsItemTemplate\" typeaheadOptionField=\"label\"\n                          [ngModelOptions]=\"{standalone: true}\" (keydown.enter)=\"$event.preventDefault()\" />\n                      </div>\n                    </div>\n                  </div>\n              </div>\n            </div>\n\n            <!-- <hr> -->\n\n            <div class=\"row\">\n                <div class=\"col-md-12\" style=\"background:#f7f7f7; padding:0; height:100%;\">\n                  \n                  <tabset #staticTabs class=\"nav-full-width\">\n                    <tab heading=\"Data\">                \n                      <div id=\"hierarchy-tree-container\" class=\"location-management-widget-section location-management-list-container\"\n                      style=\"height: calc(100vh - 290px);overflow-y: auto;\">\n                        <div class=\"list-group\">\n\n                          <!-- If -->\n                          <div *ngIf=\"nodes.length < 1 && breadcrumbs.length === 0\" [@fadeInOnEnter] style=\"padding: 20px;text-align: center;color: grey;\">\n                            <h4>No Sites in this area.</h4>\n                            <p>\n                              Zoom out to find sites in other areas of the map.\n                            </p>\n                          </div>\n\n                          <!-- Else -->\n                          <div *ngIf=\"nodes.length < 1 && breadcrumbs.length > 0\" [@fadeInOnEnter] style=\"padding: 20px;text-align: center;color: grey;\">\n                            <h4>No data at this level.</h4>\n                            <p>\n                              Create data containers as part of the upload process.\n                            </p>\n                          </div>\n\n                          <div *ngFor=\"let node of nodes; let i = index\" [@fadeInOnEnter] class=\"list-group-item\">\n\n                            <!-- Two column layout -->\n                            <div [@fadeInOnEnter] style=\"border-left: solid 15px;\" class=\"card card-default clickable\" *ngIf=\"getMetadata(node).root\" [ngClass]=\"{'active': hoverFeatureId === node.id}\"\n                                (click)=\"select(node, null, $event)\" (mouseenter)=\"onListEntityHover($event, node)\" (mouseleave)=\"onListEntityHoverOff()\">\n                              \n                                <!-- <div class=\"card-header\">Header</div> -->\n                              <div class=\"card-body card-5-7\" >\n                                <div class=\"card-left\">\n                                  <!-- <img src=\"https://via.placeholder.com/75x75\" class=\"img-responsive\"> -->\n                                   <i class=\"fas fa-map-marker-alt\" style=\"font-size: 50px;\"></i>\n                                </div>\n                                <div class=\"card-right\">\n                                  <h4 style=\"word-break: break-all;\">\n                                    <!-- <a (click)=\"select(node, $event)\"> -->\n                                      {{node.name}}\n                                    <!-- </a> -->\n                                  </h4>\n                                  <span *ngIf=\"node.type !== 'folder'\" class=\"pull-right button-column floating\" style=\"top: 0;position: absolute;right: 0;\">\n                                    <a class=\"fa fa-pencil-alt ico-edit\" (click)=\"handleEdit(node, $event)\" title=\"Edit\"></a>\n                                    <a class=\"fa fa-trash-alt ico-remove\" (click)=\"handleDelete(node, $event)\" title=\"Delete\"></a>                                   \n                                  </span>  \n                                  <p><b>{{node.numberOfChildren}}</b> {{getMetadata(node).childLabel}}</p>\n                                </div>\n                              </div>\n                              <!-- <div class=\"card-footer\">Footer</div> -->\n                            </div>\n\n\n                            <!-- Single column card -->\n                            <div [@fadeInOnEnter] class=\"card card-default clickable\" *ngIf=\"!getMetadata(node).root\" (click)=\"select(node, null, $event)\">\n                              <div class=\"card-body\">\n                                  <i (click)=\"handleExpand(node, $event)\" class=\"fa fa-caret-left expand-arrow-ico pull-right\" [ngClass]=\"{'fa-rotate-270':node.active}\" style=\"font-size: 25px; padding: 0 5px\" aria-hidden=\"true\"></i>\n\n                                  <h4 style=\"word-break: break-all;\">{{node.name}}</h4>\n                                  <p><b>{{node.numberOfChildren}}</b> {{getMetadata(node).childLabel}}</p>\n                                  \n                                  <div [collapse]=\"!node.active\" class=\"list-group\" style=\"margin-bottom: 0;\">\n                                    <div *ngFor=\"let child of node.children\" (click)=\"select(child, node, $event)\" class=\"list-group-item\" style=\"background-color: #ececec;border: solid 1px lightgrey;border-radius: 0;\">\n                                      <!-- <a (click)=\"select(child, $event)\"> -->\n                                        {{child.name}}\n                                      <!-- </a> -->\n                                      <span *ngIf=\"child.type !== 'folder'\" class=\"pull-right button-column\">\n                                        <a class=\"fa fa-pencil-alt ico-edit\" (click)=\"handleEdit(child, $event)\" title=\"Edit\"></a>\n                                        <a class=\"fa fa-trash-alt ico-remove\" (click)=\"handleDelete(child, $event)\" title=\"Delete\"></a>                                   \n                                      </span>                                 \n                                    </div>\n                                  </div>\n                              </div>\n                            </div>\n\n                          </div> \n\n                          <div *ngFor=\"let node of supportingData\" class=\"list-group-item\">\n                            <div [@fadeInOnEnter] class=\"card card-default\">\n                              <div class=\"card-body\">\n                                <h4 style=\"word-break: break-all;\">Supporting Data</h4>\n                                <div class=\"list-group\">\n                                  <div class=\"list-group-item\" style=\"background-color: #ececec;border: solid 1px lightgrey;border-radius: 0;\">\n                                    <a (click)=\"select(node, null, $event)\">\n                                      {{node.name}}\n                                    </a>\n                                  </div>\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n\n                        </div>\n                      </div>\n                      <!-- <div *ngIf=\"supportingData.length > 0\" class=\"location-management-widget-section location-management-list-container\">\n                        \n                            <div class=\"card card-default\">\n                              <div class=\"card-body\">\n                                <h4>Supporting Data</h4>\n                                <div class=\"list-group\">\n                                  <div *ngFor=\"let node of supportingData\" class=\"list-group-item\" style=\"background-color: #ececec;border: solid 1px lightgrey;border-radius: 0;\">\n                                    <a (click)=\"select(node, $event)\">\n                                      {{node.name}}\n                                    </a>\n                                  </div>\n                                </div>\n                              </div>\n                            </div>\n                      </div> -->\n\n                    </tab>\n                    <tab *ngIf=\"current != null\" heading=\"Products\">\n                      <div id=\"hierarchy-tree-container\" class=\"location-management-widget-section location-management-list-container\"\n                      style=\"height: calc(100vh - 290px);overflow-y: auto;\">\n                        <product-panel [id]=\"current.id\" (toggleMapImage)=\"handleMapImage($event)\"></product-panel>           \n                      </div>\n                    </tab>\n                  </tabset>\n\n                </div>\n            </div>\n            \n\n            <footer class=\"sidebar-footer\">\n              <div class=\"row\" *ngIf=\"current != null\" style=\"background:white;\">\n                <div class=\"col-md-12\" style=\"text-align: center;padding: 10px;border-top: 1px solid lightgrey;\">\n                  <button (click)=\"handleUploadFile()\" class=\"btn btn-primary\">Upload</button>              \n                </div>\n              </div>\n              <div class=\"row\" *ngIf=\"current == null\" style=\"background:white;\">\n                <div class=\"col-md-12\" style=\"text-align: center;padding: 10px;border-top: 1px solid lightgrey;\">\n                  <button (click)=\"handleCreate(null,null)\" class=\"btn btn-primary\">Add new site</button>\n                </div>\n              </div>\n            </footer>\n            \n        </div>\n        <div class=\"col-md-9\" id=\"site-explorer-map\">\n            <div class=\"row\">\n                <article style=\"position: absolute;z-index: 5;margin-left: 100px;margin-top: 10px;\">\n                  <div class=\"idm-toast\" *ngFor=\"let task of tasks; let idx = index\">\n                    <alert *ngIf=\"task.status === 'Complete' && task.actions.length === 0\" type=\"success\" [dismissible]=\"true\" (onClosed)=\"handleCloseToast(idx)\">\n                      <strong>Upload {{task.status}}</strong> for {{task.collectionLabel}}. <a (click)=\"handleViewSite(task.collection)\">Goto the collection view</a>\n                    </alert>\n                    <alert *ngIf=\"task.status === 'Complete' && task.actions.length !== 0\" type=\"warning\" [dismissible]=\"true\" (onClosed)=\"handleCloseToast(idx)\">\n                      <strong>Upload {{task.status}}</strong> for {{task.collectionLabel}}. Task completed with warnings.  See the <a routerLink=\"/site/tasks\">task page</a> for more details.\n                    </alert>\n                    <alert *ngIf=\"task.status === 'Failed'\" type=\"danger\" [dismissible]=\"true\" (onClosed)=\"handleCloseToast(idx)\">\n                      <strong>Upload {{task.status}}</strong> for {{task.collectionLabel}}. Task completed with errors.  See the <a routerLink=\"/site/tasks\">task page</a> for more details.\n                    </alert>\n                    <alert *ngIf=\"task.status !== 'Failed' && task.status !== 'Complete'\" type=\"info\" [dismissible]=\"true\" (onClosed)=\"handleCloseToast(idx)\">\n                      <strong>Upload {{task.status}}</strong> for {{task.collectionLabel}}.\n                    </alert>\n                  </div>    \n                </article>\n\n\n                <article class=\"base-layer-panel\">\n\n                  <div class=\"layer-toggle\" style=\"cursor: pointer;background:#fff;padding:8px;border-radius:4px;\" (mouseenter)=\"baselayerIconHover = true\"  (mouseleave)=\"baselayerIconHover = false\">\n                    <i class=\"fas fa-layer-group\" *ngIf=\"!baselayerIconHover\" style=\"vertical-align:middle; font-size: 18px;\"></i>\n                    <div *ngIf=\"baselayerIconHover\">\n                      <div class=\"row-form\" *ngFor=\"let baseLayer of baseLayers\">\n                          <input class=\"layer-toggle-input\" type='radio' name='rtoggle' [value]='baseLayer.id' [checked]=\"baseLayer.selected\" (change)=\"handleStyle(baseLayer)\">\n                          <label class=\"layer-toggle-label\">{{baseLayer.label}}</label>\n                        </div>\n                    </div>\n                  </div>\n                    <!-- <accordion> \n                      <accordion-group heading=\"Base Maps\" style=\"border:none;\">\n                        <div class=\"row-form\" *ngFor=\"let baseLayer of baseLayers\">\n                          <input class=\"layer-toggle-input\" type='radio' name='rtoggle' [value]='baseLayer.id' [checked]=\"baseLayer.selected\" (change)=\"handleStyle(baseLayer)\">\n                          <label class=\"layer-toggle-label\">{{baseLayer.label}}</label>\n                        </div>\n                      </accordion-group>\n                    </accordion> -->\n                </article>\n\n                <div id=\"mousemove-panel\" class=\"mapboxgl-ctrl-bottom-right\" style=\"background: rgba(255, 255, 255, .5); right: 0; padding: 0 5px 0 5px;bottom: 15px;\"></div>\n\n                <div id=\"map\" class=\"map-view-port\"></div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<ng-template #bsItemTemplate let-match=\"match\" let-query=\"query\">\n  <span *ngIf=\"match.item.filename == null\">\n    <i class=\"fa fa-folder-open\"></i>\n  </span>\n  <span *ngIf=\"match.item.filename != null\">\n    <i class=\"fa fa-file\"></i>\n  </span>\n  <span>\n    <span *ngFor=\"let site of match.item.hierarchy; index as i\">\n        {{site.label}} /\n        <!-- <span *ngIf=\"i < (match.item.hierarchy.length -1)\">/</span> -->\n    </span>\n  </span>\n  <b>{{ match.item.label}}</b>\n</ng-template>\n\n","import { Component, OnInit, OnDestroy, AfterViewInit, ViewChild, TemplateRef } from '@angular/core';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { TabsetComponent } from 'ngx-bootstrap';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { Map, LngLatBounds, NavigationControl, MapboxEvent, AttributionControl } from 'mapbox-gl';\n\nimport { Observable, Subject } from 'rxjs';\nimport { debounceTime, distinctUntilChanged } from \"rxjs/operators\";\nimport { webSocket, WebSocketSubject } from \"rxjs/webSocket\";\n\nimport { BasicConfirmModalComponent } from '../../shared/component/modal/basic-confirm-modal.component';\nimport { AuthService } from '../../shared/service/auth.service';\n\nimport { SiteEntity, Product, Task } from '../model/management';\n\nimport { EntityModalComponent } from './modal/entity-modal.component';\nimport { UploadModalComponent } from './modal/upload-modal.component';\nimport { LeafModalComponent } from './modal/leaf-modal.component';\nimport { AccessibleSupportModalComponent } from './modal/accessible-support-modal.component';\n\nimport { ManagementService } from '../service/management.service';\nimport { MapService } from '../service/map.service';\nimport { MetadataService } from '../service/metadata.service';\n\nimport {\n    fadeInOnEnterAnimation,\n    fadeOutOnLeaveAnimation\n} from 'angular-animations';\n\n\ndeclare var acp: any;\n\n@Component({\n    selector: 'projects',\n    templateUrl: './projects.component.html',\n    styles: ['./projects.css'],\n    animations: [\n        fadeInOnEnterAnimation(),\n        fadeOutOnLeaveAnimation()\n    ]\n})\nexport class ProjectsComponent implements OnInit, AfterViewInit, OnDestroy {\n\n    @ViewChild('staticTabs') staticTabs: TabsetComponent;\n\n    // imageToShow: any;\n    userName: string = \"\";\n\n    /*\n     * Template for the delete confirmation\n     */\n    @ViewChild('confirmTemplate') public confirmTemplate: TemplateRef<any>;\n\n    /* \n     * Datasource to get search responses\n     */\n    dataSource: Observable<any>;\n\n    /* \n     * Model for text being searched\n     */\n    search: string = \"\";\n\n    /* \n     * Root nodes of the tree\n     */\n    nodes = [] as SiteEntity[];\n\n    /* \n     * Root nodes of the tree\n     */\n    supportingData = [] as SiteEntity[];\n\n    /* \n     * Breadcrumb of previous sites clicked on\n     */\n    breadcrumbs = [] as SiteEntity[];\n\n    /* \n     * Root nodes of the tree\n     */\n    current: SiteEntity;\n\n    /* \n     * mapbox-gl map\n     */\n    map: Map;\n\n    /* \n     * Flag denoting if the user is an admin\n     */\n    admin: boolean = false;\n\n    /* \n     * Flag denoting if the user is a worker\n     */\n    worker: boolean = false;\n\n    /* \n     * Flag denoting the draw control is active\n     */\n    active: boolean = false;\n\n    /* \n     * List of base layers\n     */\n    baseLayers: any[] = [{\n        label: 'Outdoors',\n        id: 'outdoors-v11',\n        selected: true\n    }, {\n        label: 'Satellite',\n        id: 'satellite-v9'\n    }, {\n        label: 'Streets',\n        id: 'streets-v11'\n    }];\n\n    layers: { workspace: string, mapKey: string }[] = [];\n\n    baselayerIconHover = false;\n\n    hoverFeatureId: string;\n\n\t/* \n     * debounced subject for map extent change events\n     */\n    subject: Subject<MapboxEvent<MouseEvent | TouchEvent | WheelEvent>>;\n\n    /*\n     * Reference to the modal current showing\n    */\n    private bsModalRef: BsModalRef;\n\n    notifier: WebSocketSubject<any>;\n\n    tasks: Task[] = [];\n\n    constructor(private service: ManagementService, private authService: AuthService, private mapService: MapService,\n        private modalService: BsModalService, private metadataService: MetadataService) {\n\n        this.subject = new Subject();\n        this.subject.pipe(debounceTime(300), distinctUntilChanged()).subscribe(event => this.handleExtentChange(event));\n\n        this.dataSource = Observable.create((observer: any) => {\n\n            this.mapService.mbForwardGeocode(this.search).then(response => {\n                const match = response.features;\n\n                this.service.searchEntites(this.search).then(results => {\n\n                    // Add Mapbox results to any local results\n                    match.forEach(obj => {\n                        let newObj = {\n                            id: obj.id,\n                            hierarchy: [],\n                            label: obj.place_name,\n                            center: obj.center,\n                            source: \"MAPBOX\"\n                        }\n\n                        results.push(newObj);\n                    });\n\n                    observer.next(results);\n                });\n            });\n        });\n    }\n\n    ngOnInit(): void {\n        this.admin = this.authService.isAdmin();\n        this.worker = this.authService.isWorker();\n        this.userName = this.service.getCurrentUser();\n\n\n        let baseUrl = \"wss://\" + window.location.hostname + (window.location.port ? ':' + window.location.port : '') + acp;\n\n        this.notifier = webSocket(baseUrl + '/websocket/notify');\n        this.notifier.subscribe(task => {\n            this.tasks.push(task)\n        });\n    }\n\n    ngOnDestroy(): void {\n        this.map.remove();\n\n        this.notifier.complete();\n    }\n\n    ngAfterViewInit() {\n\n        this.map = new Map({\n            container: 'map',\n            style: 'mapbox://styles/mapbox/outdoors-v11',\n            zoom: 2,\n            attributionControl: false,\n            center: [-78.880453, 42.897852]\n        });\n\n        this.map.on('load', () => {\n            this.initMap();\n        });\n\n    }\n\n    initMap(): void {\n\n        this.map.on('style.load', () => {\n            this.addLayers();\n            this.refresh(false);\n        });\n\n        this.addLayers();\n\n\n        this.refresh(true);\n\n        // Add zoom and rotation controls to the map.\n        this.map.addControl(new NavigationControl());\n        this.map.addControl(new AttributionControl({ compact: true }), 'bottom-left');\n\n        this.map.on('mousemove', e => {\n            // e.point is the x, y coordinates of the mousemove event relative\n            // to the top-left corner of the map.\n            // e.lngLat is the longitude, latitude geographical position of the event\n            let coord = e.lngLat.wrap();\n\n            // EPSG:3857 = WGS 84 / Pseudo-Mercator\n            // EPSG:4326 = WGS 84 \n            // let coord4326 = window.proj4(window.proj4.defs('EPSG:3857'), window.proj4.defs('EPSG:4326'), [coord.lng, coord.lat]);\n            // let text = \"Long: \" + coord4326[0] + \" Lat: \" + coord4326[1];\n\n            let text = \"Lat: \" + coord.lat + \" Long: \" + coord.lng;\n            let mousemovePanel = document.getElementById(\"mousemove-panel\");\n            mousemovePanel.textContent = text;\n\n\n            let features = this.map.queryRenderedFeatures(e.point, { layers: ['points'] });\n\n            if (this.current == null) {\n                if (features.length > 0) {\n                    let focusFeatureId = features[0].properties.oid; // just the first\n                    this.map.setFilter('hover-points', ['all',\n                        ['==', 'oid', focusFeatureId]\n                    ])\n\n                    this.highlightListItem(focusFeatureId)\n                }\n                else {\n                    this.map.setFilter('hover-points', ['all',\n                        ['==', 'oid', \"NONE\"]\n                    ])\n\n                    this.clearHighlightListItem();\n                }\n            }\n        });\n\n        this.map.on('zoomend', (e) => {\n            this.subject.next(e);\n        });\n\n        this.map.on('moveend', (e) => {\n            this.subject.next(e);\n        });\n\n        // MapboxGL doesn't have a good way to detect when moving off the map\n        let sidebar = document.getElementById(\"navigator-left-sidebar\");\n        sidebar.addEventListener(\"mouseenter\", function() {\n            let mousemovePanel = document.getElementById(\"mousemove-panel\");\n            mousemovePanel.textContent = \"\";\n        });\n    }\n\n    addLayers(): void {\n\n        this.map.addSource('sites', {\n            type: 'geojson',\n            data: {\n                \"type\": \"FeatureCollection\",\n                \"features\": []\n            }\n        });\n\n\n        // Point layer\n        this.map.addLayer({\n            \"id\": \"points\",\n            \"type\": \"circle\",\n            \"source\": 'sites',\n            \"paint\": {\n                \"circle-radius\": 10,\n                \"circle-color\": '#800000',\n                \"circle-stroke-width\": 2,\n                \"circle-stroke-color\": '#FFFFFF'\n            }\n        });\n\n        // Hover style\n        this.map.addLayer({\n            \"id\": \"hover-points\",\n            \"type\": \"circle\",\n            \"source\": 'sites',\n            \"paint\": {\n                \"circle-radius\": 13,\n                \"circle-color\": '#cf0000',\n                \"circle-stroke-width\": 2,\n                \"circle-stroke-color\": '#FFFFFF'\n            },\n            filter: ['all',\n                ['==', 'id', 'NONE'] // start with a filter that doesn't select anything\n            ]\n        });\n\n\n        // Label layer\n        this.map.addLayer({\n            \"id\": \"points-label\",\n            \"source\": 'sites',\n            \"type\": \"symbol\",\n            \"paint\": {\n                \"text-color\": \"black\",\n                \"text-halo-color\": \"#fff\",\n                \"text-halo-width\": 2\n            },\n            \"layout\": {\n                \"text-field\": \"{name}\",\n                \"text-font\": [\"Open Sans Semibold\", \"Arial Unicode MS Bold\"],\n                \"text-offset\": [0, 0.6],\n                \"text-anchor\": \"top\",\n                \"text-size\": 12,\n            }\n        });\n\n        this.layers.forEach(layer => {\n            this.addImageLayer(layer.workspace, layer.mapKey);\n        });\n    }\n\n    handleExtentChange(e: MapboxEvent<MouseEvent | TouchEvent | WheelEvent>): void {\n        if (this.current == null) {\n            const bounds = this.map.getBounds();\n\n            // Sometimes bounds aren't valid for 4326, so validate it before sending to server\n            if (this.isValidBounds(bounds)) {\n                this.service.roots(null, bounds).then(nodes => {\n                    this.nodes = nodes;\n                });\n            }\n            else {\n                // console.log(\"Invalid bounds\", bounds);\n            }\n        }\n    }\n\n    isValidBounds(bounds: LngLatBounds): boolean {\n\n        const ne = bounds.getNorthEast();\n        const sw = bounds.getSouthWest();\n\n        if (Math.abs(ne.lng) > 180 || Math.abs(sw.lng) > 180) {\n            return false;\n        }\n\n        if (Math.abs(ne.lat) > 90 || Math.abs(sw.lat) > 90) {\n            return false;\n        }\n\n        return true;\n    }\n\n    refresh(zoom: boolean): void {\n        this.mapService.features().then(data => {\n            (<any>this.map.getSource('sites')).setData(data.features);\n\n            if (zoom) {\n                let bounds = new LngLatBounds([data.bbox[0], data.bbox[1]], [data.bbox[2], data.bbox[3]]);\n\n                this.map.fitBounds(bounds, { padding: 50 });\n            }\n        });\n    }\n\n    isData(node: any): boolean {\n\n        if (node.data.type === \"Site\") {\n            return false;\n        }\n        else if (node.data.type === \"Project\") {\n            return false;\n        }\n        else if (node.data.type === \"Mission\") {\n            return false;\n        }\n        else if (node.data.type === \"Collection\") {\n            return false;\n        }\n        else if (node.data.type === \"Imagery\") {\n            return false;\n        }\n        else {\n            return true;\n        }\n    }\n\n    handleOnUpdateData(): void {\n        //        this.tree.treeModel.expandAll();\n    }\n\n    handleCloseToast(idx: number): void {\n        this.tasks.splice(idx, 1);\n    }\n\n    handleUploadFile(): void {\n\n        this.bsModalRef = this.modalService.show(UploadModalComponent, {\n            animated: true,\n            backdrop: true,\n            ignoreBackdropClick: true,\n            'class': 'upload-modal'\n        });\n        this.bsModalRef.content.init(this.breadcrumbs);\n\n        this.bsModalRef.content.onUploadComplete.subscribe(node => {\n\n            this.service.getItems(this.current.id, null).then(nodes => {\n                this.setNodes(nodes);\n            });\n        });\n    }\n\n\n    handleCreate(parent: SiteEntity, type: string): void {\n        let parentId = parent != null ? parent.id : null;\n\n        this.service.newChild(parentId, type).then(data => {\n            this.bsModalRef = this.modalService.show(EntityModalComponent, {\n                animated: true,\n                backdrop: true,\n                ignoreBackdropClick: true,\n                'class': 'upload-modal'\n            });\n            this.bsModalRef.content.init(true, this.userName, this.admin, data.item, data.attributes, this.map.getCenter(), this.map.getZoom());\n\n\n            if (parent != null) {\n                this.bsModalRef.content.parentId = parent.id;\n            }\n\n            this.bsModalRef.content.onNodeChange.subscribe(entity => {\n\n                if (parent != null) {\n\n                }\n                else {\n                    if (this.breadcrumbs.length == 0) {\n                        this.nodes.push(entity);\n                    }\n\n                    this.refresh(false);\n                }\n            });\n        });\n    }\n\n    zoomToFeature(node: SiteEntity): void {\n        if (node.geometry != null) {\n            this.map.flyTo({\n                center: node.geometry.coordinates\n            });\n        }\n    }\n\n    handleEdit(node: SiteEntity, event: any): void {\n\n        event.stopPropagation();\n\n        this.service.edit(node.id).then(data => {\n            this.bsModalRef = this.modalService.show(EntityModalComponent, {\n                animated: true,\n                backdrop: true,\n                ignoreBackdropClick: true,\n                'class': 'edit-modal'\n            });\n            this.bsModalRef.content.init(false, this.userName, this.admin, data.item, data.attributes, this.map.getCenter(), this.map.getZoom());\n\n            this.bsModalRef.content.onNodeChange.subscribe(entity => {\n                // Update the node\n                entity.children = node.children;\n                entity.active = node.active;\n\n                this.refreshEntity(entity, this.nodes);\n                this.refreshEntity(entity, this.breadcrumbs);\n\n                this.nodes.forEach(node => {\n                    this.refreshEntity(entity, node.children);\n                });\n\n                if (this.metadataService.getMetadata(entity).root) {\n                    this.refresh(false);\n                }\n            });\n        });\n    }\n\n    refreshEntity(node: SiteEntity, nodes: SiteEntity[]): void {\n\n        if (nodes != null) {\n            let indexOf = nodes.findIndex(i => i.id === node.id);\n\n            if (indexOf !== -1) {\n                nodes[indexOf] = node;\n            }\n        }\n    }\n\n    handleDownloadAll(node: SiteEntity): void {\n\n        window.location.href = acp + '/project/download-all?id=' + node.component + \"&key=\" + node.name;\n\n        //      this.service.downloadAll( data.id ).then( data => {\n        //        \n        //      } ).catch(( err: HttpErrorResponse ) => {\n        //          this.error( err );\n        //      } );\n    }\n\n    handleDelete(node: SiteEntity, event: any): void {\n\n        event.stopPropagation();\n\n        let sText = '<b>IMPORTANT:</b> [' + node.name + '] will be deleted along with all underlying data including all files in Collections and Accessible Support';\n\n        if (node.type === 'Collection') {\n            sText = '<b>IMPORTANT:</b> [' + node.name + '] will be deleted along with all underlying data including all files.';\n        }\n\n        sText += ' This can <b>NOT</b> be undone';\n\n        this.bsModalRef = this.modalService.show(BasicConfirmModalComponent, {\n            animated: true,\n            backdrop: true,\n            ignoreBackdropClick: true,\n        });\n        this.bsModalRef.content.message = 'Are you sure you want to delete [' + node.name + ']?';\n        this.bsModalRef.content.subText = sText;\n        this.bsModalRef.content.data = node;\n        this.bsModalRef.content.type = 'DANGER';\n        this.bsModalRef.content.submitText = 'Delete';\n\n        (<BasicConfirmModalComponent>this.bsModalRef.content).onConfirm.subscribe(data => {\n            this.remove(data);\n        });\n    }\n\n    remove(node: SiteEntity): void {\n        this.service.remove(node.id).then(() => {\n            this.nodes = this.nodes.filter((n: any) => n.id !== node.id);\n\n            this.nodes.forEach(n => {\n                if (n.children != null) {\n                    n.children = n.children.filter((child: any) => child.id !== node.id);\n\n                    n.numberOfChildren = n.children.length;\n                }\n            });\n\n            if (node.type === 'Site') {\n                this.refresh(false);\n            }\n        });\n    }\n\n\n    handleDownload(node: SiteEntity): void {\n        window.location.href = acp + '/project/download?id=' + node.component + \"&key=\" + node.key;\n\n        //this.service.download( node.data.component, node.data.key, true ).subscribe( blob => {\n        //    importedSaveAs( blob, node.data.name );\n        //} );\n    }\n\n    handleImageDownload(image: any): void {\n        window.location.href = acp + '/project/download?id=' + image.component + \"&key=\" + image.key;\n\n        //this.service.download( node.data.component, node.data.key, true ).subscribe( blob => {\n        //    importedSaveAs( blob, node.data.name );\n        //} );\n    }\n\n    handleStyle(layer: any): void {\n\n        this.baseLayers.forEach(baseLayer => {\n            baseLayer.selected = false;\n        });\n\n        layer.selected = true;\n\n        this.map.setStyle('mapbox://styles/mapbox/' + layer.id);\n    }\n\n    highlightMapFeature(id: string): void {\n\n        this.map.setFilter('hover-points', ['all',\n            ['==', 'oid', id]\n        ])\n\n    }\n\n    clearHighlightMapFeature(): void {\n\n        this.map.setFilter('hover-points', ['all',\n            ['==', 'oid', \"NONE\"]\n        ])\n\n    }\n\n    onListEntityHover(event: any, site: SiteEntity): void {\n        if (this.current == null) {\n            this.highlightMapFeature(site.id);\n        }\n    }\n\n    onListEntityHoverOff(): void {\n        this.clearHighlightMapFeature();\n    }\n\n    highlightListItem(id: string): void {\n        this.nodes.forEach(node => {\n            if (node.id === id) {\n                this.hoverFeatureId = id;\n            }\n        })\n    }\n\n    clearHighlightListItem(): void {\n        if (this.hoverFeatureId) {\n            this.nodes.forEach(node => {\n                if (node.id === this.hoverFeatureId) {\n                    this.hoverFeatureId = null;\n                }\n            })\n        }\n    }\n\n\n    handleClick($event: any): void {\n        let result = $event.item;\n\n        if (result.center) {\n            this.map.flyTo({\n                center: result.center,\n                zoom: 18\n            })\n        }\n        else {\n            const index = result.hierarchy.length - 1;\n\n            const selected = result.hierarchy[index];\n\n            this.handleViewSite(selected.id);\n        }\n    }\n\n    handleViewSite(id: string): void {\n        this.service.view(id).then(response => {\n            const node = response.item;\n            const breadcrumbs = response.breadcrumbs;\n\n            if (this.getMetadata(node).leaf) {\n                this.breadcrumbs = breadcrumbs;\n                this.current = breadcrumbs[breadcrumbs.length - 1];\n                this.nodes = this.current.children;\n\n                this.select(node, null, null);\n            }\n            else {\n                const parent = breadcrumbs.length > 0 ? breadcrumbs[breadcrumbs.length - 1] : null;\n                this.breadcrumbs = breadcrumbs;\n\n                this.select(node, parent, null);\n            }\n        });\n\n    }\n\n    handleMapImage(product: Product): void {\n\n        const mapKey = product.mapKey;\n\n        if (mapKey != null) {\n            if (this.map.getLayer(mapKey) != null) {\n                this.map.removeLayer(mapKey);\n                this.map.removeSource(mapKey);\n\n                var index = this.layers.findIndex(layer => layer.mapKey === mapKey);\n                if (index !== -1) {\n                    this.layers.splice(index, 1);\n                }\n\n                product.orthoMapped = false;\n            }\n            else {\n                this.addImageLayer(product.workspace, mapKey);\n\n                this.layers.push({ workspace: product.workspace, mapKey: mapKey });\n\n                product.orthoMapped = true;\n\n                if (product.boundingBox != null) {\n                    let bbox = product.boundingBox;\n\n                    let bounds = new LngLatBounds([bbox[0], bbox[2]], [bbox[1], bbox[3]]);\n\n                    this.map.fitBounds(bounds, { padding: 50 });\n                }\n            }\n        }\n    }\n\n    addImageLayer(wkspace: string, imageKey: string) {\n        const workspace = encodeURI(wkspace);\n        const layerName = encodeURI(workspace + ':' + imageKey);\n\n        this.map.addLayer({\n            'id': imageKey,\n            'type': 'raster',\n            'source': {\n                'type': 'raster',\n                'tiles': [\n                    '/geoserver/' + workspace + '/wms?layers=' + layerName + '&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&srs=EPSG:3857&transparent=true&width=256&height=256'\n                ],\n                'tileSize': 256\n            },\n            'paint': {}\n        }, \"points\");\n    }\n\n    handleGoto(): void {\n\n        //    -111.12439336274211\n        //    39.32066259372583\n        //    -111.12342302258116\n        // 39.32107716199166\n\n        var bounds = new LngLatBounds([-111.12439336274211, 39.32066259372583, -111.12342302258116, 39.32107716199166]);\n\n        this.map.fitBounds(bounds);\n    }\n\n\n    getMetadata(node: SiteEntity): any {\n        const metadata = this.metadataService.getMetadata(node);\n\n        return metadata;\n    }\n\n\n    select(node: SiteEntity, parent: SiteEntity, event: any): void {\n\n        if (event != null) {\n            event.stopPropagation();\n        }\n\n        const metadata = this.metadataService.getMetadata(node);\n\n        if (metadata.leaf) {\n            const breadcrumbs = [...this.breadcrumbs];\n\n            if (parent != null) {\n                breadcrumbs.push(parent);\n            }\n\n            if (this.metadataService.getTypeContainsFolders(node)) {\n                this.service.getItems(node.id, null).then(nodes => {\n                    this.showLeafModal(node, nodes, breadcrumbs);\n                });\n            }\n            else {\n                this.showLeafModal(this.current, [node], breadcrumbs);\n            }\n        }\n        else if (node.type === \"object\") {\n            // Do nothing there are no children\n            //                return this.service.getItems( node.data.id, node.data.name );\n        }\n        else {\n            this.service.getItems(node.id, null).then(nodes => {\n                this.current = node;\n\n                if (parent != null) {\n                    this.addBreadcrumb(parent);\n                }\n\n                this.addBreadcrumb(node);\n                this.setNodes(nodes);\n            });\n        }\n    }\n\n    addBreadcrumb(node: SiteEntity): void {\n\n        if (this.breadcrumbs.length == 0 || this.breadcrumbs[this.breadcrumbs.length - 1].id !== node.id) {\n            this.breadcrumbs.push(node);\n        }\n    }\n\n    handleExpand(node: SiteEntity, event: any): void {\n\n        if (event != null) {\n            event.stopPropagation();\n        }\n\n        if (node.children == null || node.children.length == 0) {\n            this.service.getItems(node.id, null).then(nodes => {\n                node.children = nodes;\n\n                this.expand(node);\n            });\n        }\n        else {\n            // this.expand( node );\n            node.children = [];\n            node.active = false;\n        }\n    }\n\n    handleGotoSite(product: Product): void {\n        const entity = product.entities[product.entities.length - 1];\n\n        const breadcrumbs = product.entities;\n\n        this.service.getItems(entity.id, null).then(nodes => {\n            this.showLeafModal(entity, nodes, breadcrumbs);\n        });\n    }\n\n\n    back(node: SiteEntity): void {\n\n        if (node != null) {\n            this.service.getItems(node.id, null).then(nodes => {\n                var indexOf = this.breadcrumbs.findIndex(i => i.id === node.id);\n\n                this.current = node;\n                this.breadcrumbs.splice(indexOf + 1);\n                this.setNodes(nodes);\n            });\n        }\n        else if (this.breadcrumbs.length > 0) {\n            this.service.roots(null, this.map.getBounds()).then(nodes => {\n                this.current = null;\n                this.breadcrumbs = [];\n                this.setNodes(nodes);\n                this.staticTabs.tabs[0].active = true;\n            });\n        }\n    }\n\n    expand(node: SiteEntity) {\n        node.active = true;\n        this.current = node;\n    }\n\n    setNodes(nodes: SiteEntity[]): void {\n        this.nodes = [];\n        this.supportingData = [];\n\n        nodes.forEach(node => {\n            if (node.type === 'folder') {\n                this.supportingData.push(node);\n            }\n            else {\n                this.nodes.push(node);\n            }\n        })\n    }\n\n    showLeafModal(collection: SiteEntity, folders: SiteEntity[], breadcrumbs: SiteEntity[]): void {\n\n        if (collection.type === 'Mission') {\n            this.bsModalRef = this.modalService.show(AccessibleSupportModalComponent, {\n                animated: true,\n                backdrop: true,\n                ignoreBackdropClick: true,\n                class: 'leaf-modal'\n            });\n            this.bsModalRef.content.init(collection, folders, breadcrumbs);\n        }\n        else {\n            this.bsModalRef = this.modalService.show(LeafModalComponent, {\n                animated: true,\n                backdrop: true,\n                ignoreBackdropClick: true,\n                class: 'leaf-modal'\n            });\n            this.bsModalRef.content.init(collection, folders, breadcrumbs);\n        }\n    }\n\n\n\n    //    /*\n    //     *  Context menu visibility functions\n    //     */\n    //    public canEdit = ( item: any ): boolean => {\n    //        if ( this.admin ) {\n    //            return true;\n    //        }\n    //        else if ( this.worker ) {\n    //            return ( item.data.type === \"Mission\" || item.data.type === \"Collection\" );\n    //        }\n    //\n    //        return false;\n    //    }\n    //\n    //    public canRunOrtho = ( item: any ): boolean => {\n    //        if ( item.data == null || item.data.type !== \"Collection\" ) {\n    //            return false;\n    //        }\n    //\n    //        return true;\n    //\n    //        // TODO : If we don't have raw images uploaded then they can't run ortho\n    //\n    //        // TODO : Different roles?\n    //        //      if ( this.admin ) {\n    //        //        return true;\n    //        //      }\n    //        //\n    //        //      return false;\n    //    }\n    //\n    //    public canDelete = ( item: any ): boolean => {\n    //        if ( this.admin ) {\n    //            return true;\n    //        }\n    //\n    //        return false;\n    //    }\n    //\n    //    public canAddChild = ( item: any ): boolean => {\n    //        if ( this.admin && item.data.type !== \"Collection\" && item.data.type !== \"Imagery\" ) {\n    //            return true;\n    //        }\n    //        else if ( this.worker && ( item.data.type === \"Project\" || item.data.type === \"Mission\" ) ) {\n    //            return true;\n    //        }\n    //\n    //        return false;\n    //    }\n    //\n    //    public canCreateImageDir( item: any ): boolean {\n    //        if ( gpAppType && gpAppType.toLowerCase() === 'nps' && item.data.type === 'Project' ) {\n    //            return true;\n    //        }\n    //    }\n    //\n    //    public canEditSite = ( item: any ): boolean => {\n    //        return item.data.type === \"Site\" && this.canEdit( item );\n    //    }\n    //\n    //    public hasMapImage = ( item: any ): boolean => {\n    //        return ( item.data.imageKey != null );\n    //    }\n    //\n    //    public isSite = ( item: any ): boolean => {\n    //        return item.data.type === \"Site\";\n    //    }\n    //\n    //    public isImageDir = ( item: any ): boolean => {\n    //        return item.data.type === \"Imagery\";\n    //    }\n    //\n    //    public isCollection = ( item: any ): boolean => {\n    //        return item.data.type === \"Collection\";\n    //    }\n    //\n    //    public canUpload = ( item: any ): boolean => {\n    //        // Only allow direct uploads on Imagery child nodes\n    //        if ( gpAppType && gpAppType.toLowerCase() === 'nps' && item.parent.data.type !== \"Collection\" ) {\n    //            if ( item.data.name === \"raw\" ) {\n    //                return true;\n    //            }\n    //            else if ( item.data.name === \"georef\" ) {\n    //                return true;\n    //            }\n    //            else if ( item.data.name === \"ortho\" ) {\n    //                return true;\n    //            }\n    //            // else if(item.data.type === \"Collection\"){\n    //            //     return true;\n    //            // }\n    //            // else if(item.data.type === \"Imagery\"){\n    //            //     return true;\n    //            // }\n    //        }\n    //\n    //        return false;\n    //    }\n}\n","<uasdm-header [title]=\"'Data Upload'\"></uasdm-header>\n\n<div id=\"app-container\" class=\"container\">\n    <div *ngIf=\"sites.length === 0\" class=\"row\">\n        <div class=\"col-md-2\"></div>\n        <div class=\"col-md-8\">\n            <h4 style=\"margin-top: 50px;\">\n                There are no Sites added to the system. Add a Site, Project, Mission, and Collection using the \n                <a routerlink=\"/viewer\" routerlinkactive=\"active\" href=\"#/viewer\">Site Viewer</a> \n                before uploading data to.\n            </h4>\n        </div>\n        <div class=\"col-md-2\"></div>\n    </div>\n    <div *ngIf=\"sites.length > 0\" class=\"row\">\n        <div class=\"col-md-2\"></div>\n        <div class=\"col-md-8\">\n            <form #ngForm=\"ngForm\">\n\n                <!-- Existing task panel -->\n                <div class=\"\" *ngIf=\"existingTask && !currentTask\">\n                    <div class=\"panel panel-warning\" style=\"margin: 30px 0 30px 0;\">\n                        <div class=\"panel-heading\" style=\"font-size: 20px;\">Partial Upload Detected</div>\n                        <div class=\"panel-body\">\n                            <h4>A partial upload was detected. You can either cancel that partial upload or attempt to\n                                continue.</h4>\n                            <h4>\n                                <b>To continue an upload</b>\n                                please click the Continue Upload button and re-upload your file and we will try our best\n                                to continue where you left off.\n                            </h4>\n\n                            <hr>\n                            <button type=\"button\" class=\"btn btn-danger\" style=\"margin-top: 20px;\"\n                                (click)=\"removeUpload($event)\">\n                                <i class=\"icon-upload icon-white\"></i>\n                                Cancel Upload\n                            </button>\n                            <button type=\"button\" class=\"btn btn-primary\" style=\"margin-top: 20px;\"\n                                (click)=\"showUploadPanel()\">\n                                <i class=\"icon-upload icon-white\"></i>\n                                Continue Upload\n                            </button>\n                        </div>\n                    </div>\n                </div> <!-- End existing task panel -->\n\n                <!-- Task finished upload notification -->\n                <div *ngFor=\"let note of taskFinishedNotifications\" class=\"panel panel-success\" style=\"margin: 30px 0 30px 0;\">\n                    <div class=\"panel-heading\" style=\"font-size: 20px;\">\n                        Upload Details\n                        <i class=\"fa fa-times btn btn-close pull-right\" style=\"min-width:20px;padding:0;line-height: 27px;\" (click)=\"closeTaskFinishedNotification(note.id)\"></i>\n                    </div>\n                    <div class=\"panel-body\">\n                        <h4>\n                            Status:\n                            <b> Upload successfully completed </b>\n                        </h4>\n                        <h4>\n                            Message:\n                            <b> Your uploaded data is being processed into final image products. </b>\n                        </h4>\n                    </div>\n                </div> <!-- End task finished upload notification -->\n\n                <div style=\"margin-top: 30px;\" class=\"\" *ngIf=\"!disabled && !existingTask\">\n                    <div class=\"form-group\">\n                        <label for=\"site\">Site:</label>\n                        <select name=\"site\" (change)=\"onSiteSelect($event.target.value)\" [(ngModel)]=\"values.site\"\n                            required>\n                            <option></option>\n                            <option *ngFor=\"let site of sites\" [value]=\"site.id\">{{site.name}}</option>\n                        </select>\n                    </div>\n                    <div class=\"form-group\">\n                        <label for=\"project\">Project:</label>\n                        <select name=\"project\" [attr.disabled]=\"values.site == null ? '' : null\"\n                            (change)=\"onProjectSelect($event.target.value)\" [(ngModel)]=\"values.project\" required>\n                            <option></option>\n                            <option *ngFor=\"let project of projects\" [value]=\"project.id\">{{project.name}}</option>\n                        </select>\n                    </div>\n                    <div class=\"form-group\">\n                        <label for=\"mission\">Mission:</label>\n                        <select name=\"mission\" [attr.disabled]=\"values.project == null ? '' : null\"\n                            (change)=\"onMissionSelect($event.target.value)\" [(ngModel)]=\"values.mission\" required>\n                            <option></option>\n                            <option *ngFor=\"let mission of missions\" [value]=\"mission.id\">{{mission.name}}</option>\n                        </select>\n                    </div>\n                    <!-- \n                            <div class=\"form-check\">\n                            <label class=\"form-check-label\">\n                                <input type=\"radio\" class=\"form-check-input\" name=\"radioopt\" [(ngModel)]=\"values.create\" [value]=\"true\" (change)=\"handleChange()\" [checked]=\"values.create==true\" />\n                                Create new collection\n                            </label>\n                            </div>\n                            <div class=\"form-check\">\n                            <label class=\"form-check-label\">\n                                <input type=\"radio\" class=\"form-check-input\" name=\"radioopt\" value=\"false\" [(ngModel)]=\"values.create\" (change)=\"handleChange()\" [value]=\"false\" [checked]=\"values.create==false\" />\n                                Add to existing collection\n                            </label>\n                            </div>\n                            <div class=\"form-group\" *ngIf=\"values.create === true\">\n                            <label for=\"nameInput\">Name</label>\n                            <input [(ngModel)]=\"values.name\" name=\"name\" type=\"input\" class=\"form-control\" id=\"nameInput\" placeholder=\"Name\" #nameField=\"ngModel\" required forbiddenName>\n                            <div class=\"error-container\" *ngIf=\"nameField.errors && nameField.errors.forbiddenName\">\n                                Invalid name. No spaces or special characters such as <, >, -, +, =, !, @, #, $, %, ^, &, *, ?,/, \\ or apostrophes are allowed.        \n                            </div>\n                            </div>\n                    -->\n                    <div class=\"form-group\">\n                        <label for=\"collection\">Collection:</label>\n                        <select name=\"collection\" [attr.disabled]=\"values.mission == null ? '' : null\"\n                            (change)=\"onCollectionSelect($event.target.value)\" [(ngModel)]=\"values.collection\" required>\n                            <option></option>\n                            <option *ngFor=\"let collection of collections\" [value]=\"collection.id\">{{collection.name}}\n                            </option>\n                        </select>\n                    </div>\n\n                    <div class=\"form-group\">\n                        <label for=\"outFileName\">Output Product Name Prefix</label>\n                        <input [(ngModel)]=\"values.outFileName\" name=\"outFileName\" type=\"input\" class=\"form-control\" placeholder=\"Output product name prefix...\" />\n                    </div>\n                </div>\n\n                <!-- Current upload indicator -->\n                <div class=\"\" [hidden]=\"!uploadVisible\">\n                    <div *ngIf=\"currentTask\" class=\"panel panel-warning\" style=\"margin: 30px 0 30px 0;\">\n                        <div class=\"panel-heading\" style=\"font-size: 20px;\">Upload Details</div>\n                        <div class=\"panel-body\">\n                            <h4>\n                                Status:\n                                <b> {{currentTask.status}} </b>\n                            </h4>\n                            <h4>\n                                Message:\n                                <b> {{currentTask.message}} </b>\n                            </h4>\n                            <h4>\n                                Upload Started On:\n                                <b> {{currentTask.createDate}} </b>\n                            </h4>\n                            <h4>\n                                Last Updated:\n                                <b> {{currentTask.lastUpdatedDate}} </b>\n                            </h4>\n                            <h4>\n                                Elapsed Time:\n                                <b> {{uploadCounter}} </b>\n                            </h4>\n                        </div>\n                    </div>\n\n                    <div *ngIf=\"showFileSelectPanel\" class=\"uploader-container\" style=\"margin-top: 20px;\" #uploader></div>\n\n                    <button type=\"button btn btn-primary\" [disabled]=\"!ngForm.valid || disabled\" class=\"btn btn-primary\"\n                        style=\"margin-top: 20px;\" (click)=\"handleUpload()\">\n                        <i class=\"icon-upload icon-white\"></i>\n                        Upload\n                    </button>\n                </div> <!-- End current upload indicator -->\n            </form>\n\n        </div>\n        <div class=\"col-md-2\"></div>\n    </div>\n</div>","import { Component, OnInit, AfterViewInit, Inject, ViewChild, ElementRef, KeyValueDiffers, DoCheck, HostListener } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { interval } from 'rxjs';\nimport { switchMap, map } from 'rxjs/operators';\n\n//use Fine Uploader UI for traditional endpoints\nimport { FineUploader, UIOptions } from 'fine-uploader';\n\nimport { ErrorModalComponent } from '../../shared/component/modal/error-modal.component';\nimport { BasicConfirmModalComponent } from '../../shared/component/modal/basic-confirm-modal.component';\nimport { SiteEntity, UploadForm, Task } from '../model/management';\nimport { ManagementService } from '../service/management.service';\n\n\ndeclare var acp: string;\n\n@Component( {\n    selector: 'upload',\n    templateUrl: './upload.component.html',\n    styleUrls: []\n} )\nexport class UploadComponent implements OnInit {\n\n    /*\n     * Reference to the modal current showing\n     */\n    private bsModalRef: BsModalRef;\n\n    /* \n     * List of sites\n     */\n    sites = [] as SiteEntity[];\n\n    /* \n     * List of projects\n     */\n    projects = [] as SiteEntity[];\n\n    /* \n     * List of missions\n     */\n    missions = [] as SiteEntity[];\n\n    /* \n     * List of collections\n     */\n    collections = [] as SiteEntity[];\n\n    /* \n     * Form values\n     */\n    values = { create: false } as UploadForm;\n\n    /*\n     * FineUploader for uploading large files\n     */\n    uploader = null as FineUploader;\n\n    disabled: boolean = false;\n    taskStatusMessages: string[] = [];\n    currentTask: Task = null;\n    existingTask: boolean = false;\n    taskPolling: any;\n    pollingIsSet: boolean = false;\n    uploadVisible: boolean = true;\n    selectedContinue: boolean = false;\n    uploadCounter: string = \"00:00:00\";\n    uplodeCounterInterfal: any;\n    differ: any;\n    showFileSelectPanel: boolean = false;\n    taskFinishedNotifications: any[] = [];\n\n    constructor( private service: ManagementService, private modalService: BsModalService, differs: KeyValueDiffers ) {\n        this.differ = differs.find( [] ).create();\n    }\n\n    ngDoCheck() {\n\n        if ( this.uploader ) {\n            const change = this.differ.diff( this.uploader );\n            if ( change ) {\n                this.setExistingTask();\n            }\n        }\n    }\n\n    @ViewChild( 'uploader' ) set content( elem: ElementRef ) {\n\n        const that = this;\n\n        if ( elem != null && this.uploader == null ) {\n\n            let uiOptions: UIOptions = {\n                debug: false,\n                autoUpload: false,\n                multiple: false,\n                element: elem.nativeElement,\n                template: 'qq-template',\n                request: {\n                    endpoint: acp + \"/file/upload\",\n                    forceMultipart: true\n                },\n                resume: {\n                    enabled: true,\n                    recordsExpireIn: 1\n                },\n                chunking: {\n                    enabled: true\n                },\n                retry: {\n                    enableAuto: true\n                },\n                text: {\n                    defaultResponseError: \"Upload failed\"\n                },\n                failedUploadTextDisplay: {\n                    mode: 'none'\n                    //responseProperty: 'error'\n                },\n                validation: {\n                    allowedExtensions: ['zip', 'tar.gz']\n                },\n                showMessage: function( message: string ) {\n                    // \n                },\n                callbacks: {\n                    onUpload: function( id: any, name: any ): void {\n                        that.disabled = true;\n\n                        // document.getElementById(\"select-file-button\").className = document.getElementById(\"select-file-button\").className + \" hidden\";\n\n                        that.countUpload( that );\n                    },\n                    onProgress: function( id: any, name: any, uploadedBytes: any, totalBytes: any ): void {\n                    },\n                    onUploadChunk: function( id: any, name: any, chunkData: any ): void {\n                    },\n                    onUploadChunkSuccess: function( id: any, chunkData: any, responseJSON: any, xhr: any ): void {\n\n                        if ( responseJSON.message && responseJSON.message.currentTask && !that.currentTask ) {\n                            that.currentTask = responseJSON.message.currentTask;\n                        }\n\n                        if ( that.currentTask && !that.pollingIsSet ) {\n                            that.pollingIsSet = true;\n\n                            that.taskPolling = interval( 2000 )\n                                .pipe(switchMap(() => {\n                                    if ( that.currentTask ) {\n                                        return that.service.task( that.currentTask.oid );\n                                    }\n                                } ))\n                                .pipe(map(( data ) => data ))\n                                .subscribe(( data ) => {\n                                    that.currentTask = data.task\n                                } );\n                        }\n                    },\n                    onComplete: function( id: any, name: any, responseJSON: any, xhrOrXdr: any ): void {\n                        that.disabled = false;\n                        that.currentTask = null;\n                        that.existingTask = false;\n\n                        if ( that.taskPolling ) {\n                            that.taskPolling.unsubscribe();\n                            that.pollingIsSet = false;\n                        }\n\n                        this.clearStoredFiles();\n\n                        // document.getElementById(\"select-file-button\").classList.remove(\"hidden\");\n\n                        clearInterval( that.uplodeCounterInterfal );\n\n                        that.taskFinishedNotifications.push(\n                            {\n                                'id': id\n                            }\n                        )\n                    },\n                    onCancel: function( id: number, name: string ) {\n                        //that.currentTask = null;\n\n                        if ( that.currentTask && that.currentTask.uploadId ) {\n                            that.service.removeTask( that.currentTask.uploadId )\n                                .then(() => {\n                                    this.clearStoredFiles();\n                                } )\n                                .catch(( err: HttpErrorResponse ) => {\n                                    this.error( err );\n                                } );\n                        }\n\n                        that.disabled = false;\n                        that.currentTask = null;\n                        that.existingTask = false;\n\n                        if ( that.taskPolling ) {\n                            that.taskPolling.unsubscribe();\n                            that.pollingIsSet = false;\n                        }\n\n                        // document.getElementById(\"select-file-button\").classList.remove(\"hidden\");\n\n                        clearInterval( that.uplodeCounterInterfal );\n                    },\n                    onError: function( id: number, errorReason: string, xhrOrXdr: string ) {\n                        that.error( xhrOrXdr );\n                    }\n                }\n            };\n\n            this.uploader = new FineUploader( uiOptions );\n\n        }\n    }\n\n    ngAfterViewInit() {\n\n    }\n\n    ngOnInit(): void {\n        this.service.roots( null, null ).then( sites => {\n            this.sites = sites;\n        } );\n    }\n\n    closeTaskFinishedNotification( id: string ): void {\n        // iterate in reverse to allow splice while avoiding the reindex\n        // from affecting any of the next items in the array.\n        let i = this.taskFinishedNotifications.length;\n        while ( i-- ) {\n            let note = this.taskFinishedNotifications[i];\n            if ( id === note.id ) {\n                this.taskFinishedNotifications.splice( i, 1 );\n            }\n        }\n    }\n\n\n    setExistingTask(): void {\n        let resumable = this.uploader.getResumableFilesData() as any[];\n        if ( resumable.length > 0 ) {\n            this.existingTask = true;\n\n            if ( !this.selectedContinue ) {\n                this.hideUploadPanel();\n            }\n        }\n    }\n\n    onSiteSelect( siteId: string ): void {\n        this.values.site = siteId;\n\n        if ( siteId != null && siteId.length > 0 ) {\n\n            // Reset select options\n            this.projects = [] as SiteEntity[];\n            this.missions = [] as SiteEntity[];\n            this.collections = [] as SiteEntity[];\n\n            // Reset form values\n            this.values.project = null;\n            this.values.mission = null;\n            this.values.collection = null;\n\n            this.service.getChildren( this.values.site ).then( projects => {\n                this.projects = projects;\n            } );\n        }\n\n        //console.log( this.values );\n    }\n\n    onProjectSelect( projectId: string ): void {\n        this.values.project = projectId;\n\n        // Reset select options\n        this.missions = [] as SiteEntity[];\n        this.collections = [] as SiteEntity[];\n\n        // Reset form values\n        this.values.mission = null;\n        this.values.collection = null;\n\n        if ( projectId != null && projectId.length > 0 ) {\n            this.service.getChildren( this.values.project ).then( missions => {\n                this.missions = missions.filter( mission => {\n                    return mission.type === 'Mission';\n                } );\n            } );\n        }\n    }\n\n    onMissionSelect( missionId: string ): void {\n        this.values.mission = missionId;\n\n        // Reset select options\n        this.collections = [] as SiteEntity[];\n\n        // Reset form values\n        this.values.collection = null;\n        this.values.name = null;\n\n        if ( missionId != null && missionId.length > 0 && !this.values.create ) {\n\n            this.service.getChildren( this.values.mission ).then( collections => {\n                this.collections = collections;\n            } );\n        }\n    }\n\n    handleChange(): void {\n\n        // Reset select options\n        this.collections = [] as SiteEntity[];\n\n        // Reset form values\n        this.values.collection = null;\n        this.values.name = null;\n\n        if ( this.values.mission != null && this.values.mission.length > 0 && !this.values.create ) {\n\n            this.service.getChildren( this.values.mission ).then( collections => {\n                this.collections = collections;\n            } );\n        }\n    }\n\n    onCollectionSelect( collectionId: string ): void {\n        this.values.collection = collectionId;\n        this.values.uasComponentOid = collectionId;\n\n        if ( collectionId && collectionId.trim().length > 0 ) {\n            this.showFileSelectPanel = true;\n        }\n        else {\n            this.showFileSelectPanel = false\n        }\n    }\n\n    handleUpload(): void {\n\n        /*\n         * Validate form values before uploading\n         */\n        if ( !this.values.create && this.values.collection == null && !this.existingTask ) {\n            this.bsModalRef = this.modalService.show( ErrorModalComponent, { backdrop: true } );\n            this.bsModalRef.content.message = \"A collection must first be selected before the file can be uploaded\";\n        }\n        else if ( this.values.create && ( this.values.mission == null || this.values.name == null || this.values.name.length == 0 ) && !this.existingTask ) {\n            this.bsModalRef = this.modalService.show( ErrorModalComponent, { backdrop: true } );\n            this.bsModalRef.content.message = \"Name is required\";\n        }\n        else {\n            this.uploader.setParams( this.values );\n            this.uploader.uploadStoredFiles();\n        }\n\n    }\n\n    removeUpload( event: any ): void {\n        let that = this;\n\n        this.bsModalRef = this.modalService.show( BasicConfirmModalComponent, {\n            animated: true,\n            backdrop: true,\n            ignoreBackdropClick: true,\n        } );\n        this.bsModalRef.content.message = 'Are you sure you want to cancel the upload of [' + this.uploader.getResumableFilesData()[0].name + ']';\n        this.bsModalRef.content.type = 'DANGER';\n        this.bsModalRef.content.submitText = 'Cancel Upload';\n\n        ( <BasicConfirmModalComponent>this.bsModalRef.content ).onConfirm.subscribe( data => {\n            this.service.removeTask( this.uploader.getResumableFilesData()[0].uuid )\n                .then(() => {\n                    //that.uploader.clearStoredFiles();\n                    //that.uploader.cancelAll()\n\n                    // The above clearStoredFiles() and cancelAll() methods don't appear to work so \n                    // we are clearing localStorage manually.\n                    localStorage.clear();\n                    that.existingTask = false;\n                    that.showUploadPanel();\n\n                } );\n        } );\n    }\n\n    hideUploadPanel(): void {\n        this.uploadVisible = false;\n    }\n\n    showUploadPanel(): void {\n        this.uploadVisible = true;\n        this.selectedContinue = true;\n    }\n\n    countUpload( thisRef: any ): void {\n        let ct = 0;\n\n\n        function incrementSeconds() {\n            ct += 1;\n\n            let hours = Math.floor( ct / 3600 )\n            let minutes = Math.floor(( ct % 3600 ) / 60 );\n            let seconds = Math.floor( ct % 60 );\n\n            let hoursStr = minutes < 10 ? \"0\" + hours : hours;\n            let minutesStr = minutes < 10 ? \"0\" + minutes : minutes;\n            let secondsStr = seconds < 10 ? \"0\" + seconds : seconds;\n\n            thisRef.uploadCounter = hoursStr + \":\" + minutesStr + \":\" + secondsStr;\n        }\n\n        thisRef.uplodeCounterInterfal = setInterval( incrementSeconds, 1000 );\n    }\n\n    public canDeactivate(): boolean {\n        return this.disabled;\n    }\n\n    @HostListener( 'window:beforeunload', ['$event'] )\n    unloadNotification( $event: any ) {\n        if ( this.disabled ) {\n            $event.returnValue = 'An upload is currently in progress. Are you sure you want to leave?';\n        }\n    }\n\n    error( message: string ): void {\n        if ( message !== null ) {\n            this.bsModalRef = this.modalService.show( ErrorModalComponent, { backdrop: true } );\n            this.bsModalRef.content.message = message;\n        }\n    }\n}\n","<div class=\"panel-group\">\n  <div class=\"panel panel-default\" style=\"background: none;border: none;\">\n    <div class=\"panel-heading panel-heading-light clickable\" style=\"margin-top: 20px;\">\n      <h4 class=\"panel-title\">\n        <a data-toggle=\"collapse\" (click)=\"showProcess = !showProcess\" attr.aria-controls=\"task-group-panel-{{groupTypeId}}\">\n          <h4>{{taskCategory}}</h4>\n        </a>\n      </h4>\n      <span class=\"heading-status-label pull-right\">Current status: <span\n          [ngClass]=\"{'success':taskGroupType.status === 'Complete', 'warning':taskGroupType.status  === 'Warning', 'pending':taskGroupType.status === 'Queued' || taskGroupType.status === 'Processing','fail':taskGroupType.status === 'Failed'}\">{{taskGroupType.status}}</span></span>\n    </div>\n    <div id=\"task-group-panel-{{groupTypeId}}\" class=\"panel-body\" [isAnimated]=\"false\" [collapse]=\"!showProcess\">\n\n      <div class=\"task-container\" *ngFor=\"let task of taskGroupType.tasks; let idx=index\">\n        <div *ngIf=\"task.status !== 'Complete' && task.status !== 'Failed' && task.status !== 'Error'\" >\n          <ul class=\"list-unstyled\" style=\"margin: 0;\">\n            <li>Status: <b\n                [ngClass]=\"{'success':task.status === 'Complete', 'pending':(task.status === 'Queued' || task.status === 'Processing'),'fail':task.status === 'Failed'}\">{{task.status}}</b>\n            </li>\n            <li>Created on: <b>{{task.createDate}}</b></li>\n            <li>Last update: <b>{{task.lastUpdatedDate}}</b></li>\n            <li style=\"word-break: break-all;\">Message: <b>{{task.message}}</b></li>\n          </ul>\n          \n          <div class=\"row\">\n            <div class=\"col-sm-12\">\n              <div class=\"button-holder\" style=\"margin-top: 30px;\">\n                <button class=\"btn btn-default\" *ngIf=\"task.actions.length > 0\" (click)=\"task.showError = !task.showError\">{{task.showError ? 'Hide' : 'Show'}} Messages</button>\n                <button class=\"btn btn-default caution\" (click)=\"removeTask(task)\">Delete Task</button>\n              </div>\n            </div>\n          </div>          \n        </div>\n\n        <div *ngIf=\"task.status === 'Complete' || task.status === 'Failed' || task.status === 'Error'\">\n          <ul class=\"list-unstyled\" style=\"margin: 0;\">\n            <li>Status: \n              <b [ngClass]=\"{'success':task.status === 'Complete','pending':(task.status === 'Queued' || task.status === 'Processing'), 'fail':task.status === 'Failed'}\">\n                {{task.status === 'Complete' && task.actions.length > 0 ? 'Complete With Messages' : task.status }}\n              </b>\n            </li>\n            <li>Message: <b>{{task.message}}</b></li>\n            <li>Created on: <b>{{task.createDate}}</b></li>\n            <li>Last update: <b>{{task.lastUpdatedDate}}</b></li>\n          </ul>\n\n          <div class=\"row\">\n            <div class=\"col-sm-12\">\n              <div class=\"button-holder\" style=\"margin-top: 30px;\">\n                <button class=\"btn btn-default\" *ngIf=\"task.actions.length > 0\" (click)=\"task.showError = !task.showError\">{{task.showError ? 'Hide' : 'Show'}} Messages</button>\n                <button class=\"btn btn-default\" *ngIf=\"task.odmOutput\" (click)=\"showODMOutput = !showODMOutput\">Show Detailed Log Output</button>\n                <button class=\"btn btn-default caution\" (click)=\"removeTask(task)\">Delete Task</button>\n              </div>\n            </div>\n          </div>\n\n          <div *ngIf=\"task.odmOutput && showODMOutput\" class=\"row\">\n            <div class=\"col-sm-12\">\n              <h4>Output:</h4>\n              <textarea style=\"color:grey;width:500px;height:200px;\" [innerHTML]=\"task.odmOutput\"></textarea>\n            </div>\n          </div>\n        </div>\n        \n        <div *ngIf=\"task.showError\" class=\"row\">\n          <div class=\"col-sm-12\">\n            <h4 *ngIf=\"task.actions.length === 0\" style=\"color:grey;\">There are no actions for this task.</h4>\n            <table *ngIf=\"task.actions.length > 0\" class=\"table table-bordered\">\n              <thead>\n                <tr>\n                  <th>#</th>\n                  <th>Description</th>\n                  <th>Creation Date</th>\n                  <th>Last Updated</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr *ngFor=\"let action of task.actions; let i=index\">\n                  <th scope=\"row\">{{i + 1}}</th>\n                  <td>{{action.description}}</td>\n                  <td>{{action.createDate}}</td>\n                  <td>{{action.lastUpdatedDate}}</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>        \n      </div>\n    </div>\n  </div>\n</div>","import { Component, OnInit, Input } from '@angular/core';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\n\nimport { BasicConfirmModalComponent } from '../../../shared/component/modal/basic-confirm-modal.component';\n\nimport { Task, TaskGroup, TaskGroupType } from '../../model/management';\nimport { ManagementService } from '../../service/management.service';\n\n\n@Component({\n\tselector: 'tasks-panel',\n\ttemplateUrl: './tasks-panel.component.html',\n\tstyleUrls: ['./tasks-panel.css']\n})\nexport class TasksPanelComponent implements OnInit {\n\n\t@Input() taskGroupType: TaskGroupType;\n\t@Input() groupTypeId: string;\n\t@Input() taskCategory: string;\n    \n\tshowUploads: boolean = false;\n\tshowProcess: boolean = false;\n\tshowStore: boolean = false;\n\tshowODMOutput: boolean = false;\n\tshowError: boolean = false;\n\n    /*\n     * Reference to the modal current showing\n     */\n\tbsModalRef: BsModalRef;\n\n\n    /*\n     * List of tasks\n     */\n\ttaskGroups: TaskGroup[] = [];\n\n\tconstructor(private managementService: ManagementService, private modalService: BsModalService) {\n\n\t}\n\n\tngOnInit(): void {\n\t  if (this.taskGroupType != null && this.taskGroupType.tasks != null)\n\t  {\n\t\t  for (var i = 0; i < this.taskGroupType.tasks.length; ++i)\n\t\t  {\n\t\t    let task = this.taskGroupType.tasks[i];\n\t\t    \n\t\t    if (task.actions.length > 0)\n\t\t    {\n\t\t      task.showError = true;\n\t\t    }\n\t\t  }\n\t  }\n\t}\n\n\tngOnDestroy(): void {\n\t}\n\n\n\tremoveTask(task: Task): void {\n\n\t\tthis.bsModalRef = this.modalService.show(BasicConfirmModalComponent, {\n\t\t\tanimated: true,\n\t\t\tbackdrop: true,\n\t\t\tignoreBackdropClick: true,\n\t\t});\n\t\tthis.bsModalRef.content.message = 'Are you sure you want to delete [' + task.label + '?';\n\t\tthis.bsModalRef.content.data = task;\n\t\tthis.bsModalRef.content.type = 'DANGER';\n\t\tthis.bsModalRef.content.submitText = 'Delete';\n\n\t\t(<BasicConfirmModalComponent>this.bsModalRef.content).onConfirm.subscribe(task => {\n\t\t\tthis.deleteTask(task);\n\t\t});\n\n\t}\n\n\tdeleteTask(task: Task) {\n\t\tthis.managementService.removeTask(task.uploadId)\n\t\t\t.then(() => {\n\t\t\t\tlet pos = null;\n\t\t\t\tfor (let i = 0; i < this.taskGroupType.tasks.length; i++) {\n\t\t\t\t\tlet thisTask = this.taskGroupType.tasks[i];\n\n\t\t\t\t\tif (thisTask.uploadId === task.uploadId) {\n\t\t\t\t\t\tpos = i;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (pos !== null) {\n\t\t\t\t\tthis.taskGroupType.tasks.splice(pos, 1);\n\t\t\t\t}\n\t\t\t});\n\t}\n}\n","<uasdm-header [title]=\"'Tasks'\"></uasdm-header>\n\n<div id=\"app-container\" class=\"container-fluid\" style=\"padding-top:20px;\">\n\n  <div class=\"row\">\n    <div class=\"col-sm-1\"></div>\n    <div class=\"col-sm-10\">\n      <div id=\"tasks\">\n\n        <div *ngIf=\"messages && messages.count > 0\">\n          <h2>Tasks</h2>\n\n          <div id=\"tasks-container\">\n            <div class=\"row\">\n              <h3 class=\"col-sm-9\">Issue</h3>\n              <h3 class=\"col-sm-3\">Actions</h3>\n            </div>\n            <div class=\"panel panel-default\" *ngFor=\"let message of messages.resultSet | paginate: {id: 'message-pg-ctrl', itemsPerPage: messages.pageSize, currentPage: messages.pageNumber, totalItems: messages.count }\">\n              <!-- <div class=\"panel-heading\">Panel heading without title</div> -->\n          \n              <div class=\"panel-body\">\n                <div class=\"row\">\n                  <div class=\"col-sm-9\">\n                    <div>\n                      <span class=\"dot pending\" style=\"margin-left:0;\"></span>\n                      {{message.message}}\n                    </div>\n                    <div style=\"margin-top:10px;margin-bottom:0;color:grey;\">\n                      <ul class=\"breadcrumb\" style=\"color:grey;\">\n                        <li *ngFor=\"let ancestor of message.ancestors\">\n                          <span > <b>{{ancestor}}</b> </span>\n                        </li>\n                        <li class=\"active\">\n                          <a (click)=\"handleGoto(message.collectionId)\" style=\"color: #007276;\"> {{message.collectionName}}</a>\n                        </li>\n                      </ul>\n                    </div>\n                  </div>\n                  <div class=\"col-sm-3\" style=\"text-align: right;\">\n                    <div>\n                      <button style=\"width:47%\" class=\"btn btn-default\" (click)=\"handleGoto(message.collectionId)\">View Collection</button>\n                      <button style=\"width:47%;margin-left: 10px;\" class=\"btn btn-primary\" (click)=\"handleMessage(message)\">Add Metadata</button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n          \n            </div>\n            <div class=\"row\">\n              <pagination-controls id=\"message-pg-ctrl\" (pageChange)=\"onMessagePageChange($event)\"></pagination-controls>                  \n            </div>\n          </div>\n          \n        </div>\n\n      </div>\n    </div>\n    <div class=\"col-sm-1\"></div>\n  </div>\n\n\n  <div class=\"row\" style=\"margin-bottom: 40px;\">\n    <div class=\"col-sm-1\"></div>\n    <div class=\"col-sm-10\">\n      <h3>Processing Jobs</h3>\n\n      <ul class=\"nav nav-tabs\" role=\"tablist\">\n        <li class=\"active\">\n          <a role=\"tab\" data-toggle=\"tab\" (click)=\"onTabClick($event, 'all')\">All</a>\n        </li>\n        <li>\n          <a role=\"tab\" data-toggle=\"tab\" (click)=\"onTabClick($event, 'action-required')\">Action Required</a>\n        </li>\n<!-- \n        <li>\n          <a role=\"tab\" data-toggle=\"tab\" (click)=\"onTabClick($event, 'success')\">Successful</a>\n        </li>\n -->        \n      </ul>\n\n      <div class=\"tab-content\" >\n\n        <div *ngIf=\"activeTab === 'action-required'\" class=\"tab-pane active\" id=\"action-required\">\n          \n          <div class=\"panel-group\">\n            <div *ngFor=\"let taskGroup of collectionGroups | paginate: { id: 'tasks-pg-ctrl', itemsPerPage: taskPage.pageSize, currentPage: taskPage.pageNumber, totalItems: taskPage.count }; let idx=index\" class=\"panel panel-default\" style=\"background: none;border: none;\">\n            \n                <div class=\"panel-heading clickable\" style=\"margin-top: 20px;background-color: #e9e9e9\">\n                  <h4 class=\"panel-title\" style=\"display: inline-block; vertical-align: middle;\">\n                    <a data-toggle=\"collapse\" (click)=\"taskGroup.visible = !taskGroup.visible\" [attr.aria-expanded]=\"!taskGroup.visible\"\n                      [attr.aria-controls]=\"'taskGroup'+ idx\">\n                      <h4>{{taskGroup.label}}</h4>\n                    </a>\n                  </h4>\n                  \n                  <span class=\"dot\" [ngClass]=\"{'success':taskGroup.status === 'Complete','warning':taskGroup.status === 'Warning', 'pending blink':taskGroup.status === 'Processing' || taskGroup.status === 'Running' || taskGroup.status === 'Pending' || taskGroup.status === 'Queued','fail':taskGroup.status === 'Failed'}\" ></span>\n\n                  <button class=\"btn btn-default pull-right\" (click)=\"handleGoto(taskGroup.collectionId)\">View Collection</button>\n\n                  <div style=\"margin-top:10px;margin-bottom:0;color:grey;\">\n                    <ul class=\"breadcrumb\" style=\"color:grey;\">\n                      <li *ngFor=\"let ancestor of taskGroup.ancestors\">\n                        <span > <b>{{ancestor}}</b> </span>\n                      </li>\n                      <li class=\"active\">\n                        {{taskGroup.label}}\n                      </li>\n                    </ul>\n                  </div>\n\n                </div>\n            \n                <div class=\"panel-body\" [isAnimated]=\"false\" [collapse]=\"!taskGroup.visible\">\n                  <div *ngFor=\"let taskGroupType of taskGroup.groups; let grpi=index\">                  \n                    <div *ngIf=\"taskGroupType.tasks.length > 0\" [id]=\"'task'+ grpi\">\n\n                      <!-- Upload Tasks -->\n                      <div *ngIf=\"taskGroupType.type === 'UPLOAD'\">\n                        <tasks-panel [taskGroupType]=\"taskGroupType\" [groupTypeId]=\"grpi\" [taskCategory]=\"'Upload'\" ></tasks-panel>\n                      </div>\n\n                      <!-- Process Tasks -->\n                      <div *ngIf=\"taskGroupType.type === 'PROCESS'\">\n                        <tasks-panel [taskGroupType]=\"taskGroupType\" [groupTypeId]=\"grpi\" [taskCategory]=\"'Process'\" ></tasks-panel>\n                      </div>\n\n                      <!-- Store Tasks -->\n                      <div *ngIf=\"taskGroupType.type === 'STORE'\">\n                        <tasks-panel [taskGroupType]=\"taskGroupType\" [groupTypeId]=\"grpi\" [taskCategory]=\"'Store'\" ></tasks-panel>\n                      </div>\n                \n                    </div>\n                  </div>\n                </div>\n            </div>\n\n             <pagination-controls id=\"tasks-pg-ctrl\" (pageChange)=\"onPageChange($event)\"></pagination-controls>\n          </div>\n        </div>\n        \n        <div *ngIf=\"activeTab === 'success'\" class=\"tab-pane active\" id=\"success\">\n          <div class=\"panel-group\">\n            <div *ngFor=\"let taskGroup of collectionGroups | paginate: {id: 'tasks-pg-ctrl', itemsPerPage: taskPage.pageSize, currentPage: taskPage.pageNumber, totalItems: taskPage.count }; let idx=index\" class=\"panel panel-default\" style=\"background: none;border: none;\">\n            \n                <div class=\"panel-heading clickable\" style=\"margin-top: 20px;background-color: #e9e9e9\">\n                  <h4 class=\"panel-title\" style=\"display: inline-block; vertical-align: middle;\">\n                    <a data-toggle=\"collapse\" (click)=\"taskGroup.visible = !taskGroup.visible\" [attr.aria-expanded]=\"!taskGroup.visible\"\n                      [attr.aria-controls]=\"'taskGroup'+ idx\">\n                      <h4>{{taskGroup.label}}</h4>\n                    </a>\n                  </h4>\n                  \n                  <span class=\"dot\" [ngClass]=\"{'success':taskGroup.status === 'Complete','warning':taskGroup.status === 'Warning', 'pending blink':taskGroup.status === 'Processing' || taskGroup.status === 'Running' || taskGroup.status === 'Pending' || taskGroup.status === 'Queued', 'fail':taskGroup.status === 'Failed'}\" ></span>\n\n                  <button class=\"btn btn-default pull-right\" (click)=\"handleGoto(taskGroup.collectionId)\">View Collection</button>\n\n                  <div style=\"margin-top:10px;margin-bottom:0;color:grey;\">\n                    <ul class=\"breadcrumb\" style=\"color:grey;\">\n                      <li *ngFor=\"let ancestor of taskGroup.ancestors\">\n                        <span > <b>{{ancestor}}</b> </span>\n                      </li>\n                      <li class=\"active\">\n                        {{taskGroup.label}}\n                      </li>\n                    </ul>\n                  </div>\n\n                </div>\n            \n                <div class=\"panel-body\" [isAnimated]=\"false\" [collapse]=\"!taskGroup.visible\">\n                \n                  <div *ngFor=\"let taskGroupType of taskGroup.groups; let grpi=index\">\n                    <div *ngIf=\"taskGroupType.tasks.length > 0\" [id]=\"'task'+ grpi\">\n\n                      <div *ngIf=\"taskGroupType.type === 'UPLOAD'\">\n                        <tasks-panel [taskGroupType]=\"taskGroupType\" [groupTypeId]=\"grpi\" [taskCategory]=\"'Upload'\" ></tasks-panel>\n                      </div>\n\n                      <div *ngIf=\"taskGroupType.type === 'PROCESS'\">\n                        <tasks-panel [taskGroupType]=\"taskGroupType\" [groupTypeId]=\"grpi\" [taskCategory]=\"'Process'\" ></tasks-panel>\n                      </div>\n\n                      <div *ngIf=\"taskGroupType.type === 'STORE'\">\n                        <tasks-panel [taskGroupType]=\"taskGroupType\" [groupTypeId]=\"grpi\" [taskCategory]=\"'Store'\" ></tasks-panel>\n                      </div>\n                \n                    </div>\n                  </div>\n                </div>\n            </div>\n\n             <pagination-controls id=\"tasks-pg-ctrl\" (pageChange)=\"onPageChange($event)\"></pagination-controls>\n          </div>\n        </div>\n\n        <div *ngIf=\"activeTab === 'all'\" class=\"tab-pane active\" id=\"all\">\n          <div class=\"panel-group\">\n            <div *ngFor=\"let taskGroup of collectionGroups | paginate: {id: 'tasks-pg-ctrl', itemsPerPage: taskPage.pageSize, currentPage: taskPage.pageNumber, totalItems: taskPage.count }; let idx=index\" class=\"panel panel-default\" style=\"background: none;border: none;\">\n            \n                <div class=\"panel-heading clickable\" style=\"margin-top: 20px;background-color: #e9e9e9\">\n                  <h4 class=\"panel-title\" style=\"display: inline-block; vertical-align: middle;\">\n                    <a data-toggle=\"collapse\" (click)=\"taskGroup.visible = !taskGroup.visible\" [attr.aria-expanded]=\"!taskGroup.visible\"\n                      [attr.aria-controls]=\"'taskGroup'+ idx\">\n                      <h4>{{taskGroup.label}}</h4>\n                    </a>\n                  </h4>\n                  \n                  <span class=\"dot\" [ngClass]=\"{'success':taskGroup.status === 'Complete','warning':taskGroup.status === 'Warning', 'pending blink':taskGroup.status === 'Processing' || taskGroup.status === 'Running' || taskGroup.status === 'Pending' || taskGroup.status === 'Queued', 'fail':taskGroup.status === 'Failed'}\" ></span>\n\n                  <button class=\"btn btn-default pull-right\" (click)=\"handleGoto(taskGroup.collectionId)\">View Collection</button>\n\n                  <div style=\"margin-top:10px;margin-bottom:0;color:grey;\">\n                    <ul class=\"breadcrumb\" style=\"color:grey;\">\n                      <li *ngFor=\"let ancestor of taskGroup.ancestors\">\n                        <span > <b>{{ancestor}}</b> </span>\n                      </li>\n                      <li class=\"active\">\n                        {{taskGroup.label}}\n                      </li>\n                    </ul>\n                  </div>\n                </div>\n            \n                <div class=\"panel-body\" [isAnimated]=\"false\" [collapse]=\"!taskGroup.visible\">                \n                  <div *ngFor=\"let taskGroupType of taskGroup.groups; let grpi=index\">\n                    <div *ngIf=\"taskGroupType.tasks.length > 0\" [id]=\"'task'+ grpi\" >\n\n                      <!-- Upload Tasks -->\n                      <div *ngIf=\"taskGroupType.type === 'UPLOAD'\">\n                        <tasks-panel [taskGroupType]=\"taskGroupType\" [groupTypeId]=\"grpi\" [taskCategory]=\"'Upload'\" ></tasks-panel>\n                      </div>\n\n                      <!-- Process Tasks -->\n                      <div *ngIf=\"taskGroupType.type === 'PROCESS'\">\n                        <tasks-panel [taskGroupType]=\"taskGroupType\" [groupTypeId]=\"grpi\" [taskCategory]=\"'Process'\" ></tasks-panel>\n                      </div>\n\n                      <!-- Store Tasks -->\n                      <div *ngIf=\"taskGroupType.type === 'STORE'\">\n                        <tasks-panel [taskGroupType]=\"taskGroupType\" [groupTypeId]=\"grpi\" [taskCategory]=\"'Store'\" ></tasks-panel>\n                      </div>\n                \n                    </div>\n                  </div>\n                </div>\n            </div>\n\n            <pagination-controls id=\"tasks-pg-ctrl\" (pageChange)=\"onPageChange($event)\"></pagination-controls>\n          </div>\n        </div>\n\n      </div>\n    </div>\n    <div class=\"col-sm-1\"></div>\n\n  </div>\n\n\n</div>\n\n","import { Component, OnInit } from '@angular/core';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\n\nimport { MetadataModalComponent } from './modal/metadata-modal.component';\nimport { BasicConfirmModalComponent } from '../../shared/component/modal/basic-confirm-modal.component';\nimport { LeafModalComponent } from './modal/leaf-modal.component';\nimport { PageResult } from '../../shared/model/page';\n\nimport { interval, from } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\n\nimport { Message, Task, TaskGroup } from '../model/management';\nimport { ManagementService } from '../service/management.service';\n\n@Component({\n    selector: 'tasks',\n    templateUrl: './tasks.component.html',\n    styleUrls: ['./tasks.css']\n})\nexport class TasksComponent implements OnInit {\n\n    userName: string = \"\";\n    totalTaskCount: number = 0;\n    taskPolling: any;\n    activeTab: string = \"all\";\n    showSite: boolean = false;\n    initData: any;\n    showUploads: boolean = false;\n    showProcess: boolean = false;\n    showStore: boolean = false;\n    tasks: any;\n    taskPage: PageResult<Task> = { count: 0, pageSize: 10, pageNumber: 1, resultSet: [] };\n    errorStatuses = [\"Error\", \"Failed\", \"Queued\", \"Processing\"];\n    completeStatuses = [\"Complete\"];\n\n    statuses = [];\n\n    /*\n     * Token used to determine if a change has occured in the page before loading the polling values\n     */\n    token: number = 0;\n\n    /*\n     * Reference to the modal current showing\n     */\n    bsModalRef: BsModalRef;\n\n    /*\n     * List of messages\n     */\n    messages: PageResult<Message> = { count: 0, pageSize: 5, pageNumber: 1, resultSet: [] };\n\n    /*\n     * List of tasks\n     */\n    // tasks: PageResult<Task>;\n\n    collectionGroups: TaskGroup[] = [];\n\n    constructor(private managementService: ManagementService, private modalService: BsModalService) {\n\n        this.taskPolling = interval(5000).pipe(\n            switchMap(() => from(this.managementService.tasks(this.statuses, this.taskPage.pageSize, this.taskPage.pageNumber, this.token))))\n            .subscribe((data) => {\n                if (data['token'] === this.token) {\n                    this.updateTaskData(data);\n                }\n            });\n\n    }\n\n    ngOnInit(): void {\n        this.userName = this.managementService.getCurrentUser();\n        this.managementService.tasks([], this.taskPage.pageSize, this.taskPage.pageNumber, this.token).then(data => {\n            this.setTaskData(data, false);\n        });\n\n        this.getMissingMetadata();\n    }\n\n    ngOnDestroy(): void {\n\n        if (this.taskPolling) {\n            this.taskPolling.unsubscribe();\n        }\n    }\n\n    updatePage(data: PageResult<Task>): void {\n        this.taskPage.pageNumber = data.pageNumber;\n        this.taskPage.pageSize = data.pageSize;\n        this.taskPage.count = data.count;\n        this.taskPage.resultSet = data.resultSet;\n    }\n\n    onPageChange(pageNumber: number): void {\n        this.token++;\n\n        this.managementService.tasks(this.statuses, this.taskPage.pageSize, pageNumber, this.token).then(tasks => {\n\n            this.updatePage(tasks);\n\n            this.setTaskData(tasks, false);\n        });\n    }\n\n    onTabClick(event: any, tab: string): void {\n        this.activeTab = tab;\n        this.taskPage = { count: 0, pageSize: 20, pageNumber: 1, resultSet: [] };\n        this.token++;\n\n        if (tab === \"success\") {\n            this.statuses = this.completeStatuses;\n        }\n        else if (tab === \"action-required\") {\n            this.statuses = this.errorStatuses;\n        }\n        else if (tab === \"all\") {\n            this.statuses = [];\n        }\n\n        this.managementService.tasks(this.statuses, this.taskPage.pageSize, this.taskPage.pageNumber, this.token).then(tasks => {\n\n            this.updatePage(tasks);\n\n            this.setTaskData(tasks, false);\n        });\n\n\n        if (!event.target.parentNode.classList.contains(\"active\")) {\n\n            let lis = event.target.parentNode.parentNode.getElementsByTagName(\"li\");\n            for (let i = 0; i < lis.length; i++) {\n                let li = lis[i];\n\n                li.classList.forEach(cls => {\n                    if (cls === 'active') {\n                        li.classList.remove('active');\n                    }\n                })\n            }\n\n            event.target.parentNode.classList.add('active');\n        }\n    }\n\n    setTaskData(tasks: PageResult<Task>, addOnly: boolean): void {\n\n        if (!addOnly) {\n            this.updatePage(tasks);\n\n            this.collectionGroups = [];\n        }\n\n        for (let i = 0; i < tasks.resultSet.length; i++) {\n            let task = tasks.resultSet[i];\n            let collectPosition = this.collectionGroups.findIndex(value => { return task.collection === value.collectionId });\n            let group: TaskGroup = null;\n\n            if (collectPosition === -1) {\n                group = {\n                    label: task.collectionLabel,\n                    collectionId: task.collection,\n                    groups: [],\n                    status: task.status,\n                    lastUpdatedDate: task.lastUpdatedDate,\n                    ancestors: task.ancestors\n                };\n\n                group.groups.push({ tasks: [], status: null, type: 'UPLOAD' });\n                group.groups.push({ tasks: [], status: null, type: 'PROCESS' });\n                group.groups.push({ tasks: [], status: null, type: 'STORE' });\n                \n                this.collectionGroups.push(group);\n            }\n            else {\n                group = this.collectionGroups[collectPosition];\n            }\n            \n            if (task.type === 'gov.geoplatform.uasdm.bus.WorkflowTask') {\n\n                let taskGroupTypeIndex = group.groups.findIndex(value => { return value.type === 'UPLOAD' });\n\n                if (taskGroupTypeIndex === -1) {\n                    group.groups.push({ tasks: [task], status: task.status, type: 'UPLOAD' })\n                }\n                else {\n                    group.groups[taskGroupTypeIndex].tasks.push(task);\n                }\n            }\n            else if (task.type === 'gov.geoplatform.uasdm.odm.ODMProcessingTask') {\n\n                let taskGroupTypeIndex = group.groups.findIndex(value => { return value.type === 'PROCESS' });\n\n                if (taskGroupTypeIndex === -1) {\n                    group.groups.push({ tasks: [task], status: task.status, type: 'PROCESS' })\n                }\n                else {\n                    group.groups[taskGroupTypeIndex].tasks.push(task);\n                }\n            }\n            else if (task.type === 'gov.geoplatform.uasdm.odm.ODMUploadTask') {\n\n                let taskGroupTypeIndex = group.groups.findIndex(value => { return value.type === 'STORE' });\n\n                if (taskGroupTypeIndex === -1) {\n                    group.groups.push({ tasks: [task], status: task.status, type: 'STORE' })\n                }\n                else {\n                    group.groups[taskGroupTypeIndex].tasks.push(task);\n                }\n            }\n        }\n\n        //        this.collectionGroups = this.collectionGroups.sort((a: any, b: any) =>\n        //            new Date(b.lastUpdatedDate).getTime() - new Date(a.lastUpdatedDate).getTime()\n        //        );\n\n        this.setTaskGroupStatuses();\n    }\n\n\n    setTaskGroupStatuses(): void {\n\n        this.collectionGroups.forEach(collectionGroup => {\n\n            let isError: boolean = false;\n            let isWorking: boolean = false;\n            let isWarning: boolean = false;\n\n            collectionGroup.groups.forEach(group => {\n\n                if (group.tasks.length > 0) {\n                    let sortedTasks = group.tasks.sort((a: any, b: any) =>\n                        new Date(b.lastUpdatedDate).getTime() - new Date(a.lastUpdatedDate).getTime()\n                    );\n\n                    group.status = sortedTasks[0].status;\n\n                    if (group.status === 'Complete' && sortedTasks[0].actions.length > 0) {\n                        group.status = 'Warning';\n                        isWarning = true;\n                    }\n                }\n\n                if (group.status === \"Error\" || group.status === \"Failed\") {\n                    isError = true;\n                }\n                else if (group.status === \"Queued\" || group.status === \"Processing\" || group.status === \"Running\" || group.status === \"Pending\") {\n                    isWorking = true;\n                }\n            });\n\n            if (isWorking) {\n                collectionGroup.status = \"Processing\";\n            }\n            else if (isError) {\n                collectionGroup.status = \"Failed\";\n            }\n            else if (isWarning) {\n                collectionGroup.status = \"Warning\";\n            }\n            else {\n                collectionGroup.status = \"Complete\";\n            }\n\n        })\n    }\n\n\n    updateTaskData(tasks: PageResult<Task>): void {\n        let noMatch = [];\n\n        this.totalTaskCount = tasks.count;\n\n        // Update existing tasks\n        tasks.resultSet.forEach(newTask => {\n\n            let matchFound: boolean = false;\n\n            this.collectionGroups.forEach(existingTaskGrp => {\n                existingTaskGrp.groups.forEach(existingGroup => {\n\n                    existingGroup.tasks.forEach(existingTask => {\n                        if (existingTask.oid === newTask.oid) {\n\n                            matchFound = true;\n\n                            // Update props\n                            if (existingTask.label !== newTask.label) {\n                                existingTask.label = newTask.label;\n                            }\n                            if (existingTask.lastUpdateDate !== newTask.lastUpdateDate) {\n                                existingTask.lastUpdateDate = newTask.lastUpdateDate;\n                            }\n                            if (existingTask.lastUpdatedDate !== newTask.lastUpdatedDate) {\n                                existingTask.lastUpdatedDate = newTask.lastUpdatedDate;\n                            }\n                            if (existingTask.message !== newTask.message) {\n                                existingTask.message = newTask.message;\n                            }\n                            if (existingTask.status !== newTask.status) {\n                                existingTask.status = newTask.status;\n                            }\n                            if (existingTask.odmOutput !== newTask.odmOutput) {\n                                existingTask.odmOutput = newTask.odmOutput;\n                            }\n\n                            existingTask.actions = newTask.actions;\n                        }\n                    })\n                });\n            });\n\n            if (!matchFound) {\n                noMatch.push(newTask);\n            }\n        })\n\n        // Add new tasks\n        // let newTasks = data.tasks.filter((o: Task) => !this.collectionGroups.resultSet.find(o2 => o.oid === o2.oid));\n        if (noMatch && noMatch.length > 0) {\n            this.setTaskData({ resultSet: noMatch, count: tasks.count, pageNumber: this.taskPage.pageNumber, pageSize: this.taskPage.pageSize }, true);\n        }\n\n        this.setTaskGroupStatuses();\n    }\n\n\n    handleMessage(message: Message): void {\n        this.bsModalRef = this.modalService.show(MetadataModalComponent, {\n            animated: true,\n            backdrop: true,\n            ignoreBackdropClick: true,\n            'class': 'upload-modal'\n        });\n        this.bsModalRef.content.init(message.collectionId);\n\n        this.bsModalRef.content.onMetadataChange.subscribe((collectionId: string) => {\n\n            let index = -1;\n            for (let i = 0; i < this.messages.resultSet.length; i++) {\n                let msg = this.messages.resultSet[i];\n                if (msg.collectionId === collectionId) {\n                    index = i;\n                }\n            }\n\n            if (index >= 0) {\n                this.messages.resultSet.splice(index, 1);\n            }\n\n        });\n\n    }\n\n    handleGoto(collectionId: string): void {\n        // let breadcrumbs = []\n\n        this.managementService.view(collectionId).then(response => {\n            const entity = response.item;\n            const breadcrumbs = response.breadcrumbs;\n\n            this.managementService.getItems(collectionId, null).then(nodes => {\n                this.bsModalRef = this.modalService.show(LeafModalComponent, {\n                    animated: true,\n                    backdrop: true,\n                    ignoreBackdropClick: true,\n                    class: 'leaf-modal'\n                });\n                this.bsModalRef.content.init(entity, nodes, breadcrumbs);\n            })\n        })\n    }\n\n    removeTask(task: Task): void {\n\n        this.bsModalRef = this.modalService.show(BasicConfirmModalComponent, {\n            animated: true,\n            backdrop: true,\n            ignoreBackdropClick: true,\n        });\n        this.bsModalRef.content.message = 'Are you sure you want to delete [' + task.label + '?';\n        this.bsModalRef.content.data = task;\n        this.bsModalRef.content.type = 'DANGER';\n        this.bsModalRef.content.submitText = 'Delete';\n\n        (<BasicConfirmModalComponent>this.bsModalRef.content).onConfirm.subscribe(task => {\n            this.deleteTask(task);\n        });\n\n    }\n\n    deleteTask(task: Task) {\n        this.managementService.removeTask(task.uploadId)\n            .then(() => {\n                let pos = null;\n                for (let i = 0; i < this.tasks.resultSet.length; i++) {\n                    let thisTask = this.tasks[i];\n\n                    if (thisTask.uploadId === task.uploadId) {\n                        pos = i;\n                        break;\n                    }\n                }\n\n                if (pos !== null) {\n                    this.tasks.resultSet.splice(pos, 1);\n                }\n\n                this.getMissingMetadata();\n\n                this.totalTaskCount = this.tasks.count;\n\n            });\n    }\n\n    getMissingMetadata(): void {\n        this.onMessagePageChange(this.messages.pageNumber);\n    }\n\n    onMessagePageChange(pageNumber: number): void {\n        this.managementService.getMissingMetadata(this.messages.pageSize, pageNumber).then(messages => {\n            this.messages = messages;\n        });\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpHeaders, HttpClient, HttpErrorResponse, HttpParams, HttpBackend, HttpHandler } from '@angular/common/http';\n\n// import 'rxjs/add/operator/toPromise';\nimport { finalize } from 'rxjs/operators';\n\nimport { EventService } from '../../shared/service/event.service';\nimport { HttpBackendClient } from '../../shared/service/http-backend-client.service';\n\nimport { PageResult } from '../../shared/model/page';\nimport { Sensor } from '../model/sensor';\n\ndeclare var acp: any;\n\n@Injectable()\nexport class SensorService {\n\n    constructor( private http: HttpClient, private noErrorHttpClient: HttpBackendClient, private eventService: EventService ) { }\n\n    page( p: number ): Promise<PageResult<Sensor>> {\n        let params: HttpParams = new HttpParams();\n        params = params.set( 'number', p.toString() );\n\n        this.eventService.start();\n\n        return this.http\n            .get<PageResult<Sensor>>( acp + '/sensor/page', { params: params } )\n\t\t\t.pipe(finalize(() => {\n\t\t\t\tthis.eventService.complete();\n\t\t\t}))\n            .toPromise();\n    }\n\n    edit( oid: string ): Promise<Sensor> {\n\n        let headers = new HttpHeaders( {\n            'Content-Type': 'application/json'\n        } );\n\n        this.eventService.start();\n\n        return this.http\n            .post<Sensor>( acp + '/sensor/lock', JSON.stringify( { oid: oid } ), { headers: headers } )\n\t\t\t.pipe(finalize(() => {\n\t\t\t\tthis.eventService.complete();\n\t\t\t}))\n            .toPromise();\n    }\n\n    newInstance(): Promise<Sensor> {\n\n        let headers = new HttpHeaders( {\n            'Content-Type': 'application/json'\n        } );\n\n        this.eventService.start();\n\n        return this.http\n            .post<Sensor>( acp + '/sensor/newInstance', JSON.stringify( {} ), { headers: headers } )\n\t\t\t.pipe(finalize(() => {\n\t\t\t\tthis.eventService.complete();\n\t\t\t}))\n            .toPromise();\n    }\n\n    remove( oid: string ): Promise<void> {\n\n        let headers = new HttpHeaders( {\n            'Content-Type': 'application/json'\n        } );\n\n        this.eventService.start();\n\n        return this.http\n            .post<void>( acp + '/sensor/remove', JSON.stringify( { oid: oid } ), { headers: headers } )\n\t\t\t.pipe(finalize(() => {\n\t\t\t\tthis.eventService.complete();\n\t\t\t}))\n            .toPromise();\n    }\n\n    apply( sensor: Sensor ): Promise<Sensor> {\n\n        let headers = new HttpHeaders( {\n            'Content-Type': 'application/json'\n        } );\n\n        this.eventService.start();\n\n        return this.noErrorHttpClient\n            .post<Sensor>( acp + '/sensor/apply', JSON.stringify( { sensor: sensor } ), { headers: headers } )\n\t\t\t.pipe(finalize(() => {\n\t\t\t\tthis.eventService.complete();\n\t\t\t}))\n            .toPromise();\n    }\n\n    unlock( oid: string ): Promise<void> {\n\n        let headers = new HttpHeaders( {\n            'Content-Type': 'application/json'\n        } );\n\n        this.eventService.start();\n\n        return this.noErrorHttpClient\n            .post<void>( acp + '/sensor/unlock', JSON.stringify( { oid: oid } ), { headers: headers } )\n\t\t\t.pipe(finalize(() => {\n\t\t\t\tthis.eventService.complete();\n\t\t\t}))\n            .toPromise();\n    }\n}","<div *ngIf=\"sensor != null\" class=\"modal-body\">\n  <div *ngIf=\"message != null\" class=\"error-container\">\n    <div class=\"label-holder\">\n      <strong>Error</strong>\n    </div>\n    <div class=\"holder\">\n      <div>\n        <p class=\"error-message\">{{message}}</p>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"modal-title-container\">\n    <h3>Sensor</h3>\n  </div>\n\n  <form #ngForm=\"ngForm\">\n    <div class=\"form-group\">\n      <label>Name</label>\n      <input [(ngModel)]=\"sensor.name\" name=\"name\" type=\"input\" class=\"form-control\" placeholder=\"Name\" [disabled]=\"!newInstance\" required />\n    </div>\n    <div class=\"form-group\">\n      <label>Label</label>\n      <input [(ngModel)]=\"sensor.displayLabel\" name=\"displayLabel\" type=\"input\" class=\"form-control\" placeholder=\"Display Label\" required />\n    </div>\n    <div class=\"form-group\">\n      <label>Type</label>\n      <input [(ngModel)]=\"sensor.sensorType\" name=\"sensorType\" type=\"input\" class=\"form-control\" placeholder=\"Type\" required />\n    </div>\n    <div class=\"form-group\">\n      <label>Model</label>\n      <input [(ngModel)]=\"sensor.model\" name=\"model\" type=\"input\" class=\"form-control\" placeholder=\"Model\" required />\n    </div>\n    <div class=\"form-group\">\n      <label>Wave Length</label>\n      <div *ngFor=\"let wavelength of waveLengths\">\n        <boolean-field [value]=\"sensor.waveLength && (-1 !== sensor.waveLength.indexOf(wavelength))\" [label]=\"wavelength\" (valueChange)=\"updateSelectedWaveLength(wavelength, $event)\"></boolean-field>\n      </div>\n    </div>\n    <div class=\"btn-holder\" style=\"text-align: right;\">\n      <button type=\"button\" class=\"btn btn-default\" (click)=\"handleOnCancel()\">Cancel</button>\n      <button type=\"submit\" class=\"btn btn-primary\" (click)=\"handleOnSubmit()\" [disabled]=\"!ngForm.valid\">Apply</button>\n    </div>\n  </form>\n</div>\n","import { Component, OnInit, AfterViewInit, ViewChild, ElementRef } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { Subject } from 'rxjs';\n\nimport { Sensor, WAVELENGTHS } from '../../model/sensor';\nimport { SensorService } from '../../service/sensor.service';\n\n\n@Component({\n\tselector: 'sensor',\n\ttemplateUrl: './sensor.component.html',\n\tstyleUrls: []\n})\nexport class SensorComponent implements OnInit {\n\tsensor: Sensor;\n\tnewInstance: boolean = false;\n\n\tmessage: string = null;\n\n\twaveLengths: string[] = WAVELENGTHS;\n\n    /*\n     * Observable subject for TreeNode changes.  Called when create is successful \n     */\n\tpublic onSensorChange: Subject<Sensor>;\n\n\tconstructor(private service: SensorService, public bsModalRef: BsModalRef) { }\n\n\tngOnInit(): void {\n\t\tthis.onSensorChange = new Subject();\n\t}\n\n\thandleOnSubmit(): void {\n\t\tthis.message = null;\n\n\t\tthis.service.apply(this.sensor).then(data => {\n\t\t\tthis.onSensorChange.next(data);\n\t\t\tthis.bsModalRef.hide();\n\t\t}).catch((err: HttpErrorResponse) => {\n\t\t\tthis.error(err);\n\t\t});\n\t}\n\n\thandleOnCancel(): void {\n\t\tthis.message = null;\n\n\t\tif (this.newInstance) {\n\t\t\tthis.bsModalRef.hide();\n\t\t}\n\t\telse {\n\t\t\tthis.service.unlock(this.sensor.oid).then(data => {\n\t\t\t\tthis.bsModalRef.hide();\n\t\t\t}).catch((err: HttpErrorResponse) => {\n\t\t\t\tthis.error(err);\n\t\t\t});\n\t\t}\n\t}\n\n\tupdateSelectedWaveLength(wavelength: string, checked: boolean): void {\n\n\t\tconst indexOf = this.sensor.waveLength.indexOf(wavelength)\n\n\t\tif (checked) {\n\n\t\t\tif (indexOf < 0) {\n\t\t\t\tthis.sensor.waveLength.push(wavelength);\n\n\t\t\t}\n\t\t} else {\n\t\t\tif (indexOf > -1) {\n\t\t\t\tthis.sensor.waveLength.splice(indexOf, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\terror(err: HttpErrorResponse): void {\n\t\t// Handle error\n\t\tif (err !== null) {\n\t\t\tthis.message = (err.error.localizedMessage || err.error.message || err.message);\n\n\t\t\tconsole.log(this.message);\n\t\t}\n\t}\n\n}\n","<div class=\"new-admin-design-main\">\n    <uasdm-header></uasdm-header>\n\n    <div id=\"app-container\" class=\"container\">\n\n\t\t<h2>Sensors</h2>\n\n\t\t<pagination-controls *ngIf=\"res.resultSet.length > res.pageSize\" (pageChange)=\"onPageChange($event)\"></pagination-controls>\n\t\t\n\t\t<div class=\"list-table-wrapper\">\n\t\t\t<table id=\"manage-sensors-table\"\n\t\t\t\tclass=\"list-table table table-bordered table-striped\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th></th>\n\t\t\t\t\t\t<th class=\"label-column\">Name</th>\n\t\t\t\t\t\t<th class=\"label-column\">Label</th>\n\t\t\t\t\t\t<th class=\"label-column\">Type</th>\n\t\t\t\t\t\t<th class=\"label-column\">Model</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr *ngFor=\"let sensor of res.resultSet | paginate: { itemsPerPage: res.pageSize, currentPage: res.pageNumber, totalItems: res.count }\"\n\t\t\t\t\t\tclass=\"fade-ngRepeat-item\">\n\t\t\t\t\t\t<td class=\"button-column\">\n\t\t\t\t\t\t  <a class=\"fa fa-pencil-alt ico-edit\" (click)=\"edit(sensor)\" title=\"Edit sensor\"></a>\n\t\t\t\t\t\t  <a class=\"fa fa-trash-alt ico-remove\" (click)=\"onClickRemove(sensor)\" title=\"Remove sensor\"></a>\n\t\t\t\t\t    </td>\n\t\t\t\t\t\t<td class=\"label-column\">{{ sensor.name }}</td>\n\t\t\t\t\t\t<td class=\"label-column\">{{ sensor.displayLabel }}</td>\n\t\t\t\t\t\t<td class=\"label-column\">{{ sensor.sensorType }}</td>\n\t\t\t\t\t\t<td class=\"label-column\">{{ sensor.model }}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"button-column\">\n\t\t\t\t\t\t  <a class=\"fa fa-plus\" (click)=\"newInstance()\" title=\"Add new sensor\"></a>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\n\t\t\n\t\t<pagination-controls *ngIf=\"res.resultSet.length > res.pageSize\" (pageChange)=\"onPageChange($event)\"></pagination-controls>\n\t</div>\n</div>","import { Component, OnInit, ViewChild, ElementRef } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\n\nimport { BasicConfirmModalComponent } from '../../../shared/component/modal/basic-confirm-modal.component';\nimport { LocalizationService } from '../../../shared/service/localization.service';\n\nimport { PageResult } from '../../../shared/model/page';\nimport { Sensor } from '../../model/sensor';\nimport { SensorService } from '../../service/sensor.service';\nimport { SensorComponent } from './sensor.component';\n\ndeclare let acp: string;\n\n@Component( {\n    selector: 'sensors',\n    templateUrl: './sensors.component.html',\n    styles: ['./sensors.css']\n} )\nexport class SensorsComponent implements OnInit {\n    res: PageResult<Sensor> = {\n        resultSet: [],\n        count: 0,\n        pageNumber: 1,\n        pageSize: 10\n    };\n    bsModalRef: BsModalRef;\n    message: string = null;\n\n    constructor(\n        private router: Router,\n        private service: SensorService,\n        private modalService: BsModalService,\n        private localizeService: LocalizationService\n    ) { }\n\n    ngOnInit(): void {\n        this.service.page( 1 ).then( res => {\n            this.res = res;\n        } );\n    }\n\n    remove( sensor: Sensor ): void {\n        this.service.remove( sensor.oid ).then( response => {\n            this.res.resultSet = this.res.resultSet.filter( h => h.oid !== sensor.oid );\n        } );\n    }\n\n    onClickRemove( sensor: Sensor ): void {\n        this.bsModalRef = this.modalService.show( BasicConfirmModalComponent, {\n            animated: true,\n            backdrop: true,\n            ignoreBackdropClick: true,\n        } );\n        this.bsModalRef.content.message = \"Are you sure you want to remove the sensor [\" + sensor.name + \"]\";\n\t\tthis.bsModalRef.content.type = 'DANGER';\n        this.bsModalRef.content.submitText = \"Delete\";\n\n        this.bsModalRef.content.onConfirm.subscribe( data => {\n            this.remove( sensor );\n        } );\n    }\n\n    edit( sensor: Sensor ): void {\n        this.service.edit( sensor.oid ).then( res => {\n            this.showModal( res, false );\n        } );\n    }\n\n    newInstance(): void {\n        this.service.newInstance().then( res => {\n            this.showModal( res, true );\n        } );\n    }\n\n    showModal( sensor: Sensor, newInstance: boolean ): void {\n        this.bsModalRef = this.modalService.show( SensorComponent, {\n            animated: true,\n            backdrop: true,\n            ignoreBackdropClick: true,\n        } );\n        this.bsModalRef.content.sensor = sensor;\n        this.bsModalRef.content.newInstance = newInstance;\n\n        let that = this;\n        this.bsModalRef.content.onSensorChange.subscribe( data => {\n            this.onPageChange( this.res.pageNumber );\n        } );\n\n    }\n\n    onPageChange( pageNumber: number ): void {\n        this.service.page( pageNumber ).then( res => {\n            this.res = res;\n        } );\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpHeaders, HttpClient, HttpErrorResponse, HttpParams, HttpBackend } from '@angular/common/http';\n\n// import 'rxjs/add/operator/toPromise';\nimport { finalize } from 'rxjs/operators';\n\nimport { EventService } from '../../shared/service/event.service';\nimport { HttpBackendClient } from '../../shared/service/http-backend-client.service';\n\nimport { PageResult } from '../../shared/model/page';\nimport { Platform } from '../model/platform';\n\ndeclare var acp: any;\n\n@Injectable()\nexport class PlatformService {\n\n    constructor( private http: HttpClient, private noErrorHttpClient: HttpBackendClient, private eventService: EventService ) { }\n\n    page( p: number ): Promise<PageResult<Platform>> {\n        let params: HttpParams = new HttpParams();\n        params = params.set( 'number', p.toString() );\n\n        this.eventService.start();\n\n        return this.http\n            .get<PageResult<Platform>>( acp + '/platform/page', { params: params } )\n\t\t\t.pipe(finalize(() => {\n\t\t\t\tthis.eventService.complete();\n\t\t\t}))\n            .toPromise();\n    }\n\n    edit( oid: string ): Promise<Platform> {\n\n        let headers = new HttpHeaders( {\n            'Content-Type': 'application/json'\n        } );\n\n        this.eventService.start();\n\n        return this.http\n            .post<Platform>( acp + '/platform/lock', JSON.stringify( { oid: oid } ), { headers: headers } )\n\t\t\t.pipe(finalize(() => {\n\t\t\t\tthis.eventService.complete();\n\t\t\t}))\n            .toPromise();\n    }\n\n    newInstance(): Promise<Platform> {\n\n        let headers = new HttpHeaders( {\n            'Content-Type': 'application/json'\n        } );\n\n        this.eventService.start();\n\n        return this.http\n            .post<Platform>( acp + '/platform/newInstance', JSON.stringify( {} ), { headers: headers } )\n\t\t\t.pipe(finalize(() => {\n\t\t\t\tthis.eventService.complete();\n\t\t\t}))\n            .toPromise();\n    }\n\n    remove( oid: string ): Promise<void> {\n\n        let headers = new HttpHeaders( {\n            'Content-Type': 'application/json'\n        } );\n\n        this.eventService.start();\n\n        return this.http\n            .post<void>( acp + '/platform/remove', JSON.stringify( { oid: oid } ), { headers: headers } )\n\t\t\t.pipe(finalize(() => {\n\t\t\t\tthis.eventService.complete();\n\t\t\t}))\n            .toPromise();\n    }\n\n    apply( platform: Platform ): Promise<Platform> {\n\n        let headers = new HttpHeaders( {\n            'Content-Type': 'application/json'\n        } );\n\n        this.eventService.start();\n\n        return this.noErrorHttpClient\n            .post<Platform>( acp + '/platform/apply', JSON.stringify( { platform: platform } ), { headers: headers } )\n\t\t\t.pipe(finalize(() => {\n\t\t\t\tthis.eventService.complete();\n\t\t\t}))\n            .toPromise();\n    }\n\n    unlock( oid: string ): Promise<void> {\n\n        let headers = new HttpHeaders( {\n            'Content-Type': 'application/json'\n        } );\n\n        this.eventService.start();\n\n        return this.noErrorHttpClient\n            .post<void>( acp + '/platform/unlock', JSON.stringify( { oid: oid } ), { headers: headers } )\n\t\t\t.pipe(finalize(() => {\n\t\t\t\tthis.eventService.complete();\n\t\t\t}))\n            .toPromise();\n    }\n}","<div *ngIf=\"platform != null\" class=\"modal-body\">\n  <div *ngIf=\"message != null\" class=\"error-container\">\n    <div class=\"label-holder\">\n      <strong>Error</strong>\n    </div>\n    <div class=\"holder\">\n      <div>\n        <p class=\"error-message\">{{message}}</p>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"modal-title-container\">\n    <h3>Platform</h3>\n  </div>\n\n  <form #ngForm=\"ngForm\">\n    <div class=\"form-group\">\n      <label>Name</label>\n      <input [(ngModel)]=\"platform.name\" name=\"name\" type=\"input\" class=\"form-control\" placeholder=\"Name\" [disabled]=\"!newInstance\" required />\n    </div>\n    <div class=\"form-group\">\n      <label>Label</label>\n      <input [(ngModel)]=\"platform.displayLabel\" name=\"displayLabel\" type=\"input\" class=\"form-control\" placeholder=\"Display Label\" required />\n    </div>\n    <div class=\"form-group\">\n      <label>Type</label>\n      <select [(ngModel)]=\"platform.platformType\" name=\"platformType\" type=\"input\" class=\"form-control\" required>\n        <option></option> \n        <option>Fixed Wing</option>\n        <option>Hybrid</option>\n      </select>\n    </div>\n    <div class=\"btn-holder\" style=\"text-align: right;\">\n      <button type=\"button\" class=\"btn btn-default\" (click)=\"handleOnCancel()\">Cancel</button>\n      <button type=\"submit\" class=\"btn btn-primary\" (click)=\"handleOnSubmit()\" [disabled]=\"!ngForm.valid\">Apply</button>\n    </div>\n  </form>\n</div>\n","import { Component, OnInit, AfterViewInit, ViewChild, ElementRef } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport { Subject } from 'rxjs';\n\nimport { Platform } from '../../model/platform';\nimport { PlatformService } from '../../service/platform.service';\n\n\n@Component( {\n    selector: 'platform',\n    templateUrl: './platform.component.html',\n    styleUrls: []\n} )\nexport class PlatformComponent implements OnInit {\n    platform: Platform;\n    newInstance: boolean = false;\n\n    message: string = null;\n\n    /*\n     * Observable subject for TreeNode changes.  Called when create is successful \n     */\n    public onPlatformChange: Subject<Platform>;\n\n    constructor( private service: PlatformService, public bsModalRef: BsModalRef ) { }\n\n    ngOnInit(): void {\n        this.onPlatformChange = new Subject();\n    }\n\n    handleOnSubmit(): void {\n        this.message = null;\n\n        this.service.apply( this.platform ).then( data => {\n            this.onPlatformChange.next( data );\n            this.bsModalRef.hide();\n        } ).catch(( err: HttpErrorResponse ) => {\n            this.error( err );\n        } );\n    }\n\n    handleOnCancel(): void {\n        this.message = null;\n\n        if ( this.newInstance ) {\n            this.bsModalRef.hide();\n        }\n        else {\n            this.service.unlock( this.platform.oid ).then( data => {\n                this.bsModalRef.hide();\n            } ).catch(( err: HttpErrorResponse ) => {\n                this.error( err );\n            } );\n        }\n    }\n\n    error( err: HttpErrorResponse ): void {\n        // Handle error\n        if ( err !== null ) {\n            this.message = ( err.error.localizedMessage || err.error.message || err.message );\n\n            console.log( this.message );\n        }\n    }\n\n}\n","<div class=\"new-admin-design-main\">\n\t<uasdm-header></uasdm-header>\n\n\t<div id=\"app-container\" class=\"container\">\n\n\t\t<h2>Platforms</h2>\n\n\t\t<pagination-controls *ngIf=\"res.resultSet.length > res.pageSize\" (pageChange)=\"onPageChange($event)\"></pagination-controls>\n\t\t\n\t\t<div class=\"list-table-wrapper\">\n\t\t\t<table id=\"manage-platforms-table\"\n\t\t\t\tclass=\"list-table table table-bordered table-striped\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th></th>\n\t\t\t\t\t\t<th class=\"label-column\">Name</th>\n\t\t\t\t\t\t<th class=\"label-column\">Label</th>\n\t\t\t\t\t\t<th class=\"label-column\">Type</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr *ngFor=\"let platform of res.resultSet | paginate: { itemsPerPage: res.pageSize, currentPage: res.pageNumber, totalItems: res.count }\"\n\t\t\t\t\t\tclass=\"fade-ngRepeat-item\">\n\t\t\t\t\t\t<td class=\"button-column\">\n\t\t\t\t\t\t  <a class=\"fa fa-pencil-alt ico-edit\" (click)=\"edit(platform)\" title=\"Edit platform\"></a>\n\t\t\t\t\t\t  <a class=\"fa fa-trash-alt ico-remove\" (click)=\"onClickRemove(platform)\" title=\"Remove platform\"></a>\n\t\t\t\t\t    </td>\n\t\t\t\t\t\t<td class=\"label-column\">{{ platform.name }}</td>\n\t\t\t\t\t\t<td class=\"label-column\">{{ platform.displayLabel }}</td>\n\t\t\t\t\t\t<td class=\"label-column\">{{ platform.platformType }}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"button-column\">\n\t\t\t\t\t\t  <a class=\"fa fa-plus\" (click)=\"newInstance()\" title=\"Add new platform\"></a>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t</div>\n\t\t\n\t\t<pagination-controls *ngIf=\"res.resultSet.length > res.pageSize\" (pageChange)=\"onPageChange($event)\"></pagination-controls>\n\t</div>\n</div>","import { Component, OnInit, ViewChild, ElementRef } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\n\nimport { BasicConfirmModalComponent } from '../../../shared/component/modal/basic-confirm-modal.component';\nimport { LocalizationService } from '../../../shared/service/localization.service';\n\nimport { PageResult } from '../../../shared/model/page';\nimport { Platform } from '../../model/platform';\nimport { PlatformService } from '../../service/platform.service';\nimport { PlatformComponent } from './platform.component';\n\ndeclare let acp: string;\n\n@Component( {\n    selector: 'platforms',\n    templateUrl: './platforms.component.html',\n    styles: ['./platforms.css']\n} )\nexport class PlatformsComponent implements OnInit {\n    res: PageResult<Platform> = {\n        resultSet: [],\n        count: 0,\n        pageNumber: 1,\n        pageSize: 10\n    };\n    bsModalRef: BsModalRef;\n    message: string = null;\n\n    constructor(\n        private router: Router,\n        private service: PlatformService,\n        private modalService: BsModalService,\n        private localizeService: LocalizationService\n    ) { }\n\n    ngOnInit(): void {\n        this.service.page( 1 ).then( res => {\n            this.res = res;\n        } );\n    }\n\n    remove( platform: Platform ): void {\n        this.service.remove( platform.oid ).then( response => {\n            this.res.resultSet = this.res.resultSet.filter( h => h.oid !== platform.oid );\n        } );\n    }\n\n    onClickRemove( platform: Platform ): void {\n        this.bsModalRef = this.modalService.show( BasicConfirmModalComponent, {\n            animated: true,\n            backdrop: true,\n            ignoreBackdropClick: true,\n        } );\n        this.bsModalRef.content.message = \"Are you sure you want to remove the platform [\" + platform.name + \"]\";\n\t\tthis.bsModalRef.content.type = 'DANGER';\n        this.bsModalRef.content.submitText = \"Delete\";\n\n        this.bsModalRef.content.onConfirm.subscribe( data => {\n            this.remove( platform );\n        } );\n    }\n\n    edit( platform: Platform ): void {\n        this.service.edit( platform.oid ).then( res => {\n            this.showModal( res, false );\n        } );\n    }\n\n    newInstance(): void {\n        this.service.newInstance().then( res => {\n            this.showModal( res, true );\n        } );\n    }\n\n    showModal( platform: Platform, newInstance: boolean ): void {\n        this.bsModalRef = this.modalService.show( PlatformComponent, {\n            animated: true,\n            backdrop: true,\n            ignoreBackdropClick: true,\n        } );\n        this.bsModalRef.content.platform = platform;\n        this.bsModalRef.content.newInstance = newInstance;\n\n        let that = this;\n        this.bsModalRef.content.onPlatformChange.subscribe( data => {\n            this.onPageChange( this.res.pageNumber );\n        } );\n\n    }\n\n    onPageChange( pageNumber: number ): void {\n        this.service.page( pageNumber ).then( res => {\n            this.res = res;\n        } );\n    }\n}\n","import { Directive, Input } from \"@angular/core\";\r\nimport { AbstractControl, NG_VALIDATORS, Validator, ValidatorFn } from \"@angular/forms\";\r\n\r\nexport function forbiddenNameValidator( nameRe: RegExp ): ValidatorFn {\r\n    return ( control: AbstractControl ): { [key: string]: any } | null => {\r\n        const forbidden = nameRe.test( control.value );\r\n        return forbidden ? { 'forbiddenName': { value: control.value } } : null;\r\n    };\r\n}\r\n\r\n@Directive( {\r\n    selector: '[forbiddenName]',\r\n    providers: [{ provide: NG_VALIDATORS, useExisting: ForbiddenNameDirective, multi: true }]\r\n} )\r\nexport class ForbiddenNameDirective implements Validator {\r\n    validate( control: AbstractControl ): { [key: string]: any } | null {\r\n        return forbiddenNameValidator( new RegExp( /[\\W<>\\-+=!@#$%^&*?/\\\\']/gm  ) )( control );\r\n    }\r\n  }","import { Injectable } from \"@angular/core\";\r\nimport { CanDeactivate } from \"@angular/router\";\r\n\r\nimport { UploadComponent } from \"../component/upload.component\";\r\n\r\n@Injectable()\r\nexport class CanDeactivateGuardService implements CanDeactivate<UploadComponent> {\r\n  canDeactivate(component: UploadComponent): boolean {\r\n   \r\n    if(component.canDeactivate()){\r\n        if (confirm(\"An upload is currently in progress. Are you sure you want to leave?\")) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n  }\r\n}","import { NgModule, Injectable, Inject } from '@angular/core';\nimport { LocationStrategy, HashLocationStrategy } from '@angular/common';\nimport { Routes, RouterModule, Resolve, ActivatedRouteSnapshot, RouterStateSnapshot } from '@angular/router';\nimport { Observable } from 'rxjs';\n\nimport { ProjectsComponent } from './component/projects.component';\nimport { UploadComponent } from './component/upload.component';\nimport { TasksComponent } from './component/tasks.component';\nimport { SensorsComponent } from './component/sensor/sensors.component';\nimport { PlatformsComponent } from './component/platform/platforms.component';\n\nimport { CanDeactivateGuardService } from \"./service/can.deactivate.guard.service\";\nimport { AuthGuard, AdminGuardService } from '../shared/service/guard.service';\n\nconst routes: Routes = [\n    {\n        path: '',\n        canActivate: [AuthGuard],\n        component: ProjectsComponent\n    },\n    {\n        path: 'viewer',\n        canActivate: [AuthGuard],\n        component: ProjectsComponent\n    },\n    {\n        path: 'upload',\n        component: UploadComponent,\n        canDeactivate: [CanDeactivateGuardService]\n    },\n    {\n        path: 'tasks',\n        canActivate: [AuthGuard],\n        component: TasksComponent\n    },\n    {\n        path: 'sensors',\n        canActivate: [AdminGuardService],\n        component: SensorsComponent,\n    },\n    {\n        path: 'platforms',\n        canActivate: [AdminGuardService],\n        component: PlatformsComponent,\n    }\n];\n\n@NgModule( {\n    imports: [RouterModule.forChild( routes )],\n    exports: [RouterModule],\n    providers: [{ provide: LocationStrategy, useClass: HashLocationStrategy }]\n} )\nexport class SiteRoutingModule { }","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { RouterModule } from '@angular/router';\nimport { FormsModule } from '@angular/forms';\n//import { TreeModule } from 'angular-tree-component';\n//import { ContextMenuModule } from 'ngx-contextmenu';\nimport { NgxFileDropModule } from 'ngx-file-drop';\nimport { BsDropdownModule } from 'ngx-bootstrap/dropdown';\nimport { TypeaheadModule } from 'ngx-bootstrap/typeahead';\nimport { AccordionModule } from 'ngx-bootstrap/accordion';\nimport { TabsModule } from 'ngx-bootstrap/tabs';\nimport { AlertModule } from 'ngx-bootstrap/alert';\nimport { NgxPaginationModule } from 'ngx-pagination';\nimport { CollapseModule } from 'ngx-bootstrap/collapse';\n\nimport { MapAttributeComponent } from './component/map-attribute/map-attribute.component';\nimport { ProductPanelComponent } from './component/product-panel/product-panel.component';\nimport { EntityModalComponent } from './component/modal/entity-modal.component';\nimport { MetadataModalComponent } from './component/modal/metadata-modal.component';\nimport { ImagePreviewModalComponent } from './component/modal/image-preview-modal.component';\nimport { UploadModalComponent } from './component/modal/upload-modal.component';\nimport { LeafModalComponent } from './component/modal/leaf-modal.component';\nimport { AccessibleSupportModalComponent } from './component/modal/accessible-support-modal.component';\nimport { ProductModalComponent } from './component/modal/product-modal.component';\nimport { ProjectsComponent } from './component/projects.component';\nimport { UploadComponent } from './component/upload.component';\nimport { TasksComponent } from './component/tasks.component';\nimport { TasksPanelComponent } from './component/tasks/tasks-panel.component';\nimport { SensorsComponent } from './component/sensor/sensors.component';\nimport { SensorComponent } from './component/sensor/sensor.component';\nimport { PlatformsComponent } from './component/platform/platforms.component';\nimport { PlatformComponent } from './component/platform/platform.component';\n\n\nimport { ForbiddenNameDirective } from './directive/forbidden-name.directive';\nimport { OnlyNumber } from './directive/number-only.directive';\n\nimport { ProductService } from './service/product.service';\nimport { ManagementService } from './service/management.service';\nimport { MapService } from './service/map.service';\nimport { CanDeactivateGuardService } from './service/can.deactivate.guard.service';\nimport { SensorService } from './service/sensor.service';\nimport { PlatformService } from './service/platform.service';\nimport { MetadataService } from './service/metadata.service';\n\nimport { SiteRoutingModule } from './site-routing.module';\nimport { SharedModule } from '../shared/shared.module';\n\n@NgModule({\n\timports: [\n\t\tCommonModule,\n\t\tRouterModule,\n\t\tFormsModule,\n\t\tNgxPaginationModule,\n\t\t//        TreeModule,\n\t\t//        ContextMenuModule,\n\t\t//        ModalModule.forRoot(),\n\t\tAlertModule,\n\t\tBsDropdownModule,\n\t\tTypeaheadModule,\n\t\tAccordionModule,\n\t\tTabsModule.forRoot(),\n\t\tCollapseModule.forRoot(),\n\t\tSharedModule,\n\t\tSiteRoutingModule,\n\t\tNgxFileDropModule\n\t],\n\tdeclarations: [\n\t\tMapAttributeComponent,\n\t\tProductPanelComponent,\n\t\tEntityModalComponent,\n\t\tMetadataModalComponent,\n\t\tImagePreviewModalComponent,\n\t\tUploadModalComponent,\n\t\tLeafModalComponent,\n\t\tAccessibleSupportModalComponent,\n\t\tProductModalComponent,\n\t\tProjectsComponent,\n\t\tUploadComponent,\n\t\tTasksComponent,\n\t\tForbiddenNameDirective,\n\t\tOnlyNumber,\n\t\tSensorComponent,\n\t\tSensorsComponent,\n\t\tPlatformComponent,\n\t\tPlatformsComponent,\n\t\tTasksPanelComponent\n\t],\n\tproviders: [\n\t\tCanDeactivateGuardService,\n\t\tManagementService,\n\t\tProductService,\n\t\tMapService,\n\t\tSensorService,\n\t\tPlatformService,\n\t\tMetadataService\n\t],\n\tentryComponents: [\n\t\tUploadModalComponent,\n\t\tEntityModalComponent,\n\t\tImagePreviewModalComponent,\n\t\tMetadataModalComponent,\n\t\tSensorComponent,\n\t\tLeafModalComponent,\n\t\tProductModalComponent,\n\t\tPlatformComponent\n\t]\n})\nexport class SiteModule { }\n"],"sourceRoot":""}