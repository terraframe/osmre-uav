(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{187:function(e,t,c){"use strict";c.r(t),c.d(t,"SiteModule",(function(){return ki}));var n=c(0),i=c(3),s=c(9),a=c(4),o=c(335),l=c(18),r=c(57),d=c(45),u=c(332),p=c(44),h=c(100),g=c(21),f=c(184),m=c(185),b=c(186),k=c(5),v=c(8);const j="pk.eyJ1IjoidGVycmFmcmFtZSIsImEiOiJjanZxNTFnaTYyZ2RuNDlxcmNnejNtNjN6In0.-kmlS8Tgb2fNc1NPb5rJEQ";class y{constructor(e){this.http=e,f.accessToken=j}features(){let e=new v.g;return this.http.get(acp+"/project/features",{params:e}).toPromise()}mbForwardGeocode(e){let t=new v.g,c="https://api.mapbox.com/geocoding/v5/mapbox.places/"+e+".json?proximity=-74.70850,40.78375&access_token="+j;return this.http.get(c,{params:t}).toPromise()}}function T(e,t){1&e&&(n.kc(0,"span"),n.gc(1,"i",13),n.jc())}function S(e,t){1&e&&(n.kc(0,"span"),n.gc(1,"i",14),n.jc())}function C(e,t){if(1&e&&(n.kc(0,"span"),n.Uc(1),n.jc()),2&e){const e=t.$implicit;n.Tb(1),n.Wc(" ",e.label," / ")}}function w(e,t){if(1&e&&(n.Sc(0,T,2,0,"span",11),n.Sc(1,S,2,0,"span",11),n.kc(2,"span"),n.Sc(3,C,2,1,"span",12),n.jc(),n.kc(4,"b"),n.Uc(5),n.jc()),2&e){const e=t.match;n.Ac("ngIf",null==e.item.filename),n.Tb(1),n.Ac("ngIf",null!=e.item.filename),n.Tb(2),n.Ac("ngForOf",e.item.hierarchy),n.Tb(2),n.Vc(e.item.label)}}y.ɵfac=function(e){return new(e||y)(n.oc(v.c))},y.ɵprov=n.bc({token:y,factory:y.ɵfac});const M=function(){return{standalone:!0}};class O{constructor(e){this.mapService=e,this.baseLayers=[{label:"Outdoors",id:"outdoors-v11",selected:!0},{label:"Satellite",id:"satellite-v9"},{label:"Streets",id:"streets-v11"}],this.center=new f.LngLat(-78.880453,42.897852),this.zoom=2,this.coordinate={longitude:null,latitude:null},this.search="",this.dataSource=k.a.create(e=>{this.mapService.mbForwardGeocode(this.search).then(t=>{const c=t.features;let n=[];c.forEach(e=>{let t={id:e.id,hierarchy:[],label:e.place_name,center:e.center,source:"MAPBOX"};n.push(t)}),e.next(n)})})}ngOnInit(){this.refreshCoordinateFromMap()}ngAfterViewInit(){let e={container:"map-attribute-div",style:"mapbox://styles/mapbox/outdoors-v11",zoom:this.zoom,center:this.center};null!=this.site.geometry&&(e.center=this.site.geometry.coordinates),this.map=new f.Map(e),this.map.on("load",()=>{this.initMap()})}ngOnDestroy(){this.map.remove()}initMap(){let e=m.modes;e.static=b,this.draw=new m({modes:e,displayControlsDefault:!1,controls:{static:!0}}),this.map.addControl(this.draw),this.map.addControl(new f.NavigationControl),this.map.on("draw.update",e=>{this.onDrawUpdate(e)}),this.map.on("draw.create",e=>{this.onDrawCreate(e)}),this.map.on("draw.modechange",e=>{this.onDrawUpdate(e)}),this.map.on("style.load",()=>{this.addLayers()}),this.addLayers()}addLayers(){if(null!=this.site.geometry){let e={id:this.site.id,type:"Feature",properties:{oid:this.site.id,name:this.site.name},geometry:this.site.geometry};this.draw.add(e),this.draw.changeMode("simple_select",{featureIds:[e.id]})}else this.draw.changeMode("draw_point",{});this.map.addSource("sites",{type:"geojson",data:{type:"FeatureCollection",features:[]}})}onDrawUpdate(e){"move"===e.action&&null!=e.features&&e.features.length>0&&this.updateGeometry(e.features[0])}onDrawCreate(e){if(null!=e.features&&e.features.length>0){let t=e.features[0];t.id=this.site.id,this.updateGeometry(t)}}updateGeometry(e){this.site.geometry=e.geometry,this.refreshCoordinateFromMap()}refreshCoordinateFromMap(){null!=this.site&&null!=this.site.geometry&&(this.coordinate.longitude=this.site.geometry.coordinates[0],this.coordinate.latitude=this.site.geometry.coordinates[1])}refreshCoordinateFromInput(){if(null!=this.coordinate.longitude&&null!=this.coordinate.latitude){console.log(this.site.geometry),null==this.site.geometry&&(this.site.geometry={type:"Point"}),this.site.geometry.coordinates=[this.coordinate.longitude,this.coordinate.latitude];var e=this.draw.set({type:"FeatureCollection",features:[{id:this.site.id,type:"Feature",properties:{oid:this.site.id,name:this.site.name},geometry:this.site.geometry}]});this.draw.changeMode("simple_select",{featureIds:e})}}handleStyle(e){this.baseLayers.forEach(e=>{e.selected=!1}),e.selected=!0,this.map.setStyle("mapbox://styles/mapbox/"+e.id)}handleClick(e){let t=e.item;t.center&&this.map.flyTo({center:t.center,zoom:9})}}O.ɵfac=function(e){return new(e||O)(n.fc(y))},O.ɵcmp=n.Zb({type:O,selectors:[["map-attribute"]],inputs:{site:"site",center:"center",zoom:"zoom"},decls:23,vars:9,consts:[[1,"row-holder"],[1,"label-holder"],[1,"holder"],[1,"modal-body"],["id","search-container",2,"position","absolute","z-index","999","padding","15px","width","35%"],["type","text","placeholder","Search...","typeaheadOptionField","label",1,"form-control","search-input",3,"ngModel","typeaheadAsync","typeahead","typeaheadOptionsLimit","typeaheadItemTemplate","ngModelOptions","ngModelChange","typeaheadOnSelect","keydown.enter"],["id","map-attribute-div",1,"map-view-port",2,"height","300px"],[1,"modal-body","text-left"],["name","longitude","type","number","required","",1,"form-control",3,"ngModel","ngModelChange","change"],["name","latitude","type","number","required","",1,"form-control",3,"ngModel","ngModelChange","change"],["bsItemTemplate",""],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"fa","fa-folder-open"],[1,"fa","fa-file"]],template:function(e,t){if(1&e&&(n.kc(0,"div",0),n.gc(1,"div",1),n.kc(2,"div",2),n.kc(3,"div",3),n.kc(4,"div",4),n.kc(5,"input",5),n.sc("ngModelChange",(function(e){return t.search=e}))("typeaheadOnSelect",(function(e){return t.handleClick(e)}))("keydown.enter",(function(e){return e.preventDefault()})),n.jc(),n.jc(),n.gc(6,"div",6),n.jc(),n.jc(),n.jc(),n.kc(7,"div",0),n.kc(8,"div",1),n.kc(9,"label"),n.Uc(10,"Longitude"),n.jc(),n.jc(),n.kc(11,"div",2),n.kc(12,"div",7),n.kc(13,"input",8),n.sc("ngModelChange",(function(e){return t.coordinate.longitude=e}))("change",(function(){return t.refreshCoordinateFromInput()})),n.jc(),n.jc(),n.jc(),n.jc(),n.kc(14,"div",0),n.kc(15,"div",1),n.kc(16,"label"),n.Uc(17,"Latitude"),n.jc(),n.jc(),n.kc(18,"div",2),n.kc(19,"div",7),n.kc(20,"input",9),n.sc("ngModelChange",(function(e){return t.coordinate.latitude=e}))("change",(function(){return t.refreshCoordinateFromInput()})),n.jc(),n.jc(),n.jc(),n.jc(),n.Sc(21,w,6,4,"ng-template",null,10,n.Tc)),2&e){const e=n.Jc(22);n.Tb(5),n.Ac("ngModel",t.search)("typeaheadAsync",!0)("typeahead",t.dataSource)("typeaheadOptionsLimit",10)("typeaheadItemTemplate",e)("ngModelOptions",n.Dc(8,M)),n.Tb(8),n.Ac("ngModel",t.coordinate.longitude),n.Tb(7),n.Ac("ngModel",t.coordinate.latitude)}},directives:[a.a,a.h,a.k,r.a,a.m,a.o,i.l,i.k],encapsulation:2});var I=c(40),U=c(125),A=c(124),x=c(337),P=c(340),F=c(338),L=c(152),R=c(26),N=c(22);class D{constructor(e,t,c,n){this.http=e,this.noErrorHttpClient=t,this.eventService=c,this.authService=n}getChildren(e){let t=new v.g;return t=t.set("id",e),this.http.get(acp+"/project/get-children",{params:t}).toPromise()}getObjects(e,t,c,n){let i=new v.g;return i=i.set("id",e),null!=t&&(i=i.set("key",t)),null!=c&&(i=i.set("pageNumber",c.toString())),null!=n&&(i=i.set("pageSize",n.toString())),this.http.get(acp+"/project/objects",{params:i}).toPromise()}view(e){let t=new v.g;return t=t.set("id",e),this.http.get(acp+"/project/view",{params:t}).toPromise()}getItems(e,t){let c=new v.g;return c=c.set("id",e),null!=t&&(c=c.set("key",t)),this.http.get(acp+"/project/items",{params:c}).toPromise()}roots(e,t){let c=new v.g;return null!=e&&(c=c.set("id",e)),null!=t&&(c=c.set("bounds",JSON.stringify(t))),this.http.get(acp+"/project/roots",{params:c}).toPromise()}edit(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.http.post(acp+"/project/edit",JSON.stringify({id:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}setExclude(e,t){let c=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.http.post(acp+"/project/set-exclude",JSON.stringify({id:e,exclude:t}),{headers:c}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}runOrtho(e){let t=new v.f({"Content-Type":"application/json"});return this.http.post(acp+"/project/run-ortho",JSON.stringify({id:e}),{headers:t}).pipe(Object(A.a)(()=>{})).toPromise()}update(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.noErrorHttpClient.post(acp+"/project/update",JSON.stringify({entity:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}newChild(e,t){let c="/project/new-default-child",n=new v.f({"Content-Type":"application/json"}),i={};return null!=e&&(i.parentId=e),t&&(i.type=t,c="/project/new-child"),this.eventService.start(),this.http.post(acp+c,JSON.stringify(i),{headers:n}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}applyWithParent(e,t){let c=new v.f({"Content-Type":"application/json"}),n={entity:e};return null!=t&&(n.parentId=t),this.eventService.start(),this.noErrorHttpClient.post(acp+"/project/apply-with-parent",JSON.stringify(n),{headers:c}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}getCurrentUser(){return this.authService.getUserName()}remove(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.http.post(acp+"/project/remove",JSON.stringify({id:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}removeObject(e,t){let c=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.http.post(acp+"/project/removeObject",JSON.stringify({id:e,key:t}),{headers:c}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}removeTask(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.http.post(acp+"/project/remove-task",JSON.stringify({uploadId:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}upload(e,t,c){this.eventService.start();const n=new FormData;return n.append("file",c),n.append("id",e),n.append("folder",t),this.http.post(acp+"/project/upload",n).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}tasks(e,t,c,n){let i=new v.g;return i=i.set("statuses",JSON.stringify(e)),i=i.set("pageSize",t.toString()),i=i.set("pageNumber",c.toString()),i=i.set("token",n.toString()),this.http.get(acp+"/project/tasks",{params:i}).toPromise()}getTasks(e){let t=new v.g;return t=t.set("collectionId",e),this.http.get(acp+"/project/collection-tasks",{params:t}).toPromise()}task(e){let t=new v.g;return t=t.set("id",e),this.http.get(acp+"/project/task",{params:t}).toPromise()}getMissingMetadata(e,t){let c=new v.g;return c=c.set("pageSize",e.toString()),c=c.set("pageNumber",t.toString()),this.http.get(acp+"/project/missing-metadata",{params:c}).toPromise()}download(e,t,c){let n=new v.g;return n=n.set("id",e),n=n.set("key",t),c&&this.eventService.start(),this.noErrorHttpClient.get(acp+"/project/download",{params:n,responseType:"blob"}).pipe(Object(A.a)(()=>{c&&this.eventService.complete()}))}downloadAll(e,t,c){let n=new v.g;return n=n.set("id",e),n=n.set("key",t),c&&this.eventService.start(),this.noErrorHttpClient.get(acp+"/project/download-all",{params:n,responseType:"blob"}).pipe(Object(A.a)(()=>{c&&this.eventService.complete()}))}search(e){return e.pipe(Object(x.a)(400)).pipe(Object(P.a)()).pipe(Object(F.a)(e=>this.searchEntries(e)))}searchEntries(e){let t=new v.g;return t=t.set("term",e),this.http.get(acp+"/project/search",{params:t})}searchEntites(e){let t=new v.g;return t=t.set("term",e),this.http.get(acp+"/project/search",{params:t}).toPromise()}submitCollectionMetadata(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.noErrorHttpClient.post(acp+"/project/submit-metadata",JSON.stringify({json:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}pushToEros(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.http.post(acp+"/eros/push",JSON.stringify({collectionId:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}getMetadataOptions(e){let t=new v.g;return null!=e&&(t=t.set("id",e)),this.noErrorHttpClient.get(acp+"/project/metadata-options",{params:t}).toPromise()}evaluate(e,t){return null!=e&&"eq"===e.type?t[e.name]===e.value:null!=e&&"admin"===e.type&&this.authService.isAdmin()}}D.ɵfac=function(e){return new(e||D)(n.oc(v.c),n.oc(L.a),n.oc(R.a),n.oc(N.a))},D.ɵprov=n.bc({token:D,factory:D.ɵfac});var E=c(12),$=c(87);function V(e,t){if(1&e&&(n.kc(0,"div",7),n.kc(1,"div",8),n.kc(2,"strong"),n.Uc(3,"Error"),n.jc(),n.jc(),n.kc(4,"div",9),n.kc(5,"div"),n.kc(6,"p",10),n.Uc(7),n.jc(),n.jc(),n.jc(),n.jc()),2&e){const e=n.uc();n.Tb(7),n.Vc(e.message)}}function _(e,t){1&e&&(n.kc(0,"p",11),n.Uc(1,"Loading image..."),n.jc())}function z(e,t){if(1&e&&(n.gc(0,"img",12),n.vc(1,"safeHtml")),2&e){const e=n.uc();n.Ac("src",n.wc(1,1,e.imageToShow),n.Nc)}}class G{constructor(e,t){this.service=e,this.bsModalRef=t,this.message=null,this.open=!0,this.loading=!0}init(e,t){this.component=e,this.key=t,this.getImage(this.component,this.key)}createImageFromBlob(e){let t=new FileReader;t.addEventListener("load",()=>{this.imageToShow=t.result},!1),e&&t.readAsDataURL(e)}getImage(e,t){this.loading=!0,this.service.download(e,t,!1).subscribe(e=>{this.createImageFromBlob(e),this.loading=!1},e=>{this.loading=!1,this.error(e)})}close(){this.open=!1}error(e){this.message=U.b.getMessageFromError(e)}}G.ɵfac=function(e){return new(e||G)(n.fc(D),n.fc(E.a))},G.ɵcmp=n.Zb({type:G,selectors:[["image-preview-modal"]],decls:7,vars:3,consts:[[1,"modal-body"],["class","error-container",4,"ngIf"],[1,"image-preview-container"],[1,"fa","fa-times","btn","btn-close",2,"min-width","0",3,"click"],[1,"image-container"],["style","text-align: left;",4,"ngIf"],["class","image-preview img-responsive center-block","alt","Image",3,"src",4,"ngIf"],[1,"error-container"],[1,"label-holder"],[1,"holder"],[1,"error-message"],[2,"text-align","left"],["alt","Image",1,"image-preview","img-responsive","center-block",3,"src"]],template:function(e,t){1&e&&(n.kc(0,"div",0),n.Sc(1,V,8,1,"div",1),n.kc(2,"div",2),n.kc(3,"i",3),n.sc("click",(function(){return t.bsModalRef.hide()})),n.jc(),n.kc(4,"div",4),n.Sc(5,_,2,0,"p",5),n.Sc(6,z,2,3,"img",6),n.jc(),n.jc(),n.jc()),2&e&&(n.Tb(1),n.Ac("ngIf",null!=t.message),n.Tb(4),n.Ac("ngIf",t.loading),n.Tb(1),n.Ac("ngIf",!t.loading))},directives:[i.l],pipes:[$.a],encapsulation:2});var W=c(25);class B{}const q=["Natural Color RGB","Thermal","Red Edge","Near Infra Red","LiDAR","Other"];class H{constructor(e){this.el=e}onKeyDown(e){let t=e;if(this.OnlyNumber){if(-1!==[46,8,9,27,13,110,190].indexOf(t.keyCode)||65==t.keyCode&&!0===t.ctrlKey||67==t.keyCode&&!0===t.ctrlKey||88==t.keyCode&&!0===t.ctrlKey||t.keyCode>=35&&t.keyCode<=39)return;(t.shiftKey||t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105)&&t.preventDefault()}}}H.ɵfac=function(e){return new(e||H)(n.fc(n.r))},H.ɵdir=n.ac({type:H,selectors:[["","OnlyNumber",""]],hostBindings:function(e,t){1&e&&n.sc("keydown",(function(e){return t.onKeyDown(e)}))},inputs:{OnlyNumber:"OnlyNumber"}});var J=c(69);function Z(e,t){if(1&e&&(n.kc(0,"div",48),n.kc(1,"div",49),n.kc(2,"strong"),n.Uc(3,"Error"),n.jc(),n.jc(),n.kc(4,"div",50),n.kc(5,"div"),n.kc(6,"p",51),n.Uc(7),n.jc(),n.jc(),n.jc(),n.jc()),2&e){const e=n.uc();n.Tb(7),n.Vc(e.message)}}function Y(e,t){if(1&e&&(n.kc(0,"option",52),n.Uc(1),n.jc()),2&e){const e=t.$implicit;n.Ac("value",e.oid),n.Tb(1),n.Vc(e.displayLabel)}}function K(e,t){if(1&e){const e=n.lc();n.kc(0,"div",10),n.kc(1,"label",19),n.Uc(2,"Other name"),n.jc(),n.kc(3,"input",53),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc().metaObject.platform.otherName=t})),n.jc(),n.jc()}if(2&e){const e=n.uc();n.Tb(3),n.Ac("ngModel",e.metaObject.platform.otherName)}}function Q(e,t){if(1&e){const e=n.lc();n.kc(0,"div",10),n.kc(1,"label",54),n.Uc(2,"Type"),n.jc(),n.kc(3,"select",55),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc().metaObject.platform.type=t})),n.gc(4,"option"),n.kc(5,"option"),n.Uc(6,"Fixed Wing"),n.jc(),n.kc(7,"option"),n.Uc(8,"Hybrid"),n.jc(),n.kc(9,"option"),n.Uc(10,"Multi-rotor"),n.jc(),n.kc(11,"option"),n.Uc(12,"Helicopter"),n.jc(),n.kc(13,"option"),n.Uc(14,"VTOL Fixed-wing"),n.jc(),n.kc(15,"option"),n.Uc(16,"Quadcopter"),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc();n.Tb(3),n.Ac("ngModel",e.metaObject.platform.type)("disabled",e.metaObject.platform.name!==e.otherPlatformId)}}function X(e,t){if(1&e&&(n.kc(0,"option",52),n.Uc(1),n.jc()),2&e){const e=t.$implicit;n.Ac("value",e.oid),n.Tb(1),n.Vc(e.displayLabel)}}function ee(e,t){if(1&e){const e=n.lc();n.kc(0,"div",10),n.kc(1,"label",56),n.Uc(2,"Other name"),n.jc(),n.kc(3,"input",57),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc().metaObject.sensor.otherName=t})),n.jc(),n.jc()}if(2&e){const e=n.uc();n.Tb(3),n.Ac("ngModel",e.metaObject.sensor.otherName)}}function te(e,t){if(1&e){const e=n.lc();n.kc(0,"div"),n.kc(1,"boolean-field",58),n.sc("valueChange",(function(c){n.Lc(e);const i=t.$implicit;return n.uc().updateSelectedWaveLength(i,c)})),n.jc(),n.jc()}if(2&e){const e=t.$implicit,c=n.uc();n.Tb(1),n.Ac("value",c.metaObject.sensor.wavelength&&-1!==c.metaObject.sensor.wavelength.indexOf(e))("label",e)("disabled",c.metaObject.sensor.name!==c.otherSensorId)}}class ce{constructor(e,t){this.bsModalRef=e,this.service=t,this.message=null,this.disabled=!1,this.metaObject={collectionId:"",pointOfContact:{name:"",email:""},platform:{name:"",otherName:"",class:"",type:"",serialNumber:"",faaIdNumber:""},sensor:{name:"",otherName:"",type:"",model:"",wavelength:[],sensorWidth:"",sensorWidthUnits:"mm",sensorHeight:"",sensorHeightUnits:"mm",pixelSizeWidth:"",pixelSizeHeight:""},upload:{dataType:"raw"}},this.sensors=[],this.platforms=[],this.wavelengths=q,this.otherSensorId="",this.otherPlatformId=""}init(e){this.collectionId=e,this.onMetadataChange=new W.b,this.service.getMetadataOptions(this.collectionId).then(e=>{this.sensors=e.sensors,this.platforms=e.platforms,this.metaObject.pointOfContact.name=e.name,this.metaObject.pointOfContact.email=e.email,this.metaObject.sensor.name=e.sensor,this.metaObject.platform.name=e.platform,this.sensors.forEach(e=>{"OTHER"===e.name&&(this.otherSensorId=e.oid)}),this.platforms.forEach(e=>{"OTHER"===e.name&&(this.otherPlatformId=e.oid)}),this.handleSensorSelect(),this.handlePlatformSelect()}).catch(e=>{this.error(e)})}handleSensorSelect(){if(null!=this.metaObject.sensor.name&&""!==this.metaObject.sensor.name&&this.metaObject.sensor.name!==this.otherSensorId){const e=this.getSelectedSensor();this.metaObject.sensor.type=e.sensorType,this.metaObject.sensor.model=e.model,this.metaObject.sensor.wavelength=[...e.waveLength],console.log(this.metaObject.sensor)}}handlePlatformSelect(){if(null!=this.metaObject.platform.name&&""!==this.metaObject.platform.name&&this.metaObject.platform.name!==this.otherPlatformId){const e=this.getSelectedPlatform();this.metaObject.platform.type=e.platformType}}getSelectedSensor(){var e=this.sensors.findIndex(e=>e.oid===this.metaObject.sensor.name);return this.sensors[e]}getSelectedPlatform(){var e=this.platforms.findIndex(e=>e.oid===this.metaObject.platform.name);return this.platforms[e]}updateSelectedWaveLength(e,t){const c=this.metaObject.sensor.wavelength.indexOf(e);t?c<0&&this.metaObject.sensor.wavelength.push(e):c>-1&&this.metaObject.sensor.wavelength.splice(c,1)}handleSubmit(){this.metaObject.collectionId=this.collectionId,this.service.submitCollectionMetadata(this.metaObject).then(()=>{this.bsModalRef.hide(),this.onMetadataChange.next(this.collectionId)}).catch(e=>{this.error(e)})}error(e){this.message=U.b.getMessageFromError(e)}}ce.ɵfac=function(e){return new(e||ce)(n.fc(E.a),n.fc(D))},ce.ɵcmp=n.Zb({type:ce,selectors:[["metadata-modal"]],decls:102,vars:51,consts:[[1,"modal-header","text-center"],[1,"row"],[1,"col-md-12"],[1,"modal-form"],["ngForm","ngForm"],[1,"modal-body"],["class","error-container",4,"ngIf"],[1,"panel","panel-default"],[1,"panel-heading"],[1,"panel-body"],[1,"form-group"],["for","pointOfContact.name"],["type","text","name","pointOfContact.name",3,"ngModel","maxlength","required","disabled","ngModelChange"],["for","pointOfContact.email"],["type","text","name","pointOfContact.email",3,"ngModel","maxlength","required","disabled","ngModelChange"],["for","platform.name"],["name","platform.name","type","input","required","",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],["class","form-group",4,"ngIf"],["for","platform.class"],["type","text","name","platform.class","required","",3,"ngModel","maxlength","disabled","ngModelChange"],["for","platform.serialNumber"],["type","text","name","platform.serialNumber",3,"ngModel","maxlength","required","disabled","ngModelChange"],["for","platform.faaIdNumber"],["type","text","name","platform.faaIdNumber",3,"ngModel","maxlength","required","disabled","ngModelChange"],["for","sensor.name"],["name","sensor.name","type","input","required","",3,"ngModel","ngModelChange","change"],["for","sensor.type"],["type","text","name","sensor.type",3,"ngModel","maxlength","required","disabled","ngModelChange"],["for","sensor.model"],["type","text","name","sensor.model",3,"ngModel","maxlength","required","disabled","ngModelChange"],["for","sensor.wavelength"],[4,"ngFor","ngForOf"],["for","sensor.sensorWidth"],["type","number","name","sensor.sensorWidth","OnlyNumber","true",3,"ngModel","required","disabled","ngModelChange"],["name","sensor.sensorWidthUnits","type","input","required","","disabled","",3,"ngModel","ngModelChange"],["value","mm","selected",""],["for","sensor.sensorHeight"],["type","number","name","sensor.sensorHeight","OnlyNumber","true",3,"ngModel","required","disabled","ngModelChange"],["name","sensor.sensorHeightUnits","type","input","required","","disabled","",3,"ngModel","ngModelChange"],["for","sensor.pixelSizeWidth"],["type","number","name","sensor.pixelSizeWidth","OnlyNumber","true",3,"ngModel","required","disabled","ngModelChange"],["for","sensor.pixelSizeHeight"],["type","number","name","sensor.pixelSizeHeight","OnlyNumber","true",3,"ngModel","required","disabled","ngModelChange"],[1,"button-holder"],["type","button",1,"btn","btn-default",3,"click"],["type","button",1,"btn","btn-primary",3,"disabled","click"],[1,"icon-upload","icon-white"],[1,"error-container"],[1,"label-holder"],[1,"holder"],[1,"error-message"],[3,"value"],["type","text","name","platform.otherName","maxlength","20","required","",3,"ngModel","ngModelChange"],["for","platform.type"],["name","platform.type","type","input","required","",1,"",3,"ngModel","disabled","ngModelChange"],["for","sensor.class"],["type","text","name","sensor.otherName","maxlength","20","required","",3,"ngModel","ngModelChange"],[3,"value","label","disabled","valueChange"]],template:function(e,t){if(1&e&&(n.kc(0,"div",0),n.kc(1,"h2"),n.Uc(2,"Collection Metadata"),n.jc(),n.jc(),n.kc(3,"div",1),n.kc(4,"div",2),n.kc(5,"form",3,4),n.kc(7,"div",5),n.Sc(8,Z,8,1,"div",6),n.kc(9,"div",7),n.kc(10,"div",8),n.Uc(11,"Point Of Contact"),n.jc(),n.kc(12,"div",9),n.kc(13,"div",10),n.kc(14,"label",11),n.Uc(15,"Name"),n.jc(),n.kc(16,"input",12),n.sc("ngModelChange",(function(e){return t.metaObject.pointOfContact.name=e})),n.jc(),n.jc(),n.kc(17,"div",10),n.kc(18,"label",13),n.Uc(19,"Email"),n.jc(),n.kc(20,"input",14),n.sc("ngModelChange",(function(e){return t.metaObject.pointOfContact.email=e})),n.jc(),n.jc(),n.jc(),n.jc(),n.kc(21,"div",7),n.kc(22,"div",8),n.Uc(23,"Platform"),n.jc(),n.kc(24,"div",9),n.kc(25,"div",10),n.kc(26,"label",15),n.Uc(27,"Name"),n.jc(),n.kc(28,"select",16),n.sc("ngModelChange",(function(e){return t.metaObject.platform.name=e}))("change",(function(){return t.handlePlatformSelect()})),n.gc(29,"option"),n.Sc(30,Y,2,2,"option",17),n.jc(),n.jc(),n.Sc(31,K,4,1,"div",18),n.kc(32,"div",10),n.kc(33,"label",19),n.Uc(34,"Class"),n.jc(),n.kc(35,"input",20),n.sc("ngModelChange",(function(e){return t.metaObject.platform.class=e})),n.jc(),n.jc(),n.Sc(36,Q,17,2,"div",18),n.kc(37,"div",10),n.kc(38,"label",21),n.Uc(39,"Serial Number"),n.jc(),n.kc(40,"input",22),n.sc("ngModelChange",(function(e){return t.metaObject.platform.serialNumber=e})),n.jc(),n.jc(),n.kc(41,"div",10),n.kc(42,"label",23),n.Uc(43,"FAA Id Number"),n.jc(),n.kc(44,"input",24),n.sc("ngModelChange",(function(e){return t.metaObject.platform.faaIdNumber=e})),n.jc(),n.jc(),n.jc(),n.jc(),n.kc(45,"div",7),n.kc(46,"div",8),n.Uc(47,"Sensor"),n.jc(),n.kc(48,"div",9),n.kc(49,"div",10),n.kc(50,"label",25),n.Uc(51,"Name"),n.jc(),n.kc(52,"select",26),n.sc("ngModelChange",(function(e){return t.metaObject.sensor.name=e}))("change",(function(){return t.handleSensorSelect()})),n.gc(53,"option"),n.Sc(54,X,2,2,"option",17),n.jc(),n.jc(),n.Sc(55,ee,4,1,"div",18),n.kc(56,"div",10),n.kc(57,"label",27),n.Uc(58,"Type"),n.jc(),n.kc(59,"input",28),n.sc("ngModelChange",(function(e){return t.metaObject.sensor.type=e})),n.jc(),n.jc(),n.kc(60,"div",10),n.kc(61,"label",29),n.Uc(62,"Model"),n.jc(),n.kc(63,"input",30),n.sc("ngModelChange",(function(e){return t.metaObject.sensor.model=e})),n.jc(),n.jc(),n.kc(64,"div",10),n.kc(65,"label",31),n.Uc(66,"Wave Length"),n.jc(),n.Sc(67,te,2,3,"div",32),n.jc(),n.kc(68,"div",10),n.kc(69,"label",33),n.Uc(70,"Sensor Width"),n.jc(),n.kc(71,"input",34),n.sc("ngModelChange",(function(e){return t.metaObject.sensor.sensorWidth=e})),n.jc(),n.jc(),n.kc(72,"div",10),n.kc(73,"label",33),n.Uc(74,"Sensor Width Units"),n.jc(),n.kc(75,"select",35),n.sc("ngModelChange",(function(e){return t.metaObject.sensor.sensorWidthUnits=e})),n.kc(76,"option",36),n.Uc(77,"Millimeters"),n.jc(),n.jc(),n.jc(),n.kc(78,"div",10),n.kc(79,"label",37),n.Uc(80,"Sensor Height"),n.jc(),n.kc(81,"input",38),n.sc("ngModelChange",(function(e){return t.metaObject.sensor.sensorHeight=e})),n.jc(),n.jc(),n.kc(82,"div",10),n.kc(83,"label",33),n.Uc(84,"Sensor Height Units"),n.jc(),n.kc(85,"select",39),n.sc("ngModelChange",(function(e){return t.metaObject.sensor.sensorHeightUnits=e})),n.kc(86,"option",36),n.Uc(87,"Millimeters"),n.jc(),n.jc(),n.jc(),n.kc(88,"div",10),n.kc(89,"label",40),n.Uc(90,"Pixel Size Width"),n.jc(),n.kc(91,"input",41),n.sc("ngModelChange",(function(e){return t.metaObject.sensor.pixelSizeWidth=e})),n.jc(),n.jc(),n.kc(92,"div",10),n.kc(93,"label",42),n.Uc(94,"Pixel Size Height"),n.jc(),n.kc(95,"input",43),n.sc("ngModelChange",(function(e){return t.metaObject.sensor.pixelSizeHeight=e})),n.jc(),n.jc(),n.jc(),n.jc(),n.kc(96,"div",44),n.kc(97,"button",45),n.sc("click",(function(){return t.bsModalRef.hide()})),n.Uc(98,"Cancel"),n.jc(),n.kc(99,"button",46),n.sc("click",(function(){return t.handleSubmit()})),n.gc(100,"i",47),n.Uc(101," Submit "),n.jc(),n.jc(),n.jc(),n.jc(),n.jc(),n.jc()),2&e){const e=n.Jc(6);n.Tb(8),n.Ac("ngIf",null!=t.message),n.Tb(8),n.Ac("ngModel",t.metaObject.pointOfContact.name)("maxlength",100)("required",!1)("disabled",!1),n.Tb(4),n.Ac("ngModel",t.metaObject.pointOfContact.email)("maxlength",255)("required",!1)("disabled",!1),n.Tb(8),n.Ac("ngModel",t.metaObject.platform.name),n.Tb(2),n.Ac("ngForOf",t.platforms),n.Tb(1),n.Ac("ngIf",t.metaObject.platform.name===t.otherPlatformId),n.Tb(4),n.Ac("ngModel",t.metaObject.platform.class)("maxlength",20)("disabled",!1),n.Tb(1),n.Ac("ngIf",null!=t.metaObject.platform.name&&t.metaObject.platform.name.length>0),n.Tb(4),n.Ac("ngModel",t.metaObject.platform.serialNumber)("maxlength",50)("required",!0)("disabled",!1),n.Tb(4),n.Ac("ngModel",t.metaObject.platform.faaIdNumber)("maxlength",30)("required",!0)("disabled",!1),n.Tb(8),n.Ac("ngModel",t.metaObject.sensor.name),n.Tb(2),n.Ac("ngForOf",t.sensors),n.Tb(1),n.Ac("ngIf",t.metaObject.sensor.name===t.otherSensorId),n.Tb(4),n.Ac("ngModel",t.metaObject.sensor.type)("maxlength",20)("required",!0)("disabled",t.metaObject.sensor.name!==t.otherSensorId),n.Tb(4),n.Ac("ngModel",t.metaObject.sensor.model)("maxlength",20)("required",!0)("disabled",t.metaObject.sensor.name!==t.otherSensorId),n.Tb(4),n.Ac("ngForOf",t.wavelengths),n.Tb(4),n.Ac("ngModel",t.metaObject.sensor.sensorWidth)("required",!0)("disabled",!1),n.Tb(4),n.Ac("ngModel",t.metaObject.sensor.sensorWidthUnits),n.Tb(6),n.Ac("ngModel",t.metaObject.sensor.sensorHeight)("required",!0)("disabled",!1),n.Tb(4),n.Ac("ngModel",t.metaObject.sensor.sensorHeightUnits),n.Tb(6),n.Ac("ngModel",t.metaObject.sensor.pixelSizeWidth)("required",!0)("disabled",!1),n.Tb(4),n.Ac("ngModel",t.metaObject.sensor.pixelSizeHeight)("required",!0)("disabled",!1),n.Tb(4),n.Ac("disabled",!e.valid)}},directives:[a.r,a.i,a.j,i.l,a.a,a.h,a.k,a.d,a.o,a.p,a.l,a.q,i.k,a.m,H,J.a],encapsulation:2});var ne=c(86);class ie{constructor(e,t,c,n,i,s,a){this.root=e,this.leaf=t,this.drillable=c,this.expandable=n,this.uploadable=i,this.processable=s,this.childLabel=a}}class se{constructor(){this.cache={},this.cache.Site=new ie(!0,!1,!0,!1,!1,!1,"Projects"),this.cache.Project=new ie(!1,!1,!0,!1,!1,!1,"Missions"),this.cache.Mission=new ie(!1,!1,!1,!0,!1,!1,"Collections"),this.cache.Collection=new ie(!1,!0,!1,!1,!1,!0,"Images"),this.cache.folder=new ie(!1,!0,!1,!1,!0,!1,""),this.cache.raw=new ie(!1,!1,!1,!1,!0,!1,""),this.cache.accessible=new ie(!1,!1,!1,!1,!0,!1,"")}getMetadata(e){return this.cache[e.type]}getTypeContainsFolders(e){return"Collection"===e.type}isUploadable(e){return null!=this.cache[e]&&this.cache[e].uploadable}hasExtraField(e,t){return"Collection"===e&&("platform"===t||"sensor"===t)}isProcessable(e){return null!=this.cache[e]&&this.cache[e].processable}getUploadTarget(e){return"Imagery"===e?"imagery":"raw"}getHierarchy(){return["Site","Project","Mission","Collection"]}}function ae(e,t){if(1&e&&(n.kc(0,"div",3),n.kc(1,"div",4),n.kc(2,"strong"),n.Uc(3,"Error"),n.jc(),n.jc(),n.kc(4,"div",5),n.kc(5,"div"),n.kc(6,"p",6),n.Uc(7),n.jc(),n.jc(),n.jc(),n.jc()),2&e){const e=n.uc();n.Tb(7),n.Vc(e.message)}}function oe(e,t){1&e&&n.gc(0,"span",26)}function le(e,t){if(1&e&&(n.kc(0,"li"),n.kc(1,"span"),n.Uc(2),n.jc(),n.jc()),2&e){const e=t.$implicit;n.Tb(2),n.Wc(" ",e.name,"")}}function re(e,t){if(1&e&&(n.kc(0,"li",35),n.kc(1,"a",36),n.gc(2,"img",37),n.kc(3,"div",38),n.kc(4,"h4",39),n.Uc(5),n.jc(),n.jc(),n.jc(),n.jc()),2&e){const e=t.$implicit,c=n.uc(4);n.Tb(2),n.Ac("src",c.context+"/net/geoprism/images/thumbnail-default.png",n.Nc),n.Tb(3),n.Vc(e.name)}}function de(e,t){if(1&e&&(n.kc(0,"div",32),n.kc(1,"ul",33),n.Sc(2,re,6,2,"li",34),n.jc(),n.jc()),2&e){const e=n.uc(3);n.Tb(2),n.Ac("ngForOf",e.page.results)}}function ue(e,t){if(1&e&&(n.kc(0,"li",35),n.kc(1,"a",36),n.gc(2,"img",37),n.vc(3,"safeHtml"),n.kc(4,"div",38),n.kc(5,"h4",39),n.Uc(6),n.jc(),n.jc(),n.jc(),n.jc()),2&e){const e=t.$implicit,c=n.uc(4);n.Tb(2),n.Ac("src",null!=c.thumbnails[e.key]?n.wc(3,2,c.thumbnails[e.key]):c.context+"/net/geoprism/images/thumbnail-default.png",n.Nc),n.Tb(4),n.Vc(e.name)}}function pe(e,t){if(1&e&&(n.kc(0,"div",32),n.kc(1,"ul",33),n.Sc(2,ue,7,4,"li",34),n.jc(),n.jc()),2&e){const e=n.uc(3);n.Tb(2),n.Ac("ngForOf",e.page.results)}}function he(e,t){if(1&e){const e=n.lc();n.kc(0,"input",43),n.sc("change",(function(t){n.Lc(e);const c=n.uc().$implicit;return n.uc(4).toggleExcludeImage(t,c)})),n.jc()}if(2&e){const e=n.uc().$implicit;n.Ac("checked",e.exclude)}}se.ɵfac=function(e){return new(e||se)},se.ɵprov=n.bc({token:se,factory:se.ɵfac});const ge=function(e,t){return{"card-disabled":e,"non-clickable":t}},fe=function(e){return{"img-disabled":e}};function me(e,t){if(1&e){const e=n.lc();n.kc(0,"li",35),n.kc(1,"a",40),n.Sc(2,he,1,1,"input",41),n.kc(3,"img",42),n.sc("click",(function(c){n.Lc(e);const i=t.$implicit,s=n.uc(4);return!!s.enableSelectableImages&&s.toggleExcludeImage(c,i)})),n.vc(4,"safeHtml"),n.jc(),n.kc(5,"div",38),n.kc(6,"h4",39),n.Uc(7),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=t.$implicit,c=n.uc(4);n.Tb(1),n.Ac("ngClass",n.Fc(7,ge,e.exclude,!c.enableSelectableImages)),n.Tb(1),n.Ac("ngIf",c.enableSelectableImages),n.Tb(1),n.Ac("ngClass",n.Ec(10,fe,e.exclude))("src",null!=c.thumbnails[e.key]?n.wc(4,5,c.thumbnails[e.key]):c.context+"/net/geoprism/images/thumbnail-default.png",n.Nc),n.Tb(4),n.Wc(" ",e.name," ")}}const be=function(e,t,c){return{itemsPerPage:e,currentPage:t,totalItems:c}};function ke(e,t){if(1&e&&(n.kc(0,"div",32),n.kc(1,"ul",33),n.Sc(2,me,8,12,"li",34),n.vc(3,"paginate"),n.jc(),n.jc()),2&e){const e=n.uc(3);n.Tb(2),n.Ac("ngForOf",n.xc(3,1,e.page.results,n.Gc(4,be,e.page.pageSize,e.page.pageNumber,e.page.count)))}}function ve(e,t){if(1&e){const e=n.lc();n.kc(0,"div"),n.kc(1,"div",7),n.gc(2,"div",44),n.kc(3,"div",45),n.kc(4,"h3"),n.Uc(5),n.kc(6,"a",46),n.sc("click",(function(){n.Lc(e);const t=n.uc(4);return t.handleDownloadVideo(t.video.src)})),n.gc(7,"i",47),n.jc(),n.kc(8,"a",48),n.sc("click",(function(){return n.Lc(e),n.uc(4).closeVideo()})),n.gc(9,"i",49),n.jc(),n.jc(),n.jc(),n.gc(10,"div",44),n.jc(),n.kc(11,"div",7),n.gc(12,"div",44),n.kc(13,"div",45),n.kc(14,"video",50),n.gc(15,"source",51),n.Uc(16," Browser not supported "),n.jc(),n.jc(),n.gc(17,"div",44),n.jc(),n.jc()}if(2&e){const e=n.uc(4);n.Tb(5),n.Wc(" ",e.video.name," "),n.Tb(10),n.Ac("src",e.video.src,n.Nc)}}function je(e,t){if(1&e){const e=n.lc();n.kc(0,"li",35),n.kc(1,"a",52),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc(4).showVideo(c)})),n.gc(2,"img",53),n.kc(3,"div",38),n.kc(4,"h4",39),n.Uc(5),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=t.$implicit,c=n.uc(4);n.Tb(2),n.Ac("src",c.context+"/net/geoprism/images/thumbnail-video.png",n.Nc),n.Tb(3),n.Vc(e.name)}}function ye(e,t){if(1&e&&(n.kc(0,"div"),n.Sc(1,ve,18,2,"div",2),n.kc(2,"div",32),n.kc(3,"ul",33),n.Sc(4,je,6,2,"li",34),n.jc(),n.jc(),n.jc()),2&e){const e=n.uc(3);n.Tb(1),n.Ac("ngIf",null!==e.video.src),n.Tb(3),n.Ac("ngForOf",e.page.results)}}function Te(e,t){if(1&e){const e=n.lc();n.kc(0,"tab",27),n.sc("selectTab",(function(){n.Lc(e);const c=t.$implicit;return n.uc(2).onSelect(c)})),n.kc(1,"div",28),n.Sc(2,de,3,1,"div",29),n.Sc(3,pe,3,1,"div",30),n.Sc(4,ke,4,8,"div",30),n.Sc(5,ye,5,2,"div",31),n.jc(),n.jc()}if(2&e){const e=t.$implicit;n.Ac("heading",e.name),n.Tb(1),n.Ac("ngSwitch",e.name),n.Tb(2),n.Ac("ngSwitchCase","ortho"),n.Tb(1),n.Ac("ngSwitchCase","raw"),n.Tb(1),n.Ac("ngSwitchCase","video")}}function Se(e,t){if(1&e){const e=n.lc();n.kc(0,"pagination-controls",54),n.sc("pageChange",(function(t){return n.Lc(e),n.uc(2).onPageChange(t)})),n.jc()}}function Ce(e,t){if(1&e&&(n.kc(0,"div",55),n.kc(1,"p"),n.Uc(2),n.jc(),n.kc(3,"p"),n.Uc(4,"See this process on "),n.kc(5,"a",56),n.Uc(6,"your tasks page"),n.jc(),n.jc(),n.jc()),2&e){const e=n.uc(2);n.Tb(2),n.Vc(e.statusMessage)}}function we(e,t){if(1&e){const e=n.lc();n.kc(0,"button",57),n.sc("click",(function(){return n.Lc(e),n.uc(2).handleSetMetadata()})),n.gc(1,"i",58),n.Uc(2," Add Metadata "),n.jc()}if(2&e){const e=n.uc(2);n.Ac("disabled",e.processRunning)}}function Me(e,t){if(1&e){const e=n.lc();n.kc(0,"button",59),n.sc("click",(function(){return n.Lc(e),n.uc(2).handleDownload()})),n.Uc(1),n.jc()}if(2&e){const e=n.uc(2);n.Cc("title","Downloads all files in the ",e.folder.name," folder."),n.Ac("disabled",e.processRunning),n.Tb(1),n.Wc(" Download All ",e.capitalize(e.folder.name)," ")}}function Oe(e,t){if(1&e){const e=n.lc();n.kc(0,"button",60),n.sc("click",(function(){return n.Lc(e),n.uc(2).handleDownloadOdmAll()})),n.Uc(1," Download All Generated Data "),n.jc()}if(2&e){const e=n.uc(2);n.Ac("disabled",e.processRunning)}}const Ie=function(e){return{"fa-spin":e}};function Ue(e,t){if(1&e){const e=n.lc();n.kc(0,"button",61),n.sc("click",(function(){return n.Lc(e),n.uc(2).handleRunOrtho()})),n.Uc(1," Reprocess Imagery "),n.gc(2,"i",62),n.jc()}if(2&e){const e=n.uc(2);n.Ac("disabled",e.processRunning),n.Tb(2),n.Ac("ngClass",n.Ec(2,Ie,e.processRunning))}}function Ae(e,t){if(1&e){const e=n.lc();n.kc(0,"div"),n.kc(1,"div",7),n.kc(2,"div",8),n.kc(3,"h2"),n.Uc(4),n.Sc(5,oe,1,0,"span",9),n.jc(),n.jc(),n.jc(),n.kc(6,"div",7),n.kc(7,"div",8),n.kc(8,"ul",10),n.Sc(9,le,3,1,"li",11),n.jc(),n.jc(),n.jc(),n.kc(10,"div",7),n.kc(11,"div",12),n.kc(12,"tabset",13),n.Sc(13,Te,6,5,"tab",14),n.jc(),n.jc(),n.jc(),n.kc(14,"div",7),n.kc(15,"div",15),n.Sc(16,Se,1,0,"pagination-controls",16),n.Sc(17,Ce,7,1,"div",17),n.kc(18,"div",18),n.kc(19,"div",7),n.kc(20,"div",19),n.Sc(21,we,3,1,"button",20),n.jc(),n.kc(22,"div",21),n.kc(23,"button",22),n.sc("click",(function(){return n.Lc(e),n.uc().bsModalRef.hide()})),n.Uc(24,"Close"),n.jc(),n.Sc(25,Me,2,3,"button",23),n.Sc(26,Oe,2,1,"button",24),n.Sc(27,Ue,3,4,"button",25),n.jc(),n.jc(),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc();n.Tb(4),n.Wc("",e.entity.name," "),n.Tb(1),n.Ac("ngIf",!e.entity.metadataUploaded),n.Tb(4),n.Ac("ngForOf",e.previous),n.Tb(4),n.Ac("ngForOf",e.folders),n.Tb(3),n.Ac("ngIf","raw"===e.folder.name),n.Tb(1),n.Ac("ngIf",e.showOrthoRerunMessage),n.Tb(4),n.Ac("ngIf",!e.entity.metadataUploaded),n.Tb(4),n.Ac("ngIf",e.processable),n.Tb(1),n.Ac("ngIf",e.processable),n.Tb(1),n.Ac("ngIf",e.processable&&e.enableSelectableImages)}}class xe{constructor(e,t,c,n){this.service=e,this.metadataService=t,this.modalService=c,this.bsModalRef=n,this.previous=[],this.folders=[],this.thumbnails={},this.processRunning=!1,this.processable=!1,this.enableSelectableImages=!1,this.showOrthoRerunMessage=!1,this.constPageSize=50,this.page=new B,this.video={src:null,name:null},this.context=acp}set initData(e){this.init(e.entity,e.folders,e.previous)}ngOnInit(){this.onNodeChange=new W.b,this.page.count=0,this.page.pageNumber=1,this.page.pageSize=this.constPageSize,this.page.results=[]}init(e,t,c){this.entity=e,this.folders=t,this.previous=[...c],this.previous.length>0&&this.previous[this.previous.length-1].id!==this.entity.id&&this.previous.push(this.entity),this.folders.length>0&&this.onSelect(this.folders[0]),this.processable=this.metadataService.isProcessable(e.type)}createImageFromBlob(e,t){let c=new FileReader;c.addEventListener("load",()=>{this.thumbnails[t.key]=c.result},!1),e&&c.readAsDataURL(e)}getThumbnail(e){if(null!=e){let t=e.key.substr(0,e.key.lastIndexOf("/")),c=/[^/]*$/.exec(e.key)[0];const n=c.lastIndexOf("."),i=t+"/thumbnails/"+c.substr(0,n)+".png";this.service.download(e.component,i,!1).subscribe(t=>{this.createImageFromBlob(t,e)},e=>{console.log(e)})}}onPageChange(e){this.getData(this.folder.component,this.folder.name,e,this.page.pageSize)}onSelect(e){this.page.results=[],"raw"===e.name?this.enableSelectableImages=!0:this.enableSelectableImages=!1;let t=null,c=null;"raw"===e.name&&(t=null==this.page.pageNumber?1:this.page.pageNumber,c=this.constPageSize),this.folder=e,this.video.src=null,this.video.name=null,this.getData(e.component,e.name,t,c)}getData(e,t,c,n){this.service.getObjects(e,t,c,n).then(e=>{this.page=e;for(let e=0;e<this.page.results.length;++e){let t=this.page.results[e];this.isImage(t)&&this.getThumbnail(t)}})}isImage(e){return-1!==e.name.toLowerCase().indexOf(".png")||-1!==e.name.toLowerCase().indexOf(".jpg")||-1!==e.name.toLowerCase().indexOf(".jpeg")||-1!==e.name.toLowerCase().indexOf(".tif")||-1!==e.name.toLowerCase().indexOf(".tiff")}previewImage(e,t){}toggleExcludeImage(e,t){this.service.setExclude(t.id,!t.exclude).then(e=>{t.exclude=e.exclude})}isProcessable(e){return this.metadataService.isProcessable(e.type)}handleErosPush(){this.processRunning=!0,this.service.pushToEros(this.entity.id).then(e=>{this.processRunning=!1,setTimeout(()=>{this.showOrthoRerunMessage=!1,this.statusMessage="Your process is started."},3e4)}).catch(e=>{this.error(e)})}handleRunOrtho(){event.stopPropagation(),this.confirmModalRef=this.modalService.show(U.a,{animated:!0,backdrop:!0,ignoreBackdropClick:!0,class:"confirmation-modal"}),this.confirmModalRef.content.message="Running this process will replace all output products for this "+this.entity.type+". Are you sure you want to re-process this data?",this.confirmModalRef.content.type="DANGER",this.confirmModalRef.content.submitText="Run Process",this.confirmModalRef.content.onConfirm.subscribe(e=>{this.processRunning=!0,this.showOrthoRerunMessage=!0,this.service.runOrtho(this.entity.id).then(e=>{this.processRunning=!1,setTimeout(()=>{this.showOrthoRerunMessage=!1,this.statusMessage="Your process is started."},3e4)}).catch(e=>{this.error(e)})})}handleDownload(){window.location.href=acp+"/project/download-all?id="+this.folder.component+"&key="+this.folder.name}handleDownloadOdmAll(){window.location.href=acp+"/project/download-odm-all?colId="+this.entity.id}handleDownloadVideo(e){window.location.href=e}handleDownloadFile(e){window.location.href=acp+"/project/download?id="+this.folder.component+"&key="+e.key}handleSetMetadata(){let e=this.modalService.show(ce,{animated:!0,backdrop:!0,ignoreBackdropClick:!0,class:"upload-modal"});e.content.init(this.entity.id),e.content.onMetadataChange.subscribe(()=>{this.entity.metadataUploaded=!0})}capitalize(e){return e.replace(/^\w/,e=>e.toUpperCase())}showVideo(e){this.video.name=null,this.video.src=null,setTimeout(()=>{this.video.name=e.name,this.video.src=acp+"/project/download?id="+this.folder.component+"&key="+e.key},200)}closeVideo(){this.video.name=null,this.video.src=null}error(e){this.message=U.b.getMessageFromError(e)}}xe.ɵfac=function(e){return new(e||xe)(n.fc(D),n.fc(se),n.fc(E.b),n.fc(E.a))},xe.ɵcmp=n.Zb({type:xe,selectors:[["leaf-modal"]],inputs:{initData:"initData"},features:[n.Sb([U.a])],decls:4,vars:3,consts:[[1,"modal-body"],["class","error-container",4,"ngIf"],[4,"ngIf"],[1,"error-container"],[1,"label-holder"],[1,"holder"],[1,"error-message"],[1,"row"],[1,"col-md-12"],["class","dot pending","style","margin-left: 0;margin-bottom: 5px;",4,"ngIf"],[1,"breadcrumb",2,"margin-bottom","10px"],[4,"ngFor","ngForOf"],[1,"col-sm-12",2,"padding","0"],[1,"nav-full-width"],[3,"heading","selectTab",4,"ngFor","ngForOf"],[1,"col-sm-12"],[3,"pageChange",4,"ngIf"],["style","text-align:right;padding-right:20px;",4,"ngIf"],[1,"btn-holder",2,"margin","20px 20px 10px 20px"],[1,"col-sm-2"],["type","button","class","btn btn-warning",3,"disabled","click",4,"ngIf"],[1,"col-md-10",2,"text-align","right"],["type","button",1,"btn","btn-default",3,"click"],["type","button","class","btn btn-secondary","style","margin-left: 5px;",3,"title","disabled","click",4,"ngIf"],["type","button","class","btn btn-secondary","title","Downloads the all.zip file generated from ODM.","style","margin-left: 5px;",3,"disabled","click",4,"ngIf"],["class","btn btn-primary","title","Reprocesses the selected raw imagery and generates new products.","style","margin-left: 5px;",3,"disabled","click",4,"ngIf"],[1,"dot","pending",2,"margin-left","0","margin-bottom","5px"],[3,"heading","selectTab"],[3,"ngSwitch"],["class","image-list-container",4,"ngSwitchDefault"],["class","image-list-container",4,"ngSwitchCase"],[4,"ngSwitchCase"],[1,"image-list-container"],[1,"list-group","row"],["class","list-group-item col-xs-3",4,"ngFor","ngForOf"],[1,"list-group-item","col-xs-3"],[1,"thumbnail","non-clickable"],["alt","Image",3,"src"],[1,"caption"],[1,"media-heading"],[1,"thumbnail",3,"ngClass"],["type","checkbox","class","x-box",3,"checked","change",4,"ngIf"],["alt","Image",2,"max-height","150px",3,"ngClass","src","click"],["type","checkbox",1,"x-box",3,"checked","change"],[1,"col-md-1"],[1,"col-md-10"],[3,"click"],[1,"fas","fa-download"],[1,"pull-right",3,"click"],["aria-hidden","true",1,"fa","fa-times"],["controls","",2,"width","100%"],["type","video/mp4",3,"src"],[1,"thumbnail",3,"click"],["alt","Video",3,"src"],[3,"pageChange"],[2,"text-align","right","padding-right","20px"],["routerlink","/site/tasks","routerlinkactive","active","href","#/site/tasks"],["type","button",1,"btn","btn-warning",3,"disabled","click"],[1,"fa","fa-plus",2,"color","white"],["type","button",1,"btn","btn-secondary",2,"margin-left","5px",3,"title","disabled","click"],["type","button","title","Downloads the all.zip file generated from ODM.",1,"btn","btn-secondary",2,"margin-left","5px",3,"disabled","click"],["title","Reprocesses the selected raw imagery and generates new products.",1,"btn","btn-primary",2,"margin-left","5px",3,"disabled","click"],["aria-hidden","true",1,"fa","fa-sync-alt",2,"color","white","vertical-align","middle","margin-left","10px",3,"ngClass"]],template:function(e,t){1&e&&(n.kc(0,"div",0),n.kc(1,"div"),n.Sc(2,ae,8,1,"div",1),n.Sc(3,Ae,28,10,"div",2),n.jc(),n.jc()),2&e&&(n.Ac("@fadeInOnEnter",void 0),n.Tb(2),n.Ac("ngIf",null!=t.message),n.Tb(1),n.Ac("ngIf",null!=t.entity))},directives:[i.l,i.k,u.c,u.a,i.m,i.o,i.n,i.j,h.c],pipes:[$.a,h.b],encapsulation:2,data:{animation:[Object(ne.c)(),Object(ne.d)(),Object(ne.e)(),Object(ne.f)()]}});class Pe{constructor(e,t){this.http=e,this.eventService=t}getProducts(e){let t=new v.g;return t=t.set("id",e),this.http.get(acp+"/product/get-all",{params:t}).toPromise()}getDetail(e,t,c){let n=new v.g;return n=n.set("id",e),n=n.set("pageNumber",t.toString()),n=n.set("pageSize",c.toString()),this.eventService.start(),this.http.get(acp+"/product/detail",{params:n}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}remove(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.http.post(acp+"/product/remove",JSON.stringify({id:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}togglePublish(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.http.post(acp+"/product/toggle-publish",JSON.stringify({id:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}}Pe.ɵfac=function(e){return new(e||Pe)(n.oc(v.c),n.oc(R.a))},Pe.ɵprov=n.bc({token:Pe,factory:Pe.ɵfac});var Fe=c(85);function Le(e,t){if(1&e&&(n.kc(0,"div",5),n.kc(1,"div",6),n.kc(2,"strong"),n.Uc(3,"Error"),n.jc(),n.jc(),n.kc(4,"div",7),n.kc(5,"div"),n.kc(6,"p",8),n.Uc(7),n.jc(),n.jc(),n.jc(),n.jc()),2&e){const e=n.uc(2);n.Tb(7),n.Vc(e.message)}}function Re(e,t){if(1&e&&(n.kc(0,"li"),n.kc(1,"span"),n.Uc(2),n.jc(),n.jc()),2&e){const e=t.$implicit;n.Tb(2),n.Wc(" ",e.name,"")}}function Ne(e,t){if(1&e){const e=n.lc();n.kc(0,"div",23),n.kc(1,"a",24),n.kc(2,"img",25),n.sc("error",(function(t){return n.Lc(e),n.uc(3).getDefaultImgURL(t)})),n.vc(3,"safeHtml"),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc(3);n.Tb(2),n.Ac("src",n.wc(3,1,e.thumbnails[e.product.id]),n.Nc)}}function De(e,t){if(1&e){const e=n.lc();n.kc(0,"div",23),n.kc(1,"a",27),n.sc("click",(function(){n.Lc(e);const t=n.uc().$implicit;return n.uc(3).previewImage(t)})),n.kc(2,"img",28),n.sc("error",(function(t){return n.Lc(e),n.uc(4).getDefaultImgURL(t)})),n.vc(3,"safeHtml"),n.jc(),n.kc(4,"div",29),n.kc(5,"h4",30),n.Uc(6),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc().$implicit,t=n.uc(3);n.Tb(2),n.Ac("src",n.wc(3,2,t.thumbnails[e.id]),n.Nc),n.Tb(4),n.Vc(e.name)}}function Ee(e,t){if(1&e&&(n.kc(0,"li",26),n.Sc(1,De,7,4,"div",13),n.jc()),2&e){const e=t.$implicit,c=n.uc(3);n.Tb(1),n.Ac("ngIf",null!=c.thumbnails[e.id])}}const $e=function(e,t,c){return{itemsPerPage:e,currentPage:t,totalItems:c}};function Ve(e,t){if(1&e){const e=n.lc();n.kc(0,"div"),n.kc(1,"div",9),n.kc(2,"div",10),n.kc(3,"h2"),n.Uc(4),n.jc(),n.jc(),n.jc(),n.kc(5,"div",9),n.kc(6,"div",10),n.kc(7,"ul",11),n.Sc(8,Re,3,1,"li",12),n.jc(),n.jc(),n.jc(),n.kc(9,"div",9),n.kc(10,"div",10),n.Sc(11,Ne,4,3,"div",13),n.jc(),n.jc(),n.kc(12,"div",9),n.kc(13,"div",10),n.kc(14,"label"),n.Uc(15,"Pilot Name: "),n.jc(),n.Uc(16),n.jc(),n.jc(),n.kc(17,"div",9),n.kc(18,"div",10),n.kc(19,"label"),n.Uc(20,"Date/Time: "),n.jc(),n.Uc(21),n.vc(22,"idmdate"),n.jc(),n.jc(),n.kc(23,"div",9),n.kc(24,"div",10),n.kc(25,"label"),n.Uc(26,"Sensor Information:"),n.jc(),n.Uc(27),n.jc(),n.jc(),n.kc(28,"div",14),n.kc(29,"div",10),n.kc(30,"div",15),n.kc(31,"h3"),n.Uc(32,"Raw Images"),n.jc(),n.kc(33,"ul",16),n.Sc(34,Ee,2,1,"li",17),n.vc(35,"paginate"),n.jc(),n.jc(),n.jc(),n.jc(),n.kc(36,"div",9),n.kc(37,"pagination-controls",18),n.sc("pageChange",(function(t){return n.Lc(e),n.uc(2).onPageChange(t)})),n.jc(),n.jc(),n.kc(38,"div",14),n.kc(39,"div",19),n.kc(40,"button",20),n.sc("click",(function(){return n.Lc(e),n.uc(2).bsModalRef.hide()})),n.Uc(41,"Close"),n.jc(),n.kc(42,"button",21),n.sc("click",(function(){return n.Lc(e),n.uc(2).handleDownload()})),n.Uc(43,"Download ODM Files"),n.jc(),n.kc(44,"button",22),n.sc("click",(function(){return n.Lc(e),n.uc(2).handleGoto()})),n.Uc(45," Collection Details "),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc(2);n.Tb(4),n.Vc(e.product.name),n.Tb(4),n.Ac("ngForOf",e.product.entities),n.Tb(3),n.Ac("ngIf",null!=e.thumbnails[e.product.id]),n.Tb(5),n.Wc("   ",e.product.pilotName," "),n.Tb(5),n.Wc("   ",n.wc(22,7,e.product.dateTime)," "),n.Tb(6),n.Wc("   ",e.product.sensor," "),n.Tb(7),n.Ac("ngForOf",n.xc(35,9,e.product.page.resultSet,n.Gc(12,$e,e.product.page.pageSize,e.product.page.pageNumber,e.product.page.count)))}}function _e(e,t){if(1&e&&(n.kc(0,"div",2),n.kc(1,"div"),n.Sc(2,Le,8,1,"div",3),n.Sc(3,Ve,46,16,"div",4),n.jc(),n.jc()),2&e){const e=n.uc();n.Tb(2),n.Ac("ngIf",null!=e.message),n.Tb(1),n.Ac("ngIf",null!=e.product)}}function ze(e,t){if(1&e&&n.gc(0,"leaf-modal",31),2&e){const e=n.uc();n.Ac("initData",e.initData)}}class Ge{constructor(e,t,c,n){this.pService=e,this.service=t,this.bsModalRef=c,this.modalService=n,this.thumbnails={},this.items=[],this.showSite=!1}ngOnInit(){}init(e){this.product=e,this.product.imageKey&&this.getThumbnail(this.product.id,this.product.imageKey),this.product.page.resultSet.forEach(e=>{this.getThumbnail(e.id,e.key)})}createImageFromBlob(e,t){let c=new FileReader;c.addEventListener("load",()=>{this.thumbnails[t]=c.result},!1),e&&c.readAsDataURL(e)}getThumbnail(e,t){const c=this.product.entities[this.product.entities.length-1].id,n=t.substr(0,t.lastIndexOf("/")),i=/[^/]*$/.exec(t)[0],s=i.lastIndexOf("."),a=n+"/thumbnails/"+i.substr(0,s)+".png";this.service.download(c,a,!1).subscribe(t=>{this.createImageFromBlob(t,e)},e=>{console.log(e)})}onPageChange(e){this.pService.getDetail(this.product.id,e,20).then(e=>{this.init(e)})}getDefaultImgURL(e){e.target.src=acp+"/net/geoprism/images/thumbnail-default.png"}handleGoto(){const e=this.product.entities[this.product.entities.length-1],t=this.product.entities;this.service.getItems(e.id,null).then(c=>{this.initData={entity:e,folders:c,previous:t},this.showSite=!0})}previewImage(e){this.rawImagePreviewModal=this.modalService.show(G,{animated:!0,backdrop:!0,ignoreBackdropClick:!1,class:"image-preview-modal"}),this.rawImagePreviewModal.content.init(e.component,e.key)}handleDownload(){window.location.href=acp+"/product/get-odm-all?id="+this.product.id}error(e){this.message=U.b.getMessageFromError(e)}}function We(e,t){1&e&&(n.kc(0,"span"),n.gc(1,"i",5),n.Uc(2," Loading Products "),n.jc())}function Be(e,t){1&e&&(n.kc(0,"p"),n.Uc(1,"No data found"),n.jc())}function qe(e,t){if(1&e&&(n.kc(0,"div",3),n.kc(1,"h4"),n.Sc(2,We,3,0,"span",4),n.Sc(3,Be,2,0,"p",4),n.jc(),n.jc()),2&e){const e=n.uc();n.Ac("@fadeInOnEnter",void 0),n.Tb(2),n.Ac("ngIf",e.loading),n.Tb(1),n.Ac("ngIf",!e.loading)}}function He(e,t){if(1&e&&(n.kc(0,"li"),n.kc(1,"span"),n.Uc(2),n.jc(),n.jc()),2&e){const e=t.$implicit;n.Tb(2),n.Wc(" ",e.name," ")}}function Je(e,t){if(1&e){const e=n.lc();n.kc(0,"div"),n.kc(1,"a",25),n.sc("click",(function(){n.Lc(e);const t=n.uc().$implicit;return n.uc().previewImage(t)})),n.kc(2,"img",26),n.sc("error",(function(t){return n.Lc(e),n.uc(2).getDefaultImgURL(t)})),n.vc(3,"safeHtml"),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc().$implicit,t=n.uc();n.Tb(2),n.Ac("src",n.wc(3,1,t.thumbnails[e.id]),n.Nc)}}function Ze(e,t){1&e&&n.gc(0,"i",27),2&e&&n.Ac("@bounceInOnEnter",void 0)("@bounceOutOnLeave",void 0)}function Ye(e,t){1&e&&n.gc(0,"i",27),2&e&&n.Ac("@bounceInOnEnter",void 0)("@bounceOutOnLeave",void 0)}function Ke(e,t){if(1&e){const e=n.lc();n.kc(0,"li",20),n.kc(1,"a",28),n.sc("click",(function(){n.Lc(e);const t=n.uc().$implicit;return n.uc().handleTogglePublish(t)})),n.Uc(2,"Unpublish"),n.jc(),n.jc()}}function Qe(e,t){if(1&e){const e=n.lc();n.kc(0,"li",20),n.kc(1,"a",29),n.sc("click",(function(){n.Lc(e);const t=n.uc().$implicit;return n.uc().handleTogglePublish(t)})),n.Uc(2,"Publish"),n.jc(),n.jc()}}function Xe(e,t){if(1&e){const e=n.lc();n.kc(0,"div",6),n.kc(1,"div",7),n.kc(2,"div",8),n.kc(3,"h5",9),n.Uc(4),n.jc(),n.kc(5,"ul",10),n.Sc(6,He,3,1,"li",11),n.jc(),n.kc(7,"div",12),n.Sc(8,Je,4,3,"div",4),n.jc(),n.kc(9,"div",13),n.kc(10,"ul",14),n.kc(11,"li",15),n.kc(12,"a",16),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc().handleMapIt(c)})),n.Uc(13,"Aerial"),n.jc(),n.Sc(14,Ze,1,2,"i",17),n.jc(),n.kc(15,"li",18),n.kc(16,"a",19),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc().handleMapDem(c)})),n.Uc(17,"Hillshade"),n.jc(),n.Sc(18,Ye,1,2,"i",17),n.jc(),n.kc(19,"li",20),n.kc(20,"a",21),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc().handlePointcloud(c)})),n.Uc(21,"3D"),n.jc(),n.jc(),n.kc(22,"li",20),n.kc(23,"a",22),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc().handleGetInfo(c)})),n.Uc(24,"Get Info"),n.jc(),n.jc(),n.kc(25,"li",20),n.kc(26,"a",23),n.sc("click",(function(c){n.Lc(e);const i=t.$implicit;return n.uc().handleDelete(i,c)})),n.Uc(27,"Delete"),n.jc(),n.jc(),n.Sc(28,Ke,3,0,"li",24),n.Sc(29,Qe,3,0,"li",24),n.jc(),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=t.$implicit,c=n.uc();n.Tb(1),n.Ac("@fadeInOnEnter",void 0)("@fadeOutOnLeave",void 0),n.Tb(3),n.Wc(" ",e.name," "),n.Tb(2),n.Ac("ngForOf",e.entities),n.Tb(2),n.Ac("ngIf",null!=c.thumbnails[e.id]),n.Tb(4),n.Qc(c.hasOrthoLayer(e)?"":"cursor:not-allowed;"),n.Tb(2),n.Ac("ngIf",e.orthoMapped),n.Tb(2),n.Qc(c.hasDemLayer(e)?"":"cursor:not-allowed;"),n.Tb(2),n.Ac("ngIf",e.demMapped),n.Tb(2),n.Qc(e.hasPointcloud?"":"cursor:not-allowed;"),n.Tb(8),n.Ac("ngIf",e.published),n.Tb(1),n.Ac("ngIf",!e.published)}}Ge.ɵfac=function(e){return new(e||Ge)(n.fc(Pe),n.fc(D),n.fc(E.a),n.fc(E.b))},Ge.ɵcmp=n.Zb({type:Ge,selectors:[["product-modal"]],features:[n.Sb([xe])],decls:2,vars:2,consts:[["class","modal-body","style","padding-bottom: 0;",4,"ngIf"],[3,"initData",4,"ngIf"],[1,"modal-body",2,"padding-bottom","0"],["class","error-container",4,"ngIf"],[4,"ngIf"],[1,"error-container"],[1,"label-holder"],[1,"holder"],[1,"error-message"],[1,"row"],[1,"col-md-12"],[1,"breadcrumb",2,"margin-bottom","10px"],[4,"ngFor","ngForOf"],["class","",4,"ngIf"],[1,"row",2,"background-color","#ececec"],["id","image-list-container"],[1,"list-group","row"],["class","list-group-item col-xs-3","style","background:none;",4,"ngFor","ngForOf"],[3,"pageChange"],[1,"btn-holder",2,"text-align","right","margin","20px 20px 20px 20px"],["type","button",1,"btn","btn-default",3,"click"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",2,"margin-left","5px",3,"click"],[1,""],[1,"thumbnail","non-clickable"],["alt","Image",1,"",3,"src","error"],[1,"list-group-item","col-xs-3",2,"background","none"],[1,"thumbnail",3,"click"],["alt","Image",3,"src","error"],[1,"caption"],[1,"media-heading"],[3,"initData"]],template:function(e,t){1&e&&(n.Sc(0,_e,4,2,"div",0),n.Sc(1,ze,1,1,"leaf-modal",1)),2&e&&(n.Ac("ngIf",!t.showSite),n.Tb(1),n.Ac("ngIf",t.showSite))},directives:[i.l,i.k,h.c,xe],pipes:[Fe.a,h.b,$.a],encapsulation:2,data:{animation:[Object(ne.c)(),Object(ne.d)(),Object(ne.a)()]}});class et{constructor(e,t,c){this.pService=e,this.mService=t,this.modalService=c,this.toggleMapOrtho=new n.t,this.toggleMapDem=new n.t,this.products=[],this.thumbnails={},this.loading=!1}ngOnChanges(e){this.refreshProducts(e.id.currentValue)}refreshProducts(e){this.products=[],this.thumbnails={},this.loading=!0,this.pService.getProducts(e).then(e=>{this.products=e,this.loading=!1,this.products.forEach(e=>{this.getThumbnail(e)})})}createImageFromBlob(e,t){let c=new FileReader;c.addEventListener("load",()=>{this.thumbnails[t.id]=c.result},!1),e&&c.readAsDataURL(e)}hasOrthoLayer(e){let t=e.layers.length;for(let c=0;c<t;++c)if("ORTHO"===e.layers[c].classification&&null!=e.layers[c].key&&e.layers[c].key.length>0)return!0;return!1}hasDemLayer(e){let t=e.layers.length;for(let c=0;c<t;++c)if(("DEM_DSM"===e.layers[c].classification||"DEM_DTM"===e.layers[c].classification)&&null!=e.layers[c].key&&e.layers[c].key.length>0)return!0;return!1}getThumbnail(e){if(e.imageKey){const t=e.entities[e.entities.length-1].id,c=e.imageKey.substr(0,e.imageKey.lastIndexOf("/")),n=/[^/]*$/.exec(e.imageKey)[0],i=n.lastIndexOf("."),s=c+"/thumbnails/"+n.substr(0,i)+".png";this.mService.download(t,s,!1).subscribe(t=>{this.createImageFromBlob(t,e)},t=>{console.log(t),this.thumbnails[e.id]=acp+"/net/geoprism/images/thumbnail-default.png"})}else this.thumbnails[e.id]=acp+"/net/geoprism/images/thumbnail-default.png"}getDefaultImgURL(e){e.target.src=acp+"/net/geoprism/images/thumbnail-default.png"}handleMapIt(e){this.hasOrthoLayer(e)&&this.toggleMapOrtho.emit(e)}handleMapDem(e){this.hasDemLayer(e)&&this.toggleMapDem.emit(e)}handlePointcloud(e){if(e.hasPointcloud){let t=e.entities[e.entities.length-1].id;window.open(acp+"/pointcloud/"+t+"/potree")}}handleDelete(e,t){t.stopPropagation(),this.bsModalRef=this.modalService.show(I.a,{animated:!0,backdrop:!0,ignoreBackdropClick:!0}),this.bsModalRef.content.message="Are you sure you want to delete ["+e.name+"]?",this.bsModalRef.content.data=e,this.bsModalRef.content.type="DANGER",this.bsModalRef.content.submitText="Delete",this.bsModalRef.content.onConfirm.subscribe(e=>{this.remove(e)})}remove(e){this.pService.remove(e.id).then(t=>{this.products=this.products.filter(t=>t.id!==e.id)})}previewImage(e){const t=e.entities[e.entities.length-1].id;this.bsModalRef=this.modalService.show(G,{animated:!0,backdrop:!0,ignoreBackdropClick:!1,class:"image-preview-modal"}),this.bsModalRef.content.init(t,e.imageKey)}handleGetInfo(e){this.pService.getDetail(e.id,1,20).then(e=>{this.bsModalRef=this.modalService.show(Ge,{animated:!0,backdrop:!0,ignoreBackdropClick:!0,class:"product-info-modal"}),this.bsModalRef.content.init(e)})}handleTogglePublish(e){this.pService.togglePublish(e.id).then(t=>{const c=e.orthoMapped,n=e.demMapped;c&&this.toggleMapOrtho.emit(e),n&&this.toggleMapDem.emit(e),e.published=t.published,e.layers=t.layers,c&&this.toggleMapOrtho.emit(e),n&&this.toggleMapDem.emit(e)})}}function tt(e,t){if(1&e&&(n.kc(0,"div",10),n.kc(1,"div",11),n.kc(2,"strong"),n.Uc(3,"Error"),n.jc(),n.jc(),n.kc(4,"div",12),n.kc(5,"div"),n.kc(6,"p",13),n.Uc(7),n.jc(),n.jc(),n.jc(),n.jc()),2&e){const e=n.uc(2);n.Tb(7),n.Vc(e.message)}}function ct(e,t){if(1&e&&(n.kc(0,"div",14),n.kc(1,"h3"),n.Uc(2),n.jc(),n.jc()),2&e){const e=n.uc(2);n.Tb(2),n.Wc("Add new ",e.entity.type,"")}}function nt(e,t){if(1&e){const e=n.lc();n.kc(0,"div"),n.kc(1,"label"),n.Uc(2),n.jc(),n.kc(3,"input",17),n.sc("ngModelChange",(function(t){n.Lc(e);const c=n.uc(2).$implicit;return n.uc(2).entity[c.name]=t})),n.jc(),n.jc()}if(2&e){const e=n.uc(2).$implicit,t=n.uc(2);n.Tb(2),n.Vc(e.label),n.Tb(1),n.Ac("ngModel",t.entity[e.name])("name",e.name)("disabled",e.readonly)("placeholder",e.label)("required",e.required)}}function it(e,t){if(1&e&&(n.kc(0,"option",20),n.Uc(1),n.jc()),2&e){const e=t.$implicit;n.Ac("value",e.value),n.Tb(1),n.Vc(e.label)}}function st(e,t){if(1&e){const e=n.lc();n.kc(0,"div"),n.kc(1,"label"),n.Uc(2),n.jc(),n.kc(3,"select",18),n.sc("ngModelChange",(function(t){n.Lc(e);const c=n.uc(2).$implicit;return n.uc(2).entity[c.name]=t})),n.gc(4,"option"),n.Sc(5,it,2,2,"option",19),n.jc(),n.jc()}if(2&e){const e=n.uc(2).$implicit,t=n.uc(2);n.Tb(2),n.Vc(e.label),n.Tb(1),n.Ac("ngModel",t.entity[e.name])("name",e.name)("disabled",e.readonly)("required",e.required),n.Tb(2),n.Ac("ngForOf",e.options)}}function at(e,t){if(1&e){const e=n.lc();n.kc(0,"div"),n.kc(1,"label"),n.Uc(2),n.jc(),n.kc(3,"textarea",21),n.sc("ngModelChange",(function(t){n.Lc(e);const c=n.uc(2).$implicit;return n.uc(2).entity[c.name]=t})),n.Uc(4,"          "),n.jc(),n.jc()}if(2&e){const e=n.uc(2).$implicit,t=n.uc(2);n.Tb(2),n.Vc(e.label),n.Tb(1),n.Ac("ngModel",t.entity[e.name])("name",e.name)("disabled",e.readonly)("required",e.required)}}function ot(e,t){if(1&e){const e=n.lc();n.kc(0,"div"),n.kc(1,"map-attribute",22),n.sc("siteChange",(function(t){return n.Lc(e),n.uc(4).entity=t})),n.jc(),n.jc()}if(2&e){const e=n.uc(4);n.Tb(1),n.Ac("site",e.entity)("center",e.center)("zoom",e.zoom)}}function lt(e,t){if(1&e&&(n.kc(0,"div",15),n.Sc(1,nt,4,6,"div",16),n.Sc(2,st,6,6,"div",16),n.Sc(3,at,5,5,"div",16),n.Sc(4,ot,2,3,"div",16),n.jc()),2&e){const e=n.uc().$implicit;n.Tb(1),n.Ac("ngIf","text"===e.type),n.Tb(1),n.Ac("ngIf","list"===e.type),n.Tb(1),n.Ac("ngIf","text-area"===e.type),n.Tb(1),n.Ac("ngIf","point"===e.type)}}function rt(e,t){if(1&e&&(n.kc(0,"div"),n.Sc(1,lt,5,4,"div",6),n.jc()),2&e){const e=t.$implicit,c=n.uc(2);n.Tb(1),n.Ac("ngIf",c.evaluate(e))}}function dt(e,t){if(1&e){const e=n.lc();n.kc(0,"div",15),n.kc(1,"label"),n.Uc(2,"Privilege "),n.jc(),n.kc(3,"select",23),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc(2).entity.privilegeType=t})),n.kc(4,"option",24),n.Uc(5,"Owner"),n.jc(),n.kc(6,"option",25),n.Uc(7,"Agency"),n.jc(),n.kc(8,"option",26),n.Uc(9,"Public"),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc(2);n.Tb(3),n.Ac("ngModel",e.entity.privilegeType)("required",!0)("disabled",!1===e.admin||e.entity.ownerName!==e.userName)}}function ut(e,t){if(1&e){const e=n.lc();n.kc(0,"div",1),n.Sc(1,tt,8,1,"div",2),n.Sc(2,ct,3,1,"div",3),n.kc(3,"form",null,4),n.Sc(5,rt,2,1,"div",5),n.Sc(6,dt,10,3,"div",6),n.kc(7,"div",7),n.kc(8,"button",8),n.sc("click",(function(){return n.Lc(e),n.uc().bsModalRef.hide()})),n.Uc(9,"Cancel"),n.jc(),n.kc(10,"button",9),n.sc("click",(function(){return n.Lc(e),n.uc().handleOnSubmit()})),n.Uc(11,"Apply"),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.Jc(4),t=n.uc();n.Tb(1),n.Ac("ngIf",null!=t.message),n.Tb(1),n.Ac("ngIf",t.newInstance),n.Tb(3),n.Ac("ngForOf",t.attributes),n.Tb(1),n.Ac("ngIf","Collection"===t.entity.type&&!t.newInstance),n.Tb(4),n.Ac("disabled",!e.valid)}}et.ɵfac=function(e){return new(e||et)(n.fc(Pe),n.fc(D),n.fc(E.b))},et.ɵcmp=n.Zb({type:et,selectors:[["product-panel"]],inputs:{id:"id"},outputs:{toggleMapOrtho:"toggleMapOrtho",toggleMapDem:"toggleMapDem"},features:[n.Rb],decls:3,vars:2,consts:[[1,"list-group"],["style","padding: 10px;text-align: center;color: grey;",4,"ngIf"],["class","list-group-item",4,"ngFor","ngForOf"],[2,"padding","10px","text-align","center","color","grey"],[4,"ngIf"],["aria-hidden","true",1,"fa","fa-spinner","fa-spin"],[1,"list-group-item"],[1,"card","card-default"],[1,"card-body"],[1,"card-title",2,"color","#a0a0a0"],[1,"breadcrumb",2,"margin","5px 0 5px 0"],[4,"ngFor","ngForOf"],[1,"card-left",2,"width","calc(100% - 7.2em)","padding","0px"],[1,"card-right",2,"padding","0px","width","7.2em"],[2,"list-style","none","padding","0"],[2,"padding","3px 0 3px 0","min-width","6em"],["aria-hidden","true","title","View the Orthomosaic generated from the raw data using ODM.",1,"fa","fa-globe",3,"click"],["class","fas fa-check","style","color: #007276;float: right;vertical-align: middle;line-height: 20px;",4,"ngIf"],[2,"padding","3px 0 3px 0","min-width","7.2em"],["aria-hidden","true","title","View the DEM hillshade.",1,"fa","fa-industry",3,"click"],[2,"padding","3px 0 3px 0"],["aria-hidden","true","title","View the 3D pointcloud for this product using the Potree viewer.",1,"fa","fa-cube",3,"click"],["title","View more information about this product, including raw data.",1,"fa","fa-info-circle",3,"click"],["title","Deletes the product and all associated data and public map services.",1,"fa","fa-trash-alt",3,"click"],["style","padding: 3px 0 3px 0;",4,"ngIf"],[1,"thumbnail",3,"click"],["alt","Image",1,"",3,"src","error"],[1,"fas","fa-check",2,"color","#007276","float","right","vertical-align","middle","line-height","20px"],["title","Unpublishes the layer from the public mosaic. This layer will no longer be publicly accessible from Geoserver.",1,"fa","fa-arrow-alt-circle-down",3,"click"],["title","Publish the product to the publish mosaic. The aerial and hillshade services will be publicly accessible.",1,"fa","fa-arrow-alt-circle-up",3,"click"]],template:function(e,t){1&e&&(n.kc(0,"div",0),n.Sc(1,qe,4,3,"div",1),n.Sc(2,Xe,30,15,"div",2),n.jc()),2&e&&(n.Tb(1),n.Ac("ngIf",t.products.length<1),n.Tb(1),n.Ac("ngForOf",t.products))},directives:[i.l,i.k],pipes:[$.a],encapsulation:2,data:{animation:[Object(ne.c)(),Object(ne.d)(),Object(ne.a)(),Object(ne.b)()]}});class pt{constructor(e,t){this.service=e,this.bsModalRef=t,this.userName="",this.admin=!1,this.newInstance=!1,this.message=null,this.center=null,this.zoom=null}ngOnInit(){this.onNodeChange=new W.b}init(e,t,c,n,i,s,a){this.newInstance=e,this.userName=t,this.admin=c,this.entity=n,this.attributes=i,this.center=s,this.zoom=a}handleOnSubmit(){this.message=null,"Site"!==this.entity.type||null!=this.entity.geometry?this.newInstance?this.service.applyWithParent(this.entity,this.parentId).then(e=>{this.onNodeChange.next(e),this.bsModalRef.hide()}).catch(e=>{this.error(e)}):this.service.update(this.entity).then(e=>{this.onNodeChange.next(e),this.bsModalRef.hide()}).catch(e=>{console.log(e),this.error(e)}):this.message="Sites require a location"}evaluate(e){return(!this.newInstance||!e.readonly)&&(null==e.condition||this.service.evaluate(e.condition,this.entity))}error(e){this.message=U.b.getMessageFromError(e)}}pt.ɵfac=function(e){return new(e||pt)(n.fc(D),n.fc(E.a))},pt.ɵcmp=n.Zb({type:pt,selectors:[["entity-modal"]],decls:1,vars:1,consts:[["class","modal-body",4,"ngIf"],[1,"modal-body"],["class","error-container",4,"ngIf"],["class","modal-title-container",4,"ngIf"],["ngForm","ngForm"],[4,"ngFor","ngForOf"],["class","form-group",4,"ngIf"],[1,"btn-holder",2,"text-align","right"],["type","button",1,"btn","btn-default",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[1,"error-container"],[1,"label-holder"],[1,"holder"],[1,"error-message"],[1,"modal-title-container"],[1,"form-group"],[4,"ngIf"],["type","input",1,"form-control",3,"ngModel","name","disabled","placeholder","required","ngModelChange"],["type","input",3,"ngModel","name","disabled","required","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"form-control",3,"ngModel","name","disabled","required","ngModelChange"],[3,"site","center","zoom","siteChange"],["name","collection-privilege","type","input",2,"padding","6px 10px","font-size","14px",3,"ngModel","required","disabled","ngModelChange"],["value","OWNER"],["value","AGENCY"],["value","PUBLIC"]],template:function(e,t){1&e&&n.Sc(0,ut,12,5,"div",0),2&e&&n.Ac("ngIf",null!=t.entity)},directives:[i.l,a.r,a.i,a.j,i.k,a.a,a.h,a.k,a.o,a.p,a.l,a.q,O],encapsulation:2});var ht=c(341),gt=c(34),ft=c(334),mt=c(93);const bt=["uploader"];function kt(e,t){if(1&e&&(n.kc(0,"div",22),n.gc(1,"div",4),n.kc(2,"div",5),n.kc(3,"div",23),n.kc(4,"strong",24),n.Uc(5,"Error"),n.jc(),n.jc(),n.kc(6,"div",25),n.kc(7,"div"),n.kc(8,"p",26),n.Uc(9),n.jc(),n.jc(),n.jc(),n.jc(),n.gc(10,"div",4),n.jc()),2&e){const e=n.uc();n.Tb(9),n.Vc(e.message)}}function vt(e,t){if(1&e&&(n.kc(0,"div",15),n.gc(1,"div",4),n.kc(2,"div",5),n.kc(3,"ol",27),n.gc(4,"modal-step-indicator",28),n.jc(),n.jc(),n.jc()),2&e){const e=n.uc();n.Tb(4),n.Ac("stepConfig",e.modalStepConfig)}}function jt(e,t){if(1&e&&(n.kc(0,"li"),n.kc(1,"span"),n.Uc(2),n.jc(),n.jc()),2&e){const e=t.$implicit;n.Ac("@fadeInOnEnter",void 0),n.Tb(2),n.Wc(" ",e,"")}}function yt(e,t){if(1&e&&(n.kc(0,"div",15),n.gc(1,"div",4),n.kc(2,"div",5),n.kc(3,"ul",29),n.Sc(4,jt,3,2,"li",30),n.jc(),n.jc(),n.jc()),2&e){const e=n.uc();n.Tb(4),n.Ac("ngForOf",e.labels)}}function Tt(e,t){if(1&e&&(n.kc(0,"option",37),n.Uc(1),n.jc()),2&e){const e=t.$implicit;n.Ac("value",e.id),n.Tb(1),n.Vc(e.name)}}function St(e,t){if(1&e){const e=n.lc();n.kc(0,"button",38),n.sc("click",(function(){return n.Lc(e),n.uc(3).setIsNew(!0)})),n.Uc(1," Add "),n.jc()}}function Ct(e,t){if(1&e){const e=n.lc();n.kc(0,"div",15),n.kc(1,"div",5),n.kc(2,"select",34),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc(2).page.selection.value=t})),n.gc(3,"option"),n.Sc(4,Tt,2,2,"option",35),n.jc(),n.jc(),n.kc(5,"div",4),n.Sc(6,St,2,0,"button",36),n.jc(),n.jc()}if(2&e){const e=n.uc(2);n.Tb(2),n.Ac("name",e.page.selection.type)("ngModel",e.page.selection.value)("disabled",e.page.selection.isNew),n.Tb(2),n.Ac("ngForOf",e.page.options),n.Tb(2),n.Ac("ngIf",!e.page.selection.isNew)}}function wt(e,t){if(1&e&&(n.kc(0,"option",37),n.Uc(1),n.jc()),2&e){const e=t.$implicit;n.Ac("value",e.oid),n.Tb(1),n.Vc(e.displayLabel)}}function Mt(e,t){if(1&e){const e=n.lc();n.kc(0,"div",15),n.kc(1,"div",5),n.kc(2,"label",40),n.Uc(3,"Platform:"),n.jc(),n.kc(4,"select",41),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc(3).page.selection.platform=t})),n.gc(5,"option"),n.Sc(6,wt,2,2,"option",35),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc(3);n.Ac("@fadeInOnEnter",void 0),n.Tb(4),n.Ac("ngModel",e.page.selection.platform),n.Tb(2),n.Ac("ngForOf",e.platforms)}}function Ot(e,t){if(1&e&&(n.kc(0,"option",37),n.Uc(1),n.jc()),2&e){const e=t.$implicit;n.Ac("value",e.oid),n.Tb(1),n.Vc(e.displayLabel)}}function It(e,t){if(1&e){const e=n.lc();n.kc(0,"div",15),n.kc(1,"div",5),n.kc(2,"label",42),n.Uc(3,"Sensor:"),n.jc(),n.kc(4,"select",43),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc(3).page.selection.sensor=t})),n.gc(5,"option"),n.Sc(6,Ot,2,2,"option",35),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc(3);n.Ac("@fadeInOnEnter",void 0),n.Tb(4),n.Ac("ngModel",e.page.selection.sensor),n.Tb(2),n.Ac("ngForOf",e.sensors)}}function Ut(e,t){if(1&e){const e=n.lc();n.kc(0,"div",31),n.kc(1,"div",15),n.kc(2,"div",5),n.kc(3,"input",39),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc(2).page.selection.label=t})),n.jc(),n.jc(),n.kc(4,"div",4),n.kc(5,"button",38),n.sc("click",(function(){return n.Lc(e),n.uc(2).setIsNew(!1)})),n.Uc(6," Cancel "),n.jc(),n.jc(),n.jc(),n.Sc(7,Mt,7,3,"div",2),n.Sc(8,It,7,3,"div",2),n.jc()}if(2&e){const e=n.uc(2);n.Ac("@fadeInOnEnter",void 0),n.Tb(3),n.Ac("ngModel",e.page.selection.label)("placeholder",e.page.selection.type+" name..."),n.Tb(4),n.Ac("ngIf",e.hasField("platform")),n.Tb(1),n.Ac("ngIf",e.hasField("sensor"))}}function At(e,t){if(1&e&&(n.kc(0,"div",15),n.gc(1,"div",4),n.kc(2,"div",5),n.kc(3,"div",31),n.kc(4,"label",32),n.Uc(5),n.jc(),n.Sc(6,Ct,7,5,"div",2),n.jc(),n.Sc(7,Ut,9,5,"div",33),n.jc(),n.jc()),2&e){const e=n.uc();n.Tb(4),n.Ac("for",e.page.selection.type),n.Tb(1),n.Wc("",e.page.selection.type,":"),n.Tb(1),n.Ac("ngIf",!e.page.selection.isNew),n.Tb(1),n.Ac("ngIf",e.page.selection.isNew)}}function xt(e,t){if(1&e){const e=n.lc();n.kc(0,"div",31),n.kc(1,"label",32),n.Uc(2),n.jc(),n.kc(3,"input",48),n.sc("ngModelChange",(function(c){return n.Lc(e),t.$implicit.label=c})),n.jc(),n.jc()}if(2&e){const e=t.$implicit;n.Tb(1),n.Ac("for",e.type),n.Tb(1),n.Wc("",e.type,":"),n.Tb(1),n.Ac("ngModel",e.label)("name",e.type)}}function Pt(e,t){if(1&e){const e=n.lc();n.kc(0,"div",15),n.gc(1,"div",4),n.kc(2,"div",5),n.Sc(3,xt,4,4,"div",44),n.kc(4,"div",31),n.kc(5,"label",45),n.Uc(6,"Output Product Name Prefix"),n.jc(),n.kc(7,"input",46),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc().values.outFileName=t})),n.jc(),n.jc(),n.kc(8,"div",31),n.kc(9,"boolean-field",47),n.sc("valueChange",(function(t){return n.Lc(e),n.uc().updateProcessUpload(t)})),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc();n.Ac("@fadeInOnEnter",void 0),n.Tb(3),n.Ac("ngForOf",e.selections),n.Tb(4),n.Ac("ngModel",e.values.outFileName),n.Tb(2),n.Ac("value",e.processUpload)}}function Ft(e,t){if(1&e){const e=n.lc();n.kc(0,"div"),n.kc(1,"div",49),n.kc(2,"div",50),n.Uc(3,"Partial Upload Detected"),n.jc(),n.kc(4,"div",51),n.kc(5,"h4"),n.Uc(6,"A partial upload was detected. You can either cancel that partial upload or attempt to continue."),n.jc(),n.kc(7,"h4"),n.kc(8,"b"),n.Uc(9,"To continue an upload"),n.jc(),n.Uc(10," please re-upload your file and we will try our best to continue where you left off. "),n.jc(),n.gc(11,"hr"),n.kc(12,"button",52),n.sc("click",(function(t){return n.Lc(e),n.uc().removeUpload(t)})),n.gc(13,"i",53),n.Uc(14," Cancel Upload "),n.jc(),n.jc(),n.jc(),n.jc()}}function Lt(e,t){if(1&e){const e=n.lc();n.kc(0,"div",54),n.kc(1,"div",50),n.Uc(2," Upload Details "),n.kc(3,"i",55),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc().closeTaskFinishedNotification(c.id)})),n.jc(),n.jc(),n.kc(4,"div",51),n.kc(5,"h4"),n.Uc(6," Status: "),n.kc(7,"b"),n.Uc(8," Upload successfully completed "),n.jc(),n.jc(),n.kc(9,"h4"),n.Uc(10," Message: "),n.kc(11,"b"),n.Uc(12),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=t.$implicit;n.Tb(12),n.Wc(" ",e.message," ")}}function Rt(e,t){if(1&e&&(n.kc(0,"div",49),n.kc(1,"div",50),n.Uc(2,"Upload Details"),n.jc(),n.kc(3,"div",51),n.kc(4,"h4"),n.Uc(5," Status: "),n.kc(6,"b"),n.Uc(7),n.jc(),n.jc(),n.kc(8,"h4"),n.Uc(9," Message: "),n.kc(10,"b"),n.Uc(11),n.jc(),n.jc(),n.kc(12,"h4"),n.Uc(13," Upload Started On: "),n.kc(14,"b"),n.Uc(15),n.vc(16,"idmdate"),n.jc(),n.jc(),n.kc(17,"h4"),n.Uc(18," Last Updated: "),n.kc(19,"b"),n.Uc(20),n.vc(21,"idmdate"),n.jc(),n.jc(),n.kc(22,"h4"),n.Uc(23," Elapsed Time: "),n.kc(24,"b"),n.Uc(25),n.jc(),n.jc(),n.jc(),n.jc()),2&e){const e=n.uc();n.Tb(7),n.Wc(" ",e.currentTask.status," "),n.Tb(4),n.Wc(" ",e.currentTask.message," "),n.Tb(4),n.Wc(" ",n.wc(16,5,e.currentTask.createDate)," "),n.Tb(5),n.Wc(" ",n.wc(21,7,e.currentTask.lastUpdateDate)," "),n.Tb(5),n.Wc(" ",e.uploadCounter," ")}}function Nt(e,t){if(1&e){const e=n.lc();n.kc(0,"button",56),n.sc("click",(function(){return n.Lc(e),n.uc().handleBackPage()})),n.gc(1,"i",53),n.Uc(2," Back "),n.jc()}if(2&e){const e=n.uc();n.Ac("disabled",e.disabled)}}function Dt(e,t){if(1&e){const e=n.lc();n.kc(0,"button",57),n.sc("click",(function(){return n.Lc(e),n.uc().handleNextPage()})),n.gc(1,"i",53),n.Uc(2," Next "),n.jc()}if(2&e){const e=n.uc();n.Ac("disabled",!e.isPageValid(e.page)||e.disabled)}}function Et(e,t){if(1&e){const e=n.lc();n.kc(0,"button",57),n.sc("click",(function(){return n.Lc(e),n.uc().handleUpload()})),n.gc(1,"i",53),n.Uc(2," Upload "),n.jc()}if(2&e){const e=n.uc();n.Ac("disabled",!e.isPageValid(e.page)||e.disabled)}}class $t{constructor(e,t,c,n,i){this.service=e,this.metadataService=t,this.modalService=c,this.bsModalRef=n,this.objectKeys=Object.keys,this.importedValues=!1,this.message="",this.values={create:!1},this.uploader=null,this.disabled=!1,this.taskStatusMessages=[],this.currentTask=null,this.finishedTask=null,this.existingTask=!1,this.pollingIsSet=!1,this.uploadVisible=!0,this.selectedContinue=!1,this.uploadCounter="00:00:00",this.showFileSelectPanel=!1,this.taskFinishedNotifications=[],this.processUpload=!0,this.hierarchy=[],this.selections=[],this.labels=[],this.pages=[{index:0,selection:null,options:[],type:"FILE"}],this.hierarchyChange=!1,this.page=this.pages[0],this.sensors=[],this.platforms=[],this.modalStepConfig={steps:[{label:"Category",active:!0,enabled:!0},{label:"Final",active:!0,enabled:!1}]},this.differ=i.find([]).create()}set content(e){const t=this;if(null!=e&&null==this.uploader){let c={debug:!1,autoUpload:!1,multiple:!1,element:e.nativeElement,template:"qq-template",request:{endpoint:acp+"/file/upload",forceMultipart:!0},resume:{enabled:!0,recordsExpireIn:1},chunking:{enabled:!0},retry:{enableAuto:!0},text:{defaultResponseError:"Upload failed"},failedUploadTextDisplay:{mode:"none"},validation:{allowedExtensions:["zip","tar.gz"]},showMessage:function(e){},callbacks:{onUpload:function(e,c){t.disabled=!0,this.finishedTask=null,t.countUpload(t),t.message&&t.message.length>0&&(t.message="")},onProgress:function(e,t,c,n){},onUploadChunk:function(e,t,c){},onUploadChunkSuccess:function(e,c,n,i){n.message&&n.message.currentTask&&!t.currentTask&&(t.currentTask=n.message.currentTask),t.currentTask&&!t.pollingIsSet&&(t.pollingIsSet=!0,t.taskPolling=Object(ht.a)(2e3).pipe(Object(F.a)(()=>{if(t.currentTask)return t.service.task(t.currentTask.oid)})).pipe(Object(gt.a)(e=>e)).subscribe(e=>{t.currentTask=e.task}))},onComplete:function(e,c,n,i){if(t.disabled=!1,t.finishedTask=t.currentTask,t.currentTask=null,t.existingTask=!1,!t.hierarchyChange)for(let e=0;e<t.selections.length;e++)t.selections[e].isNew&&(t.hierarchyChange=!0);t.taskPolling&&(t.taskPolling.unsubscribe(),t.pollingIsSet=!1),this.clearStoredFiles(),clearInterval(t.uplodeCounterInterfal),n.success&&t.bsModalRef.hide(),t.onUploadComplete.next()},onCancel:function(e,c){t.currentTask&&t.currentTask.uploadId&&t.service.removeTask(t.currentTask.uploadId).then(()=>{this.clearStoredFiles()}).catch(e=>{this.error(e)}),t.existingTask&&(t.page=t.pages[0]),t.disabled=!1,t.currentTask=null,t.existingTask=!1,t.taskPolling&&(t.taskPolling.unsubscribe(),t.pollingIsSet=!1),clearInterval(t.uplodeCounterInterfal)},onError:function(e,c,n){t.error({error:{message:n}})}}};this.uploader=new ft.FineUploader(c)}}ngAfterViewInit(){}ngDoCheck(){if(this.uploader){this.differ.diff(this.uploader)&&this.setExistingTask()}}ngOnInit(){this.onUploadComplete=new W.b,this.onHierarchyChange=new W.b,this.service.getMetadataOptions(null).then(e=>{this.sensors=e.sensors,this.platforms=e.platforms}).catch(e=>{this.error(e)})}init(e){this.hierarchy=this.metadataService.getHierarchy(),this.selections=[],this.pages=[];for(let t=0;t<this.hierarchy.length;t++){const c=this.hierarchy[t],n=e.findIndex(e=>e.type===c);if(-1!==n){const t=e[n];this.selections.push({type:c,isNew:!1,value:t.id,label:t.name})}else this.selections.push({type:c,isNew:!1,value:null,label:""});t>0&&this.pages.push({index:this.pages.length,selection:this.selections[t],options:[],type:"CATEGORY"})}this.labels.push(this.selections[0].label),this.pages.push({index:this.pages.length,selection:null,options:[],type:"SUMMARY"}),this.page=this.pages[0],this.service.getChildren(this.selections[0].value).then(e=>{this.pages[0].options=e.filter(e=>e.type===this.pages[0].selection.type)}).catch(e=>{this.error(e)}),this.existingTask&&(this.page=this.pages[this.pages.length-1])}close(){this.hierarchyChange&&this.onHierarchyChange.next(!0),this.bsModalRef.hide()}closeTaskFinishedNotification(e){let t=this.taskFinishedNotifications.length;for(;t--;){e===this.taskFinishedNotifications[t].id&&this.taskFinishedNotifications.splice(t,1)}}setExistingTask(){this.uploader.getResumableFilesData().length>0&&(this.existingTask=!0)}isPageValid(e){if("CATEGORY"===e.type){if(null!=e.selection)return null!=e.selection.value&&e.selection.value.length>0||null!=e.selection.label&&e.selection.label.length>0&&((!this.hasField("platform")||null!=e.selection.platform&&0!==e.selection.platform.length)&&(!this.hasField("sensor")||null!=e.selection.sensor&&0!==e.selection.sensor.length))}else if("FILE"===e.type){if(null!=this.uploader){const e=this.uploader.getUploads();return null!=e&&e.length>0}}else if("SUMMARY"===e.type)return null==this.currentTask;return!0}updateCurrentPageLabel(){this.page.options.forEach(e=>{e.id===this.page.selection.value&&(this.page.selection.label=e.name)})}setIsNew(e){this.page.selection.isNew=e,e?this.page.selection.value=null:this.page.selection.label=null}handleAddMetadata(e){this.modalService.show(ce,{animated:!0,backdrop:!0,ignoreBackdropClick:!0,class:"upload-modal"}).content.init(e.collection)}handleNextPage(){if(this.page.index+1<this.pages.length){const e=this.pages[this.page.index+1];"CATEGORY"===this.page.type&&(this.updateCurrentPageLabel(),this.labels.push(this.page.selection.label)),"CATEGORY"===e.type?"FILE"===this.page.type?this.page=e:!this.page.selection.isNew&&null!=this.page.selection.value&&this.page.selection.value.length>0?this.service.getChildren(this.page.selection.value).then(t=>{e.options=t.filter(t=>t.type===e.selection.type),this.page=e}).catch(e=>{this.error(e)}):this.page=e:(this.page=e,this.modalStepConfig={steps:[{label:"Category",active:!0,enabled:!1},{label:"Final",active:!0,enabled:!0}]})}}handleBackPage(){if(this.page.index>0){const e=this.pages[this.page.index-1];"CATEGORY"===e.type&&(this.labels.splice(this.labels.length-1,1),this.modalStepConfig.steps.forEach(e=>{"category"===e.label.toLowerCase()&&!1===e.enabled&&(this.modalStepConfig={steps:[{label:"Category",active:!0,enabled:!0},{label:"Final",active:!0,enabled:!1}]})})),this.page=e}}handleUpload(){if(this.existingTask)this.uploader.uploadStoredFiles();else{const e=this.selections[this.selections.length-1];this.values.selections=JSON.stringify(this.selections),this.values.uploadTarget=this.metadataService.getUploadTarget(e.type),this.values.processUpload=this.processUpload,this.uploader.setParams(this.values),this.uploader.uploadStoredFiles()}}hasField(e){return this.metadataService.hasExtraField(this.page.selection.type,e)}removeUpload(e){let t=this;this.bsModalRef=this.modalService.show(U.a,{animated:!0,backdrop:!0,ignoreBackdropClick:!0}),this.bsModalRef.content.message="Are you sure you want to cancel the upload of ["+this.uploader.getResumableFilesData()[0].name+"]",this.bsModalRef.content.type="DANGER",this.bsModalRef.content.submitText="Cancel Upload",this.bsModalRef.content.onConfirm.subscribe(e=>{this.service.removeTask(this.uploader.getResumableFilesData()[0].uuid).then(()=>{localStorage.clear(),t.existingTask=!1,this.page=this.pages[0]}).catch(e=>{this.error(e)})})}updateProcessUpload(e){this.processUpload=e}countUpload(e){let t=0;e.uplodeCounterInterfal=setInterval((function(){t+=1;let c=Math.floor(t/3600),n=Math.floor(t%3600/60),i=Math.floor(t%60),s=n<10?"0"+c:c,a=n<10?"0"+n:n,o=i<10?"0"+i:i;e.uploadCounter=s+":"+a+":"+o}),1e3)}error(e){this.message=U.b.getMessageFromError(e)}canDeactivate(){return this.disabled}unloadNotification(e){this.disabled&&(e.returnValue="An upload is currently in progress. Are you sure you want to leave?")}}function Vt(e,t){if(1&e&&(n.kc(0,"div",3),n.kc(1,"div",4),n.kc(2,"strong"),n.Uc(3,"Error"),n.jc(),n.jc(),n.kc(4,"div",5),n.kc(5,"div"),n.kc(6,"p",6),n.Uc(7),n.jc(),n.jc(),n.jc(),n.jc()),2&e){const e=n.uc();n.Tb(7),n.Vc(e.message)}}function _t(e,t){if(1&e&&(n.kc(0,"li"),n.kc(1,"span"),n.Uc(2),n.jc(),n.jc()),2&e){const e=t.$implicit;n.Tb(2),n.Wc(" ",e.name,"")}}function zt(e,t){if(1&e){const e=n.lc();n.kc(0,"tr"),n.kc(1,"td",25),n.kc(2,"a",26),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc(3).handleDownloadFile(c)})),n.jc(),n.kc(3,"a",27),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc(3).handleDelete(c)})),n.jc(),n.jc(),n.kc(4,"td"),n.Uc(5),n.jc(),n.kc(6,"td"),n.Uc(7),n.jc(),n.jc()}if(2&e){const e=t.$implicit;n.Tb(5),n.Vc(e.name),n.Tb(2),n.Vc(e.lastModified)}}function Gt(e,t){1&e&&(n.Uc(0," Drag & Drop File "),n.kc(1,"button",28),n.sc("click",(function(){return(0,t.openFileSelector)()})),n.Uc(2,"Browse Files"),n.jc())}$t.ɵfac=function(e){return new(e||$t)(n.fc(D),n.fc(se),n.fc(E.b),n.fc(E.a),n.fc(n.E))},$t.ɵcmp=n.Zb({type:$t,selectors:[["upload-modal"]],viewQuery:function(e,t){var c;(1&e&&n.Yc(bt,!0),2&e)&&(n.Ic(c=n.tc())&&(t.content=c.first))},hostBindings:function(e,t){1&e&&n.sc("beforeunload",(function(e){return t.unloadNotification(e)}),!1,n.Kc)},decls:60,vars:16,consts:[["tabindex","-1","role","dialog",1,"modal-body"],["class","row error-container",4,"ngIf"],["class","row",4,"ngIf"],[1,"row",3,"hidden"],[1,"col-md-2"],[1,"col-md-8"],[4,"ngIf"],["class","panel panel-success","style","margin: 30px 0 30px 0;",4,"ngFor","ngForOf"],[1,"",3,"hidden"],[1,"well"],[1,"table"],["class","panel panel-warning","style","margin: 30px 0 30px 0;",4,"ngIf"],[1,"uploader-container",2,"margin-top","20px"],["uploader",""],[1,"modal-footer"],[1,"row"],[1,"col-md-12"],[1,"btn-holder",2,"text-align","right"],["type","button","role","button","aria-disabled","false",1,"btn","btn-default",2,"padding","4px 18px",3,"disabled","click"],[1,"ui-button-text"],["type","button btn btn-primary","class","btn btn-secondary",3,"disabled","click",4,"ngIf"],["type","button btn btn-primary","class","btn btn-primary",3,"disabled","click",4,"ngIf"],[1,"row","error-container"],[1,"label-holder"],[2,"color","#8c0000"],[1,"holder"],[1,"error-message"],[1,"list-group","list-group-horizontal"],[3,"stepConfig"],[1,"breadcrumb"],[4,"ngFor","ngForOf"],[1,"form-group"],[3,"for"],["class","form-group",4,"ngIf"],["required","",3,"name","ngModel","disabled","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["type","button btn btn-primary","class","btn btn-primary",3,"click",4,"ngIf"],[3,"value"],["type","button btn btn-primary",1,"btn","btn-primary",3,"click"],["autofocus","","name","label","type","input","required","",1,"form-control",3,"ngModel","placeholder","ngModelChange"],["for","platform",2,"margin-top","10px"],["name","platform","type","input","required","",3,"ngModel","ngModelChange"],["for","sensor",2,"margin-top","10px"],["name","sensor","type","input","required","",3,"ngModel","ngModelChange"],["class","form-group",4,"ngFor","ngForOf"],["for","outFileName"],["name","outFileName","type","input","placeholder","Output product name prefix...",1,"form-control",3,"ngModel","ngModelChange"],["label","Generate products from raw images",3,"value","valueChange"],["type","input","disabled","","required","",1,"form-control",3,"ngModel","name","ngModelChange"],[1,"panel","panel-warning",2,"margin","30px 0 30px 0"],[1,"panel-heading",2,"font-size","20px"],[1,"panel-body"],["type","button",1,"btn","btn-danger",2,"margin-top","20px",3,"click"],[1,"icon-upload","icon-white"],[1,"panel","panel-success",2,"margin","30px 0 30px 0"],[1,"fa","fa-times","btn","btn-close","pull-right",2,"min-width","20px","padding","0","line-height","27px",3,"click"],["type","button btn btn-primary",1,"btn","btn-secondary",3,"disabled","click"],["type","button btn btn-primary",1,"btn","btn-primary",3,"disabled","click"]],template:function(e,t){1&e&&(n.kc(0,"div"),n.kc(1,"div",0),n.Sc(2,kt,11,1,"div",1),n.Sc(3,vt,5,1,"div",2),n.Sc(4,yt,5,1,"div",2),n.Sc(5,At,8,4,"div",2),n.Sc(6,Pt,10,4,"div",2),n.kc(7,"div",3),n.gc(8,"div",4),n.kc(9,"div",5),n.Sc(10,Ft,15,0,"div",6),n.Sc(11,Lt,13,1,"div",7),n.kc(12,"div",8),n.kc(13,"div",9),n.kc(14,"h4"),n.Uc(15,"All files uploaded through the upload wizard must"),n.jc(),n.kc(16,"ul"),n.kc(17,"li"),n.Uc(18,"be compressed into a .zip or .tar.gz format "),n.jc(),n.kc(19,"li"),n.Uc(20,"not contain spaces or special characters such as <, >, -, +, =, !, @, #, $, %, ^, &, *, ?,/,\\ or apostrophes in any file name"),n.jc(),n.jc(),n.kc(21,"h4"),n.Uc(22," Supported File Formats "),n.jc(),n.kc(23,"table",10),n.kc(24,"thead"),n.kc(25,"tr"),n.kc(26,"th"),n.Uc(27,"Type"),n.jc(),n.kc(28,"th"),n.Uc(29,"Formats"),n.jc(),n.jc(),n.jc(),n.kc(30,"tbody"),n.kc(31,"tr"),n.kc(32,"td"),n.Uc(33,"RGB Image Data"),n.jc(),n.kc(34,"td"),n.Uc(35,"jpg, jpeg, png"),n.jc(),n.jc(),n.kc(36,"tr"),n.kc(37,"td"),n.Uc(38,"Multispectral Image Data"),n.jc(),n.kc(39,"td"),n.Uc(40,"tif"),n.jc(),n.jc(),n.kc(41,"tr"),n.kc(42,"td"),n.Uc(43,"Video"),n.jc(),n.kc(44,"td"),n.Uc(45,"mp4"),n.jc(),n.jc(),n.jc(),n.jc(),n.jc(),n.Sc(46,Rt,26,9,"div",11),n.gc(47,"div",12,13),n.jc(),n.jc(),n.gc(49,"div",4),n.jc(),n.jc(),n.kc(50,"div",14),n.kc(51,"div",15),n.kc(52,"div",16),n.kc(53,"div",17),n.kc(54,"button",18),n.sc("click",(function(){return t.close()})),n.kc(55,"span",19),n.Uc(56,"Close"),n.jc(),n.jc(),n.Sc(57,Nt,3,1,"button",20),n.Sc(58,Dt,3,1,"button",21),n.Sc(59,Et,3,1,"button",21),n.jc(),n.jc(),n.jc(),n.jc(),n.jc()),2&e&&(n.Tb(2),n.Ac("ngIf",null!=t.message&&t.message.length>0),n.Tb(1),n.Ac("ngIf",!t.existingTask),n.Tb(1),n.Ac("ngIf",!t.existingTask&&t.labels.length>0),n.Tb(1),n.Ac("ngIf","CATEGORY"===t.page.type),n.Tb(1),n.Ac("ngIf","SUMMARY"===t.page.type&&!t.existingTask&&null==t.currentTask),n.Tb(1),n.Ac("@fadeInOnEnter",void 0)("hidden","FILE"!==t.page.type&&"SUMMARY"!==t.page.type),n.Tb(3),n.Ac("ngIf",t.existingTask&&!t.currentTask),n.Tb(1),n.Ac("ngForOf",t.taskFinishedNotifications),n.Tb(1),n.Ac("hidden",!t.uploadVisible),n.Tb(34),n.Ac("ngIf",t.currentTask),n.Tb(8),n.Ac("disabled",t.disabled)("disabled",t.disabled),n.Tb(3),n.Ac("ngIf",!t.existingTask&&t.page.index>0),n.Tb(1),n.Ac("ngIf",!t.existingTask&&t.page.index<t.pages.length-1),n.Tb(1),n.Ac("ngIf",t.page.index===t.pages.length-1))},directives:[i.l,i.k,mt.a,a.p,a.o,a.h,a.k,a.l,a.q,a.a,J.a],pipes:[Fe.a],styles:[".list-group-horizontal[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%] {\n\tdisplay: inline-block;\n}\n\n.list-group-horizontal[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%] {\n\tmargin-bottom: 0;\n\tmargin-left: -4px;\n\tmargin-right: 0;\n\tborder-right-width: 0;\n}\n\n.list-group-horizontal[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%]:first-child {\n\tborder-top-right-radius: 0;\n\tborder-bottom-left-radius: 4px;\n}\n\n.list-group-horizontal[_ngcontent-%COMP%]   .list-group-item[_ngcontent-%COMP%]:last-child {\n\tborder-top-right-radius: 4px;\n\tborder-bottom-left-radius: 0;\n\tborder-right-width: 1px;\n}\n\n.list-group-item-success[_ngcontent-%COMP%] {\n\tcolor: #155724;\n\tbackground-color: #c3e6cb;\n}"],data:{animation:[Object(ne.c)(),Object(ne.d)()]}});const Wt=function(e,t,c){return{itemsPerPage:e,currentPage:t,totalItems:c}};function Bt(e,t){if(1&e){const e=n.lc();n.kc(0,"tab",17),n.sc("selectTab",(function(){n.Lc(e);const c=t.$implicit;return n.uc(2).onSelect(c)})),n.kc(1,"div",18),n.kc(2,"div",19),n.kc(3,"table",20),n.kc(4,"thead"),n.kc(5,"tr"),n.gc(6,"th",21),n.kc(7,"th",21),n.Uc(8,"Name"),n.jc(),n.kc(9,"th",21),n.Uc(10,"Date uploaded"),n.jc(),n.jc(),n.jc(),n.kc(11,"tbody",22),n.Sc(12,zt,8,2,"tr",10),n.vc(13,"paginate"),n.jc(),n.jc(),n.jc(),n.jc(),n.kc(14,"div",7),n.kc(15,"div",19),n.kc(16,"ngx-file-drop",23),n.sc("onFileDrop",(function(t){return n.Lc(e),n.uc(2).dropped(t)})),n.Sc(17,Gt,3,0,"ng-template",24),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=t.$implicit,c=n.uc(2);n.Ac("heading",e.name),n.Tb(12),n.Ac("ngForOf",n.xc(13,2,c.page.results,n.Gc(5,Wt,c.page.pageSize,c.page.pageNumber,c.page.count)))}}function qt(e,t){if(1&e){const e=n.lc();n.kc(0,"div"),n.kc(1,"div",7),n.kc(2,"div",8),n.kc(3,"h2"),n.Uc(4),n.jc(),n.jc(),n.jc(),n.kc(5,"div",7),n.kc(6,"div",8),n.kc(7,"ul",9),n.Sc(8,_t,3,1,"li",10),n.jc(),n.jc(),n.jc(),n.kc(9,"div",7),n.kc(10,"tabset",11),n.Sc(11,Bt,18,9,"tab",12),n.jc(),n.jc(),n.kc(12,"div",7),n.kc(13,"pagination-controls",13),n.sc("pageChange",(function(t){return n.Lc(e),n.uc().onPageChange(t)})),n.jc(),n.jc(),n.kc(14,"div",7),n.kc(15,"div",14),n.kc(16,"button",15),n.sc("click",(function(){return n.Lc(e),n.uc().bsModalRef.hide()})),n.Uc(17,"Close"),n.jc(),n.kc(18,"button",16),n.sc("click",(function(){return n.Lc(e),n.uc().handleDownload()})),n.Uc(19,"Download all"),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc();n.Tb(4),n.Vc(e.entity.name),n.Tb(4),n.Ac("ngForOf",e.previous),n.Tb(3),n.Ac("ngForOf",e.folders)}}class Ht{constructor(e,t,c){this.service=e,this.modalService=t,this.bsModalRef=c,this.previous=[],this.folders=[],this.page=new B}ngOnInit(){this.page.count=0,this.page.pageNumber=1,this.page.pageSize=10,this.page.results=[]}init(e,t,c){this.entity=e,this.folders=t,this.previous=[...c],this.previous.length>0&&this.previous[this.previous.length-1].id!==this.entity.id&&this.previous.push(this.entity),this.folders.length>0&&this.onSelect(this.folders[0])}onPageChange(e){this.getData(this.folder.component,this.folder.name,e,this.page.pageSize)}onSelect(e){this.page.results=[],this.folder=e,this.getData(e.component,e.name,1,this.page.pageSize)}refresh(){this.page.results=[],this.getData(this.folder.component,this.folder.name,this.page.pageNumber,this.page.pageSize)}getData(e,t,c,n){this.service.getObjects(e,t,c,n).then(e=>{this.page=e})}handleDownload(){window.location.href=acp+"/project/download-all?id="+this.folder.component+"&key="+this.folder.name}handleDownloadFile(e){window.location.href=acp+"/project/download?id="+this.folder.component+"&key="+e.key}dropped(e){for(const t of e)if(t.fileEntry.isFile){t.fileEntry.file(e=>{this.service.upload(this.folder.component,this.folder.name,e).then(()=>{this.refresh()})})}else{const e=t.fileEntry;console.log(t.relativePath,e)}}handleDelete(e){let t=this.modalService.show(U.a,{animated:!0,backdrop:!0,ignoreBackdropClick:!0});t.content.message="Are you sure you want to delete the file ["+e.name+"]?",t.content.type="DANGER",t.content.submitText="Delete",t.content.onConfirm.subscribe(()=>{this.remove(e)})}remove(e){this.service.removeObject(e.component,e.key).then(()=>{this.refresh()})}error(e){this.message=U.b.getMessageFromError(e)}}Ht.ɵfac=function(e){return new(e||Ht)(n.fc(D),n.fc(E.b),n.fc(E.a))},Ht.ɵcmp=n.Zb({type:Ht,selectors:[["accessible-support-modal"]],decls:4,vars:2,consts:[[1,"modal-body"],["class","error-container",4,"ngIf"],[4,"ngIf"],[1,"error-container"],[1,"label-holder"],[1,"holder"],[1,"error-message"],[1,"row"],[1,"col-md-12"],[1,"breadcrumb",2,"margin-bottom","10px"],[4,"ngFor","ngForOf"],[1,"nav-full-width"],[3,"heading","selectTab",4,"ngFor","ngForOf"],[3,"pageChange"],[1,"btn-holder",2,"text-align","right","margin","20px 20px 10px 20px"],["type","button",1,"btn","btn-default",3,"click"],["type","button",1,"btn","btn-secondary",2,"margin-left","5px",3,"click"],[3,"heading","selectTab"],[1,"row","image-list-container"],[1,"col-sm-12"],[1,"table","table-striped"],["scope","col"],[1,"upload-name-style"],["dropZoneLabel","Drop files here",3,"onFileDrop"],["ngx-file-drop-content-tmp",""],[1,"button-column"],["title","Download",1,"fa","fa-download",3,"click"],["title","Remove",1,"fa","fa-trash-alt","ico-remove",2,"margin-left","5px",3,"click"],["type","button",3,"click"]],template:function(e,t){1&e&&(n.kc(0,"div",0),n.kc(1,"div"),n.Sc(2,Vt,8,1,"div",1),n.Sc(3,qt,20,3,"div",2),n.jc(),n.jc()),2&e&&(n.Tb(2),n.Ac("ngIf",null!=t.message),n.Tb(1),n.Ac("ngIf",null!=t.entity))},directives:[i.l,i.k,u.c,h.c,u.a,o.a,o.c],pipes:[h.b],encapsulation:2});var Jt=c(342),Zt=c(50);const Yt=["staticTabs"],Kt=["confirmTemplate"];function Qt(e,t){1&e&&(n.kc(0,"div",3),n.kc(1,"div",30),n.kc(2,"h3",31),n.Uc(3,"IDM Sites"),n.jc(),n.jc(),n.jc())}function Xt(e,t){if(1&e){const e=n.lc();n.kc(0,"a",35),n.sc("click",(function(){n.Lc(e);const t=n.uc().$implicit;return n.uc(2).back(t)})),n.Uc(1),n.jc()}if(2&e){const e=n.uc().$implicit;n.Tb(1),n.Wc(" ",e.name,"")}}function ec(e,t){if(1&e&&(n.kc(0,"span"),n.kc(1,"b"),n.Uc(2),n.jc(),n.jc()),2&e){const e=n.uc().$implicit;n.Tb(2),n.Vc(e.name)}}const tc=function(e){return{active:e}};function cc(e,t){if(1&e&&(n.kc(0,"li",37),n.Sc(1,Xt,2,1,"a",38),n.Sc(2,ec,3,1,"span",26),n.jc()),2&e){const e=t.last;n.Ac("ngClass",n.Ec(3,tc,e)),n.Tb(1),n.Ac("ngIf",!e),n.Tb(1),n.Ac("ngIf",e)}}function nc(e,t){if(1&e){const e=n.lc();n.kc(0,"div",3),n.kc(1,"div",32),n.kc(2,"ul",33),n.kc(3,"li"),n.gc(4,"i",34),n.kc(5,"a",35),n.sc("click",(function(){return n.Lc(e),n.uc().back(null)})),n.Uc(6,"IDM Sites"),n.jc(),n.jc(),n.Sc(7,cc,3,5,"li",36),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc();n.Tb(7),n.Ac("ngForOf",e.breadcrumbs)}}function ic(e,t){1&e&&(n.kc(0,"span"),n.kc(1,"h4"),n.gc(2,"i",40),n.Uc(3," Loading Sites "),n.jc(),n.jc())}function sc(e,t){1&e&&(n.kc(0,"span"),n.kc(1,"h4"),n.Uc(2,"No Sites in this area."),n.jc(),n.kc(3,"p"),n.Uc(4," Zoom out to find sites in other areas of the map. "),n.jc(),n.jc())}function ac(e,t){if(1&e&&(n.kc(0,"div",39),n.Sc(1,ic,4,0,"span",26),n.Sc(2,sc,5,0,"span",26),n.jc()),2&e){const e=n.uc();n.Ac("@fadeInOnEnter",void 0),n.Tb(1),n.Ac("ngIf",e.loadingSites),n.Tb(1),n.Ac("ngIf",!e.loadingSites)}}function oc(e,t){1&e&&(n.kc(0,"div",39),n.kc(1,"h4"),n.Uc(2,"No data at this level."),n.jc(),n.kc(3,"p"),n.Uc(4," Create data containers as part of the upload process. "),n.jc(),n.jc()),2&e&&n.Ac("@fadeInOnEnter",void 0)}function lc(e,t){if(1&e){const e=n.lc();n.kc(0,"span",48),n.kc(1,"a",49),n.sc("click",(function(t){n.Lc(e);const c=n.uc(2).$implicit;return n.uc().handleEdit(c,t)})),n.jc(),n.kc(2,"a",50),n.sc("click",(function(t){n.Lc(e);const c=n.uc(2).$implicit;return n.uc().handleDelete(c,t)})),n.jc(),n.jc()}}function rc(e,t){if(1&e){const e=n.lc();n.kc(0,"div",44),n.sc("click",(function(t){n.Lc(e);const c=n.uc().$implicit;return n.uc().select(c,null,t)}))("mouseenter",(function(t){n.Lc(e);const c=n.uc().$implicit;return n.uc().onListEntityHover(t,c)}))("mouseleave",(function(){return n.Lc(e),n.uc(2).onListEntityHoverOff()})),n.kc(1,"div",45),n.kc(2,"div"),n.kc(3,"h4",46),n.Uc(4),n.jc(),n.kc(5,"span"),n.kc(6,"span"),n.kc(7,"b"),n.Uc(8),n.jc(),n.Uc(9),n.jc(),n.Sc(10,lc,3,0,"span",47),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc().$implicit,t=n.uc();n.Ac("@fadeInOnEnter",void 0)("ngClass",n.Ec(6,tc,t.hoverFeatureId===e.id)),n.Tb(4),n.Wc(" ",e.name," "),n.Tb(4),n.Vc(e.numberOfChildren),n.Tb(1),n.Wc(" ",t.getMetadata(e).childLabel,""),n.Tb(1),n.Ac("ngIf","folder"!==e.type)}}function dc(e,t){if(1&e){const e=n.lc();n.kc(0,"span",59),n.kc(1,"a",49),n.sc("click",(function(t){n.Lc(e);const c=n.uc().$implicit;return n.uc(3).handleEdit(c,t)})),n.jc(),n.kc(2,"a",50),n.sc("click",(function(t){n.Lc(e);const c=n.uc().$implicit;return n.uc(3).handleDelete(c,t)})),n.jc(),n.jc()}}function uc(e,t){if(1&e){const e=n.lc();n.kc(0,"div",57),n.sc("click",(function(c){n.Lc(e);const i=t.$implicit,s=n.uc(2).$implicit;return n.uc().select(i,s,c)})),n.Uc(1),n.Sc(2,dc,3,0,"span",58),n.jc()}if(2&e){const e=t.$implicit;n.Tb(1),n.Wc(" ",e.name," "),n.Tb(1),n.Ac("ngIf","folder"!==e.type)}}const pc=function(e){return{"fa-rotate-270":e}};function hc(e,t){if(1&e){const e=n.lc();n.kc(0,"div",51),n.sc("click",(function(t){n.Lc(e);const c=n.uc().$implicit;return n.uc().select(c,null,t)})),n.kc(1,"div",52),n.kc(2,"i",53),n.sc("click",(function(t){n.Lc(e);const c=n.uc().$implicit;return n.uc().handleExpand(c,t)})),n.jc(),n.kc(3,"h4",54),n.Uc(4),n.jc(),n.kc(5,"p"),n.kc(6,"b"),n.Uc(7),n.jc(),n.Uc(8),n.jc(),n.kc(9,"div",55),n.Sc(10,uc,3,2,"div",56),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc().$implicit,t=n.uc();n.Ac("@fadeInOnEnter",void 0),n.Tb(2),n.Ac("ngClass",n.Ec(7,pc,e.active)),n.Tb(2),n.Vc(e.name),n.Tb(3),n.Vc(e.numberOfChildren),n.Tb(1),n.Wc(" ",t.getMetadata(e).childLabel,""),n.Tb(1),n.Ac("collapse",!e.active),n.Tb(1),n.Ac("ngForOf",e.children)}}function gc(e,t){if(1&e&&(n.kc(0,"div",41),n.Sc(1,rc,11,8,"div",42),n.Sc(2,hc,11,9,"div",43),n.jc()),2&e){const e=t.$implicit,c=n.uc();n.Ac("@fadeInOnEnter",void 0),n.Tb(1),n.Ac("ngIf",c.getMetadata(e).root),n.Tb(1),n.Ac("ngIf",!c.getMetadata(e).root)}}function fc(e,t){if(1&e){const e=n.lc();n.kc(0,"div",41),n.kc(1,"div",60),n.kc(2,"div",52),n.kc(3,"h4",54),n.Uc(4,"Supporting Data"),n.jc(),n.kc(5,"div",14),n.kc(6,"div",61),n.kc(7,"a",62),n.sc("click",(function(c){n.Lc(e);const i=t.$implicit;return n.uc().select(i,null,c)})),n.Uc(8),n.jc(),n.jc(),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=t.$implicit;n.Tb(1),n.Ac("@fadeInOnEnter",void 0),n.Tb(7),n.Wc(" ",e.name," ")}}function mc(e,t){if(1&e){const e=n.lc();n.kc(0,"tab",63),n.kc(1,"div",13),n.kc(2,"product-panel",64),n.sc("toggleMapOrtho",(function(t){return n.Lc(e),n.uc().handleMapOrtho(t)}))("toggleMapDem",(function(t){return n.Lc(e),n.uc().handleMapDem(t)})),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc();n.Tb(2),n.Ac("id",e.current.id)}}function bc(e,t){if(1&e){const e=n.lc();n.kc(0,"div",65),n.kc(1,"div",66),n.kc(2,"button",67),n.sc("click",(function(){return n.Lc(e),n.uc().handleUploadFile()})),n.Uc(3,"Upload"),n.jc(),n.jc(),n.jc()}}function kc(e,t){if(1&e){const e=n.lc();n.kc(0,"div",65),n.kc(1,"div",66),n.kc(2,"button",67),n.sc("click",(function(){return n.Lc(e),n.uc().handleCreate(null,null)})),n.Uc(3,"Add new site"),n.jc(),n.jc(),n.jc()}}function vc(e,t){if(1&e){const e=n.lc();n.kc(0,"alert",73),n.sc("onClosed",(function(){n.Lc(e);const t=n.uc().index;return n.uc().handleCloseToast(t)})),n.kc(1,"strong"),n.Uc(2),n.jc(),n.Uc(3),n.kc(4,"a",62),n.sc("click",(function(){n.Lc(e);const t=n.uc().$implicit;return n.uc().handleViewSite(t.collection)})),n.Uc(5,"Goto the collection view"),n.jc(),n.jc()}if(2&e){const e=n.uc().$implicit;n.Ac("dismissible",!0),n.Tb(2),n.Wc("Upload ",e.status,""),n.Tb(1),n.Wc(" for ",e.collectionLabel,". ")}}function jc(e,t){if(1&e){const e=n.lc();n.kc(0,"alert",74),n.sc("onClosed",(function(){n.Lc(e);const t=n.uc().index;return n.uc().handleCloseToast(t)})),n.kc(1,"strong"),n.Uc(2),n.jc(),n.Uc(3),n.kc(4,"a",75),n.Uc(5,"task page"),n.jc(),n.Uc(6," for more details. "),n.jc()}if(2&e){const e=n.uc().$implicit;n.Ac("dismissible",!0),n.Tb(2),n.Wc("Upload ",e.status,""),n.Tb(1),n.Wc(" for ",e.collectionLabel,". Task completed with warnings. See the ")}}function yc(e,t){if(1&e){const e=n.lc();n.kc(0,"alert",76),n.sc("onClosed",(function(){n.Lc(e);const t=n.uc().index;return n.uc().handleCloseToast(t)})),n.kc(1,"strong"),n.Uc(2),n.jc(),n.Uc(3),n.kc(4,"a",75),n.Uc(5,"task page"),n.jc(),n.Uc(6," for more details. "),n.jc()}if(2&e){const e=n.uc().$implicit;n.Ac("dismissible",!0),n.Tb(2),n.Wc("Upload ",e.status,""),n.Tb(1),n.Wc(" for ",e.collectionLabel,". Task completed with errors. See the ")}}function Tc(e,t){if(1&e){const e=n.lc();n.kc(0,"alert",77),n.sc("onClosed",(function(){n.Lc(e);const t=n.uc().index;return n.uc().handleCloseToast(t)})),n.kc(1,"strong"),n.Uc(2),n.jc(),n.Uc(3),n.jc()}if(2&e){const e=n.uc().$implicit;n.Ac("dismissible",!0),n.Tb(2),n.Wc("Upload ",e.status,""),n.Tb(1),n.Wc(" for ",e.collectionLabel,". ")}}function Sc(e,t){if(1&e&&(n.kc(0,"div",68),n.Sc(1,vc,6,3,"alert",69),n.Sc(2,jc,7,3,"alert",70),n.Sc(3,yc,7,3,"alert",71),n.Sc(4,Tc,4,3,"alert",72),n.jc()),2&e){const e=t.$implicit;n.Tb(1),n.Ac("ngIf","Complete"===e.status&&0===e.actions.length),n.Tb(1),n.Ac("ngIf","Complete"===e.status&&0!==e.actions.length),n.Tb(1),n.Ac("ngIf","Failed"===e.status),n.Tb(1),n.Ac("ngIf","Failed"!==e.status&&"Complete"!==e.status)}}function Cc(e,t){1&e&&n.gc(0,"i",78)}function wc(e,t){if(1&e){const e=n.lc();n.kc(0,"div",80),n.kc(1,"input",81),n.sc("change",(function(){n.Lc(e);const c=t.$implicit;return n.uc(2).handleStyle(c)})),n.jc(),n.kc(2,"label",82),n.Uc(3),n.jc(),n.jc()}if(2&e){const e=t.$implicit;n.Tb(1),n.Ac("value",e.id)("checked",e.selected),n.Tb(2),n.Vc(e.label)}}function Mc(e,t){if(1&e&&(n.kc(0,"div"),n.Sc(1,wc,4,3,"div",79),n.jc()),2&e){const e=n.uc();n.Tb(1),n.Ac("ngForOf",e.baseLayers)}}function Oc(e,t){1&e&&(n.kc(0,"span"),n.gc(1,"i",84),n.jc())}function Ic(e,t){1&e&&(n.kc(0,"span"),n.gc(1,"i",85),n.jc())}function Uc(e,t){if(1&e&&(n.kc(0,"span"),n.Uc(1),n.jc()),2&e){const e=t.$implicit;n.Tb(1),n.Wc(" ",e.label," / ")}}function Ac(e,t){if(1&e&&(n.Sc(0,Oc,2,0,"span",26),n.Sc(1,Ic,2,0,"span",26),n.kc(2,"span"),n.Sc(3,Uc,2,1,"span",83),n.jc(),n.kc(4,"b"),n.Uc(5),n.jc()),2&e){const e=t.match;n.Ac("ngIf",null==e.item.filename),n.Tb(1),n.Ac("ngIf",null!=e.item.filename),n.Tb(2),n.Ac("ngForOf",e.item.hierarchy),n.Tb(2),n.Vc(e.item.label)}}const xc=function(){return{standalone:!0}};class Pc{constructor(e,t,c,n,i){this.service=e,this.authService=t,this.mapService=c,this.modalService=n,this.metadataService=i,this.userName="",this.search="",this.nodes=[],this.supportingData=[],this.breadcrumbs=[],this.admin=!1,this.worker=!1,this.active=!1,this.loadingSites=!0,this.baseLayers=[{label:"Outdoors",id:"outdoors-v11",selected:!0},{label:"Satellite",id:"satellite-v9"},{label:"Streets",id:"streets-v11"}],this.layers=[],this.baselayerIconHover=!1,this.tasks=[],this.subject=new W.b,this.subject.pipe(Object(x.a)(300),Object(P.a)()).subscribe(e=>this.handleExtentChange(e)),this.dataSource=k.a.create(e=>{this.mapService.mbForwardGeocode(this.search).then(t=>{const c=t.features;this.service.searchEntites(this.search).then(t=>{c.forEach(e=>{let c={id:e.id,hierarchy:[],label:e.place_name,center:e.center,source:"MAPBOX"};t.push(c)}),e.next(t)})})})}ngOnInit(){this.admin=this.authService.isAdmin(),this.worker=this.authService.isWorker(),this.userName=this.service.getCurrentUser();let e="wss://"+window.location.hostname+(window.location.port?":"+window.location.port:"")+acp;this.notifier=Object(Jt.a)(e+"/websocket/notify"),this.notifier.subscribe(e=>{"UPLOAD_JOB_CHANGE"===e.type&&this.tasks.push(e.content)})}ngOnDestroy(){this.map.remove(),this.notifier.complete()}ngAfterViewInit(){this.map=new f.Map({container:"map",style:"mapbox://styles/mapbox/outdoors-v11",zoom:2,attributionControl:!1,center:[-78.880453,42.897852]}),this.map.on("load",()=>{this.initMap()})}initMap(){this.map.on("style.load",()=>{this.addLayers(),this.refreshMapPoints(!1)}),this.addLayers(),this.refreshMapPoints(!0),this.map.addControl(new f.NavigationControl),this.map.addControl(new f.AttributionControl({compact:!0}),"bottom-left"),this.map.on("mousemove",e=>{let t=e.lngLat.wrap(),c="Lat: "+t.lat+" Long: "+t.lng;document.getElementById("mousemove-panel").textContent=c;let n=this.map.queryRenderedFeatures(e.point,{layers:["points"]});if(null==this.current)if(n.length>0){let e=n[0].properties.oid;this.map.setFilter("hover-points",["all",["==","oid",e]]),this.highlightListItem(e)}else this.map.setFilter("hover-points",["all",["==","oid","NONE"]]),this.clearHighlightListItem()}),this.map.on("zoomend",e=>{this.subject.next(e)}),this.map.on("moveend",e=>{this.subject.next(e)}),this.map.on("dblclick",e=>{let t=this.map.queryRenderedFeatures(e.point,{layers:["points"]});if(t.length>0){let e=t[0].properties.oid;this.handleViewSite(e)}}),document.getElementById("navigator-left-sidebar").addEventListener("mouseenter",(function(){document.getElementById("mousemove-panel").textContent=""}))}addLayers(){this.map.addSource("sites",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"points",type:"circle",source:"sites",paint:{"circle-radius":10,"circle-color":"#800000","circle-stroke-width":2,"circle-stroke-color":"#FFFFFF"}}),this.map.addLayer({id:"hover-points",type:"circle",source:"sites",paint:{"circle-radius":13,"circle-color":"#cf0000","circle-stroke-width":2,"circle-stroke-color":"#FFFFFF"},filter:["all",["==","id","NONE"]]}),this.map.addLayer({id:"points-label",source:"sites",type:"symbol",paint:{"text-color":"black","text-halo-color":"#fff","text-halo-width":2},layout:{"text-field":"{name}","text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[0,.6],"text-anchor":"top","text-size":12}}),this.layers.forEach(e=>{e.isMapped&&this.addImageLayer(e)})}handleExtentChange(e){if(null==this.current){const e=this.map.getBounds();this.isValidBounds(e)&&(this.loadingSites=!0,this.service.roots(null,e).then(e=>{this.nodes=e,this.loadingSites=!1}))}}isValidBounds(e){const t=e.getNorthEast(),c=e.getSouthWest();return!(Math.abs(t.lng)>180||Math.abs(c.lng)>180)&&!(Math.abs(t.lat)>90||Math.abs(c.lat)>90)}refreshMapPoints(e){this.mapService.features().then(t=>{this.map.getSource("sites").setData(t.features),e&&(this.allPointsBounds=new f.LngLatBounds([t.bbox[0],t.bbox[1]],[t.bbox[2],t.bbox[3]]),this.map.fitBounds(this.allPointsBounds,{padding:50}))})}isData(e){return"Site"!==e.data.type&&("Project"!==e.data.type&&("Mission"!==e.data.type&&("Collection"!==e.data.type&&"Imagery"!==e.data.type)))}handleOnUpdateData(){}handleCloseToast(e){this.tasks.splice(e,1)}handleUploadFile(){this.bsModalRef=this.modalService.show($t,{animated:!0,backdrop:!0,ignoreBackdropClick:!0,class:"upload-modal"}),this.bsModalRef.content.init(this.breadcrumbs),this.bsModalRef.content.onUploadComplete.subscribe(e=>{this.service.getItems(this.current.id,null).then(e=>{this.setNodes(e)})})}handleCreate(e,t){let c=null!=e?e.id:null;this.service.newChild(c,t).then(t=>{this.bsModalRef=this.modalService.show(pt,{animated:!0,backdrop:!0,ignoreBackdropClick:!0,class:"upload-modal"}),this.bsModalRef.content.init(!0,this.userName,this.admin,t.item,t.attributes,this.map.getCenter(),this.map.getZoom()),null!=e&&(this.bsModalRef.content.parentId=e.id),this.bsModalRef.content.onNodeChange.subscribe(t=>{null!=e||(0==this.breadcrumbs.length&&this.nodes.push(t),this.refreshMapPoints(!1))})})}zoomToFeature(e){null!=e.geometry&&this.map.flyTo({center:e.geometry.coordinates})}handleEdit(e,t){t.stopPropagation(),this.service.edit(e.id).then(t=>{this.bsModalRef=this.modalService.show(pt,{animated:!0,backdrop:!0,ignoreBackdropClick:!0,class:"edit-modal"}),this.bsModalRef.content.init(!1,this.userName,this.admin,t.item,t.attributes,this.map.getCenter(),this.map.getZoom()),this.bsModalRef.content.onNodeChange.subscribe(t=>{t.children=e.children,t.active=e.active,this.refreshEntity(t,this.nodes),this.refreshEntity(t,this.breadcrumbs),this.nodes.forEach(e=>{this.refreshEntity(t,e.children)}),this.metadataService.getMetadata(t).root&&this.refreshMapPoints(!1)})})}refreshEntity(e,t){if(null!=t){let c=t.findIndex(t=>t.id===e.id);-1!==c&&(t[c]=e)}}handleDownloadAll(e){window.location.href=acp+"/project/download-all?id="+e.component+"&key="+e.name}handleDelete(e,t){t.stopPropagation();let c="<b>IMPORTANT:</b> ["+e.name+"] will be deleted along with all underlying data including all files in Collections and Accessible Support";"Collection"===e.type&&(c="<b>IMPORTANT:</b> ["+e.name+"] will be deleted along with all underlying data including all files."),c+=" This can <b>NOT</b> be undone",this.bsModalRef=this.modalService.show(I.a,{animated:!0,backdrop:!0,ignoreBackdropClick:!0}),this.bsModalRef.content.message="Are you sure you want to delete ["+e.name+"]?",this.bsModalRef.content.subText=c,this.bsModalRef.content.data=e,this.bsModalRef.content.type="DANGER",this.bsModalRef.content.submitText="Delete",this.bsModalRef.content.onConfirm.subscribe(e=>{this.remove(e)})}remove(e){this.service.remove(e.id).then(()=>{this.nodes=this.nodes.filter(t=>t.id!==e.id),this.nodes.forEach(t=>{null!=t.children&&(t.children=t.children.filter(t=>t.id!==e.id),t.numberOfChildren=t.children.length)}),"Site"===e.type&&this.refreshMapPoints(!1)})}handleDownload(e){window.location.href=acp+"/project/download?id="+e.component+"&key="+e.key}handleImageDownload(e){window.location.href=acp+"/project/download?id="+e.component+"&key="+e.key}handleStyle(e){this.baseLayers.forEach(e=>{e.selected=!1}),e.selected=!0,this.map.setStyle("mapbox://styles/mapbox/"+e.id)}highlightMapFeature(e){this.map.setFilter("hover-points",["all",["==","oid",e]])}clearHighlightMapFeature(){this.map.setFilter("hover-points",["all",["==","oid","NONE"]])}onListEntityHover(e,t){null==this.current&&this.highlightMapFeature(t.id)}onListEntityHoverOff(){this.clearHighlightMapFeature()}highlightListItem(e){this.nodes.forEach(t=>{t.id===e&&(this.hoverFeatureId=e)})}clearHighlightListItem(){this.hoverFeatureId&&this.nodes.forEach(e=>{e.id===this.hoverFeatureId&&(this.hoverFeatureId=null)})}handleClick(e){let t=e.item;if(t.center)this.map.flyTo({center:t.center,zoom:18});else{const e=t.hierarchy.length-1,c=t.hierarchy[e];this.handleViewSite(c.id)}}handleViewSite(e){this.service.view(e).then(e=>{const t=e.item,c=e.breadcrumbs;if(this.getMetadata(t).leaf)this.breadcrumbs=c,this.current=c[c.length-1],this.nodes=this.current.children,this.select(t,null,null);else{const e=c.length>0?c[c.length-1]:null;this.breadcrumbs=c,this.select(t,e,null)}})}handleMapOrtho(e){const t=this.getLayerByClassification("ORTHO",e);if(null!=t&&null!=t.key)if(null!=this.map.getLayer(t.key))this.map.removeLayer(t.key),this.map.removeSource(t.key),t.isMapped=!1,e.orthoMapped=!1;else if(this.addImageLayer(t),t.isMapped=!0,e.orthoMapped=!0,null!=e.boundingBox){let t=e.boundingBox,c=new f.LngLatBounds([t[0],t[2]],[t[1],t[3]]);this.map.fitBounds(c,{padding:50})}}getLayerByClassification(e,t){let c=t.layers.length;for(let n=0;n<c;++n){let c=t.layers[n];if(c.classification===e)return c}return null}handleMapDem(e){const t=this.getLayerByClassification("DEM_DSM",e);if(null!=t&&null!=t.key)if(null!=this.map.getLayer(t.key))this.map.removeLayer(t.key),this.map.removeSource(t.key),t.isMapped=!1,e.demMapped=!1;else if(this.addImageLayer(t),t.isMapped=!0,e.demMapped=!0,null!=e.boundingBox){let t=e.boundingBox,c=new f.LngLatBounds([t[0],t[2]],[t[1],t[3]]);this.map.fitBounds(c,{padding:50})}}addImageLayer(e){const t=encodeURI(e.workspace),c=encodeURI(e.workspace+":"+e.key);this.map.addLayer({id:e.key,type:"raster",source:{type:"raster",tiles:["/geoserver/"+t+"/wms?layers="+c+"&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&srs=EPSG:3857&transparent=true&width=256&height=256"],tileSize:256},paint:{}},"points")}handleGoto(){var e=new f.LngLatBounds([-111.12439336274211,39.32066259372583,-111.12342302258116,39.32107716199166]);this.map.fitBounds(e)}getMetadata(e){return this.metadataService.getMetadata(e)}select(e,t,c){if(null!=c&&c.stopPropagation(),null!=e&&null!=e.geometry&&"Point"===e.geometry.type&&this.map.easeTo({center:e.geometry.coordinates,zoom:8}),this.metadataService.getMetadata(e).leaf){const c=[...this.breadcrumbs];null!=t&&c.push(t),this.metadataService.getTypeContainsFolders(e)?this.service.getItems(e.id,null).then(t=>{this.showLeafModal(e,t,c)}):this.showLeafModal(this.current,[e],c)}else"object"===e.type||this.service.getItems(e.id,null).then(c=>{this.current=e,null!=t&&this.addBreadcrumb(t),this.addBreadcrumb(e),this.setNodes(c)})}addBreadcrumb(e){0!=this.breadcrumbs.length&&this.breadcrumbs[this.breadcrumbs.length-1].id===e.id||this.breadcrumbs.push(e)}handleExpand(e,t){null!=t&&t.stopPropagation(),null==e.children||0==e.children.length?this.service.getItems(e.id,null).then(t=>{e.children=t,this.expand(e)}):(e.children=[],e.active=!1)}handleGotoSite(e){const t=e.entities[e.entities.length-1],c=e.entities;this.service.getItems(t.id,null).then(e=>{this.showLeafModal(t,e,c)})}back(e){null!=e?(null!=e.geometry&&"Point"===e.geometry.type&&this.map.easeTo({center:e.geometry.coordinates,zoom:8}),this.service.getItems(e.id,null).then(t=>{var c=this.breadcrumbs.findIndex(t=>t.id===e.id);this.current=e,this.breadcrumbs.splice(c+1),this.setNodes(t)})):this.breadcrumbs.length>0&&(this.loadingSites=!0,this.service.roots(null,null).then(e=>{this.loadingSites=!1,this.breadcrumbs=[],this.setNodes(e),this.staticTabs.tabs[0].active=!0,this.map.fitBounds(this.allPointsBounds,{padding:50});let t=this;window.setTimeout((function(){t.current=null}),500)}))}expand(e){e.active=!0,this.current=e}setNodes(e){this.nodes=[],this.supportingData=[],e.forEach(e=>{"folder"===e.type?this.supportingData.push(e):this.nodes.push(e)})}showLeafModal(e,t,c){"Mission"===e.type?(this.bsModalRef=this.modalService.show(Ht,{animated:!0,backdrop:!0,ignoreBackdropClick:!0,class:"leaf-modal modal-lg"}),this.bsModalRef.content.init(e,t,c)):(this.bsModalRef=this.modalService.show(xe,{animated:!0,backdrop:!0,ignoreBackdropClick:!0,class:"leaf-modal modal-lg"}),this.bsModalRef.content.init(e,t,c))}}Pc.ɵfac=function(e){return new(e||Pc)(n.fc(D),n.fc(N.a),n.fc(y),n.fc(E.b),n.fc(se))},Pc.ɵcmp=n.Zb({type:Pc,selectors:[["projects"]],viewQuery:function(e,t){var c;(1&e&&(n.Yc(Yt,!0),n.Yc(Kt,!0)),2&e)&&(n.Ic(c=n.tc())&&(t.staticTabs=c.first),n.Ic(c=n.tc())&&(t.confirmTemplate=c.first))},decls:40,vars:20,consts:[["id","navigator-header-container"],[3,"title"],["id","app-container",1,"container-fluid",2,"background","#f7f7f7"],[1,"row"],["id","navigator-left-sidebar",1,"col-md-3","lw-inner-col"],[1,"col-md-12"],["class","row",4,"ngIf"],[1,"location-management-widget-section"],["type","text","placeholder","Search...","typeaheadOptionField","label",1,"form-control","search-input",3,"ngModel","typeaheadAsync","typeahead","typeaheadOptionsLimit","typeaheadItemTemplate","ngModelOptions","ngModelChange","typeaheadOnSelect","keydown.enter"],[1,"col-md-12",2,"background","#f7f7f7","padding","0","height","100%"],[1,"nav-full-width"],["staticTabs",""],["heading","Data"],["id","hierarchy-tree-container",1,"location-management-widget-section","location-management-list-container",2,"height","calc(100vh - 296px)","overflow-y","auto"],[1,"list-group"],["style","padding: 20px;text-align: center;color: grey;",4,"ngIf"],["class","list-group-item",4,"ngFor","ngForOf"],["heading","Products",4,"ngIf"],[1,"sidebar-footer"],["class","row","style","background:white;",4,"ngIf"],["id","site-explorer-map",1,"col-md-9"],[2,"position","absolute","z-index","5","margin-left","100px","margin-top","10px"],["class","idm-toast",4,"ngFor","ngForOf"],[1,"base-layer-panel"],[1,"layer-toggle",2,"cursor","pointer","background","#fff","padding","8px","border-radius","4px",3,"mouseenter","mouseleave"],["class","fas fa-layer-group","style","vertical-align:middle; font-size: 18px;",4,"ngIf"],[4,"ngIf"],["id","mousemove-panel",1,"mapboxgl-ctrl-bottom-right",2,"background","rgba(255, 255, 255, .5)","right","0","padding","0 5px 0 5px","bottom","0px"],["id","map",1,"map-view-port"],["bsItemTemplate",""],[1,"col-md-6",2,"height","64px"],[2,"font-weight","bold"],[1,"col-md-12",2,"height","65px","overflow","auto"],[1,"breadcrumb",2,"background-color","white","vertical-align","middle","line-height","2"],["aria-hidden","true",1,"fa","fa-angle-left","breadcrumb-back-ico"],[2,"color","#007276",3,"click"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],["style","color: #007276;",3,"click",4,"ngIf"],[2,"padding","20px","text-align","center","color","grey"],["aria-hidden","true",1,"fa","fa-spinner","fa-spin"],[1,"list-group-item"],["style","border-left: solid 15px;","class","card card-default clickable",3,"ngClass","click","mouseenter","mouseleave",4,"ngIf"],["class","card card-default clickable",3,"click",4,"ngIf"],[1,"card","card-default","clickable",2,"border-left","solid 15px",3,"ngClass","click","mouseenter","mouseleave"],[1,"card-body","card-5-7"],[2,"word-break","break-all","border-bottom-color","rgba(195, 195, 195, 0.3)","border-bottom-style","inset","border-bottom-width","2px","margin-bottom","10px","padding-bottom","10px"],["class","pull-right",4,"ngIf"],[1,"pull-right"],["title","Edit",1,"fa","fa-pencil-alt","ico-edit",3,"click"],["title","Delete",1,"fa","fa-trash-alt","ico-remove",3,"click"],[1,"card","card-default","clickable",3,"click"],[1,"card-body"],["aria-hidden","true",1,"fa","fa-caret-left","expand-arrow-ico","pull-right",2,"font-size","25px","padding","0 5px",3,"ngClass","click"],[2,"word-break","break-all"],[1,"list-group",2,"margin-bottom","0",3,"collapse"],["class","list-group-item","style","background-color: #ececec;border: solid 1px lightgrey;border-radius: 0;",3,"click",4,"ngFor","ngForOf"],[1,"list-group-item",2,"background-color","#ececec","border","solid 1px lightgrey","border-radius","0",3,"click"],["class","pull-right button-column",4,"ngIf"],[1,"pull-right","button-column"],[1,"card","card-default"],[1,"list-group-item",2,"background-color","#ececec","border","solid 1px lightgrey","border-radius","0"],[3,"click"],["heading","Products"],[3,"id","toggleMapOrtho","toggleMapDem"],[1,"row",2,"background","white"],[1,"col-md-12",2,"text-align","center","padding","10px","border-top","1px solid lightgrey"],[1,"btn","btn-primary",3,"click"],[1,"idm-toast"],["type","success",3,"dismissible","onClosed",4,"ngIf"],["type","warning",3,"dismissible","onClosed",4,"ngIf"],["type","danger",3,"dismissible","onClosed",4,"ngIf"],["type","info",3,"dismissible","onClosed",4,"ngIf"],["type","success",3,"dismissible","onClosed"],["type","warning",3,"dismissible","onClosed"],["routerLink","/site/tasks"],["type","danger",3,"dismissible","onClosed"],["type","info",3,"dismissible","onClosed"],[1,"fas","fa-layer-group",2,"vertical-align","middle","font-size","18px"],["class","row-form",4,"ngFor","ngForOf"],[1,"row-form"],["type","radio","name","rtoggle",1,"layer-toggle-input",3,"value","checked","change"],[1,"layer-toggle-label"],[4,"ngFor","ngForOf"],[1,"fa","fa-folder-open"],[1,"fa","fa-file"]],template:function(e,t){if(1&e&&(n.kc(0,"div",0),n.gc(1,"uasdm-header",1),n.jc(),n.kc(2,"div",2),n.kc(3,"div",3),n.kc(4,"div",4),n.kc(5,"div",3),n.kc(6,"div",5),n.Sc(7,Qt,4,0,"div",6),n.Sc(8,nc,8,1,"div",6),n.kc(9,"div",3),n.kc(10,"div",5),n.kc(11,"div",7),n.kc(12,"input",8),n.sc("ngModelChange",(function(e){return t.search=e}))("typeaheadOnSelect",(function(e){return t.handleClick(e)}))("keydown.enter",(function(e){return e.preventDefault()})),n.jc(),n.jc(),n.jc(),n.jc(),n.jc(),n.jc(),n.kc(13,"div",3),n.kc(14,"div",9),n.kc(15,"tabset",10,11),n.kc(17,"tab",12),n.kc(18,"div",13),n.kc(19,"div",14),n.Sc(20,ac,3,3,"div",15),n.Sc(21,oc,5,1,"div",15),n.Sc(22,gc,3,3,"div",16),n.Sc(23,fc,9,2,"div",16),n.jc(),n.jc(),n.jc(),n.Sc(24,mc,3,1,"tab",17),n.jc(),n.jc(),n.jc(),n.kc(25,"footer",18),n.Sc(26,bc,4,0,"div",19),n.Sc(27,kc,4,0,"div",19),n.jc(),n.jc(),n.kc(28,"div",20),n.kc(29,"div",3),n.kc(30,"article",21),n.Sc(31,Sc,5,4,"div",22),n.jc(),n.kc(32,"article",23),n.kc(33,"div",24),n.sc("mouseenter",(function(){return t.baselayerIconHover=!0}))("mouseleave",(function(){return t.baselayerIconHover=!1})),n.Sc(34,Cc,1,0,"i",25),n.Sc(35,Mc,2,1,"div",26),n.jc(),n.jc(),n.gc(36,"div",27),n.gc(37,"div",28),n.jc(),n.jc(),n.jc(),n.jc(),n.Sc(38,Ac,6,4,"ng-template",null,29,n.Tc)),2&e){const e=n.Jc(39);n.Tb(1),n.Ac("title","Site Viewer"),n.Tb(6),n.Ac("ngIf",!t.current),n.Tb(1),n.Ac("ngIf",t.current),n.Tb(4),n.Ac("ngModel",t.search)("typeaheadAsync",!0)("typeahead",t.dataSource)("typeaheadOptionsLimit",10)("typeaheadItemTemplate",e)("ngModelOptions",n.Dc(19,xc)),n.Tb(8),n.Ac("ngIf",t.nodes.length<1&&0===t.breadcrumbs.length),n.Tb(1),n.Ac("ngIf",t.nodes.length<1&&t.breadcrumbs.length>0),n.Tb(1),n.Ac("ngForOf",t.nodes),n.Tb(1),n.Ac("ngForOf",t.supportingData),n.Tb(1),n.Ac("ngIf",null!=t.current),n.Tb(2),n.Ac("ngIf",null!=t.current),n.Tb(1),n.Ac("ngIf",null==t.current),n.Tb(4),n.Ac("ngForOf",t.tasks),n.Tb(3),n.Ac("ngIf",!t.baselayerIconHover),n.Tb(1),n.Ac("ngIf",t.baselayerIconHover)}},directives:[Zt.a,i.l,a.a,a.h,a.k,r.a,u.c,u.a,i.k,i.j,g.a,et,p.a,s.d],styles:["./projects.css"],data:{animation:[Object(ne.c)(),Object(ne.d)()]}});var Fc=c(42);const Lc=["uploader"];function Rc(e,t){1&e&&(n.kc(0,"div",3),n.gc(1,"div",4),n.kc(2,"div",5),n.kc(3,"h4",6),n.Uc(4," There are no Sites added to the system. Add a Site, Project, Mission, and Collection using the "),n.kc(5,"a",7),n.Uc(6,"Site Viewer"),n.jc(),n.Uc(7," before uploading data to. "),n.jc(),n.jc(),n.gc(8,"div",4),n.jc())}function Nc(e,t){if(1&e){const e=n.lc();n.kc(0,"div",17),n.kc(1,"div",18),n.kc(2,"div",19),n.Uc(3,"Partial Upload Detected"),n.jc(),n.kc(4,"div",20),n.kc(5,"h4"),n.Uc(6,"A partial upload was detected. You can either cancel that partial upload or attempt to continue."),n.jc(),n.kc(7,"h4"),n.kc(8,"b"),n.Uc(9,"To continue an upload"),n.jc(),n.Uc(10," please click the Continue Upload button and re-upload your file and we will try our best to continue where you left off. "),n.jc(),n.gc(11,"hr"),n.kc(12,"button",21),n.sc("click",(function(t){return n.Lc(e),n.uc(2).removeUpload(t)})),n.gc(13,"i",16),n.Uc(14," Cancel Upload "),n.jc(),n.kc(15,"button",22),n.sc("click",(function(){return n.Lc(e),n.uc(2).showUploadPanel()})),n.gc(16,"i",16),n.Uc(17," Continue Upload "),n.jc(),n.jc(),n.jc(),n.jc()}}function Dc(e,t){if(1&e){const e=n.lc();n.kc(0,"div",23),n.kc(1,"div",19),n.Uc(2," Upload Details "),n.kc(3,"i",24),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc(2).closeTaskFinishedNotification(c.id)})),n.jc(),n.jc(),n.kc(4,"div",20),n.kc(5,"h4"),n.Uc(6," Status: "),n.kc(7,"b"),n.Uc(8," Upload successfully completed "),n.jc(),n.jc(),n.kc(9,"h4"),n.Uc(10," Message: "),n.kc(11,"b"),n.Uc(12," Your uploaded data is being processed into final image products. "),n.jc(),n.jc(),n.jc(),n.jc()}}function Ec(e,t){if(1&e&&(n.kc(0,"option",38),n.Uc(1),n.jc()),2&e){const e=t.$implicit;n.Ac("value",e.id),n.Tb(1),n.Vc(e.name)}}function $c(e,t){if(1&e&&(n.kc(0,"option",38),n.Uc(1),n.jc()),2&e){const e=t.$implicit;n.Ac("value",e.id),n.Tb(1),n.Vc(e.name)}}function Vc(e,t){if(1&e&&(n.kc(0,"option",38),n.Uc(1),n.jc()),2&e){const e=t.$implicit;n.Ac("value",e.id),n.Tb(1),n.Vc(e.name)}}function _c(e,t){if(1&e&&(n.kc(0,"option",38),n.Uc(1),n.jc()),2&e){const e=t.$implicit;n.Ac("value",e.id),n.Tb(1),n.Wc("",e.name," ")}}function zc(e,t){if(1&e){const e=n.lc();n.kc(0,"div",25),n.kc(1,"div",26),n.kc(2,"label",27),n.Uc(3,"Site:"),n.jc(),n.kc(4,"select",28),n.sc("change",(function(t){return n.Lc(e),n.uc(2).onSiteSelect(t.target.value)}))("ngModelChange",(function(t){return n.Lc(e),n.uc(2).values.site=t})),n.gc(5,"option"),n.Sc(6,Ec,2,2,"option",29),n.jc(),n.jc(),n.kc(7,"div",26),n.kc(8,"label",30),n.Uc(9,"Project:"),n.jc(),n.kc(10,"select",31),n.sc("change",(function(t){return n.Lc(e),n.uc(2).onProjectSelect(t.target.value)}))("ngModelChange",(function(t){return n.Lc(e),n.uc(2).values.project=t})),n.gc(11,"option"),n.Sc(12,$c,2,2,"option",29),n.jc(),n.jc(),n.kc(13,"div",26),n.kc(14,"label",32),n.Uc(15,"Mission:"),n.jc(),n.kc(16,"select",33),n.sc("change",(function(t){return n.Lc(e),n.uc(2).onMissionSelect(t.target.value)}))("ngModelChange",(function(t){return n.Lc(e),n.uc(2).values.mission=t})),n.gc(17,"option"),n.Sc(18,Vc,2,2,"option",29),n.jc(),n.jc(),n.kc(19,"div",26),n.kc(20,"label",34),n.Uc(21,"Collection:"),n.jc(),n.kc(22,"select",35),n.sc("change",(function(t){return n.Lc(e),n.uc(2).onCollectionSelect(t.target.value)}))("ngModelChange",(function(t){return n.Lc(e),n.uc(2).values.collection=t})),n.gc(23,"option"),n.Sc(24,_c,2,2,"option",29),n.jc(),n.jc(),n.kc(25,"div",26),n.kc(26,"label",36),n.Uc(27,"Output Product Name Prefix"),n.jc(),n.kc(28,"input",37),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc(2).values.outFileName=t})),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc(2);n.Tb(4),n.Ac("ngModel",e.values.site),n.Tb(2),n.Ac("ngForOf",e.sites),n.Tb(4),n.Ac("ngModel",e.values.project),n.Ub("disabled",null==e.values.site?"":null),n.Tb(2),n.Ac("ngForOf",e.projects),n.Tb(4),n.Ac("ngModel",e.values.mission),n.Ub("disabled",null==e.values.project?"":null),n.Tb(2),n.Ac("ngForOf",e.missions),n.Tb(4),n.Ac("ngModel",e.values.collection),n.Ub("disabled",null==e.values.mission?"":null),n.Tb(2),n.Ac("ngForOf",e.collections),n.Tb(4),n.Ac("ngModel",e.values.outFileName)}}function Gc(e,t){if(1&e&&(n.kc(0,"div",18),n.kc(1,"div",19),n.Uc(2,"Upload Details"),n.jc(),n.kc(3,"div",20),n.kc(4,"h4"),n.Uc(5," Status: "),n.kc(6,"b"),n.Uc(7),n.jc(),n.jc(),n.kc(8,"h4"),n.Uc(9," Message: "),n.kc(10,"b"),n.Uc(11),n.jc(),n.jc(),n.kc(12,"h4"),n.Uc(13," Upload Started On: "),n.kc(14,"b"),n.Uc(15),n.vc(16,"idmdate"),n.jc(),n.jc(),n.kc(17,"h4"),n.Uc(18," Last Updated: "),n.kc(19,"b"),n.Uc(20),n.vc(21,"idmdate"),n.jc(),n.jc(),n.kc(22,"h4"),n.Uc(23," Elapsed Time: "),n.kc(24,"b"),n.Uc(25),n.jc(),n.jc(),n.jc(),n.jc()),2&e){const e=n.uc(2);n.Tb(7),n.Wc(" ",e.currentTask.status," "),n.Tb(4),n.Wc(" ",e.currentTask.message," "),n.Tb(4),n.Wc(" ",n.wc(16,5,e.currentTask.createDate)," "),n.Tb(5),n.Wc(" ",n.wc(21,7,e.currentTask.lastUpdateDate)," "),n.Tb(5),n.Wc(" ",e.uploadCounter," ")}}function Wc(e,t){1&e&&n.gc(0,"div",39,40)}function Bc(e,t){if(1&e){const e=n.lc();n.kc(0,"div",3),n.gc(1,"div",4),n.kc(2,"div",5),n.kc(3,"form",null,8),n.Sc(5,Nc,18,0,"div",9),n.Sc(6,Dc,13,0,"div",10),n.Sc(7,zc,29,12,"div",11),n.kc(8,"div",12),n.Sc(9,Gc,26,9,"div",13),n.Sc(10,Wc,2,0,"div",14),n.kc(11,"button",15),n.sc("click",(function(){return n.Lc(e),n.uc().handleUpload()})),n.gc(12,"i",16),n.Uc(13," Upload "),n.jc(),n.jc(),n.jc(),n.jc(),n.gc(14,"div",4),n.jc()}if(2&e){const e=n.Jc(4),t=n.uc();n.Tb(5),n.Ac("ngIf",t.existingTask&&!t.currentTask),n.Tb(1),n.Ac("ngForOf",t.taskFinishedNotifications),n.Tb(1),n.Ac("ngIf",!t.disabled&&!t.existingTask),n.Tb(1),n.Ac("hidden",!t.uploadVisible),n.Tb(1),n.Ac("ngIf",t.currentTask),n.Tb(1),n.Ac("ngIf",t.showFileSelectPanel),n.Tb(1),n.Ac("disabled",!e.valid||t.disabled)}}class qc{constructor(e,t,c){this.service=e,this.modalService=t,this.sites=[],this.projects=[],this.missions=[],this.collections=[],this.values={create:!1},this.uploader=null,this.disabled=!1,this.taskStatusMessages=[],this.currentTask=null,this.existingTask=!1,this.pollingIsSet=!1,this.uploadVisible=!0,this.selectedContinue=!1,this.uploadCounter="00:00:00",this.showFileSelectPanel=!1,this.taskFinishedNotifications=[],this.differ=c.find([]).create()}ngDoCheck(){if(this.uploader){this.differ.diff(this.uploader)&&this.setExistingTask()}}set content(e){const t=this;if(null!=e&&null==this.uploader){let c={debug:!1,autoUpload:!1,multiple:!1,element:e.nativeElement,template:"qq-template",request:{endpoint:acp+"/file/upload",forceMultipart:!0},resume:{enabled:!0,recordsExpireIn:1},chunking:{enabled:!0},retry:{enableAuto:!0},text:{defaultResponseError:"Upload failed"},failedUploadTextDisplay:{mode:"none"},validation:{allowedExtensions:["zip","tar.gz"]},showMessage:function(e){},callbacks:{onUpload:function(e,c){t.disabled=!0,t.countUpload(t)},onProgress:function(e,t,c,n){},onUploadChunk:function(e,t,c){},onUploadChunkSuccess:function(e,c,n,i){n.message&&n.message.currentTask&&!t.currentTask&&(t.currentTask=n.message.currentTask),t.currentTask&&!t.pollingIsSet&&(t.pollingIsSet=!0,t.taskPolling=Object(ht.a)(2e3).pipe(Object(F.a)(()=>{if(t.currentTask)return t.service.task(t.currentTask.oid)})).pipe(Object(gt.a)(e=>e)).subscribe(e=>{t.currentTask=e.task}))},onComplete:function(e,c,n,i){t.disabled=!1,t.currentTask=null,t.existingTask=!1,t.taskPolling&&(t.taskPolling.unsubscribe(),t.pollingIsSet=!1),this.clearStoredFiles(),clearInterval(t.uplodeCounterInterfal),t.taskFinishedNotifications.push({id:e})},onCancel:function(e,c){t.currentTask&&t.currentTask.uploadId&&t.service.removeTask(t.currentTask.uploadId).then(()=>{this.clearStoredFiles()}).catch(e=>{this.error(e)}),t.disabled=!1,t.currentTask=null,t.existingTask=!1,t.taskPolling&&(t.taskPolling.unsubscribe(),t.pollingIsSet=!1),clearInterval(t.uplodeCounterInterfal)},onError:function(e,c,n){t.error(n)}}};this.uploader=new ft.FineUploader(c)}}ngAfterViewInit(){}ngOnInit(){this.service.roots(null,null).then(e=>{this.sites=e})}closeTaskFinishedNotification(e){let t=this.taskFinishedNotifications.length;for(;t--;){e===this.taskFinishedNotifications[t].id&&this.taskFinishedNotifications.splice(t,1)}}setExistingTask(){this.uploader.getResumableFilesData().length>0&&(this.existingTask=!0,this.selectedContinue||this.hideUploadPanel())}onSiteSelect(e){this.values.site=e,null!=e&&e.length>0&&(this.projects=[],this.missions=[],this.collections=[],this.values.project=null,this.values.mission=null,this.values.collection=null,this.service.getChildren(this.values.site).then(e=>{this.projects=e}))}onProjectSelect(e){this.values.project=e,this.missions=[],this.collections=[],this.values.mission=null,this.values.collection=null,null!=e&&e.length>0&&this.service.getChildren(this.values.project).then(e=>{this.missions=e.filter(e=>"Mission"===e.type)})}onMissionSelect(e){this.values.mission=e,this.collections=[],this.values.collection=null,this.values.name=null,null!=e&&e.length>0&&!this.values.create&&this.service.getChildren(this.values.mission).then(e=>{this.collections=e})}handleChange(){this.collections=[],this.values.collection=null,this.values.name=null,null!=this.values.mission&&this.values.mission.length>0&&!this.values.create&&this.service.getChildren(this.values.mission).then(e=>{this.collections=e})}onCollectionSelect(e){this.values.collection=e,this.values.uasComponentOid=e,e&&e.trim().length>0?this.showFileSelectPanel=!0:this.showFileSelectPanel=!1}handleUpload(){this.values.create||null!=this.values.collection||this.existingTask?!this.values.create||null!=this.values.mission&&null!=this.values.name&&0!=this.values.name.length||this.existingTask?(this.uploader.setParams(this.values),this.uploader.uploadStoredFiles()):(this.bsModalRef=this.modalService.show(Fc.a,{backdrop:!0}),this.bsModalRef.content.message="Name is required"):(this.bsModalRef=this.modalService.show(Fc.a,{backdrop:!0}),this.bsModalRef.content.message="A collection must first be selected before the file can be uploaded")}removeUpload(e){let t=this;this.bsModalRef=this.modalService.show(I.a,{animated:!0,backdrop:!0,ignoreBackdropClick:!0}),this.bsModalRef.content.message="Are you sure you want to cancel the upload of ["+this.uploader.getResumableFilesData()[0].name+"]",this.bsModalRef.content.type="DANGER",this.bsModalRef.content.submitText="Cancel Upload",this.bsModalRef.content.onConfirm.subscribe(e=>{this.service.removeTask(this.uploader.getResumableFilesData()[0].uuid).then(()=>{localStorage.clear(),t.existingTask=!1,t.showUploadPanel()})})}hideUploadPanel(){this.uploadVisible=!1}showUploadPanel(){this.uploadVisible=!0,this.selectedContinue=!0}countUpload(e){let t=0;e.uplodeCounterInterfal=setInterval((function(){t+=1;let c=Math.floor(t/3600),n=Math.floor(t%3600/60),i=Math.floor(t%60),s=n<10?"0"+c:c,a=n<10?"0"+n:n,o=i<10?"0"+i:i;e.uploadCounter=s+":"+a+":"+o}),1e3)}canDeactivate(){return this.disabled}unloadNotification(e){this.disabled&&(e.returnValue="An upload is currently in progress. Are you sure you want to leave?")}error(e){null!==e&&(this.bsModalRef=this.modalService.show(Fc.a,{backdrop:!0}),this.bsModalRef.content.message=e)}}qc.ɵfac=function(e){return new(e||qc)(n.fc(D),n.fc(E.b),n.fc(n.E))},qc.ɵcmp=n.Zb({type:qc,selectors:[["upload"]],viewQuery:function(e,t){var c;(1&e&&n.Yc(Lc,!0),2&e)&&(n.Ic(c=n.tc())&&(t.content=c.first))},hostBindings:function(e,t){1&e&&n.sc("beforeunload",(function(e){return t.unloadNotification(e)}),!1,n.Kc)},decls:4,vars:3,consts:[[3,"title"],["id","app-container",1,"container"],["class","row",4,"ngIf"],[1,"row"],[1,"col-md-2"],[1,"col-md-8"],[2,"margin-top","50px"],["routerlink","/viewer","routerlinkactive","active","href","#/viewer"],["ngForm","ngForm"],["class","",4,"ngIf"],["class","panel panel-success","style","margin: 30px 0 30px 0;",4,"ngFor","ngForOf"],["style","margin-top: 30px;","class","",4,"ngIf"],[1,"",3,"hidden"],["class","panel panel-warning","style","margin: 30px 0 30px 0;",4,"ngIf"],["class","uploader-container","style","margin-top: 20px;",4,"ngIf"],["type","button btn btn-primary",1,"btn","btn-primary",2,"margin-top","20px",3,"disabled","click"],[1,"icon-upload","icon-white"],[1,""],[1,"panel","panel-warning",2,"margin","30px 0 30px 0"],[1,"panel-heading",2,"font-size","20px"],[1,"panel-body"],["type","button",1,"btn","btn-danger",2,"margin-top","20px",3,"click"],["type","button",1,"btn","btn-primary",2,"margin-top","20px",3,"click"],[1,"panel","panel-success",2,"margin","30px 0 30px 0"],[1,"fa","fa-times","btn","btn-close","pull-right",2,"min-width","20px","padding","0","line-height","27px",3,"click"],[1,"",2,"margin-top","30px"],[1,"form-group"],["for","site"],["name","site","required","",3,"ngModel","change","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["for","project"],["name","project","required","",3,"ngModel","change","ngModelChange"],["for","mission"],["name","mission","required","",3,"ngModel","change","ngModelChange"],["for","collection"],["name","collection","required","",3,"ngModel","change","ngModelChange"],["for","outFileName"],["name","outFileName","type","input","placeholder","Output product name prefix...",1,"form-control",3,"ngModel","ngModelChange"],[3,"value"],[1,"uploader-container",2,"margin-top","20px"],["uploader",""]],template:function(e,t){1&e&&(n.gc(0,"uasdm-header",0),n.kc(1,"div",1),n.Sc(2,Rc,9,0,"div",2),n.Sc(3,Bc,15,7,"div",2),n.jc()),2&e&&(n.Ac("title","Data Upload"),n.Tb(2),n.Ac("ngIf",0===t.sites.length),n.Tb(1),n.Ac("ngIf",t.sites.length>0))},directives:[Zt.a,i.l,a.r,a.i,a.j,i.k,a.p,a.o,a.h,a.k,a.l,a.q,a.a],pipes:[Fe.a],encapsulation:2});var Hc=c(153);function Jc(e,t){if(1&e&&(n.kc(0,"li"),n.Uc(1,"Sensor: "),n.kc(2,"b"),n.Uc(3),n.jc(),n.jc()),2&e){const e=n.uc(2).$implicit;n.Tb(3),n.Vc(e.sensorName)}}function Zc(e,t){if(1&e){const e=n.lc();n.kc(0,"button",19),n.sc("click",(function(){n.Lc(e);const t=n.uc(2).$implicit;return t.showError=!t.showError})),n.Uc(1),n.jc()}if(2&e){const e=n.uc(2).$implicit;n.Tb(1),n.Wc("",e.showError?"Hide":"Show"," Messages")}}const Yc=function(e,t,c){return{success:e,pending:t,fail:c}};function Kc(e,t){if(1&e){const e=n.lc();n.kc(0,"div"),n.kc(1,"ul",12),n.kc(2,"li"),n.Uc(3,"Status: "),n.kc(4,"b",6),n.Uc(5),n.jc(),n.jc(),n.kc(6,"li"),n.Uc(7,"Created on: "),n.kc(8,"b"),n.Uc(9),n.vc(10,"idmdate"),n.jc(),n.jc(),n.kc(11,"li"),n.Uc(12,"Last update: "),n.kc(13,"b"),n.Uc(14),n.vc(15,"idmdate"),n.jc(),n.jc(),n.kc(16,"li",13),n.Uc(17,"Message: "),n.kc(18,"b"),n.Uc(19),n.jc(),n.jc(),n.Sc(20,Jc,4,1,"li",10),n.jc(),n.kc(21,"div",14),n.kc(22,"div",15),n.kc(23,"div",16),n.Sc(24,Zc,2,1,"button",17),n.kc(25,"button",18),n.sc("click",(function(){n.Lc(e);const t=n.uc().$implicit;return n.uc().removeTask(t)})),n.Uc(26,"Delete Task"),n.jc(),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc().$implicit,t=n.uc();n.Tb(4),n.Ac("ngClass",n.Gc(11,Yc,"Complete"===e.status,"Queued"===e.status||"Processing"===e.status,"Failed"===e.status)),n.Tb(1),n.Vc(e.status),n.Tb(4),n.Vc(n.wc(10,7,e.createDate)),n.Tb(5),n.Vc(n.wc(15,9,e.lastUpdateDate)),n.Tb(5),n.Vc(e.message),n.Tb(1),n.Ac("ngIf","Upload"==t.taskCategory),n.Tb(4),n.Ac("ngIf",e.actions.length>0)}}function Qc(e,t){if(1&e&&(n.kc(0,"li"),n.Uc(1,"Sensor: "),n.kc(2,"b"),n.Uc(3),n.jc(),n.jc()),2&e){const e=n.uc(2).$implicit;n.Tb(3),n.Vc(e.sensorName)}}function Xc(e,t){if(1&e){const e=n.lc();n.kc(0,"button",19),n.sc("click",(function(){n.Lc(e);const t=n.uc(2).$implicit;return t.showError=!t.showError})),n.Uc(1),n.jc()}if(2&e){const e=n.uc(2).$implicit;n.Tb(1),n.Wc("",e.showError?"Hide":"Show"," Messages")}}function en(e,t){if(1&e){const e=n.lc();n.kc(0,"button",19),n.sc("click",(function(){n.Lc(e);const t=n.uc(3);return t.showODMOutput=!t.showODMOutput})),n.Uc(1,"Show Detailed Log Output"),n.jc()}}function tn(e,t){if(1&e&&(n.kc(0,"div",14),n.kc(1,"div",15),n.kc(2,"h4"),n.Uc(3,"Output:"),n.jc(),n.gc(4,"textarea",20),n.jc(),n.jc()),2&e){const e=n.uc(2).$implicit;n.Tb(4),n.Ac("innerHTML",e.odmOutput,n.Mc)}}function cn(e,t){if(1&e){const e=n.lc();n.kc(0,"div"),n.kc(1,"ul",12),n.kc(2,"li"),n.Uc(3,"Status: "),n.kc(4,"b",6),n.Uc(5),n.jc(),n.jc(),n.kc(6,"li"),n.Uc(7,"Message: "),n.kc(8,"b"),n.Uc(9),n.jc(),n.jc(),n.kc(10,"li"),n.Uc(11,"Created on: "),n.kc(12,"b"),n.Uc(13),n.vc(14,"idmdate"),n.jc(),n.jc(),n.kc(15,"li"),n.Uc(16,"Last update: "),n.kc(17,"b"),n.Uc(18),n.vc(19,"idmdate"),n.jc(),n.jc(),n.Sc(20,Qc,4,1,"li",10),n.jc(),n.kc(21,"div",14),n.kc(22,"div",15),n.kc(23,"div",16),n.Sc(24,Xc,2,1,"button",17),n.Sc(25,en,2,0,"button",17),n.kc(26,"button",18),n.sc("click",(function(){n.Lc(e);const t=n.uc().$implicit;return n.uc().removeTask(t)})),n.Uc(27,"Delete Task"),n.jc(),n.jc(),n.jc(),n.jc(),n.Sc(28,tn,5,1,"div",11),n.jc()}if(2&e){const e=n.uc().$implicit,t=n.uc();n.Tb(4),n.Ac("ngClass",n.Gc(13,Yc,"Complete"===e.status,"Queued"===e.status||"Processing"===e.status,"Failed"===e.status)),n.Tb(1),n.Wc(" ","Complete"===e.status&&e.actions.length>0?"Complete With Messages":e.status," "),n.Tb(4),n.Vc(e.message),n.Tb(4),n.Vc(n.wc(14,9,e.createDate)),n.Tb(5),n.Vc(n.wc(19,11,e.lastUpdateDate)),n.Tb(2),n.Ac("ngIf","Upload"==t.taskCategory),n.Tb(4),n.Ac("ngIf",e.actions.length>0),n.Tb(1),n.Ac("ngIf",e.odmOutput),n.Tb(3),n.Ac("ngIf",e.odmOutput&&t.showODMOutput)}}function nn(e,t){1&e&&(n.kc(0,"h4",23),n.Uc(1,"There are no actions for this task."),n.jc())}function sn(e,t){if(1&e&&(n.kc(0,"tr"),n.kc(1,"th",26),n.Uc(2),n.jc(),n.kc(3,"td"),n.Uc(4),n.jc(),n.kc(5,"td"),n.Uc(6),n.vc(7,"idmdate"),n.jc(),n.kc(8,"td"),n.Uc(9),n.vc(10,"idmdate"),n.jc(),n.jc()),2&e){const e=t.$implicit,c=t.index;n.Tb(2),n.Vc(c+1),n.Tb(2),n.Vc(e.description),n.Tb(2),n.Vc(n.wc(7,4,e.createDate)),n.Tb(3),n.Vc(n.wc(10,6,e.lastUpdateDate))}}function an(e,t){if(1&e&&(n.kc(0,"table",24),n.kc(1,"thead"),n.kc(2,"tr"),n.kc(3,"th"),n.Uc(4,"#"),n.jc(),n.kc(5,"th"),n.Uc(6,"Description"),n.jc(),n.kc(7,"th"),n.Uc(8,"Creation Date"),n.jc(),n.kc(9,"th"),n.Uc(10,"Last Updated"),n.jc(),n.jc(),n.jc(),n.kc(11,"tbody"),n.Sc(12,sn,11,8,"tr",25),n.jc(),n.jc()),2&e){const e=n.uc(2).$implicit;n.Tb(12),n.Ac("ngForOf",e.actions)}}function on(e,t){if(1&e&&(n.kc(0,"div",14),n.kc(1,"div",15),n.Sc(2,nn,2,0,"h4",21),n.Sc(3,an,13,1,"table",22),n.jc(),n.jc()),2&e){const e=n.uc().$implicit;n.Tb(2),n.Ac("ngIf",0===e.actions.length),n.Tb(1),n.Ac("ngIf",e.actions.length>0)}}function ln(e,t){if(1&e&&(n.kc(0,"div",9),n.Sc(1,Kc,27,15,"div",10),n.Sc(2,cn,29,17,"div",10),n.Sc(3,on,4,2,"div",11),n.jc()),2&e){const e=t.$implicit;n.Tb(1),n.Ac("ngIf","Complete"!==e.status&&"Failed"!==e.status&&"Error"!==e.status),n.Tb(1),n.Ac("ngIf","Complete"===e.status||"Failed"===e.status||"Error"===e.status),n.Tb(1),n.Ac("ngIf",e.showError)}}const rn=function(e,t,c,n){return{success:e,warning:t,pending:c,fail:n}};class dn{constructor(e,t,c){this.managementService=e,this.modalService=t,this.showUploads=!1,this.showProcess=!1,this.showStore=!1,this.showODMOutput=!1,this.showError=!1,this.taskGroups=[]}ngOnInit(){if(null!=this.taskGroupType&&null!=this.taskGroupType.tasks)for(var e=0;e<this.taskGroupType.tasks.length;++e){let t=this.taskGroupType.tasks[e];t.actions.length>0&&(t.showError=!0)}}ngOnDestroy(){}removeTask(e){this.bsModalRef=this.modalService.show(I.a,{animated:!0,backdrop:!0,ignoreBackdropClick:!0}),this.bsModalRef.content.message="Are you sure you want to delete ["+e.label+"?",this.bsModalRef.content.data=e,this.bsModalRef.content.type="DANGER",this.bsModalRef.content.submitText="Delete",this.bsModalRef.content.onConfirm.subscribe(e=>{this.deleteTask(e)})}deleteTask(e){this.managementService.removeTask(e.uploadId).then(()=>{let t=null;for(let c=0;c<this.taskGroupType.tasks.length;c++){if(this.taskGroupType.tasks[c].uploadId===e.uploadId){t=c;break}}null!==t&&this.taskGroupType.tasks.splice(t,1)})}}function un(e,t){if(1&e&&(n.kc(0,"li"),n.kc(1,"span"),n.kc(2,"b"),n.Uc(3),n.jc(),n.jc(),n.jc()),2&e){const e=t.$implicit;n.Tb(3),n.Vc(e)}}function pn(e,t){if(1&e){const e=n.lc();n.kc(0,"div",20),n.kc(1,"div",21),n.kc(2,"div",2),n.kc(3,"div",16),n.kc(4,"div"),n.gc(5,"span",22),n.Uc(6),n.jc(),n.kc(7,"div",23),n.kc(8,"ul",24),n.Sc(9,un,4,1,"li",25),n.kc(10,"li",9),n.kc(11,"a",26),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc(2).handleGoto(c.collectionId)})),n.Uc(12),n.jc(),n.jc(),n.jc(),n.jc(),n.jc(),n.kc(13,"div",27),n.kc(14,"div"),n.kc(15,"button",28),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc(2).handleGoto(c.collectionId)})),n.Uc(16,"View Collection"),n.jc(),n.kc(17,"button",29),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc(2).handleMessage(c)})),n.Uc(18,"Add Metadata"),n.jc(),n.jc(),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=t.$implicit;n.Tb(6),n.Wc(" ",e.message," "),n.Tb(3),n.Ac("ngForOf",e.ancestors),n.Tb(3),n.Wc(" ",e.collectionName,"")}}dn.ɵfac=function(e){return new(e||dn)(n.fc(D),n.fc(E.b),n.fc(Hc.a))},dn.ɵcmp=n.Zb({type:dn,selectors:[["tasks-panel"]],inputs:{taskGroupType:"taskGroupType",groupTypeId:"groupTypeId",taskCategory:"taskCategory"},decls:13,vars:13,consts:[[1,"panel-group"],[1,"panel","panel-default",2,"background","none","border","none"],[1,"panel-heading","panel-heading-light","clickable",2,"margin-top","20px"],[1,"panel-title"],["data-toggle","collapse",3,"click"],[1,"heading-status-label","pull-right"],[3,"ngClass"],[1,"panel-body",3,"id","isAnimated","collapse"],["class","task-container",4,"ngFor","ngForOf"],[1,"task-container"],[4,"ngIf"],["class","row",4,"ngIf"],[1,"list-unstyled",2,"margin","0"],[2,"word-break","break-all"],[1,"row"],[1,"col-sm-12"],[1,"button-holder",2,"margin-top","30px"],["class","btn btn-default",3,"click",4,"ngIf"],[1,"btn","btn-default","caution",3,"click"],[1,"btn","btn-default",3,"click"],[2,"color","grey","width","500px","height","200px",3,"innerHTML"],["style","color:grey;",4,"ngIf"],["class","table table-bordered",4,"ngIf"],[2,"color","grey"],[1,"table","table-bordered"],[4,"ngFor","ngForOf"],["scope","row"]],template:function(e,t){1&e&&(n.kc(0,"div",0),n.kc(1,"div",1),n.kc(2,"div",2),n.kc(3,"h4",3),n.kc(4,"a",4),n.sc("click",(function(){return t.showProcess=!t.showProcess})),n.kc(5,"h4"),n.Uc(6),n.jc(),n.jc(),n.jc(),n.kc(7,"span",5),n.Uc(8,"Current status: "),n.kc(9,"span",6),n.Uc(10),n.jc(),n.jc(),n.jc(),n.kc(11,"div",7),n.Sc(12,ln,4,3,"div",8),n.jc(),n.jc(),n.jc()),2&e&&(n.Tb(4),n.Vb("aria-controls","task-group-panel-",t.groupTypeId,""),n.Tb(2),n.Vc(t.taskCategory),n.Tb(3),n.Ac("ngClass",n.Hc(8,rn,"Complete"===t.taskGroupType.status,"Warning"===t.taskGroupType.status,"Queued"===t.taskGroupType.status||"Processing"===t.taskGroupType.status,"Failed"===t.taskGroupType.status)),n.Tb(1),n.Vc(t.taskGroupType.status),n.Tb(1),n.Cc("id","task-group-panel-",t.groupTypeId,""),n.Ac("isAnimated",!1)("collapse",!t.showProcess),n.Tb(1),n.Ac("ngForOf",t.taskGroupType.tasks))},directives:[i.j,g.a,i.k,i.l],pipes:[Fe.a],styles:[".button-holder[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%] {\n\tmargin-right: 10px;\n}\n.btn.btn-danger[_ngcontent-%COMP%] {\n    background-color: #d9534f !important;\n    border-color: #d43f3a !important;\n}\n.btn.btn-danger[_ngcontent-%COMP%]:hover {\n    background-color: #d2322d !important;\n    border-color: #ac2925 !important;\n}\n.btn.btn-default.caution[_ngcontent-%COMP%]:hover {\n\tborder-color: #ac2925 !important;\n\tcolor: #ac2925 !important;\n}\n\n\n#tasks[_ngcontent-%COMP%]   .panel-body[_ngcontent-%COMP%] {\n    background: #e9e9e9;\n}\n#tasks[_ngcontent-%COMP%]   .panel-footer[_ngcontent-%COMP%] {\n    background: #e9e9e9;\n}\n\n.task-container[_ngcontent-%COMP%]{\n    border-bottom: solid lightgrey 1px;\n    padding: 10px;\n    margin-bottom: 20px;\n}\n\n.panel-body[_ngcontent-%COMP%]{\n    background: white;\n}\n.panel-body.collapse[_ngcontent-%COMP%]{\n    padding: 0;\n}\n.panel-body.collapse.in.show[_ngcontent-%COMP%]{\n    padding: 20px;\n    max-height: fit-content;\n}\n\n.panel-group[_ngcontent-%COMP%] {\n    margin-bottom: 0;\n}\n\n.panel-heading[_ngcontent-%COMP%]{\n  background-color: #e9e9e9;\n}\n\n.panel-heading.panel-heading-light[_ngcontent-%COMP%] {\n  background: none;\n  border-bottom: 2px solid lightgrey;\n  padding-left: 0;\n  padding-right: 0;\n}\n\n.panel-heading.panel-heading-light[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%] {\n    display: inline-block;\n}\n.panel-heading.panel-heading-light[_ngcontent-%COMP%]   .heading-status-label[_ngcontent-%COMP%] {\n    display: inline-block;\n    vertical-align: middle;\n    line-height: 40px;\n}\n.panel-heading.panel-heading-light[_ngcontent-%COMP%]   .heading-status-label[_ngcontent-%COMP%]   .success[_ngcontent-%COMP%] {\n    color: #6CB46F;\n}\n.panel-heading.panel-heading-light[_ngcontent-%COMP%]   .heading-status-label[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%] {\n    color: #2C88CB;\n}\n.panel-heading.panel-heading-light[_ngcontent-%COMP%]   .heading-status-label[_ngcontent-%COMP%]   .pending[_ngcontent-%COMP%] {\n    color: #FF8C42;\n}\n.panel-heading.panel-heading-light[_ngcontent-%COMP%]   .heading-status-label[_ngcontent-%COMP%]   .fail[_ngcontent-%COMP%] {\n    color: #BF1E1E;\n}\n\nb.success[_ngcontent-%COMP%] {\n    color: #6CB46F;\n}\nb.pending[_ngcontent-%COMP%] {\n    color: #FF8C42;\n}\nb.fail[_ngcontent-%COMP%] {\n    color: #BF1E1E;\n}\n\n\n.nav-tabs[_ngcontent-%COMP%]    > li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%] {\n    color: grey;\n}\n.nav-tabs[_ngcontent-%COMP%]    > li.active[_ngcontent-%COMP%]   a[_ngcontent-%COMP%] {\n    color: #007276;\n}\n.nav-tabs[_ngcontent-%COMP%]    > li[_ngcontent-%COMP%]    > a[_ngcontent-%COMP%]:hover {\n  background-color: #e4e4e4;\n  cursor: pointer;\n  color: #007276;\n}\n\n\n.dot[_ngcontent-%COMP%] {\n  height: 20px;\n  width: 20px;\n  background-color: #bbb;\n  border-radius: 50%;\n  display: inline-block;\n  vertical-align: middle;\n  margin-right: 10px;\n}\n.dot.success[_ngcontent-%COMP%] {\n  background-color: #6CB46F;\n}\n.dot.pending[_ngcontent-%COMP%] {    \n  background-color: #FF8C42;\n}\n.dot.warning[_ngcontent-%COMP%] {\n  background-color: #2C88CB;\n}\n.dot.fail[_ngcontent-%COMP%] {\n  background-color:#BF1E1E;\n}\n.dot.pending.blink[_ngcontent-%COMP%] {\n   animation-duration: 400ms;\n   animation-name: blink;\n   animation-iteration-count: infinite;\n   animation-direction: alternate;\n}\n@keyframes blink {\n   from {\n      opacity: 1;\n   }\n   to {\n      opacity: .5;\n   }\n }"]});const hn=function(e,t,c){return{id:"message-pg-ctrl",itemsPerPage:e,currentPage:t,totalItems:c}};function gn(e,t){if(1&e){const e=n.lc();n.kc(0,"div"),n.kc(1,"h2"),n.Uc(2,"Tasks"),n.jc(),n.kc(3,"div",15),n.kc(4,"div",2),n.kc(5,"h3",16),n.Uc(6,"Issue"),n.jc(),n.kc(7,"h3",17),n.Uc(8,"Actions"),n.jc(),n.jc(),n.Sc(9,pn,19,3,"div",18),n.vc(10,"paginate"),n.kc(11,"div",2),n.kc(12,"pagination-controls",19),n.sc("pageChange",(function(t){return n.Lc(e),n.uc().onMessagePageChange(t)})),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc();n.Tb(9),n.Ac("ngForOf",n.xc(10,1,e.messages.resultSet,n.Gc(4,hn,e.messages.pageSize,e.messages.pageNumber,e.messages.count)))}}function fn(e,t){if(1&e&&(n.kc(0,"li"),n.kc(1,"span"),n.kc(2,"b"),n.Uc(3),n.jc(),n.jc(),n.jc()),2&e){const e=t.$implicit;n.Tb(3),n.Vc(e)}}function mn(e,t){1&e&&n.gc(0,"i",42)}function bn(e,t){if(1&e&&(n.kc(0,"div"),n.gc(1,"tasks-panel",45),n.jc()),2&e){const e=n.uc(2),t=e.$implicit,c=e.index;n.Tb(1),n.Ac("taskGroupType",t)("groupTypeId",c)("taskCategory","Upload")}}function kn(e,t){if(1&e&&(n.kc(0,"div"),n.gc(1,"tasks-panel",45),n.jc()),2&e){const e=n.uc(2),t=e.$implicit,c=e.index;n.Tb(1),n.Ac("taskGroupType",t)("groupTypeId",c)("taskCategory","Process")}}function vn(e,t){if(1&e&&(n.kc(0,"div"),n.gc(1,"tasks-panel",45),n.jc()),2&e){const e=n.uc(2),t=e.$implicit,c=e.index;n.Tb(1),n.Ac("taskGroupType",t)("groupTypeId",c)("taskCategory","Store")}}function jn(e,t){if(1&e&&(n.kc(0,"div",44),n.Sc(1,bn,2,3,"div",6),n.Sc(2,kn,2,3,"div",6),n.Sc(3,vn,2,3,"div",6),n.jc()),2&e){const e=n.uc(),t=e.index,c=e.$implicit;n.Ac("id","task"+t),n.Tb(1),n.Ac("ngIf","UPLOAD"===c.type),n.Tb(1),n.Ac("ngIf","PROCESS"===c.type),n.Tb(1),n.Ac("ngIf","STORE"===c.type)}}function yn(e,t){if(1&e&&(n.kc(0,"div"),n.Sc(1,jn,4,4,"div",43),n.jc()),2&e){const e=t.$implicit;n.Tb(1),n.Ac("ngIf",e.tasks.length>0)}}function Tn(e,t){if(1&e&&(n.kc(0,"span"),n.Sc(1,yn,2,1,"div",25),n.jc()),2&e){const e=n.uc().$implicit;n.Tb(1),n.Ac("ngForOf",e.groups)}}const Sn=function(e,t,c,n){return{success:e,warning:t,"pending blink":c,fail:n}};function Cn(e,t){if(1&e){const e=n.lc();n.kc(0,"div",34),n.kc(1,"div",35),n.kc(2,"h4",36),n.kc(3,"a",37),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc(2).setVisibility(c)})),n.kc(4,"h4"),n.Uc(5),n.jc(),n.jc(),n.jc(),n.gc(6,"span",38),n.kc(7,"button",39),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc(2).handleGoto(c.collectionId)})),n.Uc(8,"View Collection"),n.jc(),n.kc(9,"div",23),n.kc(10,"ul",24),n.Sc(11,fn,4,1,"li",25),n.kc(12,"li",9),n.Uc(13),n.jc(),n.jc(),n.jc(),n.jc(),n.kc(14,"div",40),n.Sc(15,mn,1,0,"i",41),n.Sc(16,Tn,2,1,"span",6),n.jc(),n.jc()}if(2&e){const e=t.$implicit,c=t.index,i=n.uc(2);n.Tb(3),n.Ub("aria-expanded",!i.visible[e.collectionId])("aria-controls","taskGroup"+c),n.Tb(2),n.Vc(e.label),n.Tb(1),n.Ac("ngClass",n.Hc(10,Sn,"Complete"===e.status,"Warning"===e.status,"Processing"===e.status||"Running"===e.status||"Pending"===e.status||"Queued"===e.status,"Failed"===e.status)),n.Tb(5),n.Ac("ngForOf",e.ancestors),n.Tb(2),n.Wc(" ",e.label," "),n.Tb(1),n.Ac("isAnimated",!1)("collapse",!i.visible[e.collectionId]),n.Tb(1),n.Ac("ngIf",e.loading),n.Tb(1),n.Ac("ngIf",!e.loading)}}const wn=function(e,t,c){return{id:"tasks-pg-ctrl",itemsPerPage:e,currentPage:t,totalItems:c}};function Mn(e,t){if(1&e){const e=n.lc();n.kc(0,"div",30),n.kc(1,"div",31),n.Sc(2,Cn,17,15,"div",32),n.vc(3,"paginate"),n.kc(4,"pagination-controls",33),n.sc("pageChange",(function(t){return n.Lc(e),n.uc().onPageChange(t)})),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc();n.Tb(2),n.Ac("ngForOf",n.xc(3,1,e.taskPage.resultSet,n.Gc(4,wn,e.taskPage.pageSize,e.taskPage.pageNumber,e.taskPage.count)))}}function On(e,t){if(1&e&&(n.kc(0,"li"),n.kc(1,"span"),n.kc(2,"b"),n.Uc(3),n.jc(),n.jc(),n.jc()),2&e){const e=t.$implicit;n.Tb(3),n.Vc(e)}}function In(e,t){if(1&e&&(n.kc(0,"div"),n.gc(1,"tasks-panel",45),n.jc()),2&e){const e=n.uc(2),t=e.$implicit,c=e.index;n.Tb(1),n.Ac("taskGroupType",t)("groupTypeId",c)("taskCategory","Upload")}}function Un(e,t){if(1&e&&(n.kc(0,"div"),n.gc(1,"tasks-panel",45),n.jc()),2&e){const e=n.uc(2),t=e.$implicit,c=e.index;n.Tb(1),n.Ac("taskGroupType",t)("groupTypeId",c)("taskCategory","Process")}}function An(e,t){if(1&e&&(n.kc(0,"div"),n.gc(1,"tasks-panel",45),n.jc()),2&e){const e=n.uc(2),t=e.$implicit,c=e.index;n.Tb(1),n.Ac("taskGroupType",t)("groupTypeId",c)("taskCategory","Store")}}function xn(e,t){if(1&e&&(n.kc(0,"div",44),n.Sc(1,In,2,3,"div",6),n.Sc(2,Un,2,3,"div",6),n.Sc(3,An,2,3,"div",6),n.jc()),2&e){const e=n.uc(),t=e.index,c=e.$implicit;n.Ac("id","task"+t),n.Tb(1),n.Ac("ngIf","UPLOAD"===c.type),n.Tb(1),n.Ac("ngIf","PROCESS"===c.type),n.Tb(1),n.Ac("ngIf","STORE"===c.type)}}function Pn(e,t){if(1&e&&(n.kc(0,"div"),n.Sc(1,xn,4,4,"div",43),n.jc()),2&e){const e=t.$implicit;n.Tb(1),n.Ac("ngIf",e.tasks.length>0)}}function Fn(e,t){if(1&e){const e=n.lc();n.kc(0,"div",34),n.kc(1,"div",35),n.kc(2,"h4",36),n.kc(3,"a",37),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc(2).setVisibility(c)})),n.kc(4,"h4"),n.Uc(5),n.jc(),n.jc(),n.jc(),n.gc(6,"span",38),n.kc(7,"button",39),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc(2).handleGoto(c.collectionId)})),n.Uc(8,"View Collection"),n.jc(),n.kc(9,"div",23),n.kc(10,"ul",24),n.Sc(11,On,4,1,"li",25),n.kc(12,"li",9),n.Uc(13),n.jc(),n.jc(),n.jc(),n.jc(),n.kc(14,"div",40),n.Sc(15,Pn,2,1,"div",25),n.jc(),n.jc()}if(2&e){const e=t.$implicit,c=t.index,i=n.uc(2);n.Tb(3),n.Ub("aria-expanded",!i.visible[e.collectionId])("aria-controls","taskGroup"+c),n.Tb(2),n.Vc(e.label),n.Tb(1),n.Ac("ngClass",n.Hc(9,Sn,"Complete"===e.status,"Warning"===e.status,"Processing"===e.status||"Running"===e.status||"Pending"===e.status||"Queued"===e.status,"Failed"===e.status)),n.Tb(5),n.Ac("ngForOf",e.ancestors),n.Tb(2),n.Wc(" ",e.label," "),n.Tb(1),n.Ac("isAnimated",!1)("collapse",!i.visible[e.collectionId]),n.Tb(1),n.Ac("ngForOf",e.groups)}}function Ln(e,t){if(1&e){const e=n.lc();n.kc(0,"div",46),n.kc(1,"div",31),n.Sc(2,Fn,16,14,"div",32),n.vc(3,"paginate"),n.kc(4,"pagination-controls",33),n.sc("pageChange",(function(t){return n.Lc(e),n.uc().onPageChange(t)})),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc();n.Tb(2),n.Ac("ngForOf",n.xc(3,1,e.taskPage.resultSet,n.Gc(4,wn,e.taskPage.pageSize,e.taskPage.pageNumber,e.taskPage.count)))}}function Rn(e,t){if(1&e&&(n.kc(0,"li"),n.kc(1,"span"),n.kc(2,"b"),n.Uc(3),n.jc(),n.jc(),n.jc()),2&e){const e=t.$implicit;n.Tb(3),n.Vc(e)}}function Nn(e,t){1&e&&n.gc(0,"i",42)}function Dn(e,t){if(1&e&&(n.kc(0,"div"),n.gc(1,"tasks-panel",45),n.jc()),2&e){const e=n.uc(2),t=e.$implicit,c=e.index;n.Tb(1),n.Ac("taskGroupType",t)("groupTypeId",c)("taskCategory","Upload")}}function En(e,t){if(1&e&&(n.kc(0,"div"),n.gc(1,"tasks-panel",45),n.jc()),2&e){const e=n.uc(2),t=e.$implicit,c=e.index;n.Tb(1),n.Ac("taskGroupType",t)("groupTypeId",c)("taskCategory","Process")}}function $n(e,t){if(1&e&&(n.kc(0,"div"),n.gc(1,"tasks-panel",45),n.jc()),2&e){const e=n.uc(2),t=e.$implicit,c=e.index;n.Tb(1),n.Ac("taskGroupType",t)("groupTypeId",c)("taskCategory","Store")}}function Vn(e,t){if(1&e&&(n.kc(0,"div",44),n.Sc(1,Dn,2,3,"div",6),n.Sc(2,En,2,3,"div",6),n.Sc(3,$n,2,3,"div",6),n.jc()),2&e){const e=n.uc(),t=e.index,c=e.$implicit;n.Ac("id","task"+t),n.Tb(1),n.Ac("ngIf","UPLOAD"===c.type),n.Tb(1),n.Ac("ngIf","PROCESS"===c.type),n.Tb(1),n.Ac("ngIf","STORE"===c.type)}}function _n(e,t){if(1&e&&(n.kc(0,"div"),n.Sc(1,Vn,4,4,"div",43),n.jc()),2&e){const e=t.$implicit;n.Tb(1),n.Ac("ngIf",e.tasks.length>0)}}function zn(e,t){if(1&e&&(n.kc(0,"span"),n.Sc(1,_n,2,1,"div",25),n.jc()),2&e){const e=n.uc().$implicit;n.Tb(1),n.Ac("ngForOf",e.groups)}}function Gn(e,t){if(1&e){const e=n.lc();n.kc(0,"div",34),n.kc(1,"div",35),n.kc(2,"h4",36),n.kc(3,"a",37),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc(2).setVisibility(c)})),n.kc(4,"h4"),n.Uc(5),n.jc(),n.jc(),n.jc(),n.gc(6,"span",38),n.kc(7,"button",39),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc(2).handleGoto(c.collectionId)})),n.Uc(8,"View Collection"),n.jc(),n.kc(9,"div",23),n.kc(10,"ul",24),n.Sc(11,Rn,4,1,"li",25),n.kc(12,"li",9),n.Uc(13),n.jc(),n.jc(),n.jc(),n.jc(),n.kc(14,"div",40),n.Sc(15,Nn,1,0,"i",41),n.Sc(16,zn,2,1,"span",6),n.jc(),n.jc()}if(2&e){const e=t.$implicit,c=t.index,i=n.uc(2);n.Tb(3),n.Ub("aria-expanded",!i.visible[e.collectionId])("aria-controls","taskGroup"+c),n.Tb(2),n.Vc(e.label),n.Tb(1),n.Ac("ngClass",n.Hc(10,Sn,"Complete"===e.status,"Warning"===e.status,"Processing"===e.status||"Running"===e.status||"Pending"===e.status||"Queued"===e.status,"Failed"===e.status)),n.Tb(5),n.Ac("ngForOf",e.ancestors),n.Tb(2),n.Wc(" ",e.label," "),n.Tb(1),n.Ac("isAnimated",!1)("collapse",!i.visible[e.collectionId]),n.Tb(1),n.Ac("ngIf",e.loading),n.Tb(1),n.Ac("ngIf",!e.loading)}}function Wn(e,t){if(1&e){const e=n.lc();n.kc(0,"div",47),n.kc(1,"div",31),n.Sc(2,Gn,17,15,"div",32),n.vc(3,"paginate"),n.kc(4,"pagination-controls",33),n.sc("pageChange",(function(t){return n.Lc(e),n.uc().onPageChange(t)})),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.uc();n.Tb(2),n.Ac("ngForOf",n.xc(3,1,e.taskPage.resultSet,n.Gc(4,wn,e.taskPage.pageSize,e.taskPage.pageNumber,e.taskPage.count)))}}class Bn{constructor(e,t){this.managementService=e,this.modalService=t,this.userName="",this.totalTaskCount=0,this.activeTab="all",this.showSite=!1,this.showUploads=!1,this.showProcess=!1,this.showStore=!1,this.taskPage={count:0,pageSize:10,pageNumber:1,resultSet:[]},this.errorStatuses=["Failed","Processing"],this.completeStatuses=["Complete"],this.statuses=[],this.token=0,this.messages={count:0,pageSize:5,pageNumber:1,resultSet:[]}}ngOnInit(){this.userName=this.managementService.getCurrentUser(),this.managementService.tasks([],this.taskPage.pageSize,this.taskPage.pageNumber,this.token).then(e=>{this.setTaskData(e)}),this.getMissingMetadata();let e="wss://"+window.location.hostname+(window.location.port?":"+window.location.port:"")+acp;this.notifier=Object(Jt.a)(e+"/websocket/notify"),this.notifier.subscribe(e=>{"JOB_CHANGE"===e.type&&this.managementService.tasks(this.statuses,this.taskPage.pageSize,this.taskPage.pageNumber,this.token).then(e=>{e.token===this.token&&this.updateTaskData(e)})})}ngOnDestroy(){this.notifier.complete()}onPageChange(e){this.token++,this.managementService.tasks(this.statuses,this.taskPage.pageSize,e,this.token).then(e=>{this.setTaskData(e)})}onTabClick(e,t){if(this.activeTab=t,this.taskPage={count:0,pageSize:20,pageNumber:1,resultSet:[]},this.token++,"success"===t?this.statuses=this.completeStatuses:"action-required"===t?this.statuses=this.errorStatuses:"all"===t&&(this.statuses=[]),this.managementService.tasks(this.statuses,this.taskPage.pageSize,this.taskPage.pageNumber,this.token).then(e=>{this.setTaskData(e)}),!e.target.parentNode.classList.contains("active")){let t=e.target.parentNode.parentNode.getElementsByTagName("li");for(let e=0;e<t.length;e++){let c=t[e];c.classList.forEach(e=>{"active"===e&&c.classList.remove("active")})}e.target.parentNode.classList.add("active")}}setTaskData(e){this.taskPage=e,this.visible={},this.taskPage.resultSet.forEach(e=>{this.visible[e.collectionId]=!1})}setGroupTasks(e,t){e.groups=[],e.groups.push({tasks:[],status:null,type:"UPLOAD"}),e.groups.push({tasks:[],status:null,type:"PROCESS"}),e.groups.push({tasks:[],status:null,type:"STORE"});for(let c=0;c<t.length;c++){let n=t[c];if("gov.geoplatform.uasdm.bus.WorkflowTask"===n.type){let t=e.groups.findIndex(e=>"UPLOAD"===e.type);-1===t?e.groups.push({tasks:[n],status:n.status,type:"UPLOAD"}):e.groups[t].tasks.push(n)}else if("gov.geoplatform.uasdm.odm.ODMProcessingTask"===n.type){let t=e.groups.findIndex(e=>"PROCESS"===e.type);-1===t?e.groups.push({tasks:[n],status:n.status,type:"PROCESS"}):e.groups[t].tasks.push(n)}else if("gov.geoplatform.uasdm.odm.ODMUploadTask"===n.type){let t=e.groups.findIndex(e=>"STORE"===e.type);-1===t?e.groups.push({tasks:[n],status:n.status,type:"STORE"}):e.groups[t].tasks.push(n)}}this.setTaskGroupStatuses(e)}setTaskGroupStatuses(e){let t=null;e.groups.forEach(e=>{let c=!1;if(e.tasks.length>0){const n=e.tasks.sort((e,t)=>new Date(t.lastUpdateDate).getTime()-new Date(e.lastUpdateDate).getTime());e.status=n[0].status;const i=new Date(n[0].lastUpdateDate);c=null==t||t.getTime()-i.getTime()<=0,c&&(t=i),"Complete"===e.status&&n[0].actions.length>0&&(e.status="Warning")}})}updateTaskData(e){this.taskPage=e,this.taskPage.resultSet.forEach(e=>{this.visible[e.collectionId]&&this.managementService.getTasks(e.collectionId).then(t=>{this.setGroupTasks(e,t)})})}setVisibility(e){this.visible[e.collectionId]?this.visible[e.collectionId]=!1:(this.visible[e.collectionId]=!0,null!=e.groups||e.loading||(e.loading=!0,this.managementService.getTasks(e.collectionId).then(t=>{this.setGroupTasks(e,t),e.loading=!1})))}handleMessage(e){this.bsModalRef=this.modalService.show(ce,{animated:!0,backdrop:!0,ignoreBackdropClick:!0,class:"upload-modal"}),this.bsModalRef.content.init(e.collectionId),this.bsModalRef.content.onMetadataChange.subscribe(e=>{let t=-1;for(let c=0;c<this.messages.resultSet.length;c++){this.messages.resultSet[c].collectionId===e&&(t=c)}t>=0&&this.messages.resultSet.splice(t,1)})}handleGoto(e){this.managementService.view(e).then(t=>{const c=t.item,n=t.breadcrumbs;this.managementService.getItems(e,null).then(e=>{this.bsModalRef=this.modalService.show(xe,{animated:!0,backdrop:!0,ignoreBackdropClick:!0,class:"leaf-modal"}),this.bsModalRef.content.init(c,e,n)})})}removeTask(e){this.bsModalRef=this.modalService.show(I.a,{animated:!0,backdrop:!0,ignoreBackdropClick:!0}),this.bsModalRef.content.message="Are you sure you want to delete ["+e.label+"?",this.bsModalRef.content.data=e,this.bsModalRef.content.type="DANGER",this.bsModalRef.content.submitText="Delete",this.bsModalRef.content.onConfirm.subscribe(e=>{this.deleteTask(e)})}deleteTask(e){this.managementService.removeTask(e.uploadId).then(()=>{let t=null;for(let c=0;c<this.tasks.resultSet.length;c++){if(this.tasks[c].uploadId===e.uploadId){t=c;break}}null!==t&&this.tasks.resultSet.splice(t,1),this.getMissingMetadata(),this.totalTaskCount=this.tasks.count})}getMissingMetadata(){this.onMessagePageChange(this.messages.pageNumber)}onMessagePageChange(e){this.managementService.getMissingMetadata(this.messages.pageSize,e).then(e=>{this.messages=e})}}Bn.ɵfac=function(e){return new(e||Bn)(n.fc(D),n.fc(E.b))},Bn.ɵcmp=n.Zb({type:Bn,selectors:[["tasks"]],decls:25,vars:5,consts:[[3,"title"],["id","app-container",1,"container-fluid",2,"padding-top","20px"],[1,"row"],[1,"col-sm-1"],[1,"col-sm-10"],["id","tasks"],[4,"ngIf"],[1,"row",2,"margin-bottom","40px"],["role","tablist",1,"nav","nav-tabs"],[1,"active"],["role","tab","data-toggle","tab",3,"click"],[1,"tab-content"],["class","tab-pane active","id","action-required",4,"ngIf"],["class","tab-pane active","id","success",4,"ngIf"],["class","tab-pane active","id","all",4,"ngIf"],["id","tasks-container"],[1,"col-sm-7"],[1,"col-sm-5",2,"text-align","right","padding-right","8em"],["class","panel panel-default",4,"ngFor","ngForOf"],["id","message-pg-ctrl",3,"pageChange"],[1,"panel","panel-default"],[1,"panel-body"],[1,"dot","pending",2,"margin-left","0"],[2,"margin-top","10px","margin-bottom","0","color","grey"],[1,"breadcrumb",2,"color","grey"],[4,"ngFor","ngForOf"],[2,"color","#007276",3,"click"],[1,"col-sm-5",2,"text-align","right"],[1,"btn","btn-default",3,"click"],[1,"btn","btn-primary",2,"margin-left","10px",3,"click"],["id","action-required",1,"tab-pane","active"],[1,"panel-group"],["class","panel panel-default","style","background: none;border: none;",4,"ngFor","ngForOf"],["id","tasks-pg-ctrl",3,"pageChange"],[1,"panel","panel-default",2,"background","none","border","none"],[1,"panel-heading","clickable"],[1,"panel-title",2,"display","inline-block","vertical-align","middle"],["data-toggle","collapse",3,"click"],[1,"dot",3,"ngClass"],[1,"btn","btn-default","pull-right",3,"click"],[1,"panel-body",3,"isAnimated","collapse"],["class","fa fa-spinner fa-spin task-group-loading",4,"ngIf"],[1,"fa","fa-spinner","fa-spin","task-group-loading"],[3,"id",4,"ngIf"],[3,"id"],[3,"taskGroupType","groupTypeId","taskCategory"],["id","success",1,"tab-pane","active"],["id","all",1,"tab-pane","active"]],template:function(e,t){1&e&&(n.gc(0,"uasdm-header",0),n.kc(1,"div",1),n.kc(2,"div",2),n.gc(3,"div",3),n.kc(4,"div",4),n.kc(5,"div",5),n.Sc(6,gn,13,8,"div",6),n.jc(),n.jc(),n.gc(7,"div",3),n.jc(),n.kc(8,"div",7),n.gc(9,"div",3),n.kc(10,"div",4),n.kc(11,"h3"),n.Uc(12,"Processing Jobs"),n.jc(),n.kc(13,"ul",8),n.kc(14,"li",9),n.kc(15,"a",10),n.sc("click",(function(e){return t.onTabClick(e,"all")})),n.Uc(16,"All"),n.jc(),n.jc(),n.kc(17,"li"),n.kc(18,"a",10),n.sc("click",(function(e){return t.onTabClick(e,"action-required")})),n.Uc(19,"Action Required"),n.jc(),n.jc(),n.jc(),n.kc(20,"div",11),n.Sc(21,Mn,5,8,"div",12),n.Sc(22,Ln,5,8,"div",13),n.Sc(23,Wn,5,8,"div",14),n.jc(),n.jc(),n.gc(24,"div",3),n.jc(),n.jc()),2&e&&(n.Ac("title","Tasks"),n.Tb(6),n.Ac("ngIf",t.messages&&t.messages.count>0),n.Tb(15),n.Ac("ngIf","action-required"===t.activeTab),n.Tb(1),n.Ac("ngIf","success"===t.activeTab),n.Tb(1),n.Ac("ngIf","all"===t.activeTab))},directives:[Zt.a,i.l,i.k,h.c,i.j,g.a,dn],pipes:[h.b],styles:["#app-container[_ngcontent-%COMP%] {\n    background: #f7f7f7;\n}\n\n#tasks-container[_ngcontent-%COMP%] {\n    padding: 20px;\n    background: white;\n    border-radius: 6px;\n}\n\n#tasks[_ngcontent-%COMP%]   .panel-body[_ngcontent-%COMP%] {\n    background: #e9e9e9;\n}\n#tasks[_ngcontent-%COMP%]   .panel-footer[_ngcontent-%COMP%] {\n    background: #e9e9e9;\n}\n\n.task-container[_ngcontent-%COMP%]{\n    border-bottom: solid lightgrey 1px;\n    padding: 10px;\n    margin-bottom: 20px;\n}\n\n.panel-body[_ngcontent-%COMP%]{\n    background: white;\n}\n.panel-body.collapse[_ngcontent-%COMP%]{\n    padding: 0;\n}\n.panel-body.collapse.in.show[_ngcontent-%COMP%]{\n    padding: 20px;\n    max-height: fit-content;\n}\n\n.task-group-loading[_ngcontent-%COMP%] {\n}\n\n.panel-group[_ngcontent-%COMP%] {\n    margin-bottom: 0;\n}\n\n.panel-heading[_ngcontent-%COMP%] {\n  background-color: #e9e9e9;\n  margin-top: 20px;\n}\n\n.panel-heading.panel-heading-light[_ngcontent-%COMP%] {\n  background: none;\n  border-bottom: 2px solid lightgrey;\n  padding-left: 0;\n  padding-right: 0;\n}\n\n.panel-heading.panel-heading-light[_ngcontent-%COMP%]   .panel-title[_ngcontent-%COMP%] {\n    display: inline-block;\n}\n.panel-heading.panel-heading-light[_ngcontent-%COMP%]   .heading-status-label[_ngcontent-%COMP%] {\n    display: inline-block;\n    vertical-align: middle;\n    line-height: 40px;\n}\n\n.panel-heading.panel-heading-light[_ngcontent-%COMP%]   .heading-status-label[_ngcontent-%COMP%]   .success[_ngcontent-%COMP%] {\n    color: #6CB46F;\n}\n.panel-heading.panel-heading-light[_ngcontent-%COMP%]   .heading-status-label[_ngcontent-%COMP%]   .warning[_ngcontent-%COMP%] {\n    color: #2C88CB;\n}\n.panel-heading.panel-heading-light[_ngcontent-%COMP%]   .heading-status-label[_ngcontent-%COMP%]   .pending[_ngcontent-%COMP%] {\n    color: #FF8C42;\n}\n.panel-heading.panel-heading-light[_ngcontent-%COMP%]   .heading-status-label[_ngcontent-%COMP%]   .fail[_ngcontent-%COMP%] {\n    color: #BF1E1E;\n}\n\nb.success[_ngcontent-%COMP%] {\n    color: #6CB46F;\n}\nb.pending[_ngcontent-%COMP%] {\n    color: #FF8C42;\n}\nb.fail[_ngcontent-%COMP%] {\n    color: #BF1E1E;\n}\n\n.nav-tabs[_ngcontent-%COMP%]    > li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%] {\n    color: grey;\n}\n.nav-tabs[_ngcontent-%COMP%]    > li.active[_ngcontent-%COMP%]   a[_ngcontent-%COMP%] {\n    color: #007276;\n}\n.nav-tabs[_ngcontent-%COMP%]    > li[_ngcontent-%COMP%]    > a[_ngcontent-%COMP%]:hover {\n  background-color: #e4e4e4;\n  cursor: pointer;\n  color: #007276;\n}"]});class qn{constructor(e,t,c){this.http=e,this.noErrorHttpClient=t,this.eventService=c}page(e){let t=new v.g;return t=t.set("number",e.toString()),this.eventService.start(),this.http.get(acp+"/sensor/page",{params:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}edit(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.http.post(acp+"/sensor/lock",JSON.stringify({oid:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}newInstance(){let e=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.http.post(acp+"/sensor/newInstance",JSON.stringify({}),{headers:e}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}remove(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.http.post(acp+"/sensor/remove",JSON.stringify({oid:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}apply(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.noErrorHttpClient.post(acp+"/sensor/apply",JSON.stringify({sensor:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}unlock(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.noErrorHttpClient.post(acp+"/sensor/unlock",JSON.stringify({oid:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}}function Hn(e,t){if(1&e&&(n.kc(0,"div",14),n.kc(1,"div",15),n.kc(2,"strong"),n.Uc(3,"Error"),n.jc(),n.jc(),n.kc(4,"div",16),n.kc(5,"div"),n.kc(6,"p",17),n.Uc(7),n.jc(),n.jc(),n.jc(),n.jc()),2&e){const e=n.uc(2);n.Tb(7),n.Vc(e.message)}}function Jn(e,t){if(1&e){const e=n.lc();n.kc(0,"div"),n.kc(1,"boolean-field",18),n.sc("valueChange",(function(c){n.Lc(e);const i=t.$implicit;return n.uc(2).updateSelectedWaveLength(i,c)})),n.jc(),n.jc()}if(2&e){const e=t.$implicit,c=n.uc(2);n.Tb(1),n.Ac("value",c.sensor.waveLength&&-1!==c.sensor.waveLength.indexOf(e))("label",e)}}function Zn(e,t){if(1&e){const e=n.lc();n.kc(0,"div",1),n.Sc(1,Hn,8,1,"div",2),n.kc(2,"div",3),n.kc(3,"h3"),n.Uc(4,"Sensor"),n.jc(),n.jc(),n.kc(5,"form",null,4),n.kc(7,"div",5),n.kc(8,"label"),n.Uc(9,"Name"),n.jc(),n.kc(10,"input",6),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc().sensor.name=t})),n.jc(),n.jc(),n.kc(11,"div",5),n.kc(12,"label"),n.Uc(13,"Label"),n.jc(),n.kc(14,"input",7),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc().sensor.displayLabel=t})),n.jc(),n.jc(),n.kc(15,"div",5),n.kc(16,"label"),n.Uc(17,"Type"),n.jc(),n.kc(18,"input",8),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc().sensor.sensorType=t})),n.jc(),n.jc(),n.kc(19,"div",5),n.kc(20,"label"),n.Uc(21,"Model"),n.jc(),n.kc(22,"input",9),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc().sensor.model=t})),n.jc(),n.jc(),n.kc(23,"div",5),n.kc(24,"label"),n.Uc(25,"Wave Length"),n.jc(),n.Sc(26,Jn,2,2,"div",10),n.jc(),n.kc(27,"div",11),n.kc(28,"button",12),n.sc("click",(function(){return n.Lc(e),n.uc().handleOnCancel()})),n.Uc(29,"Cancel"),n.jc(),n.kc(30,"button",13),n.sc("click",(function(){return n.Lc(e),n.uc().handleOnSubmit()})),n.Uc(31,"Apply"),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.Jc(6),t=n.uc();n.Tb(1),n.Ac("ngIf",null!=t.message),n.Tb(9),n.Ac("ngModel",t.sensor.name)("disabled",!t.newInstance),n.Tb(4),n.Ac("ngModel",t.sensor.displayLabel),n.Tb(4),n.Ac("ngModel",t.sensor.sensorType),n.Tb(4),n.Ac("ngModel",t.sensor.model),n.Tb(4),n.Ac("ngForOf",t.waveLengths),n.Tb(4),n.Ac("disabled",!e.valid)}}qn.ɵfac=function(e){return new(e||qn)(n.oc(v.c),n.oc(L.a),n.oc(R.a))},qn.ɵprov=n.bc({token:qn,factory:qn.ɵfac});class Yn{constructor(e,t){this.service=e,this.bsModalRef=t,this.newInstance=!1,this.message=null,this.waveLengths=q}ngOnInit(){this.onSensorChange=new W.b}handleOnSubmit(){this.message=null,this.service.apply(this.sensor).then(e=>{this.onSensorChange.next(e),this.bsModalRef.hide()}).catch(e=>{this.error(e)})}handleOnCancel(){this.message=null,this.newInstance?this.bsModalRef.hide():this.service.unlock(this.sensor.oid).then(e=>{this.bsModalRef.hide()}).catch(e=>{this.error(e)})}updateSelectedWaveLength(e,t){const c=this.sensor.waveLength.indexOf(e);t?c<0&&this.sensor.waveLength.push(e):c>-1&&this.sensor.waveLength.splice(c,1)}error(e){this.message=U.b.getMessageFromError(e)}}Yn.ɵfac=function(e){return new(e||Yn)(n.fc(qn),n.fc(E.a))},Yn.ɵcmp=n.Zb({type:Yn,selectors:[["sensor"]],decls:1,vars:1,consts:[["class","modal-body",4,"ngIf"],[1,"modal-body"],["class","error-container",4,"ngIf"],[1,"modal-title-container"],["ngForm","ngForm"],[1,"form-group"],["name","name","type","input","placeholder","Name","required","",1,"form-control",3,"ngModel","disabled","ngModelChange"],["name","displayLabel","type","input","placeholder","Display Label","required","",1,"form-control",3,"ngModel","ngModelChange"],["name","sensorType","type","input","placeholder","Type","required","",1,"form-control",3,"ngModel","ngModelChange"],["name","model","type","input","placeholder","Model","required","",1,"form-control",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],[1,"btn-holder",2,"text-align","right"],["type","button",1,"btn","btn-default",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[1,"error-container"],[1,"label-holder"],[1,"holder"],[1,"error-message"],[3,"value","label","valueChange"]],template:function(e,t){1&e&&n.Sc(0,Zn,32,8,"div",0),2&e&&n.Ac("ngIf",null!=t.sensor)},directives:[i.l,a.r,a.i,a.j,a.a,a.o,a.h,a.k,i.k,J.a],encapsulation:2});var Kn=c(35);function Qn(e,t){if(1&e){const e=n.lc();n.kc(0,"pagination-controls",8),n.sc("pageChange",(function(t){return n.Lc(e),n.uc().onPageChange(t)})),n.jc()}}function Xn(e,t){if(1&e){const e=n.lc();n.kc(0,"tr",9),n.kc(1,"td",6),n.kc(2,"a",10),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc().edit(c)})),n.jc(),n.kc(3,"a",11),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc().onClickRemove(c)})),n.jc(),n.jc(),n.kc(4,"td",4),n.Uc(5),n.jc(),n.kc(6,"td",4),n.Uc(7),n.jc(),n.kc(8,"td",4),n.Uc(9),n.jc(),n.kc(10,"td",4),n.Uc(11),n.jc(),n.jc()}if(2&e){const e=t.$implicit;n.Tb(5),n.Vc(e.name),n.Tb(2),n.Vc(e.displayLabel),n.Tb(2),n.Vc(e.sensorType),n.Tb(2),n.Vc(e.model)}}function ei(e,t){if(1&e){const e=n.lc();n.kc(0,"pagination-controls",8),n.sc("pageChange",(function(t){return n.Lc(e),n.uc().onPageChange(t)})),n.jc()}}const ti=function(e,t,c){return{itemsPerPage:e,currentPage:t,totalItems:c}};class ci{constructor(e,t,c,n){this.router=e,this.service=t,this.modalService=c,this.localizeService=n,this.res={resultSet:[],count:0,pageNumber:1,pageSize:10},this.message=null}ngOnInit(){this.service.page(1).then(e=>{this.res=e})}remove(e){this.service.remove(e.oid).then(t=>{this.res.resultSet=this.res.resultSet.filter(t=>t.oid!==e.oid)})}onClickRemove(e){this.bsModalRef=this.modalService.show(I.a,{animated:!0,backdrop:!0,ignoreBackdropClick:!0}),this.bsModalRef.content.message="Are you sure you want to remove the sensor ["+e.name+"]",this.bsModalRef.content.type="DANGER",this.bsModalRef.content.submitText="Delete",this.bsModalRef.content.onConfirm.subscribe(t=>{this.remove(e)})}edit(e){this.service.edit(e.oid).then(e=>{this.showModal(e,!1)})}newInstance(){this.service.newInstance().then(e=>{this.showModal(e,!0)})}showModal(e,t){this.bsModalRef=this.modalService.show(Yn,{animated:!0,backdrop:!0,ignoreBackdropClick:!0}),this.bsModalRef.content.sensor=e,this.bsModalRef.content.newInstance=t;this.bsModalRef.content.onSensorChange.subscribe(e=>{this.onPageChange(this.res.pageNumber)})}onPageChange(e){this.service.page(e).then(e=>{this.res=e})}}ci.ɵfac=function(e){return new(e||ci)(n.fc(s.b),n.fc(qn),n.fc(E.b),n.fc(Kn.a))},ci.ɵcmp=n.Zb({type:ci,selectors:[["sensors"]],decls:26,vars:10,consts:[["id","app-container",1,"container"],[3,"pageChange",4,"ngIf"],[1,"list-table-wrapper"],["id","manage-sensors-table",1,"list-table","table","table-bordered","table-striped"],[1,"label-column"],["class","fade-ngRepeat-item",4,"ngFor","ngForOf"],[1,"button-column"],["title","Add new sensor",1,"fa","fa-plus",3,"click"],[3,"pageChange"],[1,"fade-ngRepeat-item"],["title","Edit sensor",1,"fa","fa-pencil-alt","ico-edit",3,"click"],["title","Remove sensor",1,"fa","fa-trash-alt","ico-remove",3,"click"]],template:function(e,t){1&e&&(n.kc(0,"div"),n.gc(1,"uasdm-header"),n.kc(2,"div",0),n.kc(3,"h2"),n.Uc(4,"Sensors"),n.jc(),n.Sc(5,Qn,1,0,"pagination-controls",1),n.kc(6,"div",2),n.kc(7,"table",3),n.kc(8,"thead"),n.kc(9,"tr"),n.gc(10,"th"),n.kc(11,"th",4),n.Uc(12,"Name"),n.jc(),n.kc(13,"th",4),n.Uc(14,"Label"),n.jc(),n.kc(15,"th",4),n.Uc(16,"Type"),n.jc(),n.kc(17,"th",4),n.Uc(18,"Model"),n.jc(),n.jc(),n.jc(),n.kc(19,"tbody"),n.Sc(20,Xn,12,4,"tr",5),n.vc(21,"paginate"),n.kc(22,"tr"),n.kc(23,"td",6),n.kc(24,"a",7),n.sc("click",(function(){return t.newInstance()})),n.jc(),n.jc(),n.jc(),n.jc(),n.jc(),n.jc(),n.Sc(25,ei,1,0,"pagination-controls",1),n.jc(),n.jc()),2&e&&(n.Tb(5),n.Ac("ngIf",t.res.resultSet.length>t.res.pageSize),n.Tb(15),n.Ac("ngForOf",n.xc(21,3,t.res.resultSet,n.Gc(6,ti,t.res.pageSize,t.res.pageNumber,t.res.count))),n.Tb(5),n.Ac("ngIf",t.res.resultSet.length>t.res.pageSize))},directives:[Zt.a,i.l,i.k,h.c],pipes:[h.b],styles:["./sensors.css"]});class ni{constructor(e,t,c){this.http=e,this.noErrorHttpClient=t,this.eventService=c}page(e){let t=new v.g;return t=t.set("number",e.toString()),this.eventService.start(),this.http.get(acp+"/platform/page",{params:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}edit(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.http.post(acp+"/platform/lock",JSON.stringify({oid:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}newInstance(){let e=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.http.post(acp+"/platform/newInstance",JSON.stringify({}),{headers:e}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}remove(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.http.post(acp+"/platform/remove",JSON.stringify({oid:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}apply(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.noErrorHttpClient.post(acp+"/platform/apply",JSON.stringify({platform:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}unlock(e){let t=new v.f({"Content-Type":"application/json"});return this.eventService.start(),this.noErrorHttpClient.post(acp+"/platform/unlock",JSON.stringify({oid:e}),{headers:t}).pipe(Object(A.a)(()=>{this.eventService.complete()})).toPromise()}}function ii(e,t){if(1&e&&(n.kc(0,"div",12),n.kc(1,"div",13),n.kc(2,"strong"),n.Uc(3,"Error"),n.jc(),n.jc(),n.kc(4,"div",14),n.kc(5,"div"),n.kc(6,"p",15),n.Uc(7),n.jc(),n.jc(),n.jc(),n.jc()),2&e){const e=n.uc(2);n.Tb(7),n.Vc(e.message)}}function si(e,t){if(1&e){const e=n.lc();n.kc(0,"div",1),n.Sc(1,ii,8,1,"div",2),n.kc(2,"div",3),n.kc(3,"h3"),n.Uc(4,"Platform"),n.jc(),n.jc(),n.kc(5,"form",null,4),n.kc(7,"div",5),n.kc(8,"label"),n.Uc(9,"Name"),n.jc(),n.kc(10,"input",6),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc().platform.name=t})),n.jc(),n.jc(),n.kc(11,"div",5),n.kc(12,"label"),n.Uc(13,"Label"),n.jc(),n.kc(14,"input",7),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc().platform.displayLabel=t})),n.jc(),n.jc(),n.kc(15,"div",5),n.kc(16,"label"),n.Uc(17,"Type"),n.jc(),n.kc(18,"select",8),n.sc("ngModelChange",(function(t){return n.Lc(e),n.uc().platform.platformType=t})),n.gc(19,"option"),n.kc(20,"option"),n.Uc(21,"Fixed Wing"),n.jc(),n.kc(22,"option"),n.Uc(23,"Hybrid"),n.jc(),n.kc(24,"option"),n.Uc(25,"Multi-rotor"),n.jc(),n.kc(26,"option"),n.Uc(27,"Helicopter"),n.jc(),n.kc(28,"option"),n.Uc(29,"VTOL Fixed-wing"),n.jc(),n.kc(30,"option"),n.Uc(31,"Quadcopter"),n.jc(),n.jc(),n.jc(),n.kc(32,"div",9),n.kc(33,"button",10),n.sc("click",(function(){return n.Lc(e),n.uc().handleOnCancel()})),n.Uc(34,"Cancel"),n.jc(),n.kc(35,"button",11),n.sc("click",(function(){return n.Lc(e),n.uc().handleOnSubmit()})),n.Uc(36,"Apply"),n.jc(),n.jc(),n.jc(),n.jc()}if(2&e){const e=n.Jc(6),t=n.uc();n.Tb(1),n.Ac("ngIf",null!=t.message),n.Tb(9),n.Ac("ngModel",t.platform.name)("disabled",!t.newInstance),n.Tb(4),n.Ac("ngModel",t.platform.displayLabel),n.Tb(4),n.Ac("ngModel",t.platform.platformType),n.Tb(17),n.Ac("disabled",!e.valid)}}ni.ɵfac=function(e){return new(e||ni)(n.oc(v.c),n.oc(L.a),n.oc(R.a))},ni.ɵprov=n.bc({token:ni,factory:ni.ɵfac});class ai{constructor(e,t){this.service=e,this.bsModalRef=t,this.newInstance=!1,this.message=null}ngOnInit(){this.onPlatformChange=new W.b}handleOnSubmit(){this.message=null,this.service.apply(this.platform).then(e=>{this.onPlatformChange.next(e),this.bsModalRef.hide()}).catch(e=>{this.error(e)})}handleOnCancel(){this.message=null,this.newInstance?this.bsModalRef.hide():this.service.unlock(this.platform.oid).then(e=>{this.bsModalRef.hide()}).catch(e=>{this.error(e)})}error(e){this.message=U.b.getMessageFromError(e)}}function oi(e,t){if(1&e){const e=n.lc();n.kc(0,"pagination-controls",8),n.sc("pageChange",(function(t){return n.Lc(e),n.uc().onPageChange(t)})),n.jc()}}function li(e,t){if(1&e){const e=n.lc();n.kc(0,"tr",9),n.kc(1,"td",6),n.kc(2,"a",10),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc().edit(c)})),n.jc(),n.kc(3,"a",11),n.sc("click",(function(){n.Lc(e);const c=t.$implicit;return n.uc().onClickRemove(c)})),n.jc(),n.jc(),n.kc(4,"td",4),n.Uc(5),n.jc(),n.kc(6,"td",4),n.Uc(7),n.jc(),n.kc(8,"td",4),n.Uc(9),n.jc(),n.jc()}if(2&e){const e=t.$implicit;n.Tb(5),n.Vc(e.name),n.Tb(2),n.Vc(e.displayLabel),n.Tb(2),n.Vc(e.platformType)}}function ri(e,t){if(1&e){const e=n.lc();n.kc(0,"pagination-controls",8),n.sc("pageChange",(function(t){return n.Lc(e),n.uc().onPageChange(t)})),n.jc()}}ai.ɵfac=function(e){return new(e||ai)(n.fc(ni),n.fc(E.a))},ai.ɵcmp=n.Zb({type:ai,selectors:[["platform"]],decls:1,vars:1,consts:[["class","modal-body",4,"ngIf"],[1,"modal-body"],["class","error-container",4,"ngIf"],[1,"modal-title-container"],["ngForm","ngForm"],[1,"form-group"],["name","name","type","input","placeholder","Name","required","",1,"form-control",3,"ngModel","disabled","ngModelChange"],["name","displayLabel","type","input","placeholder","Display Label","required","",1,"form-control",3,"ngModel","ngModelChange"],["name","platformType","type","input","required","",1,"form-control",3,"ngModel","ngModelChange"],[1,"btn-holder",2,"text-align","right"],["type","button",1,"btn","btn-default",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[1,"error-container"],[1,"label-holder"],[1,"holder"],[1,"error-message"]],template:function(e,t){1&e&&n.Sc(0,si,37,6,"div",0),2&e&&n.Ac("ngIf",null!=t.platform)},directives:[i.l,a.r,a.i,a.j,a.a,a.o,a.h,a.k,a.p,a.l,a.q],encapsulation:2});const di=function(e,t,c){return{itemsPerPage:e,currentPage:t,totalItems:c}};class ui{constructor(e,t,c,n){this.router=e,this.service=t,this.modalService=c,this.localizeService=n,this.res={resultSet:[],count:0,pageNumber:1,pageSize:10},this.message=null}ngOnInit(){this.service.page(1).then(e=>{this.res=e})}remove(e){this.service.remove(e.oid).then(t=>{this.res.resultSet=this.res.resultSet.filter(t=>t.oid!==e.oid)})}onClickRemove(e){this.bsModalRef=this.modalService.show(I.a,{animated:!0,backdrop:!0,ignoreBackdropClick:!0}),this.bsModalRef.content.message="Are you sure you want to remove the platform ["+e.name+"]",this.bsModalRef.content.type="DANGER",this.bsModalRef.content.submitText="Delete",this.bsModalRef.content.onConfirm.subscribe(t=>{this.remove(e)})}edit(e){this.service.edit(e.oid).then(e=>{this.showModal(e,!1)})}newInstance(){this.service.newInstance().then(e=>{this.showModal(e,!0)})}showModal(e,t){this.bsModalRef=this.modalService.show(ai,{animated:!0,backdrop:!0,ignoreBackdropClick:!0}),this.bsModalRef.content.platform=e,this.bsModalRef.content.newInstance=t;this.bsModalRef.content.onPlatformChange.subscribe(e=>{this.onPageChange(this.res.pageNumber)})}onPageChange(e){this.service.page(e).then(e=>{this.res=e})}}ui.ɵfac=function(e){return new(e||ui)(n.fc(s.b),n.fc(ni),n.fc(E.b),n.fc(Kn.a))},ui.ɵcmp=n.Zb({type:ui,selectors:[["platforms"]],decls:24,vars:10,consts:[["id","app-container",1,"container"],[3,"pageChange",4,"ngIf"],[1,"list-table-wrapper"],["id","manage-platforms-table",1,"list-table","table","table-bordered","table-striped"],[1,"label-column"],["class","fade-ngRepeat-item",4,"ngFor","ngForOf"],[1,"button-column"],["title","Add new platform",1,"fa","fa-plus",3,"click"],[3,"pageChange"],[1,"fade-ngRepeat-item"],["title","Edit platform",1,"fa","fa-pencil-alt","ico-edit",3,"click"],["title","Remove platform",1,"fa","fa-trash-alt","ico-remove",3,"click"]],template:function(e,t){1&e&&(n.kc(0,"div"),n.gc(1,"uasdm-header"),n.kc(2,"div",0),n.kc(3,"h2"),n.Uc(4,"Platforms"),n.jc(),n.Sc(5,oi,1,0,"pagination-controls",1),n.kc(6,"div",2),n.kc(7,"table",3),n.kc(8,"thead"),n.kc(9,"tr"),n.gc(10,"th"),n.kc(11,"th",4),n.Uc(12,"Name"),n.jc(),n.kc(13,"th",4),n.Uc(14,"Label"),n.jc(),n.kc(15,"th",4),n.Uc(16,"Type"),n.jc(),n.jc(),n.jc(),n.kc(17,"tbody"),n.Sc(18,li,10,3,"tr",5),n.vc(19,"paginate"),n.kc(20,"tr"),n.kc(21,"td",6),n.kc(22,"a",7),n.sc("click",(function(){return t.newInstance()})),n.jc(),n.jc(),n.jc(),n.jc(),n.jc(),n.jc(),n.Sc(23,ri,1,0,"pagination-controls",1),n.jc(),n.jc()),2&e&&(n.Tb(5),n.Ac("ngIf",t.res.resultSet.length>t.res.pageSize),n.Tb(13),n.Ac("ngForOf",n.xc(19,3,t.res.resultSet,n.Gc(6,di,t.res.pageSize,t.res.pageNumber,t.res.count))),n.Tb(5),n.Ac("ngIf",t.res.resultSet.length>t.res.pageSize))},directives:[Zt.a,i.l,i.k,h.c],pipes:[h.b],styles:["./platforms.css"]});class pi{validate(e){return(t=new RegExp(/[\W<>\-+=!@#$%^&*?/\\']/gm),e=>t.test(e.value)?{forbiddenName:{value:e.value}}:null)(e);var t}}pi.ɵfac=function(e){return new(e||pi)},pi.ɵdir=n.ac({type:pi,selectors:[["","forbiddenName",""]],features:[n.Sb([{provide:a.f,useExisting:pi,multi:!0}])]});class hi{canDeactivate(e){return!e.canDeactivate()||!!confirm("An upload is currently in progress. Are you sure you want to leave?")}}hi.ɵfac=function(e){return new(e||hi)},hi.ɵprov=n.bc({token:hi,factory:hi.ɵfac});var gi=c(126);const fi=[{path:"",canActivate:[gi.b],component:Pc},{path:"viewer",canActivate:[gi.b],component:Pc},{path:"upload",component:qc,canDeactivate:[hi]},{path:"tasks",canActivate:[gi.b],component:Bn},{path:"sensors",canActivate:[gi.a],component:ci},{path:"platforms",canActivate:[gi.a],component:ui}];class mi{}mi.ɵmod=n.dc({type:mi}),mi.ɵinj=n.cc({factory:function(e){return new(e||mi)},providers:[{provide:i.i,useClass:i.f}],imports:[[s.e.forChild(fi)],s.e]}),("undefined"==typeof ngJitMode||ngJitMode)&&n.Oc(mi,{imports:[s.e],exports:[s.e]});var bi=c(92);class ki{}ki.ɵmod=n.dc({type:ki}),ki.ɵinj=n.cc({factory:function(e){return new(e||ki)},providers:[hi,D,Pe,y,qn,ni,se],imports:[[i.b,s.e,a.c,h.a,p.b,l.c,r.b,d.a,u.b.forRoot(),g.b.forRoot(),bi.a,mi,o.b]]}),("undefined"==typeof ngJitMode||ngJitMode)&&n.Oc(ki,{declarations:[O,et,pt,ce,G,$t,xe,Ht,Ge,Pc,qc,Bn,pi,H,Yn,ci,ai,ui,dn],imports:[i.b,s.e,a.c,h.a,p.b,l.c,r.b,d.a,u.b,g.b,bi.a,mi,o.b]})}}]);
//# sourceMappingURL=2.chunk.js.map