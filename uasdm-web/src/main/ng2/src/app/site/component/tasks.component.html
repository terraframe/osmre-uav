<uasdm-header [title]="'Tasks'"></uasdm-header>

<div id="app-container" class="container-fluid" style="padding-top:20px;">

  <div class="row">
    <div class="col-sm-1"></div>
    <div class="col-sm-10">
      <div id="tasks">

        <div *ngIf="messages && messages.length > 0">
          <h2>Tasks</h2>

          <div id="tasks-container">
            <div class="row">
              <h3 class="col-sm-6">Issue</h3>
              <h3 class="col-sm-3">Upload Date</h3>
              <h3 class="col-sm-3">Actions</h3>
            </div>
            <div class="panel panel-default" *ngFor="let message of messages">
              <!-- <div class="panel-heading">Panel heading without title</div> -->
          
              <div class="panel-body">
                <div class="row">
                  <div class="col-sm-6">
                    <div>{{message.message}}</div>
                    <div>Bread / crumb / to / collection</div>
                  </div>
                  <div class="col-sm-3">
                    <div>TODO: date</div>
                  </div>
                  <div class="col-sm-3" style="text-align: right;">
                    <div>
                      <button class="btn btn-default" (click)="handleGoto(message.collectionId)">View Collection</button>
                      <button class="btn btn-primary" (click)="handleMessage(message)">Add Metadata</button>
                    </div>
                  </div>
                </div>
              </div>
          
              <!-- <div class="panel-footer">Bread / crumb / to / collection</div> -->
            </div>
          </div>
          
        </div>

      </div>
    </div>
    <div class="col-sm-1"></div>
  </div>


  <div class="row" style="margin-bottom: 40px;">
    <div class="col-sm-1"></div>
    <div class="col-sm-10">
      <h3>Uploads</h3>

      <ul class="nav nav-tabs" role="tablist">
        <li class="active"><a role="tab" data-toggle="tab" (click)="onTabClick('action-required')">Action Required</a></li>
        <li class="active"><a role="tab" data-toggle="tab" (click)="onTabClick('success')">Successful</a></li>
        <!-- <li class="active"><a role="tab" data-toggle="tab" (click)="onTabClick('all')">All</a></li> -->
      </ul>

      <div class="tab-content" >

        <div *ngIf="activeTab === 'action-required'" class="tab-pane active" id="action-required">
          
          <div class="panel-group">
            <div *ngFor="let taskGroup of taskGroups; let idx=index" class="panel panel-default" style="background: none;border: none;">
            
                <div class="panel-heading clickable" style="margin-top: 20px;">
                  <h4 class="panel-title">
                    <a data-toggle="collapse" (click)="taskGroup.visible = !taskGroup.visible" [attr.aria-expanded]="!taskGroup.visible"
                      [attr.aria-controls]="'taskGroup'+ idx">
                      <h4>{{taskGroup.label}}</h4>
                      <!-- <ul class="list-inline" style="margin: 0;">
                        <li style="max-width: 80%;">{{task.label}}</li>
                        <li *ngIf="task.status === 'Failed'" class="pull-right" style="color:#e30000; max-width: 20%;">
                          <b>{{task.status}}</b></li>
                        <li *ngIf="task.status !== 'Complete' && task.status !== 'Failed'" class="pull-right"
                          style="color:green; max-width: 20%;"><b>{{task.status}}...</b></li>
                        <li *ngIf="task.status === 'Complete'" class="pull-right" style="color:grey; max-width: 20%;">
                          <b>{{task.status}}</b></li>
                      </ul> -->
                    </a>
                  </h4>
                </div>
            
                <div class="panel-body" [isAnimated]="false" [collapse]="!taskGroup.visible">
                  <div *ngFor="let task of taskGroup.group; let i=index">
                    <div [id]="'task'+ i">

                      <div *ngIf="task.type === 'gov.geoplatform.uasdm.bus.WorkflowTask'">
                      
                        <div class="panel-group">
                          <div *ngFor="let taskGroup of taskGroups; let idx=index" class="panel panel-default" style="background: none;border: none;">
                            <div class="panel-heading clickable" style="margin-top: 20px;">
                              <h4 class="panel-title">
                                <a data-toggle="collapse" (click)="showUploads = !showUploads"
                                  [attr.aria-expanded]="!taskGroup.visible" [attr.aria-controls]="'showUploads'+ idx">
                                  <h4>Upload</h4>
                                </a>
                              </h4>
                            </div>
                            <div class="panel-body" [isAnimated]="false" [collapse]="!showUploads">
                      
                              <div *ngIf="task.status !== 'Complete' && task.status !== 'Failed'">
                                <ul class="list-unstyled" style="margin: 0;">
                                  <li>Status: <b>{{task.status}}</b></li>
                                  <li style="word-break: break-all;">Message: <b>{{task.message}}</b></li>
                                  <li>Created on: <b>{{task.createDate}}</b></li>
                                  <li>Last update: <b>{{task.lastUpdatedDate}}</b></li>
                                </ul>
                                <button class="btn btn-danger" (click)="removeTask(task)">Delete Task</button>
                              </div>
                      
                              <div *ngIf="task.status === 'Complete' || task.status === 'Failed'">
                                <ul class="list-unstyled" style="margin: 0;">
                                  <li>Status: <b>{{task.status}}</b></li>
                                  <li>Message: <b>{{task.message}}</b></li>
                                  <li>Created on: <b>{{task.createDate}}</b></li>
                                  <li>Last update: <b>{{task.lastUpdatedDate}}</b></li>
                                </ul>
                      
                                <div class="table-row">
                                  <button class="btn btn-danger" (click)="removeTask(task)">Delete Task</button>
                                </div>
                                <hr>
                      
                                <h4 *ngIf="task.odmOutput != null">Output:</h4>
                                <textarea *ngIf="task.odmOutput != null" style="color:grey;width:500px;height:200px;"
                                  [innerHTML]="task.odmOutput"></textarea>
                      
                                <h4>Actions:</h4>
                                <h4 *ngIf="task.actions.length === 0" style="color:grey;">There are no actions for this task.</h4>
                                <table *ngIf="task.actions.length > 0" class="table table-bordered">
                                  <thead>
                                    <tr>
                                      <th>#</th>
                                      <th>Type</th>
                                      <th>Description</th>
                                      <th>Creation Date</th>
                                      <th>Last Updated</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr *ngFor="let action of task.actions; let i=index" [ngClass]="{'danger':action.type === 'error'}">
                                      <th scope="row">{{i + 1}}</th>
                                      <td>{{action.type}}</td>
                                      <td>{{action.description}}</td>
                                      <td>{{action.createDate}}</td>
                                      <td>{{action.lastUpdatedDate}}</td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>


                      <div *ngIf="task.type === 'gov.geoplatform.uasdm.odm.ODMProcessingTask'">
                      
                        <div class="panel-group">
                          <div *ngFor="let taskGroup of taskGroups; let idx=index" class="panel panel-default" style="background: none;border: none;">
                            <div class="panel-heading clickable" style="margin-top: 20px;">
                              <h4 class="panel-title">
                                <a data-toggle="collapse" (click)="showProcess = !showProcess"
                                  [attr.aria-expanded]="!taskGroup.visible" [attr.aria-controls]="'showProcess'+ idx">
                                  <h4>Process</h4>
                                </a>
                              </h4>
                            </div>
                            <div class="panel-body" [isAnimated]="false" [collapse]="!showProcess">
                      
                              <div *ngIf="task.status !== 'Complete' && task.status !== 'Failed'">
                                <ul class="list-unstyled" style="margin: 0;">
                                  <li>Status: <b>{{task.status}}</b></li>
                                  <li style="word-break: break-all;">Message: <b>{{task.message}}</b></li>
                                  <li>Created on: <b>{{task.createDate}}</b></li>
                                  <li>Last update: <b>{{task.lastUpdatedDate}}</b></li>
                                </ul>
                                <button class="btn btn-danger" (click)="removeTask(task)">Delete Task</button>
                              </div>
                      
                              <div *ngIf="task.status === 'Complete' || task.status === 'Failed'">
                                <ul class="list-unstyled" style="margin: 0;">
                                  <li>Status: <b>{{task.status}}</b></li>
                                  <li>Message: <b>{{task.message}}</b></li>
                                  <li>Created on: <b>{{task.createDate}}</b></li>
                                  <li>Last update: <b>{{task.lastUpdatedDate}}</b></li>
                                </ul>
                      
                                <div class="table-row">
                                  <button class="btn btn-danger" (click)="removeTask(task)">Delete Task</button>
                                </div>
                                <hr>
                      
                                <h4 *ngIf="task.odmOutput != null">Output:</h4>
                                <textarea *ngIf="task.odmOutput != null" style="color:grey;width:500px;height:200px;"
                                  [innerHTML]="task.odmOutput"></textarea>
                      
                                <h4>Actions:</h4>
                                <h4 *ngIf="task.actions.length === 0" style="color:grey;">There are no actions for this task.</h4>
                                <table *ngIf="task.actions.length > 0" class="table table-bordered">
                                  <thead>
                                    <tr>
                                      <th>#</th>
                                      <th>Type</th>
                                      <th>Description</th>
                                      <th>Creation Date</th>
                                      <th>Last Updated</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr *ngFor="let action of task.actions; let i=index" [ngClass]="{'danger':action.type === 'error'}">
                                      <th scope="row">{{i + 1}}</th>
                                      <td>{{action.type}}</td>
                                      <td>{{action.description}}</td>
                                      <td>{{action.createDate}}</td>
                                      <td>{{action.lastUpdatedDate}}</td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>


                      <div *ngIf="task.type === 'gov.geoplatform.uasdm.odm.ODMUploadTask'">
                      
                        <div class="panel-group">
                          <div *ngFor="let taskGroup of taskGroups; let idx=index" class="panel panel-default" style="background: none;border: none;">
                            <div class="panel-heading clickable" style="margin-top: 20px;">
                              <h4 class="panel-title">
                                <a data-toggle="collapse" (click)="showStore = !showStore"
                                  [attr.aria-expanded]="!taskGroup.visible" [attr.aria-controls]="'showStore'+ idx">
                                  <h4>Store</h4>
                                </a>
                              </h4>
                            </div>
                            <div class="panel-body" [isAnimated]="false" [collapse]="!showStore">
                      
                              <div *ngIf="task.status !== 'Complete' && task.status !== 'Failed'">
                                <ul class="list-unstyled" style="margin: 0;">
                                  <li>Status: <b>{{task.status}}</b></li>
                                  <li style="word-break: break-all;">Message: <b>{{task.message}}</b></li>
                                  <li>Created on: <b>{{task.createDate}}</b></li>
                                  <li>Last update: <b>{{task.lastUpdatedDate}}</b></li>
                                </ul>
                                <button class="btn btn-danger" (click)="removeTask(task)">Delete Task</button>
                              </div>
                      
                              <div *ngIf="task.status === 'Complete' || task.status === 'Failed'">
                                <ul class="list-unstyled" style="margin: 0;">
                                  <li>Status: <b>{{task.status}}</b></li>
                                  <li>Message: <b>{{task.message}}</b></li>
                                  <li>Created on: <b>{{task.createDate}}</b></li>
                                  <li>Last update: <b>{{task.lastUpdatedDate}}</b></li>
                                </ul>
                      
                                <div class="table-row">
                                  <button class="btn btn-danger" (click)="removeTask(task)">Delete Task</button>
                                </div>
                                <hr>
                      
                                <h4 *ngIf="task.odmOutput != null">Output:</h4>
                                <textarea *ngIf="task.odmOutput != null" style="color:grey;width:500px;height:200px;"
                                  [innerHTML]="task.odmOutput"></textarea>
                      
                                <h4>Actions:</h4>
                                <h4 *ngIf="task.actions.length === 0" style="color:grey;">There are no actions for this task.</h4>
                                <table *ngIf="task.actions.length > 0" class="table table-bordered">
                                  <thead>
                                    <tr>
                                      <th>#</th>
                                      <th>Type</th>
                                      <th>Description</th>
                                      <th>Creation Date</th>
                                      <th>Last Updated</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr *ngFor="let action of task.actions; let i=index" [ngClass]="{'danger':action.type === 'error'}">
                                      <th scope="row">{{i + 1}}</th>
                                      <td>{{action.type}}</td>
                                      <td>{{action.description}}</td>
                                      <td>{{action.createDate}}</td>
                                      <td>{{action.lastUpdatedDate}}</td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                
                    </div>
                  </div>
                </div>
            </div>
          </div>
        </div>

        <div *ngIf="activeTab === 'success'" class="tab-pane active" id="success">
          <div class="panel-group">
          </div>
        </div>

        <div *ngIf="activeTab === 'all'" class="tab-pane active" id="all">
          <div class="panel-group">
          </div>
        </div>

      </div>
    </div>
    <div class="col-sm-1"></div>

  </div>



<leaf-modal *ngIf="showSite" [initData]="initData"></leaf-modal>






</div>

