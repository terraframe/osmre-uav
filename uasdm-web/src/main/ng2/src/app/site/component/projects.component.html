<div id="navigator-header-container">
    <uasdm-header [title]="'Site Viewer'"></uasdm-header>
</div>

<div id="app-container" class="container-fluid">

    <div class="row">
        <div class="col-md-3 lw-inner-col" id="location-explorer-list" style="overflow: visible;">
            <form class="submit-form">
                <div class="row">
                    <div class="col-md-8">
                      <ul class="breadcrumb">
                          <li>
                            <a (click)="back(null)">UAS Sites</a>
                          </li>
                          <li *ngFor="let entity of previous; last as isLast" [ngClass]="{'active':isLast}">
                            <a *ngIf="!isLast" (click)="back(entity)"> {{entity.name}}</a>
                            <span *ngIf="isLast"> {{entity.name}}</span>
                          </li>
                      </ul>                    
                    </div>
                    <div class="col-md-4" *ngIf="admin">
                        <button (click)="handleCreate()" class="btn btn-primary create-site-btn pull-right">Create new site</button>
                        <!-- 
                        <button (click)="handleGoto()" class="btn btn-primary create-site-btn pull-right">View map image</button>
               -->

                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="location-management-widget-section">
                            <input class="form-control" type="text" placeholder="Search..." [(ngModel)]="search" [typeaheadAsync]="true" [typeahead]="dataSource" (typeaheadOnSelect)="handleClick($event)" [typeaheadOptionsLimit]="10" [typeaheadItemTemplate]="bsItemTemplate" typeaheadOptionField="label" [ngModelOptions]="{standalone: true}" (keydown.enter)="$event.preventDefault()" />
                        </div>
                    </div>
                </div>                
            </form>

            <!-- <hr> -->

            <div class="row">
                <div class="col-md-12">
                  <tabset>
                    <tab heading="Data">                
                      <div id="hierarchy-tree-container" class="location-management-widget-section location-management-list-container">
                        <div class="list-group">
                          <div  *ngFor="let node of nodes" class="list-group-item">
                            <a (click)="select(node, $event)">
                              {{node.name}}
                            </a>
                            <span *ngIf="node.type !== 'folder'" class="pull-right button-column">
                              <a class="fa fa-pencil ico-edit" (click)="handleEdit(node)" title="Edit"></a>
                              <a class="fa fa-trash-o ico-remove" (click)="handleDelete(node)" title="Delete"></a>                                   
                            </span>                                 
                            <div *ngIf="node.active" class="list-group">
                              <div  *ngFor="let child of node.children" class="list-group-item">
                                <a (click)="select(child, $event)">
                                  {{node.name}}
                                </a>
                                <span *ngIf="child.type !== 'folder'" class="pull-right button-column">
                                  <a class="fa fa-pencil ico-edit" (click)="handleEdit(child)" title="Edit"></a>
                                  <a class="fa fa-trash-o ico-remove" (click)="handleDelete(child)" title="Delete"></a>                                   
                                </span>                                 
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div *ngIf="supportingData.length > 0" class="location-management-widget-section location-management-list-container">
                        <label>Supporting Data</label>
                        <div class="list-group">
                          <div *ngFor="let node of supportingData" class="list-group-item">
                            <a (click)="select(node, $event)">
                              {{node.name}}
                            </a>
                          </div>
                        </div>
                      </div>
                    </tab>
                    <tab *ngIf="current != null" heading="Products">                
                    </tab>
                  </tabset>
                </div>
            </div>
            
            <div *ngIf="current != null" class="row">
              <div class="col-md-12">
                <button (click)="handleUploadFile()" class="btn btn-primary">Upload</button>              
              </div>
            </div>
            
        </div>
        <div class="col-md-9" id="site-explorer-map">
            <div class="row">

                <article class="base-layer-panel">
                    <accordion> 
                      <accordion-group heading="Base Maps" style="border:none;">
                        <div class="row-form" *ngFor="let baseLayer of baseLayers">
                          <input class="layer-toggle-input" type='radio' name='rtoggle' [value]='baseLayer.id' [checked]="baseLayer.selected" (change)="handleStyle(baseLayer)">
                          <label class="layer-toggle-label">{{baseLayer.label}}</label>
                        </div>
                      </accordion-group>
                    </accordion>
                </article>

                <div id="mousemove-panel" class="mapboxgl-ctrl-bottom-right" style="background: rgba(255, 255, 255, .5); right: 265px; padding: 0 5px 0 5px;"></div>

                <div *ngIf="active" class="cancel-layer-panel mapboxgl-ctrl mapboxgl-ctrl-group">
                    <button (click)="cancelDraw()" class="mapboxgl-ctrl-icon ">
                        <i class="fa fa-times-circle"></i>
                    </button>
                </div>

                <div id="map" class="map-view-port"></div>
            </div>
        </div>
    </div>
</div>

<ng-template #bsItemTemplate let-match="match" let-query="query">
  <span *ngIf="match.item.filename == null">
    <i class="fa fa-folder-open"></i>
  </span>
  <span *ngIf="match.item.filename != null">
    <i class="fa fa-file"></i>
  </span>
  <span>
    <span *ngFor="let site of match.item.hierarchy; index as i">
        {{site.label}} /
        <!-- <span *ngIf="i < (match.item.hierarchy.length -1)">/</span> -->
    </span>
  </span>
  <b>{{ match.item.label}}</b>
</ng-template>

