<uasdm-header [title]="'Site Viewer'"></uasdm-header>

<div id="app-container" class="container-fluid">

    <div class="row">
        <div class="col-md-3 lw-inner-col" id="location-explorer-list">
            <form class="submit-form">
                <div class="row">
                    <div class="location-management-widget-section">
                        <input class="form-control" type="text" placeholder="Search..." [(ngModel)]="search"
                            [typeaheadAsync]="true" [typeahead]="dataSource" (typeaheadOnSelect)="handleClick($event)"
                            [typeaheadOptionsLimit]="10" [typeaheadItemTemplate]="bsItemTemplate" typeaheadOptionField="label"
                            [ngModelOptions]="{standalone: true}" />
                    </div>
                </div>
                <div *ngIf="admin" class="row">
                    <button (click)="handleCreate()" class="btn btn-primary create-site-btn pull-right">Create new site</button>
                </div>
            </form>

            <!-- <hr> -->

            <div class="row">
                <div class="location-management-widget-section location-management-list-container">
                    <div *ngIf="nodes.length > 0" class="tree">
                        <tree-root [nodes]="nodes" [options]="options" (updateData)="handleOnUpdateData()">
                            <ng-template #treeNodeTemplate let-node let-index="index">
                                <span>{{ node.data.name }}</span> <i class="fa fa-folder" *ngIf="!isData(node)"></i>
                            </ng-template>
                        </tree-root>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-9" id="site-explorer-map">
            <div class="row">
                <aside class="base-layer-panel mapboxgl-ctrl mapboxgl-ctrl-group">
                    <span *ngFor="let baseLayer of baseLayers">
                        <input type='radio' name='rtoggle' [value]='baseLayer.id' [checked]="baseLayer.selected"
                            (change)="handleStyle(baseLayer)">
                        <label>{{baseLayer.label}}</label>
                    </span>
                </aside>
                <div id="map" class="map-view-port"></div>
            </div>
        </div>
    </div>
</div>

<ng-template #bsItemTemplate let-match="match" let-query="query">
    <span *ngIf="match.item.filename == null">
        <i class="fa fa-folder-open"></i>
    </span>
    <span *ngIf="match.item.filename != null">
        <i class="fa fa-file"></i>
    </span>

    {{ match.item.label}}

    <div class="pull-right">
        <span *ngFor="let site of match.item.hierarchy; index as i">
            {{site.label}}
            <span *ngIf="i < (match.item.hierarchy.length -1)"> / </span>
        </span>
    </div>
</ng-template>

<context-menu #nodeMenu>
    <ng-template contextMenuItem let-item [visible]="canEdit" (execute)="handleEdit($event.item)"> <i class="fa fa-edit"></i> Edit
        {{item?.data.name}} 
    </ng-template>
    <ng-template contextMenuItem let-item [visible]="isSite" (execute)="handleEditGeom($event.item)"> <i class="fa fa-globe" aria-hidden="true"></i>
        Edit geometry for {{item?.data.name}} 
    </ng-template>
    <ng-template contextMenuItem divider="true"></ng-template>
    <ng-template contextMenuItem let-item [visible]="canAddChild" (execute)="handleCreate($event.item)"> <i class="fa fa-arrow-circle-down"></i>
        Add a {{item?.data.childType.toLowerCase()}} to {{item?.data.name}} </ng-template>
    <ng-template contextMenuItem let-item [visible]="canDelete" (execute)="handleDelete($event.item)"> <i class="fa fa-trash" aria-hidden="true"></i>
        Delete {{item?.data.name}} 
    </ng-template>
</context-menu>
<context-menu #objectMenu>
    <ng-template contextMenuItem let-item (execute)="handleDownload($event.item)"> <i class="fa fa-download"
            aria-hidden="true"></i> Download {{item?.data.name}} </ng-template>
</context-menu>